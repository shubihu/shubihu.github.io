<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>å…è´¹VPNâ€”â€”WARP</title>
    <link href="/2023/09/25/%E5%85%8D%E8%B4%B9VPN%E2%80%94%E2%80%94WARP/"/>
    <url>/2023/09/25/%E5%85%8D%E8%B4%B9VPN%E2%80%94%E2%80%94WARP/</url>
    
    <content type="html"><![CDATA[<h2 id="FREE"><a href="#FREE" class="headerlink" title="FREE"></a>FREE</h2><span id="more"></span><p>è¯¦ç»†åœ°å€ï¼š<a href="https://mp.weixin.qq.com/s/2e9GZjxTBYgj3K9hlwiodw">https://mp.weixin.qq.com/s/2e9GZjxTBYgj3K9hlwiodw</a></p>]]></content>
    
    
    <categories>
      
      <category>VPN</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç§‘å­¦ä¸Šç½‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Macè‡ªåŠ¨åŒ–â€”â€”è‡ªåŠ¨ç™»é™†å…¬å…±Wi-Fi</title>
    <link href="/2023/09/15/Mac%E8%87%AA%E5%8A%A8%E5%8C%96%E2%80%94%E2%80%94%E8%87%AA%E5%8A%A8%E7%99%BB%E9%99%86%E5%85%AC%E5%85%B1Wi-Fi/"/>
    <url>/2023/09/15/Mac%E8%87%AA%E5%8A%A8%E5%8C%96%E2%80%94%E2%80%94%E8%87%AA%E5%8A%A8%E7%99%BB%E9%99%86%E5%85%AC%E5%85%B1Wi-Fi/</url>
    
    <content type="html"><![CDATA[<h2 id="é€‚ç”¨åœºæ™¯ï¼šç»å¸¸éœ€è¦ç™»é™†åŒä¸€ä¸ªå…¬å…±Wi-Fiä¸”ç”¨æˆ·åå’Œå¯†ç ä¸å˜çš„"><a href="#é€‚ç”¨åœºæ™¯ï¼šç»å¸¸éœ€è¦ç™»é™†åŒä¸€ä¸ªå…¬å…±Wi-Fiä¸”ç”¨æˆ·åå’Œå¯†ç ä¸å˜çš„" class="headerlink" title="é€‚ç”¨åœºæ™¯ï¼šç»å¸¸éœ€è¦ç™»é™†åŒä¸€ä¸ªå…¬å…±Wi-Fiä¸”ç”¨æˆ·åå’Œå¯†ç ä¸å˜çš„"></a>é€‚ç”¨åœºæ™¯ï¼šç»å¸¸éœ€è¦ç™»é™†åŒä¸€ä¸ªå…¬å…±Wi-Fiä¸”ç”¨æˆ·åå’Œå¯†ç ä¸å˜çš„</h2><span id="more"></span><p>ä¸€èˆ¬æƒ…å†µç™»é™†å…¬å…±Wi-Fiåä¼šå¼¹å‡ºä¸€ä¸ªç™»é™†ç•Œé¢ä¾›ç”¨æˆ·ç™»é™†ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç å³å¯ä¸Šç½‘ã€‚</p><p>è¿™é‡Œä»‹ç»ä¸¤ä¸ªè‡ªåŠ¨åŒ–æ–¹æ³•ã€‚è¿˜æœ‰ä¸€ä¸ªæ˜¯ä½¿ç”¨hammerspoon+lua+applescriptï¼ˆå‚è€ƒï¼š<a href="https://www.jianshu.com/p/59e1334b0a5e%EF%BC%89%E3%80%82%E6%9C%80%E5%90%8E%E8%BF%99%E4%B8%AA%E4%B8%80%E7%9C%8B%E5%B0%B1%E5%BE%88%E9%BA%BB%E7%83%A6%E3%80%82">https://www.jianshu.com/p/59e1334b0a5eï¼‰ã€‚æœ€åè¿™ä¸ªä¸€çœ‹å°±å¾ˆéº»çƒ¦ã€‚</a></p><p>è™½è¯´æ˜¯ä»‹ç»ä¸¤ä¸ªå…¶å®æ ¹æœ¬ä¸Šä¹Ÿç®—ä¸€ä¸ªå§ã€‚ä¸»è¦éƒ½æ˜¯ä½¿ç”¨è„šæœ¬è¿›è¡Œç™»é™†ã€‚åªæ˜¯æ‰§è¡Œçš„æ–¹æ³•ä¸å¤ªä¸€æ ·ã€‚</p><p>è¿™é‡Œæœ‰ä¸ªå‰æï¼Œå°±æ˜¯éœ€è¦å…³é—­Captive Network Assistantã€‚åŸå› å¦‚ä¸‹ï¼š<br>å½“Captive Network Assistantå¼¹å‡ºçš„æ—¶å€™ï¼Œç½‘ç»œä¼šè¢«æ‹¦æˆªï¼Œè¿™ä¸ªè‹±è¯­ç¿»è¯‘æˆä¸­æ–‡çš„æ„æ€å¼ºåˆ¶ç½‘ç»œåŠ©ç†ã€‚åªè¦æœ‰è¿™ä¸ªå¼¹çª—åœ¨ï¼Œç½‘ç»œéƒ½ä¼šè¢«ç»ˆæ­¢ï¼ˆæ²¡æœ‰å®é™…æ€§çš„åŸç†ï¼Œäº²æµ‹æ˜¯ç½‘ç»œè¢«æ‹¦æˆªï¼‰<br>å…³é—­æ–¹æ³•ï¼š</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">sudo defaults <span class="hljs-keyword">write</span> <span class="hljs-regexp">/Library/</span>Preferences<span class="hljs-regexp">/SystemConfiguration/</span>com.apple.captive.control Active -<span class="hljs-keyword">boolean</span> <span class="hljs-keyword">false</span><br></code></pre></td></tr></table></figure><p>å…³é—­ä¹‹åå°±æ²¡æœ‰ä»€ä¹ˆé˜»æ­¢æˆ‘ä»¬ç™»é™†äº†ã€‚</p><p>ç™»é™†è„šæœ¬ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell">wifiName=<span class="hljs-variable">$</span>(networksetup <span class="hljs-literal">-getairportnetwork</span> en0 | cut <span class="hljs-literal">-f2</span> <span class="hljs-literal">-d</span><span class="hljs-string">&#x27;:&#x27;</span>)<br><span class="hljs-comment"># echo $wifiName</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$wifiName</span> = <span class="hljs-string">&quot;xxxx&quot;</span> ]; then<br>  <span class="hljs-comment"># ä½¿ç”¨curlå‘é€ç™»é™†è¯·æ±‚</span><br>   <span class="hljs-built_in">curl</span> xxxx <br>fi<br></code></pre></td></tr></table></figure><p>ä¿å­˜åå¹¶æ·»åŠ æ‰§è¡Œæƒé™ã€‚</p><h5 id="æ–¹æ³•1-æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æ›´æ”¹ä¸Šè¿°è„šæœ¬çš„é»˜è®¤æ‰“å¼€æ–¹å¼ä¸ºç»ˆç«¯ï¼ˆå¿…é¡»æ˜¯macè‡ªå¸¦çš„ç»ˆç«¯ï¼‰"><a href="#æ–¹æ³•1-æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æ›´æ”¹ä¸Šè¿°è„šæœ¬çš„é»˜è®¤æ‰“å¼€æ–¹å¼ä¸ºç»ˆç«¯ï¼ˆå¿…é¡»æ˜¯macè‡ªå¸¦çš„ç»ˆç«¯ï¼‰" class="headerlink" title="æ–¹æ³•1: æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æ›´æ”¹ä¸Šè¿°è„šæœ¬çš„é»˜è®¤æ‰“å¼€æ–¹å¼ä¸ºç»ˆç«¯ï¼ˆå¿…é¡»æ˜¯macè‡ªå¸¦çš„ç»ˆç«¯ï¼‰"></a>æ–¹æ³•1: æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯æ›´æ”¹ä¸Šè¿°è„šæœ¬çš„é»˜è®¤æ‰“å¼€æ–¹å¼ä¸ºç»ˆç«¯ï¼ˆå¿…é¡»æ˜¯macè‡ªå¸¦çš„ç»ˆç«¯ï¼‰</h5><p>ç„¶ååœ¨ç³»ç»Ÿè®¾ç½®-é€šç”¨-ç™»é™†é¡¹é‡ŒæŠŠè¯¥è„šæœ¬æ·»åŠ åˆ°ç™»é™†æ—¶è‡ªåŠ¨æ‰“å¡ã€‚</p><p>è¿™æ ·è®¾ç½®ä¹‹åç™»é™†åä¾¿ä¼šè‡ªåŠ¨æ‰“å¼€ç»ˆç«¯æ‰§è¡Œç™»é™†è„šæœ¬äº†ã€‚ä¸è¿‡æœ‰ä¸€ç‚¹ä¸å®Œç¾çš„å°±æ˜¯ä¼šå¤šå‡ºä¸ªç»ˆç«¯çš„çª—å£ã€‚</p><p>å¦‚ä½•è®©è„šæœ¬åœ¨åå°é»˜é»˜æŠŠæ´»å¹²äº†ã€‚</p><h5 id="æ–¹æ³•2ï¼šä½¿ç”¨launchctl"><a href="#æ–¹æ³•2ï¼šä½¿ç”¨launchctl" class="headerlink" title="æ–¹æ³•2ï¼šä½¿ç”¨launchctl"></a>æ–¹æ³•2ï¼šä½¿ç”¨launchctl</h5><p>å…·ä½“æ¦‚å¿µçš„ä¸œè¥¿å¯å‚è€ƒï¼š<a href="https://www.jianshu.com/p/0886e1510bbb">https://www.jianshu.com/p/0886e1510bbb</a></p><ul><li>é¦–å…ˆåˆ›å»ºä¸€ä¸ªåç¼€ä¸º.plistçš„å±æ€§åˆ—è¡¨æ–‡ä»¶ï¼Œä¾‹å¦‚com.example.myScript.plistï¼Œå¹¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">plist</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">&quot;-//Apple//DTD PLIST 1.0//EN&quot;</span> <span class="hljs-meta-string">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plist</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;1.0&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>Label<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>com.example.myScript<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>ProgramArguments<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span><br>          # è¿™é‡Œæ¢æˆè‡ªå·±çš„è„šæœ¬<br>        <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>/path/to/your/script.sh<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span> <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>RunAtLoad<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">true</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plist</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li>å°†è¿™ä¸ªplistæ–‡ä»¶ä¿å­˜åˆ°~/Library/LaunchAgentsç›®å½•ä¸‹ï¼ˆç”¨æˆ·çº§åˆ«ï¼‰æˆ–/Library/LaunchAgentsç›®å½•ä¸‹ï¼ˆç³»ç»Ÿçº§åˆ«ï¼‰ï¼Œç„¶åæ‰§è¡Œå‘½ä»¤ï¼š<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">launchctl load ~<span class="hljs-regexp">/Library/</span>LaunchAgents/com.example.myScript.plist<br></code></pre></td></tr></table></figure>ä¸‹æ¬¡ç™»é™†å³å¯åœ¨åå°è‡ªåŠ¨ç™»é™†Wi-Fiäº†ã€‚</li></ul><p>å¦å¤–ï¼šsleepwatcherè²Œä¼¼åªèƒ½è®¾ç½®ç¡çœ å’Œå”¤é†’åæ‰§è¡Œçš„ä»»åŠ¡ï¼Œæ— æ³•åšå¼€æœºç™»é™†çš„ä»»åŠ¡ã€‚</p><p>å‚è€ƒï¼š<br><a href="https://discussionschinese.apple.com/thread/44410">https://discussionschinese.apple.com/thread/44410</a><br><a href="https://www.jianshu.com/p/0886e1510bbb">https://www.jianshu.com/p/0886e1510bbb</a><br><a href="https://www.jianshu.com/p/59e1334b0a5e">https://www.jianshu.com/p/59e1334b0a5e</a><br><a href="https://fuzhii.com/2017/10/09/Mac-sleepwatcher/">https://fuzhii.com/2017/10/09/Mac-sleepwatcher/</a><br><a href="https://zhuanlan.zhihu.com/p/388287366">https://zhuanlan.zhihu.com/p/388287366</a></p>]]></content>
    
    
    <categories>
      
      <category>Mac</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è‡ªåŠ¨åŒ–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>v2rayä¸€é”®æ­å»ºæ¢¯å­</title>
    <link href="/2023/09/01/v2ray%E4%B8%80%E9%94%AE%E6%90%AD%E5%BB%BA%E6%A2%AF%E5%AD%90/"/>
    <url>/2023/09/01/v2ray%E4%B8%80%E9%94%AE%E6%90%AD%E5%BB%BA%E6%A2%AF%E5%AD%90/</url>
    
    <content type="html"><![CDATA[<h2 id="v2ray-Qv2ray"><a href="#v2ray-Qv2ray" class="headerlink" title="v2ray, Qv2ray"></a>v2ray, Qv2ray</h2><span id="more"></span><p>ä¹‹å‰ä½¿ç”¨é…¸é…¸ä¹³ï¼Œä½†æ˜¯æ¯æ¬¡åˆ‡æ¢ä»£ç†çš„æ—¶å€™è¯»ä¼šå¼¹å‡ºé€šçŸ¥ï¼Œå…³ä¹Ÿå…³ä¸æ‰ï¼Œå°±å¾ˆçƒ¦ï¼äºæ˜¯æ”¾å¼ƒé…¸é…¸ä¹³ï¼Œæ‹¥æŠ±v2ray!</p><h4 id="æœåŠ¡ç«¯ï¼šv2rayå®‰è£…"><a href="#æœåŠ¡ç«¯ï¼šv2rayå®‰è£…" class="headerlink" title="æœåŠ¡ç«¯ï¼šv2rayå®‰è£…"></a>æœåŠ¡ç«¯ï¼šv2rayå®‰è£…</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo bash &lt;(wget -qO- -o- https:<span class="hljs-regexp">//gi</span>t.io/v2ray.sh)<br></code></pre></td></tr></table></figure><p>ä¸€é”®å®‰è£…ä¸€é”®é…ç½®ï¼Œéƒ½ä¸ç”¨è‡ªå·±é€‰æ‹©äº†ã€‚å®‰è£…å®Œåä¼šç”Ÿæˆé…ç½®ä¿¡æ¯ã€‚åŒæ—¶ä¹Ÿä¼šç”Ÿæˆä¸€ä¸ªvmessé“¾æ¥ã€‚</p><h4 id="å®¢æˆ·ç«¯ï¼šQv2ray-å®‰è£…"><a href="#å®¢æˆ·ç«¯ï¼šQv2ray-å®‰è£…" class="headerlink" title="å®¢æˆ·ç«¯ï¼šQv2ray å®‰è£…"></a>å®¢æˆ·ç«¯ï¼šQv2ray å®‰è£…</h4><p>å®˜ç½‘æä¾›çš„å®¢æˆ·ç«¯çœŸæ˜¯å¤šå½©å¤šæ ·ã€‚åœ°å€ï¼š<a href="https://www.v2ray.com/awesome/tools.html">https://www.v2ray.com/awesome/tools.html</a><br>æˆ‘å‚è€ƒçš„è¿™ç¯‡æ–‡ç« ä¸‹çš„ Qv2rayï¼Œ åœ°å€ï¼š<a href="https://v2xtls.org/v2ray-mac%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8B%E8%BD%BD/">https://v2xtls.org/v2ray-mac%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8B%E8%BD%BD/</a><br>Qv2ray mac åœ°å€ï¼š <a href="https://github.com/Qv2ray/Qv2ray/releases">https://github.com/Qv2ray/Qv2ray/releases</a><br>çœ‹è¿™ä¸ªé¡¹ç›®åœ¨githubä¸Šä¸åœ¨ç»´æŠ¤äº†ï¼ŒåæœŸä¹Ÿå¯ä»¥è¯•è¯•å®˜ç½‘æä¾›çš„å…¶ä»–è½¯ä»¶ã€‚<br>å¦å¤–éœ€è¦ä¸‹è½½ v2ray çš„æ ¸å¿ƒæ¨¡å—ï¼Œåœ°å€ï¼š<a href="https://github.com/v2ray/v2ray-core/releases">https://github.com/v2ray/v2ray-core/releases</a></p><p>ä¸‹è½½å®Œ v2ray coreä¹‹åè¦æŠŠå¯¹åº”çš„è·¯å¾„é…ç½®åˆ°Qv2rayé‡Œã€‚<br>é…ç½®æ–¹æ³•ä¸ºï¼šPreferences â€”â€”&gt; Kernel Settingsé‡Œåˆ†åˆ«é…ç½® v2ray çš„æ‰§è¡Œæ–‡ä»¶ï¼ˆä¸‹è½½åè§£å‹ç›®å½•ä¸‹çš„v2rayå¯æ‰§è¡Œæ–‡ä»¶ï¼‰ å’Œ v2ray assetsçš„ç›®å½•ï¼ˆä¸‹è½½åè§£å‹çš„ç›®å½•ï¼‰</p><p>æœ€åæŠŠæœåŠ¡å™¨ç«¯ç”Ÿæˆçš„ vmessé“¾æ¥ å¯¼å…¥å³å¯ã€‚</p><h4 id="å¼€å¯bbråŠ é€Ÿï¼ˆè™½ç„¶ä¸çŸ¥é“æœ‰æ²¡æœ‰ç”¨ï¼‰"><a href="#å¼€å¯bbråŠ é€Ÿï¼ˆè™½ç„¶ä¸çŸ¥é“æœ‰æ²¡æœ‰ç”¨ï¼‰" class="headerlink" title="å¼€å¯bbråŠ é€Ÿï¼ˆè™½ç„¶ä¸çŸ¥é“æœ‰æ²¡æœ‰ç”¨ï¼‰"></a>å¼€å¯bbråŠ é€Ÿï¼ˆè™½ç„¶ä¸çŸ¥é“æœ‰æ²¡æœ‰ç”¨ï¼‰</h4><p>å‚è€ƒï¼š<a href="https://www.linuxv2ray.com/speedup/google-tcp-bbr-one-click-script-for-v2ray/">https://www.linuxv2ray.com/speedup/google-tcp-bbr-one-click-script-for-v2ray/</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">echo <span class="hljs-string">&#x27;net.core.default_qdisc=fq&#x27;</span> | sudo tee -a <span class="hljs-regexp">/etc/</span>sysctl.conf<br>echo <span class="hljs-string">&#x27;net.ipv4.tcp_congestion_control=bbr&#x27;</span> | sudo tee -a <span class="hljs-regexp">/etc/</span>sysctl.conf<br>sysctl -p<br>sysctl net.ipv4.tcp_available_congestion_control<br><br>lsmod | grep bbr   <span class="hljs-comment"># æ£€æµ‹ BBR æ˜¯å¦å¼€å¯, è¿”å›å€¼æœ‰ tcp_bbr æ¨¡å—è¯´æ˜ BBR å·²ç»å¯åŠ¨</span><br></code></pre></td></tr></table></figure><h4 id="v2ray-å¸¸ç”¨å‘½ä»¤"><a href="#v2ray-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="v2ray å¸¸ç”¨å‘½ä»¤"></a>v2ray å¸¸ç”¨å‘½ä»¤</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">v2ray</span> <span class="hljs-literal">info</span>     <span class="hljs-comment"># æŸ¥çœ‹ V2Ray é…ç½®ä¿¡æ¯</span><br>v2ray qr       <span class="hljs-comment"># ç”Ÿæˆ V2Ray é…ç½®äºŒç»´ç é“¾æ¥</span><br>v2ray url      <span class="hljs-comment"># ç”Ÿæˆ vmess URL é“¾æ¥</span><br>v2ray help<br></code></pre></td></tr></table></figure><p>å‚è€ƒï¼š<br><a href="https://v2xtls.org/qv2ray%e4%b8%8b%e8%bd%bd%e5%8f%8a%e4%bd%bf%e7%94%a8%e6%95%99%e7%a8%8b-v2ray-windows%e5%ae%a2%e6%88%b7%e7%ab%af-%e5%90%8c%e6%97%b6%e6%94%af%e6%8c%81ss-ssr-v2ray-trojan/">https://v2xtls.org/qv2ray%e4%b8%8b%e8%bd%bd%e5%8f%8a%e4%bd%bf%e7%94%a8%e6%95%99%e7%a8%8b-v2ray-windows%e5%ae%a2%e6%88%b7%e7%ab%af-%e5%90%8c%e6%97%b6%e6%94%af%e6%8c%81ss-ssr-v2ray-trojan/</a></p>]]></content>
    
    
    <categories>
      
      <category>TroubleShoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>v2ray</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨gdbè°ƒè¯•ç¨‹åºcoredump</title>
    <link href="/2023/09/01/%E4%BD%BF%E7%94%A8gdb%E8%B0%83%E8%AF%95%E7%A8%8B%E5%BA%8Fcoredump/"/>
    <url>/2023/09/01/%E4%BD%BF%E7%94%A8gdb%E8%B0%83%E8%AF%95%E7%A8%8B%E5%BA%8Fcoredump/</url>
    
    <content type="html"><![CDATA[<h2 id="gdbè°ƒè¯•"><a href="#gdbè°ƒè¯•" class="headerlink" title="gdbè°ƒè¯•"></a>gdbè°ƒè¯•</h2><span id="more"></span><p>ä½¿ç”¨autogrid4å¤„ç†æ•°æ®çš„æ—¶å€™æŠ¥é”™ï¼Œcoredumpï¼æ ¹æ®GPTçš„æŒ‡ç¤ºè§£å†³äº†é—®é¢˜ã€‚ç®€å•è®°å½•ä¸€ä¸‹ã€‚<br>è¦ä½¿ç”¨ gdb è°ƒè¯• Autogrid4ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š</p><ul><li><p>å®‰è£… gdbï¼šç¡®ä¿åœ¨æ‚¨çš„ç³»ç»Ÿä¸Šå®‰è£…äº† gdbã€‚æ‚¨å¯ä»¥é€šè¿‡åœ¨ç»ˆç«¯ä¸­è¿è¡Œé€‚ç”¨äºæ‚¨çš„æ“ä½œç³»ç»Ÿçš„ç›¸åº”å®‰è£…å‘½ä»¤æ¥å®‰è£…å®ƒã€‚ä¾‹å¦‚ï¼Œåœ¨ Ubuntu ä¸Šï¼Œæ‚¨å¯ä»¥è¿è¡Œ sudo apt-get install gdb æ¥å®‰è£… gdbã€‚</p></li><li><p>è·å–å¯è°ƒè¯•çš„ Autogrid4 å¯æ‰§è¡Œæ–‡ä»¶ï¼šå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯æä¾›çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¯·ç¡®ä¿ä» Autodock-GPU è·å–äº†å¸¦æœ‰è°ƒè¯•ä¿¡æ¯çš„ç‰ˆæœ¬ã€‚å¦‚æœæ‚¨å¯ä»¥ç¼–è¯‘ Autogrid4ï¼Œå¯ä»¥ä½¿ç”¨é€‚å½“çš„è°ƒè¯•æ ‡å¿—ï¼ˆå¦‚ -gï¼‰æ¥ç”Ÿæˆå¸¦æœ‰è°ƒè¯•ä¿¡æ¯çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p></li><li><p>å¯åŠ¨ gdbï¼šåœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ gdb å¹¶åŠ è½½ Autogrid4 å¯æ‰§è¡Œæ–‡ä»¶ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">gdb <span class="hljs-built_in">auto</span>grid4<br></code></pre></td></tr></table></figure></li><li><p>è®¾ç½®æ–­ç‚¹ï¼šæ‚¨å¯ä»¥åœ¨ä»£ç ä¸­é€‰æ‹©è®¾ç½®æ–­ç‚¹ï¼Œä»¥åœ¨ç‰¹å®šçš„ä½ç½®ä¸­æ–­æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ break å‘½ä»¤åœ¨æŸä¸ªå‡½æ•°æˆ–ä»£ç è¡Œä¸Šè®¾ç½®æ–­ç‚¹ã€‚ä¾‹å¦‚ï¼Œè¦åœ¨ä»£ç çš„ç¬¬ 98 è¡Œè®¾ç½®æ–­ç‚¹ï¼Œå¯ä»¥è¿è¡Œï¼š(è¿™ä¸€æ­¥å¯ä»¥è·³è¿‡)</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">break</span> <span class="hljs-number">98</span><br></code></pre></td></tr></table></figure></li><li><p>è¿è¡Œç¨‹åºï¼šåœ¨ gdb æç¤ºç¬¦ä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ run å‘½ä»¤æ¥æ‰§è¡Œ Autogrid4ã€‚ä¾‹å¦‚ï¼š(åˆ°è¿™ä¸€æ­¥å°±å·²ç»æŠ¥å‡ºå¾ˆæ˜æ˜¾çš„é”™è¯¯äº†)</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">run</span> -p <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;PAIR&#125;</span>.gpf&quot;</span> -l <span class="hljs-variable">$&#123;PAIR&#125;</span><br></code></pre></td></tr></table></figure></li><li><p>è°ƒè¯•è¿‡ç¨‹ä¸­çš„å‘½ä»¤ï¼šä¸€æ—¦ç¨‹åºåœ¨æ–­ç‚¹å¤„åœæ­¢ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤å¦‚ continueï¼ˆç»§ç»­æ‰§è¡Œï¼‰ã€nextï¼ˆæ‰§è¡Œä¸‹ä¸€è¡Œï¼‰ã€printï¼ˆæ‰“å°å˜é‡å†…å®¹ï¼‰ç­‰æ¥å•æ­¥è°ƒè¯•ä»£ç ï¼Œè§‚å¯Ÿå˜é‡çš„å€¼å’Œç¨‹åºè¡Œä¸ºã€‚</p></li><li><p>åˆ†ææ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ï¼šå¦‚æœç¨‹åºå‘ç”Ÿæ ¸å¿ƒè½¬å‚¨å¹¶é€€å‡ºè°ƒè¯•æ¨¡å¼ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ gdb åˆ†ææ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚åœ¨ gdb ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥åŠ è½½æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ï¼š</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">gdb <span class="hljs-built_in">auto</span>grid4 core<br></code></pre></td></tr></table></figure></li></ul><p>è¿™äº›æ­¥éª¤å°†å¸®åŠ©æ‚¨ä½¿ç”¨ gdb è°ƒè¯• Autogrid4ã€‚è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡æŸ¥é˜… gdb çš„æ–‡æ¡£æˆ–ä½¿ç”¨ help å‘½ä»¤æ¥äº†è§£æ›´å¤š gdb çš„åŠŸèƒ½å’Œå‘½ä»¤ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Debug</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gdb</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>githubè·å–å¿…åº”æ¯æ—¥å¤§å›¾å¹¶æ¨é€åˆ°å…¶ä»–ä»“åº“</title>
    <link href="/2023/08/29/github%E8%8E%B7%E5%8F%96%E5%BF%85%E5%BA%94%E6%AF%8F%E6%97%A5%E5%A4%A7%E5%9B%BE%E5%B9%B6%E6%8E%A8%E9%80%81%E5%88%B0%E5%85%B6%E4%BB%96%E4%BB%93%E5%BA%93/"/>
    <url>/2023/08/29/github%E8%8E%B7%E5%8F%96%E5%BF%85%E5%BA%94%E6%AF%8F%E6%97%A5%E5%A4%A7%E5%9B%BE%E5%B9%B6%E6%8E%A8%E9%80%81%E5%88%B0%E5%85%B6%E4%BB%96%E4%BB%93%E5%BA%93/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><p>ä¹‹å‰åšå®¢é¦–é¡µï¼ˆè™½ç„¶å¥½ä¹…æ²¡æ›´æ–°äº†ï¼‰çš„å¿…åº”å›¾ç‰‡ç”¨çš„æ˜¯ä»–äººçš„æ¥å£ï¼Œæœ‰ä¸€å¤©çªç„¶å‘ç°é¦–é¡µé»‘äº†ï¼Œç„¶åä¸€çœ‹ï¼Œæœç„¶ï¼Œåˆ«äººçš„ä¸œè¥¿ç»ˆç©¶æ˜¯ä¸å®‰å…¨ï¼Œè¯´å¯„å°±å¯„äº†ã€‚<br>æœ€å®‰å…¨çš„åŠæ³•å°±æ˜¯è‡ªå·±å®ç°ï¼Œé™¤éæœåŠ¡å™¨å¯„äº†ã€‚è®¡åˆ’ç™½å«–githubçš„æœåŠ¡å™¨ï¼Œgithubç°å·²èƒŒé å¾®è½¯ï¼Œå¾®è½¯å¯„çš„å¯èƒ½æ€§ä¸å¤§ï¼Œæ‰€ä»¥æ”¾å®½å¿ƒä½¿ç”¨å¥½äº†ã€‚</p><h4 id="è·å–æ¯æ—¥å¿…åº”å£çº¸ï¼ˆä»£ç å¾ˆç®€å•å°±å‡ è¡Œï¼Œåæ­£ä¹Ÿæ˜¯æŠ„æ¥çš„ğŸ˜ï¼‰"><a href="#è·å–æ¯æ—¥å¿…åº”å£çº¸ï¼ˆä»£ç å¾ˆç®€å•å°±å‡ è¡Œï¼Œåæ­£ä¹Ÿæ˜¯æŠ„æ¥çš„ğŸ˜ï¼‰" class="headerlink" title="è·å–æ¯æ—¥å¿…åº”å£çº¸ï¼ˆä»£ç å¾ˆç®€å•å°±å‡ è¡Œï¼Œåæ­£ä¹Ÿæ˜¯æŠ„æ¥çš„ğŸ˜ï¼‰"></a>è·å–æ¯æ—¥å¿…åº”å£çº¸ï¼ˆä»£ç å¾ˆç®€å•å°±å‡ è¡Œï¼Œåæ­£ä¹Ÿæ˜¯æŠ„æ¥çš„ğŸ˜ï¼‰</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs stylus">import re<br>import json<br>from datetime import datetime<br>from urllib<span class="hljs-selector-class">.parse</span> import urljoin<br><br>import requests<br><br>url = <span class="hljs-string">&#x27;https://cn.bing.com&#x27;</span><br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;user-agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36&#x27;</span><br>&#125;<br><br>res = requests<span class="hljs-selector-class">.get</span>(url, headers=headers)<br>res<span class="hljs-selector-class">.encoding</span> = res<span class="hljs-selector-class">.apparent_encoding</span><br>ret = re<span class="hljs-selector-class">.search</span>(<span class="hljs-string">&quot;var _model =(\&#123;.*?\&#125;);&quot;</span>, res.text)<br><span class="hljs-keyword">if</span> ret:<br>    data = json<span class="hljs-selector-class">.loads</span>(ret<span class="hljs-selector-class">.group</span>(<span class="hljs-number">1</span>))<br>    image_content = data<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;MediaContents&#x27;</span>]</span><span class="hljs-selector-attr">[0]</span><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;ImageContent&#x27;</span>]</span><br><br>    image_url = urljoin(url, image_content<span class="hljs-selector-attr">[<span class="hljs-string">&#x27;Image&#x27;</span>]</span><span class="hljs-selector-attr">[<span class="hljs-string">&#x27;Url&#x27;</span>]</span>)<br>    r = requests<span class="hljs-selector-class">.get</span>(image_url)<br>    with open(<span class="hljs-string">&#x27;today.png&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) as f:<br>        f<span class="hljs-selector-class">.write</span>(r.<span class="hljs-attribute">content</span>)<br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨github-actionå®šæ—¶æ‰§è¡Œ"><a href="#ä½¿ç”¨github-actionå®šæ—¶æ‰§è¡Œ" class="headerlink" title="ä½¿ç”¨github actionå®šæ—¶æ‰§è¡Œ"></a>ä½¿ç”¨github actionå®šæ—¶æ‰§è¡Œ</h4><p>åœ¨GitHubä¸Šæ‰§è¡ŒActionæœ‰ä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>åˆ›å»ºä¸€ä¸ªåŒ…å«Workflowå®šä¹‰çš„YAMLæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å°†æè¿°Actionçš„è§¦å‘æ¡ä»¶ã€ä»»åŠ¡åºåˆ—å’Œæ‰§è¡Œç¯å¢ƒç­‰ä¿¡æ¯ã€‚</li><li>å°†YAMLæ–‡ä»¶ä¿å­˜åœ¨ä½ çš„ä»£ç ä»“åº“çš„<code>.github/workflows</code>ç›®å½•ä¸‹ï¼Œç¡®ä¿æ–‡ä»¶åä»¥<code>.yml</code>æˆ–<code>.yaml</code>ç»“å°¾ã€‚</li><li>æ¨é€è¿™ä¸ªæ–‡ä»¶åˆ°ä½ çš„GitHubä»“åº“ï¼Œè§¦å‘ä¸€ä¸ªç‰ˆæœ¬æ§åˆ¶æ“ä½œã€‚</li><li>GitHubä¼šè‡ªåŠ¨æ£€æµ‹åˆ°æ–°çš„Workflowæ–‡ä»¶ï¼Œå¹¶æ ¹æ®ä½ å®šä¹‰çš„è§¦å‘æ¡ä»¶å¯åŠ¨Actionè¿è¡Œã€‚</li><li>åœ¨Actionè¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒGitHubä¼šæ ¹æ®ä½ çš„å®šä¹‰ï¼Œåˆ†é…ç¬¦åˆæ¡ä»¶çš„æ‰§è¡Œç¯å¢ƒï¼Œå¹¶æ‰§è¡Œå®šä¹‰çš„ä»»åŠ¡åºåˆ—ã€‚</li><li>ä½ å¯ä»¥åœ¨GitHubçš„Actionsé¡µé¢ä¸ŠæŸ¥çœ‹Actionè¿è¡Œçš„çŠ¶æ€ã€æ—¥å¿—å’Œç»“æœã€‚<br>å¦å¤–ï¼Œä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨åœ¨GitHubä¸Šæ‰§è¡ŒActionã€‚åœ¨ä½ çš„ä»“åº“é¡µé¢ä¸Šï¼Œé€‰æ‹©â€Actionsâ€æ ‡ç­¾ï¼Œç„¶åé€‰æ‹©ä½ æƒ³è¿è¡Œçš„Actionï¼Œåœ¨Actioné¡µé¢ä¸Šç‚¹å‡»â€Run workflowâ€æŒ‰é’®æ‰‹åŠ¨è§¦å‘æ‰§è¡Œã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒGitHub Actionsçš„æ‰§è¡Œéœ€è¦æ»¡è¶³ä¸€äº›æ¡ä»¶ï¼Œå¦‚æ­£ç¡®çš„é…ç½®æ–‡ä»¶ã€æƒé™è®¾ç½®å’Œè§¦å‘æ¡ä»¶ç­‰ã€‚è¯·å‚è€ƒGitHubçš„å®˜æ–¹æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—ä»¥è·å–æ›´è¯¦ç»†çš„ä¿¡æ¯å’ŒæŒ‡å¯¼ã€‚</li></ol><p>é…ç½®æ–‡ä»¶ä¿¡æ¯å¦‚ä¸‹ï¼ˆåç§°å¯ä»¥éšæ„å–,å¦å¤–å°±æ˜¯å¿…é¡»æ”¾åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ .github/workflows/run.ymlï¼‰</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Bing</span> <span class="hljs-string">Today</span> <span class="hljs-string">Img</span><br><br><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">schedule:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">cron:</span> <span class="hljs-string">&#x27;0 21 * * *&#x27;</span>  <span class="hljs-comment"># å›½é™…æ—¶é—´ 21 ç‚¹ï¼Œä¼°è®¡åŒ—äº¬æ—¶é—´ 5ç‚¹</span><br><br><span class="hljs-comment"># on:</span><br><span class="hljs-comment">#     push:</span><br><span class="hljs-comment">#         branches: [ main ]</span><br><br><br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">build:</span><br><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br><br>    <span class="hljs-attr">steps:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">Python</span> <span class="hljs-number">3.10</span><br>      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-python@v3</span><br>      <span class="hljs-attr">with:</span><br>        <span class="hljs-attr">python-version:</span> <span class="hljs-string">&quot;3.10&quot;</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span><br>      <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br><span class="hljs-string">        python -m pip install --upgrade pip</span><br><span class="hljs-string">        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi</span><br><span class="hljs-string"></span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">run</span><br>      <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br><span class="hljs-string">        python bingTodayImg.py</span><br><span class="hljs-string"></span>    <br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">commit</span><br>      <span class="hljs-attr">run:</span> <span class="hljs-string">| </span><br><span class="hljs-string">        git config user.name github-actions</span><br><span class="hljs-string">        git config user.email github-actions@github.com</span><br><span class="hljs-string">        git add .</span><br><span class="hljs-string">        git commit -m &quot;generated&quot;</span><br><span class="hljs-string">        git push</span><br></code></pre></td></tr></table></figure><p>å¦å¤–å°±æ˜¯è¦è®¾ç½®ä¸‹github-actions botçš„æƒé™ï¼Œä¸ç„¶æ— æ³•æ¨é€ï¼ˆæ²¡æœ‰æƒé™ï¼‰ã€‚è®¾ç½®æ–¹æ³•ä¸ºï¼šåœ¨è¯¥ä»“åº“çš„Settingsä¸‹æ‰¾åˆ°Actionsï¼Œå¯¹Generalä¸‹çš„Workflow permissionsè¿›è¡Œè¯»å†™æƒé™çš„å‹¾é€‰å³å¯ã€‚</p><p>æ¯æ—¥å¿…åº”å¤§å›¾çš„æ¥å£åœ°å€ä¸ºï¼š<a href="https://raw.githubusercontent.com/shubihu/BingTodayImg/main/today.png">https://raw.githubusercontent.com/shubihu/BingTodayImg/main/today.png</a></p><h4 id="æ”¹æ¬¾"><a href="#æ”¹æ¬¾" class="headerlink" title="æ”¹æ¬¾"></a>æ”¹æ¬¾</h4><p>ä¸Šè¿°çš„æ¥å£åœ°å€å›½å†…ä¸å¤ªå¥½è®¿é—®ï¼Œæœ¬èº«åšå®¢ä¹Ÿæ˜¯åœ¨githubä¸Šéƒ¨ç½²çš„ï¼Œä¾¿æƒ³ç€ç›´æ¥æŠŠå›¾ç‰‡æ¨é€åˆ°åšå®¢çš„ä»“åº“ã€‚æ¨é€åˆ°å…¶ä»–ä»“åº“éœ€è¦æƒé™ï¼Œæƒé™è®¾ç½®æ–¹æ³•å¦‚ä¸‹ï¼š<br>token çš„ç”Ÿæˆéœ€è¦åˆ°è¿™é‡Œï¼šä¸ªäººå¤´åƒ -&gt; Settings -&gt; Developer settings -&gt; Personal access tokensï¼Œç‚¹å‡» Generate new tokenã€‚è¿™ä¸€æ­¥éœ€è¦è¾“å…¥å¯†ç ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥é€‰æ‹©æ‰€éœ€æƒé™å»ç”Ÿæˆä¸€ä¸ªtokenã€‚<br>ä¸ºäº†å®‰å…¨è€ƒè™‘ï¼Œè¿™ä¸ªtokenç”Ÿæˆä¹‹ååªä¼šå¯è§ä¸€æ¬¡ï¼Œå› ä¸ºåé¢çš„æ­¥éª¤ä¼šä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åšå¥½ä¿å­˜ã€‚<br>æ³¨æ„è¿™ä¸ª token æ˜¯ç”¨æˆ·çº§åˆ«çš„ï¼Œå®ƒå¯ä»¥ç”¨äºè®¿é—®ä¿®æ”¹è¯¥è´¦æˆ·åä¸‹çš„ä»»æ„ä»“åº“ã€‚<br>ä¸ºäº†è®© Github Action å¯ä»¥è®¿é—®åˆ°è¿™ä¸ªtokenï¼Œéœ€è¦ç»™å®ƒåšä¸€ä¸ªé…ç½®ã€‚é…ç½®è·¯å¾„æ˜¯ï¼šåœ¨è¯¥ä»“åº“ä¸‹çš„ Settingsï¼ˆæ³¨æ„è¿™ä¸ªæ˜¯ä»“åº“ä¸‹çš„è®¾ç½®è€Œéä¸ªäººä¸‹çš„è®¾ç½®ï¼‰ -&gt; Secrets -&gt; Actions ç‚¹å‡» New repository secretã€‚<br>Name çš„è¯å¯ä»¥å‘½åä¸º ACCESS_TOKENï¼ŒValue ä¸ºä¸Šä¸€æ­¥ç”Ÿæˆçš„è®¿é—® tokenã€‚è¿™é‡Œé…ç½®çš„ä»»æ„å†…å®¹éƒ½å¯ä»¥é€šè¿‡Github Action è®¿é—®åˆ°ï¼Œä¸”æ˜¯åŠ å¯†çš„ï¼Œåˆ›å»ºä¹‹ååªèƒ½çœ‹åˆ° Name çœ‹ä¸åˆ° Valueã€‚</p><p>æ”¹æ¬¾åçš„é…ç½®ä¿¡æ¯ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># This workflow will install Python dependencies, run tests and lint with a single version of Python</span><br><span class="hljs-comment"># For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-python</span><br><br><span class="hljs-attr">name:</span> <span class="hljs-string">Bing</span> <span class="hljs-string">Today</span> <span class="hljs-string">Img</span><br><br><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">schedule:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">cron:</span> <span class="hljs-string">&#x27;0 21 * * *&#x27;</span>    <span class="hljs-comment"># å›½é™…æ—¶é—´ 21 ç‚¹ï¼Œä¼°è®¡åŒ—äº¬æ—¶é—´ 5ç‚¹</span><br><br><span class="hljs-comment"># on:</span><br><span class="hljs-comment">#     push:</span><br><span class="hljs-comment">#         branches: [ main ]</span><br><br><br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">build:</span><br><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br><br>    <span class="hljs-attr">env:</span><br>          <span class="hljs-attr">ACCESS_TOKEN:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.ACCESS_TOKEN</span> <span class="hljs-string">&#125;&#125;</span><br>          <br>    <span class="hljs-attr">steps:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">Python</span> <span class="hljs-number">3.10</span><br>      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-python@v3</span><br>      <span class="hljs-attr">with:</span><br>        <span class="hljs-attr">python-version:</span> <span class="hljs-string">&quot;3.10&quot;</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span><br>      <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br><span class="hljs-string">        python -m pip install --upgrade pip</span><br><span class="hljs-string">        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi</span><br><span class="hljs-string"></span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">run</span><br>      <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br><span class="hljs-string">        python bingTodayImg.py</span><br><span class="hljs-string"></span>        <br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">commit</span><br>      <span class="hljs-attr">run:</span> <span class="hljs-string">| </span><br><span class="hljs-string">        git config user.name github-actions</span><br><span class="hljs-string">        git config user.email github-actions@github.com</span><br><span class="hljs-string">        git add today.png</span><br><span class="hljs-string">        git commit -m &quot;generated&quot;</span><br><span class="hljs-string">        git push</span><br><span class="hljs-string"></span><br>        <span class="hljs-string">git</span> <span class="hljs-string">config</span> <span class="hljs-string">--global</span> <span class="hljs-string">user.email</span> <span class="hljs-string">&quot;jrwjb@sina.com&quot;</span><br>        <span class="hljs-string">git</span> <span class="hljs-string">config</span> <span class="hljs-string">--global</span> <span class="hljs-string">user.name</span> <span class="hljs-string">&quot;shubihu&quot;</span><br>        <span class="hljs-string">git</span> <span class="hljs-string">clone</span> <span class="hljs-string">https://$&#123;ACCESS_TOKEN&#125;@github.com/shubihu/shubihu.github.io.git</span> <span class="hljs-string">repo</span><br>        <span class="hljs-string">cp</span> <span class="hljs-string">today.png</span> <span class="hljs-string">repo/</span><br>        <span class="hljs-string">cd</span> <span class="hljs-string">repo</span><br>        <span class="hljs-string">git</span> <span class="hljs-string">add</span> <span class="hljs-string">today.png</span><br>        <span class="hljs-string">git</span> <span class="hljs-string">commit</span> <span class="hljs-string">-m</span> <span class="hljs-string">&quot;Add today.png&quot;</span><br>        <span class="hljs-string">git</span> <span class="hljs-string">push</span><br></code></pre></td></tr></table></figure><p>å¦å¤–åšå®¢ä»“åº“ä¹Ÿæ·»åŠ äº†ä¸ªActionsä»»åŠ¡ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Get</span> <span class="hljs-string">Bing</span> <span class="hljs-string">Today</span> <span class="hljs-string">Img</span><br><br><span class="hljs-comment"># on:</span><br><span class="hljs-comment">#     push:</span><br><span class="hljs-comment">#         branches: [ main ]</span><br><br><span class="hljs-attr">on:</span><br>    <span class="hljs-attr">schedule:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">cron:</span> <span class="hljs-string">&#x27;0 */2 * * *&#x27;</span>  <span class="hljs-comment"># æ¯éš”ä¸¤ä¸ªå°æ—¶</span><br><br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">build:</span><br><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br><br>    <span class="hljs-attr">env:</span><br>          <span class="hljs-attr">ACCESS_TOKEN:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">secrets.ACCESS_TOKEN</span> <span class="hljs-string">&#125;&#125;</span><br>          <br>    <span class="hljs-attr">steps:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span><br><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">commit</span><br>      <span class="hljs-attr">run:</span> <span class="hljs-string">| </span><br><span class="hljs-string">        if [[ ! -f &quot;today.png&quot; ]]; then</span><br><span class="hljs-string">            git config --global user.email &quot;jrwjb@sina.com&quot;</span><br><span class="hljs-string">            git config --global user.name &quot;shubihu&quot;</span><br><span class="hljs-string">            git clone https://$&#123;ACCESS_TOKEN&#125;@github.com/shubihu/BingTodayImg.git repo</span><br><span class="hljs-string">            cp repo/today.png ./</span><br><span class="hljs-string"></span>    <br>            <span class="hljs-string">git</span> <span class="hljs-string">config</span> <span class="hljs-string">user.name</span> <span class="hljs-string">github-actions</span><br>            <span class="hljs-string">git</span> <span class="hljs-string">config</span> <span class="hljs-string">user.email</span> <span class="hljs-string">github-actions@github.com</span><br>            <span class="hljs-string">git</span> <span class="hljs-string">add</span> <span class="hljs-string">today.png</span><br>            <span class="hljs-string">git</span> <span class="hljs-string">commit</span> <span class="hljs-string">-m</span> <span class="hljs-string">&quot;generated&quot;</span><br>            <span class="hljs-string">git</span> <span class="hljs-string">push</span><br>        <span class="hljs-string">fi</span><br><br></code></pre></td></tr></table></figure><p>è¿™æ ·å°±ä¸å®Œç¾è§£å†³äº†ï¼</p><p>å‚è€ƒï¼š<br><a href="https://mp.weixin.qq.com/s/oRXqNL48wZ0IbrfmNNOTGg">https://mp.weixin.qq.com/s/oRXqNL48wZ0IbrfmNNOTGg</a><br><a href="https://github.com/mouday/wallpaper-database/tree/main">https://github.com/mouday/wallpaper-database/tree/main</a><br><a href="https://github.com/licoded/BaiduFanyi_Crawler/issues/1">https://github.com/licoded/BaiduFanyi_Crawler/issues/1</a></p>]]></content>
    
    
    <categories>
      
      <category>CI/CD</category>
      
    </categories>
    
    
    <tags>
      
      <tag>github</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¿«æ·æŒ‡ä»¤ä¸€é”®åŠ å…¥æ ¡å›­ç½‘</title>
    <link href="/2023/08/23/%E5%BF%AB%E6%8D%B7%E6%8C%87%E4%BB%A4%E4%B8%80%E9%94%AE%E5%8A%A0%E5%85%A5%E6%A0%A1%E5%9B%AD%E7%BD%91/"/>
    <url>/2023/08/23/%E5%BF%AB%E6%8D%B7%E6%8C%87%E4%BB%A4%E4%B8%80%E9%94%AE%E5%8A%A0%E5%85%A5%E6%A0%A1%E5%9B%AD%E7%BD%91/</url>
    
    <content type="html"><![CDATA[<h2 id="è‡ªåŠ¨åŒ–å†²æµª"><a href="#è‡ªåŠ¨åŒ–å†²æµª" class="headerlink" title="è‡ªåŠ¨åŒ–å†²æµª"></a>è‡ªåŠ¨åŒ–å†²æµª</h2><span id="more"></span><h4 id="å‰å¥"><a href="#å‰å¥" class="headerlink" title="å‰å¥"></a>å‰å¥</h4><p>å› ä¸ºåœ¨å­¦æ ¡åŠå…¬ï¼Œç”¨çš„ç½‘ç»œæ˜¯guestç±»å‹ï¼Œæ¯æ¬¡å†²æµªå‰å¿…é¡»å…ˆç™»é™†ï¼Œç”µè„‘ç«¯è¿˜å¥½ï¼Œéƒ½æœ‰è®°å¿†åŠŸèƒ½ï¼Œè´¦å·å¯†ç å¯ä»¥è®°ä½åªéœ€è¦ç‚¹å‡»ä¸Šç½‘å³å¯ã€‚ä½†æ˜¯æ‰‹æœºç«¯å°±æ²¡é‚£ä¹ˆæ–¹ä¾¿äº†ã€‚<br>è¿™é‡Œä½¿ç”¨å¿«æ·æŒ‡ä»¤å®ç°å¿«æ·ä¸Šç½‘ã€‚<br>é€šè¿‡æŠ“åŒ…å‘ç°ä»¥ä¸‹å‚æ•°å¯ç›´æ¥è”ç½‘ï¼ˆä»…ç”¨pythonåšä¸‹æµ‹è¯•ï¼‰ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs powershell">import requests<br>url = <span class="hljs-string">&#x27;https://wificontroller.nic.sjtu.edu.cn/portal/logon.cgi&#x27;</span><br><span class="hljs-comment"># å¤„ç†postè¯·æ±‚æºå¸¦çš„å‚æ•°(ä»æŠ“åŒ…å·¥å…·ä¸­è·å–)</span><br><span class="hljs-keyword">data</span> = &#123;<br>    <span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-number">2000</span>,<br>    <span class="hljs-string">&#x27;cmd&#x27;</span>: <span class="hljs-string">&#x27;authenticate&#x27;</span>,<br>    <span class="hljs-string">&#x27;mac&#x27;</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>    <span class="hljs-string">&#x27;ip&#x27;</span>:<span class="hljs-string">&#x27;&#x27;</span>,<br>    <span class="hljs-string">&#x27;essid&#x27;</span>:<span class="hljs-string">&#x27;&#x27;</span>,<br>    <span class="hljs-string">&#x27;url&#x27;</span>:<span class="hljs-string">&#x27;http://www.sjtu.edu.cn&#x27;</span>,<br>    <span class="hljs-string">&#x27;PtButton&#x27;</span>:<span class="hljs-string">&#x27;Logon&#x27;</span>,<br>    <span class="hljs-string">&#x27;PtUser&#x27;</span>:<span class="hljs-string">&#x27;xxxxxx&#x27;</span>,<br>    <span class="hljs-string">&#x27;PtPwd&#x27;</span>:<span class="hljs-string">&#x27;xxxxxx&#x27;</span>,<br>    <span class="hljs-string">&#x27;PtSubmit&#x27;</span>:<span class="hljs-string">&#x27;ç«‹å³ä¸Šç½‘&#x27;</span><br>&#125;<br><br><span class="hljs-comment"># è‡ªå®šä¹‰è¯·æ±‚å¤´ä¿¡æ¯ï¼Œç›¸å…³çš„å¤´ä¿¡æ¯å¿…é¡»å°è£…åœ¨å­—å…¸ç»“æ„ä¸­</span><br>headers = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36&#x27;</span>,<br>&#125;<br><br><span class="hljs-comment"># 2.å‘èµ·åŸºäºajaxçš„postè¯·æ±‚</span><br>requests.post(url=url,<span class="hljs-keyword">data</span>=<span class="hljs-keyword">data</span>,headers=headers)<br></code></pre></td></tr></table></figure><p>å…·ä½“åˆ›å»ºå¿«æ·æŒ‡ä»¤çš„æ–¹æ³•å¯å‚è€ƒï¼š<br><a href="https://mp.weixin.qq.com/s?__biz=Mzg4OTEzMDcxNw==&amp;mid=2247484113&amp;idx=1&amp;sn=6db4b38a7004e922ab8de5420b8e15b1&amp;chksm=cff1d963f8865075b5e32c84f7ca44d3cf2238bacef444e6c12b1d603f5fa0daf5c385374f03&amp;token=14643316&amp;lang=zh_CN#rd">https://mp.weixin.qq.com/s?__biz=Mzg4OTEzMDcxNw==&amp;mid=2247484113&amp;idx=1&amp;sn=6db4b38a7004e922ab8de5420b8e15b1&amp;chksm=cff1d963f8865075b5e32c84f7ca44d3cf2238bacef444e6c12b1d603f5fa0daf5c385374f03&amp;token=14643316&amp;lang=zh_CN#rd</a></p><h4 id="åç»­ï¼šåæ¥å› ä¸ºæœåŠ¡å™¨ç«¯çš„sslè¯ä¹¦é—®é¢˜ï¼Œä¸Šè¿°å¿«æ·æŒ‡ä»¤å¤±æ•ˆã€‚"><a href="#åç»­ï¼šåæ¥å› ä¸ºæœåŠ¡å™¨ç«¯çš„sslè¯ä¹¦é—®é¢˜ï¼Œä¸Šè¿°å¿«æ·æŒ‡ä»¤å¤±æ•ˆã€‚" class="headerlink" title="åç»­ï¼šåæ¥å› ä¸ºæœåŠ¡å™¨ç«¯çš„sslè¯ä¹¦é—®é¢˜ï¼Œä¸Šè¿°å¿«æ·æŒ‡ä»¤å¤±æ•ˆã€‚"></a>åç»­ï¼šåæ¥å› ä¸ºæœåŠ¡å™¨ç«¯çš„sslè¯ä¹¦é—®é¢˜ï¼Œä¸Šè¿°å¿«æ·æŒ‡ä»¤å¤±æ•ˆã€‚</h4><p>äºæ˜¯æ–°çš„æŠ˜è…¾æ–¹æ³•å…¥ä¸‹ï¼š<br>pythonæµ‹è¯•æ–¹æ³•å‡ ä¹æ²¡å˜ï¼Œåªéœ€è¦æ·»åŠ ä¸€ä¸ªssléªŒè¯ä¸ºfalseå³å¯</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs routeros">import requests<br>url = <span class="hljs-string">&#x27;https://wificontroller.nic.sjtu.edu.cn/portal/logon.cgi&#x27;</span><br><span class="hljs-comment"># å¤„ç†postè¯·æ±‚æºå¸¦çš„å‚æ•°(ä»æŠ“åŒ…å·¥å…·ä¸­è·å–)</span><br>data = &#123;<br>    <span class="hljs-string">&#x27;id&#x27;</span>: 2000,<br>    <span class="hljs-string">&#x27;cmd&#x27;</span>: <span class="hljs-string">&#x27;authenticate&#x27;</span>,<br>    <span class="hljs-string">&#x27;mac&#x27;</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>    <span class="hljs-string">&#x27;ip&#x27;</span>:<span class="hljs-string">&#x27;&#x27;</span>,<br>    <span class="hljs-string">&#x27;essid&#x27;</span>:<span class="hljs-string">&#x27;&#x27;</span>,<br>    <span class="hljs-string">&#x27;url&#x27;</span>:<span class="hljs-string">&#x27;http://www.sjtu.edu.cn&#x27;</span>,<br>    <span class="hljs-string">&#x27;PtButton&#x27;</span>:<span class="hljs-string">&#x27;Logon&#x27;</span>,<br>    <span class="hljs-string">&#x27;PtUser&#x27;</span>:<span class="hljs-string">&#x27;xxxxx&#x27;</span>,<br>    <span class="hljs-string">&#x27;PtPwd&#x27;</span>:<span class="hljs-string">&#x27;xxxx&#x27;</span>,<br>    <span class="hljs-string">&#x27;PtSubmit&#x27;</span>:<span class="hljs-string">&#x27;ç«‹å³ä¸Šç½‘&#x27;</span><br>&#125;<br><br><span class="hljs-comment"># è‡ªå®šä¹‰è¯·æ±‚å¤´ä¿¡æ¯ï¼Œç›¸å…³çš„å¤´ä¿¡æ¯å¿…é¡»å°è£…åœ¨å­—å…¸ç»“æ„ä¸­</span><br>headers = &#123;<br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>: <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36&#x27;</span>,<br>&#125;<br><br><span class="hljs-comment"># 2.å‘èµ·åŸºäºajaxçš„postè¯·æ±‚</span><br>response = requests.post(<span class="hljs-attribute">url</span>=url,data=data,headers=headers, <span class="hljs-attribute">verify</span>=<span class="hljs-literal">False</span>)<br><span class="hljs-builtin-name">print</span>(response.text)<br></code></pre></td></tr></table></figure><p>å¿«æ·æŒ‡ä»¤çš„å®ç°å€ŸåŠ©äº†ç¬¬ä¸‰æ–¹å·¥å…·iSH,å…·ä½“æ•™ç¨‹å¯ä»¥å‚è€ƒï¼š<br><a href="https://blog.csdn.net/Qmj2333333/article/details/128910249">https://blog.csdn.net/Qmj2333333/article/details/128910249</a></p><p>è¿™é‡Œå¯ä»¥ç”¨pythonè„šæœ¬è¿›è¡Œç™»é™†ä¹Ÿå¯ä»¥ä½¿ç”¨curlï¼Œcurlå‘½ä»¤å¦‚ä¸‹, ä½¿ç”¨ <code>-k</code> è®¾ç½®ç¦ç”¨ssléªŒè¯ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">curl</span> -X POST -H <span class="hljs-string">&quot;User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36&quot;</span> -d <span class="hljs-string">&quot;id=2000&amp;cmd=authenticate&amp;mac=&amp;ip=&amp;essid=&amp;url=http://www.sjtu.edu.cn&amp;PtButton=Logon&amp;PtUser=xxxx&amp;PtPwd=xxxx&amp;PtSubmit=ç«‹å³ä¸Šç½‘&quot;</span> -k <span class="hljs-string">&quot;https://wificontroller.nic.sjtu.edu.cn/portal/logon.cgi&quot;</span><br><br></code></pre></td></tr></table></figure><p>è‡³æ­¤å°±å¯ä»¥æ— éšœç¢å†²æµªäº†ï¼</p>]]></content>
    
    
    <categories>
      
      <category>å¿«æ·æŒ‡ä»¤</category>
      
    </categories>
    
    
    <tags>
      
      <tag>iphone</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>conda å®‰è£…åŒ…å†²çªè§£å†³</title>
    <link href="/2023/05/18/conda-%E5%AE%89%E8%A3%85%E5%8C%85%E5%86%B2%E7%AA%81%E8%A7%A3%E5%86%B3/"/>
    <url>/2023/05/18/conda-%E5%AE%89%E8%A3%85%E5%8C%85%E5%86%B2%E7%AA%81%E8%A7%A3%E5%86%B3/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><h4 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h4><p>ä½¿ç”¨conda installå®‰è£…åŒ…çš„æ—¶å€™é‡åˆ°ä¸‹è¿°é—®é¢˜ï¼š</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs haml">The environment is inconsistent, please check the package plan carefully<br>The following packages are causing the inconsistency:<br><br>  -<span class="ruby"> <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/mirrors.njupt.edu.cn/anaconda</span><span class="hljs-regexp">/pkgs/main</span><span class="hljs-regexp">/linux-64::notebook==6.4.12=py39h06a4308_0</span></span><br><span class="hljs-regexp"><span class="ruby"></span></span>  -<span class="ruby"><span class="hljs-regexp"> defaults/linux</span>-<span class="hljs-number">64</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:pandas=</span>=<span class="hljs-number">1.3</span>.<span class="hljs-number">5</span>=py39h8c16a72_0</span><br><span class="ruby"></span>  -<span class="ruby"> pytorch/linux-<span class="hljs-number">64</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:torchvision=</span>=<span class="hljs-number">0.13</span>.<span class="hljs-number">0</span>=py39_cu116</span><br><span class="ruby"></span>  -<span class="ruby"> conda-forge/linux-<span class="hljs-number">64</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:mamba=</span>=<span class="hljs-number">0.25</span>.<span class="hljs-number">0</span>=py39hfa8f2c8_1</span><br><span class="ruby"></span>  -<span class="ruby"> <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/mirrors.njupt.edu.cn/anaconda</span><span class="hljs-regexp">/pkgs/main</span><span class="hljs-regexp">/linux-64::jupyterlab==3.4.4=py39h06a4308_0</span></span><br><span class="hljs-regexp"><span class="ruby"></span></span>  -<span class="ruby"><span class="hljs-regexp"> conda-forge/noarch</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:jupyterhub-base=</span>=<span class="hljs-number">2.3</span>.<span class="hljs-number">1</span>=pyhd8ed1ab_0</span><br><span class="ruby"></span>  -<span class="ruby"> pytorch/linux-<span class="hljs-number">64</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:torchaudio=</span>=<span class="hljs-number">0.12</span>.<span class="hljs-number">0</span>=py39_cu116</span><br><span class="ruby"></span>  -<span class="ruby"> <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/mirrors.njupt.edu.cn/anaconda</span><span class="hljs-regexp">/pkgs/main</span><span class="hljs-regexp">/linux-64::nb_conda==2.2.1=py39h06a4308_1</span></span><br><span class="hljs-regexp"><span class="ruby"></span></span>  -<span class="ruby"><span class="hljs-regexp"> conda-forge/noarch</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:distributed=</span>=<span class="hljs-number">2022.3</span>.<span class="hljs-number">0</span>=pyhd8ed1ab_0</span><br><span class="ruby"></span>  -<span class="ruby"> conda-forge/linux-<span class="hljs-number">64</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:arrow-cpp=</span>=<span class="hljs-number">6.0</span>.<span class="hljs-number">1</span>=py39h964882e_6_cuda</span><br><span class="ruby"></span>  -<span class="ruby"> rapidsai/linux-<span class="hljs-number">64</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:libcudf=</span>=<span class="hljs-number">22.04</span>.<span class="hljs-number">00</span>=cuda11_g8bf0520170_0</span><br><span class="ruby"></span>  -<span class="ruby"> conda-forge/linux-<span class="hljs-number">64</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:pyarrow=</span>=<span class="hljs-number">6.0</span>.<span class="hljs-number">1</span>=py39h1ed2e5d_6_cuda</span><br></code></pre></td></tr></table></figure><p>ç„¶åå¯¼è‡´åŒ…æ— æ³•æ­£å¸¸å®‰è£…ã€‚ä¹‹å‰è¯•è¿‡condaå›æ»šï¼ˆå½“ç„¶æ²¡æœ‰è¯•è¿‡å›æ»šåˆ°æœ€åˆçš„çŠ¶æ€ï¼Œå³ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼‰ä¹Ÿæ²¡æœ‰è§£å†³é—®é¢˜ã€‚å½“ç„¶å¦‚æœæ‰“ç®—åºŸå¼ƒç¯å¢ƒçš„è¯å°±æ— æ‰€è°“äº†ï¼Œå¦‚æœè¿˜æƒ³æ‹¯æ•‘ä¸€ä¸‹çš„è¯å¯ä»¥è¿›è¡Œåˆ é™¤è¿™äº›åŒ…ã€‚</p><h4 id="åˆ é™¤å†²çªçš„åŒ…"><a href="#åˆ é™¤å†²çªçš„åŒ…" class="headerlink" title="åˆ é™¤å†²çªçš„åŒ…"></a>åˆ é™¤å†²çªçš„åŒ…</h4><p>å¦‚æœåªæœ‰å‡ ä¸ªå†²çªçš„è¯å¤åˆ¶ç²˜è´´å°±å¯ä»¥äº†ï¼Œå¦‚æœæ¯”è¾ƒå¤šå¯ä»¥ç”¨å‘½ä»¤è¡Œå¤„ç†ã€‚æ¯”å¦‚ä½¿ç”¨awk, å…ˆå¤åˆ¶ä¸Šé¢çš„å†…å®¹åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­packages.txt</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">awk</span> -F<span class="hljs-string">&#x27;::&#x27;</span> <span class="hljs-string">&#x27;&#123;print <span class="hljs-variable">$2</span>&#125;&#x27;</span> packages.txt | sed <span class="hljs-string">&#x27;:a;N;$!ba;s/\n/ /g&#x27;</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­â€™:a;N;$!ba;â€™å°†æ‰€æœ‰è¡Œç¼“å†²åˆ°æ¨¡å¼ç©ºé—´ä¸­ã€‚æœ€åï¼Œä½¿ç”¨â€s/\n/ /gâ€å‘½ä»¤å°†æ¯è¡Œçš„æ¢è¡Œç¬¦æ›¿æ¢ä¸ºç©ºæ ¼<br>å¤„ç†åçš„å†²çªåŒ…å¦‚ä¸‹(å³ä¸Šè¯‰æç¤ºä¿¡æ¯ä¸­<code>::</code>åé¢çš„éƒ¨åˆ†, åŒ…ä¸åŒ…ä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€)</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">notebook</span>==<span class="hljs-number">6</span>.<span class="hljs-number">4</span>.<span class="hljs-number">12</span>=py<span class="hljs-number">39</span>h<span class="hljs-number">06</span>a<span class="hljs-number">4308</span>_<span class="hljs-number">0</span> pandas==<span class="hljs-number">1</span>.<span class="hljs-number">3</span>.<span class="hljs-number">5</span>=py<span class="hljs-number">39</span>h<span class="hljs-number">8</span>c<span class="hljs-number">16</span>a<span class="hljs-number">72</span>_<span class="hljs-number">0</span> torchvision==<span class="hljs-number">0</span>.<span class="hljs-number">13</span>.<span class="hljs-number">0</span>=py<span class="hljs-number">39</span>_cu<span class="hljs-number">116</span> mamba==<span class="hljs-number">0</span>.<span class="hljs-number">25</span>.<span class="hljs-number">0</span>=py<span class="hljs-number">39</span>hfa<span class="hljs-number">8</span>f<span class="hljs-number">2</span>c<span class="hljs-number">8</span>_<span class="hljs-number">1</span> jupyterlab==<span class="hljs-number">3</span>.<span class="hljs-number">4</span>.<span class="hljs-number">4</span>=py<span class="hljs-number">39</span>h<span class="hljs-number">06</span>a<span class="hljs-number">4308</span>_<span class="hljs-number">0</span> jupyterhub-base==<span class="hljs-number">2</span>.<span class="hljs-number">3</span>.<span class="hljs-number">1</span>=pyhd<span class="hljs-number">8</span>ed<span class="hljs-number">1</span>ab_<span class="hljs-number">0</span> torchaudio==<span class="hljs-number">0</span>.<span class="hljs-number">12</span>.<span class="hljs-number">0</span>=py<span class="hljs-number">39</span>_cu<span class="hljs-number">116</span> nb_conda==<span class="hljs-number">2</span>.<span class="hljs-number">2</span>.<span class="hljs-number">1</span>=py<span class="hljs-number">39</span>h<span class="hljs-number">06</span>a<span class="hljs-number">4308</span>_<span class="hljs-number">1</span> distributed==<span class="hljs-number">2022</span>.<span class="hljs-number">3</span>.<span class="hljs-number">0</span>=pyhd<span class="hljs-number">8</span>ed<span class="hljs-number">1</span>ab_<span class="hljs-number">0</span> arrow-cpp==<span class="hljs-number">6</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>=py<span class="hljs-number">39</span>h<span class="hljs-number">964882</span>e_<span class="hljs-number">6</span>_cuda libcudf==<span class="hljs-number">22</span>.<span class="hljs-number">04</span>.<span class="hljs-number">00</span>=cuda<span class="hljs-number">11</span>_g<span class="hljs-number">8</span>bf<span class="hljs-number">0520170</span>_<span class="hljs-number">0</span> pyarrow==<span class="hljs-number">6</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>=py<span class="hljs-number">39</span>h<span class="hljs-number">1</span>ed<span class="hljs-number">2</span>e<span class="hljs-number">5</span>d_<span class="hljs-number">6</span>_cuda<br></code></pre></td></tr></table></figure><p>åˆ é™¤å‘½ä»¤ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">conda</span> remove notebook==<span class="hljs-number">6</span>.<span class="hljs-number">4</span>.<span class="hljs-number">12</span>=py<span class="hljs-number">39</span>h<span class="hljs-number">06</span>a<span class="hljs-number">4308</span>_<span class="hljs-number">0</span> pandas==<span class="hljs-number">1</span>.<span class="hljs-number">3</span>.<span class="hljs-number">5</span>=py<span class="hljs-number">39</span>h<span class="hljs-number">8</span>c<span class="hljs-number">16</span>a<span class="hljs-number">72</span>_<span class="hljs-number">0</span> torchvision==<span class="hljs-number">0</span>.<span class="hljs-number">13</span>.<span class="hljs-number">0</span>=py<span class="hljs-number">39</span>_cu<span class="hljs-number">116</span> mamba==<span class="hljs-number">0</span>.<span class="hljs-number">25</span>.<span class="hljs-number">0</span>=py<span class="hljs-number">39</span>hfa<span class="hljs-number">8</span>f<span class="hljs-number">2</span>c<span class="hljs-number">8</span>_<span class="hljs-number">1</span> jupyterlab==<span class="hljs-number">3</span>.<span class="hljs-number">4</span>.<span class="hljs-number">4</span>=py<span class="hljs-number">39</span>h<span class="hljs-number">06</span>a<span class="hljs-number">4308</span>_<span class="hljs-number">0</span> jupyterhub-base==<span class="hljs-number">2</span>.<span class="hljs-number">3</span>.<span class="hljs-number">1</span>=pyhd<span class="hljs-number">8</span>ed<span class="hljs-number">1</span>ab_<span class="hljs-number">0</span> torchaudio==<span class="hljs-number">0</span>.<span class="hljs-number">12</span>.<span class="hljs-number">0</span>=py<span class="hljs-number">39</span>_cu<span class="hljs-number">116</span> nb_conda==<span class="hljs-number">2</span>.<span class="hljs-number">2</span>.<span class="hljs-number">1</span>=py<span class="hljs-number">39</span>h<span class="hljs-number">06</span>a<span class="hljs-number">4308</span>_<span class="hljs-number">1</span> distributed==<span class="hljs-number">2022</span>.<span class="hljs-number">3</span>.<span class="hljs-number">0</span>=pyhd<span class="hljs-number">8</span>ed<span class="hljs-number">1</span>ab_<span class="hljs-number">0</span> arrow-cpp==<span class="hljs-number">6</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>=py<span class="hljs-number">39</span>h<span class="hljs-number">964882</span>e_<span class="hljs-number">6</span>_cuda libcudf==<span class="hljs-number">22</span>.<span class="hljs-number">04</span>.<span class="hljs-number">00</span>=cuda<span class="hljs-number">11</span>_g<span class="hljs-number">8</span>bf<span class="hljs-number">0520170</span>_<span class="hljs-number">0</span> pyarrow==<span class="hljs-number">6</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>=py<span class="hljs-number">39</span>h<span class="hljs-number">1</span>ed<span class="hljs-number">2</span>e<span class="hljs-number">5</span>d_<span class="hljs-number">6</span>_cuda<br></code></pre></td></tr></table></figure><p>åˆ é™¤åŒ…ä¹‹åå†æ‰§è¡Œå®‰è£…å‘½ä»¤åº”è¯¥å°±å¯ä»¥æ­£å¸¸å®‰è£…åŒ…äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>conda</category>
      
    </categories>
    
    
    <tags>
      
      <tag>conda</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŸºäºchatglm-6bçš„æœ¬åœ°çŸ¥è¯†é—®ç­”</title>
    <link href="/2023/05/08/%E5%9F%BA%E4%BA%8Echatglm-6b%E7%9A%84%E6%9C%AC%E5%9C%B0%E7%9F%A5%E8%AF%86%E9%97%AE%E7%AD%94/"/>
    <url>/2023/05/08/%E5%9F%BA%E4%BA%8Echatglm-6b%E7%9A%84%E6%9C%AC%E5%9C%B0%E7%9F%A5%E8%AF%86%E9%97%AE%E7%AD%94/</url>
    
    <content type="html"><![CDATA[<h2 id="langchain-chatglm-6b"><a href="#langchain-chatglm-6b" class="headerlink" title="langchain + chatglm-6b"></a>langchain + chatglm-6b</h2><span id="more"></span><h4 id="å¯¼åŒ…"><a href="#å¯¼åŒ…" class="headerlink" title="å¯¼åŒ…"></a>å¯¼åŒ…</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> os<br><span class="hljs-comment"># è®¾ç½®CUDA_VISIBLE_DEVICESç¯å¢ƒå˜é‡</span><br>os.environ[<span class="hljs-string">&#x27;CUDA_VISIBLE_DEVICES&#x27;</span>] = <span class="hljs-string">&#x27;0&#x27;</span><br><br><span class="hljs-keyword">from</span> llama_index <span class="hljs-keyword">import</span> StorageContext, load_index_from_storage, SimpleDirectoryReader, LangchainEmbedding, GPTListIndex, GPTVectorStoreIndex, PromptHelper, LLMPredictor, ServiceContext<br><span class="hljs-keyword">from</span> langchain.llms.base <span class="hljs-keyword">import</span> LLM<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>, <span class="hljs-type">List</span>, Mapping, <span class="hljs-type">Any</span><br><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer, AutoModel<br><span class="hljs-keyword">from</span> langchain.embeddings.huggingface <span class="hljs-keyword">import</span> HuggingFaceEmbeddings<br></code></pre></td></tr></table></figure><h4 id="åŠ è½½chatglm-6b"><a href="#åŠ è½½chatglm-6b" class="headerlink" title="åŠ è½½chatglm-6b"></a>åŠ è½½chatglm-6b</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python">tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">&quot;THUDM/chatglm-6b&quot;</span>, trust_remote_code=<span class="hljs-literal">True</span>)<br>model = AutoModel.from_pretrained(<span class="hljs-string">&quot;THUDM/chatglm-6b&quot;</span>, trust_remote_code=<span class="hljs-literal">True</span>).half().cuda()<br>model = model.<span class="hljs-built_in">eval</span>()<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ChatGLM</span>(<span class="hljs-params">LLM</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_call</span>(<span class="hljs-params">self, prompt: <span class="hljs-built_in">str</span>, stop: <span class="hljs-type">Optional</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]] = <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-built_in">str</span>:</span><br>        response, history = model.chat(tokenizer, prompt, history=[])<br>        <span class="hljs-comment"># only return newly generated tokens</span><br>        <span class="hljs-keyword">return</span> response<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_identifying_params</span>(<span class="hljs-params">self</span>) -&gt; Mapping[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:</span><br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;name_of_model&quot;</span>: <span class="hljs-string">&quot;chatglm-6b&quot;</span>&#125;<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_llm_type</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ChatGLM&quot;</span><br></code></pre></td></tr></table></figure><h4 id="åŠ è½½æœ¬åœ°çŸ¥è¯†åº“ï¼Œæ”¯æŒtxtã€pdfç­‰æ ¼å¼ï¼Œè¿™é‡Œä»¥txtä¸ºä¾‹ï¼Œå³æŠŠtxtçš„æ–‡æ¡£æ”¾åˆ°docsç›®å½•ä¸‹"><a href="#åŠ è½½æœ¬åœ°çŸ¥è¯†åº“ï¼Œæ”¯æŒtxtã€pdfç­‰æ ¼å¼ï¼Œè¿™é‡Œä»¥txtä¸ºä¾‹ï¼Œå³æŠŠtxtçš„æ–‡æ¡£æ”¾åˆ°docsç›®å½•ä¸‹" class="headerlink" title="åŠ è½½æœ¬åœ°çŸ¥è¯†åº“ï¼Œæ”¯æŒtxtã€pdfç­‰æ ¼å¼ï¼Œè¿™é‡Œä»¥txtä¸ºä¾‹ï¼Œå³æŠŠtxtçš„æ–‡æ¡£æ”¾åˆ°docsç›®å½•ä¸‹"></a>åŠ è½½æœ¬åœ°çŸ¥è¯†åº“ï¼Œæ”¯æŒtxtã€pdfç­‰æ ¼å¼ï¼Œè¿™é‡Œä»¥txtä¸ºä¾‹ï¼Œå³æŠŠtxtçš„æ–‡æ¡£æ”¾åˆ°docsç›®å½•ä¸‹</h4><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">directory_path</span> = <span class="hljs-string">&quot;./docs&quot;</span><br><br><span class="hljs-attr">max_input_size</span> = <span class="hljs-number">4096</span><br><span class="hljs-attr">num_outputs</span> = <span class="hljs-number">2000</span><br><span class="hljs-attr">max_chunk_overlap</span> = <span class="hljs-number">20</span><br><span class="hljs-attr">chunk_size_limit</span> = <span class="hljs-number">600</span><br><span class="hljs-attr">prompt_helper</span> = PromptHelper(max_input_size, num_outputs, max_chunk_overlap, chunk_size_limit=chunk_size_limit)<br><span class="hljs-attr">documents</span> = SimpleDirectoryReader(directory_path).load_data()<br></code></pre></td></tr></table></figure><h4 id="åŠ è½½embeddingæ¨¡å‹-è¿™é‡ŒåŠ è½½é»˜è®¤çš„huggingface-embedding-sentence-transformers-all-mpnet-base-v2"><a href="#åŠ è½½embeddingæ¨¡å‹-è¿™é‡ŒåŠ è½½é»˜è®¤çš„huggingface-embedding-sentence-transformers-all-mpnet-base-v2" class="headerlink" title="åŠ è½½embeddingæ¨¡å‹, è¿™é‡ŒåŠ è½½é»˜è®¤çš„huggingface embedding(sentence-transformers/all-mpnet-base-v2)"></a>åŠ è½½embeddingæ¨¡å‹, è¿™é‡ŒåŠ è½½é»˜è®¤çš„huggingface embedding(sentence-transformers/all-mpnet-base-v2)</h4><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">embed_model</span> = <span class="hljs-function"><span class="hljs-title">LangchainEmbedding</span>(<span class="hljs-title">HuggingFaceEmbeddings</span>())</span><br><span class="hljs-variable">llm_predictor</span> = <span class="hljs-function"><span class="hljs-title">LLMPredictor</span>(<span class="hljs-variable">llm</span>=<span class="hljs-title">ChatGLM</span>())</span><br></code></pre></td></tr></table></figure><h4 id="æœ¬åœ°çŸ¥è¯†å‘é‡åŒ–å­˜å‚¨-é»˜è®¤å­˜å‚¨åœ¨-storage"><a href="#æœ¬åœ°çŸ¥è¯†å‘é‡åŒ–å­˜å‚¨-é»˜è®¤å­˜å‚¨åœ¨-storage" class="headerlink" title="æœ¬åœ°çŸ¥è¯†å‘é‡åŒ–å­˜å‚¨, é»˜è®¤å­˜å‚¨åœ¨ ./storage"></a>æœ¬åœ°çŸ¥è¯†å‘é‡åŒ–å­˜å‚¨, é»˜è®¤å­˜å‚¨åœ¨ <code>./storage</code></h4><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">service_context = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ServiceContext</span>.</span></span>from<span class="hljs-constructor">_defaults(<span class="hljs-params">embed_model</span>=<span class="hljs-params">embed_model</span>, <span class="hljs-params">llm_predictor</span>=<span class="hljs-params">llm_predictor</span>)</span><br>index = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">GPTVectorStoreIndex</span>.</span></span>from<span class="hljs-constructor">_documents(<span class="hljs-params">documents</span>,<span class="hljs-params">service_context</span>=<span class="hljs-params">service_context</span>)</span><br>index.storage_context.persist<span class="hljs-literal">()</span><br></code></pre></td></tr></table></figure><h4 id="åŠ è½½æœ¬åœ°çŸ¥è¯†å‘é‡å¹¶æé—®"><a href="#åŠ è½½æœ¬åœ°çŸ¥è¯†å‘é‡å¹¶æé—®" class="headerlink" title="åŠ è½½æœ¬åœ°çŸ¥è¯†å‘é‡å¹¶æé—®"></a>åŠ è½½æœ¬åœ°çŸ¥è¯†å‘é‡å¹¶æé—®</h4><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">storage_context = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">StorageContext</span>.</span></span>from<span class="hljs-constructor">_defaults(<span class="hljs-params">persist_dir</span>=&#x27;.<span class="hljs-operator">/</span><span class="hljs-params">storage</span>&#x27;)</span><br>index = load<span class="hljs-constructor">_index_from_storage(<span class="hljs-params">storage_context</span>, <span class="hljs-params">service_context</span>=<span class="hljs-params">service_context</span>)</span><br>query_engine = index.<span class="hljs-keyword">as</span><span class="hljs-constructor">_query_engine()</span><br>response = query_engine.query(<span class="hljs-string">&quot;&lt;What are the diseases associated with macrophage&gt;?&quot;</span>)<br>print(response.response)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>AI</category>
      
    </categories>
    
    
    <tags>
      
      <tag>chatglm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GPUå•å¡å¤šè¿›ç¨‹</title>
    <link href="/2023/04/26/GPU%E5%8D%95%E5%8D%A1%E5%A4%9A%E8%BF%9B%E7%A8%8B/"/>
    <url>/2023/04/26/GPU%E5%8D%95%E5%8D%A1%E5%A4%9A%E8%BF%9B%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><p>è¿™é‡Œåˆ©ç”¨äº†æ¸…åå¼€æºçš„chatglm-6bæ¨¡å‹å¯¹pubmedä¸Šçš„æ–‡çŒ®æ‘˜è¦è¿›è¡Œæ€»ç»“å¼æ¦‚æ‹¬ã€‚<br>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs routeros">import os<br>import re<br><span class="hljs-comment"># è®¾ç½®CUDA_VISIBLE_DEVICESç¯å¢ƒå˜é‡</span><br>os.environ[<span class="hljs-string">&#x27;CUDA_VISIBLE_DEVICES&#x27;</span>] = <span class="hljs-string">&#x27;2&#x27;</span><br><span class="hljs-keyword">from</span> functools import partial<br><span class="hljs-keyword">from</span> transformers import AutoTokenizer, AutoModel<br>import pandas as pd<br>import torch<br><span class="hljs-keyword">from</span> torch.multiprocessing import<span class="hljs-built_in"> Pool</span><br><span class="hljs-built_in"></span><span class="hljs-keyword">from</span> tqdm import tqdm<br>import summarize<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    torch.multiprocessing.set_start_method(<span class="hljs-string">&#x27;spawn&#x27;</span>)<br>    df = pd.read_excel(<span class="hljs-string">&#x27;/data/database/pubmed/macrophage_disease.xlsx&#x27;</span>)<br>    <span class="hljs-builtin-name">print</span>(df.shape)<br>    tokenizer = AutoTokenizer.from_pretrained(<span class="hljs-string">&quot;THUDM/chatglm-6b&quot;</span>, <span class="hljs-attribute">trust_remote_code</span>=<span class="hljs-literal">True</span>)<br>    model = AutoModel.from_pretrained(<span class="hljs-string">&quot;THUDM/chatglm-6b&quot;</span>, <span class="hljs-attribute">trust_remote_code</span>=<span class="hljs-literal">True</span>).half().cuda()<br>    model = model.eval()<br><br>    partial_process_data = partial(summarize.summarize_abstract, <span class="hljs-attribute">tokenizer</span>=tokenizer, <span class="hljs-attribute">model</span>=model)<br><br>    summary_ls = []<br>    with Pool(<span class="hljs-attribute">processes</span>=4) as pool:<br>        <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> tqdm(pool.imap(partial_process_data, df[<span class="hljs-string">&#x27;abstract&#x27;</span>]), <span class="hljs-attribute">total</span>=len(df[<span class="hljs-string">&#x27;abstract&#x27;</span>])):<br>            summary_ls.append(r)<br><br>    df[<span class="hljs-string">&#x27;summmary&#x27;</span>] = summary_ls<br>    <br>    df.to_csv(<span class="hljs-string">&#x27;pubmed_summary.txt&#x27;</span>, <span class="hljs-attribute">index</span>=<span class="hljs-literal">False</span>, <span class="hljs-attribute">sep</span>=<span class="hljs-string">&#x27;\t&#x27;</span>)<br></code></pre></td></tr></table></figure><p>å¦å¤–summarize.pyä»£ç å¦‚ä¸‹, summarize_abstractå‡½æ•°å¿…é¡»å†™åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function">def <span class="hljs-title">summarize_abstract</span>(<span class="hljs-params"><span class="hljs-keyword">abstract</span>, tokenizer, model</span>):</span><br><span class="hljs-function">        </span><br><span class="hljs-function">    # Remove non-alphanumeric characters <span class="hljs-keyword">and</span> extra whitespace</span><br><span class="hljs-function">    # <span class="hljs-keyword">abstract</span></span> = re.sub(r<span class="hljs-string">&#x27;[^a-zA-Z0-9\s]&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-keyword">abstract</span>).strip()<br>    prompt = f<span class="hljs-string">&quot;è¯·ç”¨ä¸€å¥è¯æ€»ç»“ä»¥ä¸‹æ‘˜è¦å¹¶ä¸”æ€»ç»“ä¸­å¿…é¡»è¦åŒ…å«macrophageå’Œç›¸å…³çš„ç–¾ç—…,å­—æ•°æ§åˆ¶åœ¨50ä»¥å†…:&#123;abstract&#125;&quot;</span><br>    response, history = model.chat(tokenizer, prompt, history=[])<br>    <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/junjunzai123/article/details/126286131">https://blog.csdn.net/junjunzai123/article/details/126286131</a></p>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å•å¡ã€å¤šè¿›ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonè¿œç¨‹è¿‡ç¨‹è°ƒç”¨RPCå°ä¾‹å­</title>
    <link href="/2023/03/17/%E8%BF%9C%E7%A8%8B%E8%BF%87%E7%A8%8B%E8%B0%83%E7%94%A8RPC%E5%B0%8F%E4%BE%8B%E5%AD%90/"/>
    <url>/2023/03/17/%E8%BF%9C%E7%A8%8B%E8%BF%87%E7%A8%8B%E8%B0%83%E7%94%A8RPC%E5%B0%8F%E4%BE%8B%E5%AD%90/</url>
    
    <content type="html"><![CDATA[<h2 id="RPC-demo"><a href="#RPC-demo" class="headerlink" title="RPC demo"></a>RPC demo</h2><span id="more"></span><h4 id="åœ¨BæœåŠ¡å™¨ä¸Šè¿è¡ŒRPCæœåŠ¡"><a href="#åœ¨BæœåŠ¡å™¨ä¸Šè¿è¡ŒRPCæœåŠ¡" class="headerlink" title="åœ¨BæœåŠ¡å™¨ä¸Šè¿è¡ŒRPCæœåŠ¡"></a>åœ¨BæœåŠ¡å™¨ä¸Šè¿è¡ŒRPCæœåŠ¡</h4><ul><li>æœåŠ¡ç«¯server.pyä»£ç ï¼š<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># server.py</span><br><span class="hljs-keyword">import</span> Pyro4<br><br><span class="hljs-meta">@Pyro4.expose</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyServer</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">do_something</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello from server&quot;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    daemon = Pyro4.Daemon(port=<span class="hljs-number">35721</span>)<br>    uri = daemon.register(MyServer, objectId=<span class="hljs-string">&quot;helloworld&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Ready. Object uri =&quot;</span>, uri)<br>    daemon.requestLoop()<br></code></pre></td></tr></table></figure></li><li>æ‰§è¡Œç¨‹åº<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> server.<span class="hljs-keyword">py</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="åœ¨AæœåŠ¡å™¨ä¸Šè¿è¡ŒRPCå®¢æˆ·ç«¯"><a href="#åœ¨AæœåŠ¡å™¨ä¸Šè¿è¡ŒRPCå®¢æˆ·ç«¯" class="headerlink" title="åœ¨AæœåŠ¡å™¨ä¸Šè¿è¡ŒRPCå®¢æˆ·ç«¯"></a>åœ¨AæœåŠ¡å™¨ä¸Šè¿è¡ŒRPCå®¢æˆ·ç«¯</h4><ul><li>å®¢æˆ·ç«¯client.pyä»£ç <figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-meta"># client.py</span><br>import Pyro4<br><br><span class="hljs-meta"># è¾“å…¥server ç«¯çš„uri</span><br><span class="hljs-keyword">server</span> = Pyro4.Proxy(<span class="hljs-string">&quot;PYRO:helloworld@localhost:35721&quot;</span>)<br><br>result = <span class="hljs-keyword">server</span>.do_something()<br><span class="hljs-keyword">print</span>(result)<br></code></pre></td></tr></table></figure></li><li>æ‰§è¡Œç¨‹åº<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> client.<span class="hljs-keyword">py</span><br></code></pre></td></tr></table></figure>æ­£å¸¸è¾“å‡ºï¼šhello from server</li></ul><h4 id="å…¶ä»–æ–¹æ³•ï¼ˆç”±chatgptç”Ÿæˆ"><a href="#å…¶ä»–æ–¹æ³•ï¼ˆç”±chatgptç”Ÿæˆ" class="headerlink" title="å…¶ä»–æ–¹æ³•ï¼ˆç”±chatgptç”Ÿæˆ)"></a>å…¶ä»–æ–¹æ³•ï¼ˆç”±chatgptç”Ÿæˆ)</h4><ul><li><p>ä½¿ç”¨socketé€šä¿¡ï¼šå¯ä»¥åœ¨AæœåŠ¡å™¨ä¸Šç¼–å†™ä¸€ä¸ªPythonç¨‹åºï¼Œå®ƒå°†é€šè¿‡socketè¿æ¥åˆ°BæœåŠ¡å™¨ï¼Œå¹¶å‘é€éœ€è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ŒBæœåŠ¡å™¨å°†æ¥æ”¶å¹¶æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™AæœåŠ¡å™¨ã€‚</p></li><li><p>ä½¿ç”¨è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰ï¼šå¯ä»¥ä½¿ç”¨Pythonçš„RPCåº“ï¼Œå¦‚Pyroæˆ–RPC4Djangoï¼Œä»¥ç¼–å†™AæœåŠ¡å™¨ä¸Šçš„Pythonç¨‹åºï¼Œå®ƒå°†è°ƒç”¨BæœåŠ¡å™¨ä¸Šçš„Pythonç¨‹åºã€‚</p></li><li><p>ä½¿ç”¨WebæœåŠ¡ï¼šå¯ä»¥åœ¨BæœåŠ¡å™¨ä¸Šç¼–å†™ä¸€ä¸ªPython WebæœåŠ¡ï¼Œä½¿ç”¨Flaskã€Djangoç­‰Webæ¡†æ¶ï¼Œä»¥æ¥æ”¶æ¥è‡ªAæœåŠ¡å™¨çš„HTTPè¯·æ±‚ï¼Œå¹¶è¿”å›ç»“æœã€‚åœ¨AæœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥ä½¿ç”¨Pythonçš„requestsåº“æˆ–ç±»ä¼¼çš„HTTPå®¢æˆ·ç«¯åº“å‘é€HTTPè¯·æ±‚å¹¶è·å–ç»“æœã€‚</p></li><li><p>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼šå¯ä»¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚RabbitMQæˆ–Apache Kafkaï¼Œä»¥åœ¨AæœåŠ¡å™¨å’ŒBæœåŠ¡å™¨ä¹‹é—´ä¼ é€’æ¶ˆæ¯ã€‚åœ¨AæœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥ä½¿ç”¨Pythonçš„pikaæˆ–kafka-pythonåº“å‘é€æ¶ˆæ¯ï¼Œè€Œåœ¨BæœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ç›¸åº”çš„åº“æ¥æ¥æ”¶å’Œå¤„ç†æ¶ˆæ¯ã€‚</p></li></ul><h5 id="ä½¿ç”¨socketé€šä¿¡"><a href="#ä½¿ç”¨socketé€šä¿¡" class="headerlink" title="ä½¿ç”¨socketé€šä¿¡"></a>ä½¿ç”¨socketé€šä¿¡</h5><ul><li>AæœåŠ¡å™¨ä¸Šçš„Pythonç¨‹åºï¼š<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">import <span class="hljs-built_in">socket</span><br><br>HOST = <span class="hljs-string">&#x27;BæœåŠ¡å™¨IPåœ°å€&#x27;</span><br>PORT = BæœåŠ¡å™¨ç›‘å¬çš„ç«¯å£å·<br><br><span class="hljs-comment"># å»ºç«‹socketè¿æ¥</span><br>s = <span class="hljs-built_in">socket</span>.<span class="hljs-built_in">socket</span>(<span class="hljs-built_in">socket</span>.AF_INET, <span class="hljs-built_in">socket</span>.SOCK_STREAM)<br>s.connect((HOST, PORT))<br><br><span class="hljs-comment"># å‘é€å‘½ä»¤åˆ°BæœåŠ¡å™¨</span><br>cmd = <span class="hljs-string">&#x27;python /path/to/python/program.py&#x27;</span><br>s.sendall(cmd.encode())<br><br><span class="hljs-comment"># è·å–BæœåŠ¡å™¨è¿”å›çš„ç»“æœ</span><br>data = s.recv(<span class="hljs-number">1024</span>)<br>print(<span class="hljs-string">&#x27;Received:&#x27;</span>, data.decode())<br><br><span class="hljs-comment"># å…³é—­è¿æ¥</span><br>s.<span class="hljs-built_in">close</span>()<br><br></code></pre></td></tr></table></figure></li><li>BæœåŠ¡å™¨ä¸Šçš„Pythonç¨‹åºï¼š<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">import subprocess<br><br><span class="hljs-keyword">while</span> True:<br>    <span class="hljs-comment"># ç›‘å¬ç«¯å£</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">socket</span>.<span class="hljs-built_in">socket</span>(<span class="hljs-built_in">socket</span>.AF_INET, <span class="hljs-built_in">socket</span>.SOCK_STREAM) <span class="hljs-keyword">as</span> s:<br>        s.bind((HOST, PORT))<br>        s.listen()<br>        conn, addr = s.accept()<br><br>        <span class="hljs-comment"># æ¥æ”¶æ¥è‡ªAæœåŠ¡å™¨çš„å‘½ä»¤</span><br>        cmd = conn.recv(<span class="hljs-number">1024</span>).decode()<br><br>        <span class="hljs-comment"># æ‰§è¡Œå‘½ä»¤å¹¶è¿”å›ç»“æœ</span><br>        <span class="hljs-built_in">result</span> = subprocess.run(cmd, <span class="hljs-built_in">shell</span>=True, capture_output=True)<br>        conn.sendall(<span class="hljs-built_in">result</span>.<span class="hljs-keyword">stdout</span>)<br><br></code></pre></td></tr></table></figure></li></ul><h5 id="ä½¿ç”¨WebæœåŠ¡"><a href="#ä½¿ç”¨WebæœåŠ¡" class="headerlink" title="ä½¿ç”¨WebæœåŠ¡"></a>ä½¿ç”¨WebæœåŠ¡</h5><ul><li>åœ¨BæœåŠ¡å™¨ä¸Šä½¿ç”¨Flaskæ¡†æ¶åˆ›å»ºWebæœåŠ¡ï¼š<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># app.py</span><br><span class="hljs-keyword">from</span> flask import Flask<br><br>app = Flask(__name__)<br><br>@app.route(<span class="hljs-string">&#x27;/do_something&#x27;</span>)<br>def do_something():<br>    return <span class="hljs-string">&quot;hello from server&quot;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.<span class="hljs-builtin-name">run</span>(<span class="hljs-attribute">host</span>=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, <span class="hljs-attribute">port</span>=5000)<br><br></code></pre></td></tr></table></figure></li><li>åœ¨AæœåŠ¡å™¨ä¸Šä½¿ç”¨requestsåº“å‘é€HTTPè¯·æ±‚ï¼š<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&#x27;BæœåŠ¡å™¨IPåœ°å€:5000/do_something&#x27;</span><br>response = requests.<span class="hljs-built_in">get</span>(url)<br><br><span class="hljs-built_in">print</span>(response.<span class="hljs-built_in">text</span>)<br><br></code></pre></td></tr></table></figure></li></ul><h5 id="ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—"><a href="#ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—"></a>ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—</h5><ul><li>åœ¨AæœåŠ¡å™¨ä¸Šä½¿ç”¨pikaåº“å‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼š<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs routeros">import pika<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">connection </span>= pika.BlockingConnection(pika.ConnectionParameters(<span class="hljs-string">&#x27;localhost&#x27;</span>))<br>channel = connection.channel()<br><br>channel.queue_declare(<span class="hljs-attribute">queue</span>=<span class="hljs-string">&#x27;task_queue&#x27;</span>, <span class="hljs-attribute">durable</span>=<span class="hljs-literal">True</span>)<br><br>message = <span class="hljs-string">&#x27;python /path/to/python/program.py&#x27;</span><br>channel.basic_publish(<span class="hljs-attribute">exchange</span>=<span class="hljs-string">&#x27;&#x27;</span>,<br>                      <span class="hljs-attribute">routing_key</span>=<span class="hljs-string">&#x27;task_queue&#x27;</span>,<br>                      <span class="hljs-attribute">body</span>=message,<br>                      <span class="hljs-attribute">properties</span>=pika.BasicProperties(<br>                          <span class="hljs-attribute">delivery_mode</span>=2,  # make message persistent<br>                      ))<br><br><span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot; [x] Sent %r&quot;</span> % message)<br>connection.close()<br><br></code></pre></td></tr></table></figure></li><li>åœ¨BæœåŠ¡å™¨ä¸Šä½¿ç”¨pikaåº“æ¥æ”¶æ¶ˆæ¯å¹¶å¤„ç†ï¼š<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> pika<br><span class="hljs-keyword">import</span> subprocess<br><br><span class="hljs-keyword">connection</span> = pika.BlockingConnection(pika.ConnectionParameters(<span class="hljs-string">&#x27;localhost&#x27;</span>))<br>channel = <span class="hljs-keyword">connection</span>.channel()<br><br>channel.queue_declare(queue=<span class="hljs-string">&#x27;task_queue&#x27;</span>,<br><br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RPC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dockeræ‰“åŒ…pythoné¡¹ç›®è¸©å‘</title>
    <link href="/2023/03/15/Docker%E6%89%93%E5%8C%85python%E9%A1%B9%E7%9B%AE%E8%B8%A9%E5%9D%91/"/>
    <url>/2023/03/15/Docker%E6%89%93%E5%8C%85python%E9%A1%B9%E7%9B%AE%E8%B8%A9%E5%9D%91/</url>
    
    <content type="html"><![CDATA[<h2 id="Dockerè¸©å‘"><a href="#Dockerè¸©å‘" class="headerlink" title="Dockerè¸©å‘"></a>Dockerè¸©å‘</h2><span id="more"></span><h4 id="æŠ¥é”™ä¿¡æ¯"><a href="#æŠ¥é”™ä¿¡æ¯" class="headerlink" title="æŠ¥é”™ä¿¡æ¯"></a>æŠ¥é”™ä¿¡æ¯</h4><p>ERROR: No .egg-info directory found in /tmp/pip-pip-egg-info-lsnfgjec</p><ul><li>requirements.txtä¿¡æ¯å¦‚ä¸‹<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">colorama</span>==<span class="hljs-number">0</span>.<span class="hljs-number">4</span>.<span class="hljs-number">4</span><br><span class="hljs-attribute">Flask</span>==<span class="hljs-number">2</span>.<span class="hljs-number">1</span>.<span class="hljs-number">3</span><br><span class="hljs-attribute">Flask_Cors</span>==<span class="hljs-number">3</span>.<span class="hljs-number">0</span>.<span class="hljs-number">10</span><br><span class="hljs-attribute">Flask_Executor</span>==<span class="hljs-number">1</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">Flask_SocketIO</span>==<span class="hljs-number">5</span>.<span class="hljs-number">3</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">numpy</span>==<span class="hljs-number">1</span>.<span class="hljs-number">22</span>.<span class="hljs-number">4</span><br><span class="hljs-attribute">pandas</span>==<span class="hljs-number">1</span>.<span class="hljs-number">3</span>.<span class="hljs-number">5</span><br><span class="hljs-attribute">ProDy</span>==<span class="hljs-number">2</span>.<span class="hljs-number">3</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">redis</span>==<span class="hljs-number">3</span>.<span class="hljs-number">5</span>.<span class="hljs-number">3</span><br><span class="hljs-attribute">toml</span>==<span class="hljs-number">0</span>.<span class="hljs-number">10</span>.<span class="hljs-number">2</span><br><span class="hljs-attribute">ulid</span>==<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">ulid_py</span>==<span class="hljs-number">1</span>.<span class="hljs-number">1</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">Werkzeug</span>==<span class="hljs-number">2</span>.<span class="hljs-number">2</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">yagmail</span>==<span class="hljs-number">0</span>.<span class="hljs-number">15</span>.<span class="hljs-number">293</span><br></code></pre></td></tr></table></figure></li><li>Dockerfileä¿¡æ¯å¦‚ä¸‹<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> python:<span class="hljs-number">3.9</span>-slim<br><br><span class="hljs-keyword">WORKDIR</span><span class="bash"> /frontend</span><br><span class="hljs-keyword">COPY</span><span class="bash"> requirements.txt requirements.txt</span><br><br><span class="hljs-comment">#RUN python -m pip install --quiet --upgrade pip -i https://pypi.tuna.tsinghua.edu.cn/simple --trusted-host pypi.tuna.tsinghua.edu.cn</span><br><span class="hljs-keyword">RUN</span><span class="bash"> python -m pip install -r requirements.txt</span><br><br><span class="hljs-keyword">ADD</span><span class="bash"> . .</span><br><br><span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">&quot;python&quot;</span>, <span class="hljs-string">&quot;fapp.py&quot;</span>]</span><br></code></pre></td></tr></table></figure>åœ¨ä»¥ä¸Šä¸¤ä¸ªæ–‡ä»¶çš„åŸºç¡€ä¸‹buildé•œåƒ<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">docker <span class="hljs-keyword">build </span>-t frontend:<span class="hljs-built_in">v1</span> .<br></code></pre></td></tr></table></figure>æˆåŠŸï¼Œï¼Œï¼ŒæŠ¥é”™ã€‚ç½‘ä¸Šæ‰’äº†å¥½å¤šä¿¡æ¯å¤§éƒ¨åˆ†è¯´æ˜¯pipç‰ˆæœ¬è¾ƒä½éœ€è¦å‡çº§ç­‰ç­‰ï¼Œæµ‹è¯•äº†å¥½å¤šæ¬¡ï¼Œä¾ç„¶æŠ¥é”™ã€‚ä¸è¿‡buildçš„æ—¶å€™å‘ç°ä¸€ç›´å¡åœ¨ProDyè¿™ä¸ªæ¨¡å—ï¼Œäºæ˜¯æƒ³ç€å°±å•ç‹¬å®‰è£…è¿™ä¸€ä¸ªæ¨¡å—è¯•è¯•ã€‚åœ¨å„ç§å°è¯•ä¸‹å‘ç°æ˜¯ProDyæ¨¡å—çš„ç‰ˆæœ¬é—®é¢˜ï¼ŒçœŸçš„æ˜¯å·¨å‘ã€‚</li></ul><h4 id="æˆåŠŸç¼–è¯‘"><a href="#æˆåŠŸç¼–è¯‘" class="headerlink" title="æˆåŠŸç¼–è¯‘"></a>æˆåŠŸç¼–è¯‘</h4><ul><li>requirements.txtä¿¡æ¯å¦‚ä¸‹<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">colorama</span>==<span class="hljs-number">0</span>.<span class="hljs-number">4</span>.<span class="hljs-number">4</span><br><span class="hljs-attribute">Flask</span>==<span class="hljs-number">2</span>.<span class="hljs-number">1</span>.<span class="hljs-number">3</span><br><span class="hljs-attribute">Flask_Cors</span>==<span class="hljs-number">3</span>.<span class="hljs-number">0</span>.<span class="hljs-number">10</span><br><span class="hljs-attribute">Flask_Executor</span>==<span class="hljs-number">1</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">Flask_SocketIO</span>==<span class="hljs-number">5</span>.<span class="hljs-number">3</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">numpy</span>==<span class="hljs-number">1</span>.<span class="hljs-number">22</span>.<span class="hljs-number">4</span><br><span class="hljs-attribute">pandas</span>==<span class="hljs-number">1</span>.<span class="hljs-number">3</span>.<span class="hljs-number">5</span><br><span class="hljs-attribute">ProDy</span>==<span class="hljs-number">2</span>.<span class="hljs-number">4</span>.<span class="hljs-number">0</span>           # å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬<br><span class="hljs-attribute">redis</span>==<span class="hljs-number">3</span>.<span class="hljs-number">5</span>.<span class="hljs-number">3</span><br><span class="hljs-attribute">toml</span>==<span class="hljs-number">0</span>.<span class="hljs-number">10</span>.<span class="hljs-number">2</span><br><span class="hljs-attribute">ulid</span>==<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">ulid_py</span>==<span class="hljs-number">1</span>.<span class="hljs-number">1</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">Werkzeug</span>==<span class="hljs-number">2</span>.<span class="hljs-number">2</span>.<span class="hljs-number">0</span><br><span class="hljs-attribute">yagmail</span>==<span class="hljs-number">0</span>.<span class="hljs-number">15</span>.<span class="hljs-number">293</span><br></code></pre></td></tr></table></figure></li><li>Dockerfileä¿¡æ¯å¦‚ä¸‹<figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs hsp">FROM python:<span class="hljs-number">3.9</span>-slim<br><br>WORKDIR /frontend<br>COPY requirements.txt requirements.txt<br><br><span class="hljs-keyword">RUN</span> apt update &amp;&amp; \<br>    apt install -y gcc g++<br><br><span class="hljs-meta">#RUN python -m pip install --quiet --upgrade pip -i https:<span class="hljs-comment">//pypi.tuna.tsinghua.edu.cn/simple --trusted-host pypi.tuna.tsinghua.edu.cn</span></span><br><span class="hljs-keyword">RUN</span> python -m pip install -r requirements.txt -i https:<span class="hljs-comment">//pypi.tuna.tsinghua.edu.cn/simple --trusted-host pypi.tuna.tsinghua.edu.cn</span><br><br><span class="hljs-meta">#ADD . .</span><br>COPY . .<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">CMD</span> [<span class="hljs-meta-string">&quot;python&quot;</span>, <span class="hljs-meta-string">&quot;fapp.py&quot;</span>]</span><br>ENTRYPOINT [<span class="hljs-string">&quot;python&quot;</span>, <span class="hljs-string">&quot;fapp.py&quot;</span>] <span class="hljs-meta"># ENTRYPOINT æŒ‡å®šäº†å®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ï¼Œè€Œ <span class="hljs-meta-keyword">CMD</span> åˆ™æ˜¯æŒ‡å®šè¿è¡Œè¿™ä¸ªå‘½ä»¤æ—¶çš„é»˜è®¤å‚æ•°ã€‚é»˜è®¤å‚æ•°å¯é€šè¿‡docker runå‘½ä»¤åçš„å‚æ•°æ¥è¦†ç›–å®ƒ</span><br></code></pre></td></tr></table></figure>åœ¨ä»¥ä¸Šä¸¤ä¸ªæ–‡ä»¶çš„åŸºç¡€ä¸‹buildé•œåƒï¼Œæµ‹è¯•ä¸­å‘ç°å®‰è£…prodyéœ€è¦gccå’Œg++<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">docker <span class="hljs-keyword">build </span>-t frontend:<span class="hljs-built_in">v1</span> .<br></code></pre></td></tr></table></figure></li></ul><h4 id="è¿è¡Œå®¹å™¨"><a href="#è¿è¡Œå®¹å™¨" class="headerlink" title="è¿è¡Œå®¹å™¨"></a>è¿è¡Œå®¹å™¨</h4><ul><li>è·å–é•œåƒçš„è¯¦ç»†ä¿¡æ¯<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">docker <span class="hljs-keyword">inspect</span> é•œåƒIDå·<br></code></pre></td></tr></table></figure></li><li>äº¤äº’å¼è¿è¡Œ<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run -it -p <span class="hljs-number">5001</span>:<span class="hljs-number">5001</span> frontend:v<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li><li>äº¤äº’å¼è¿›å…¥é•œåƒ<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run -it -p <span class="hljs-number">5001</span>:<span class="hljs-number">5001</span> frontend:v<span class="hljs-number">1</span> bash<br></code></pre></td></tr></table></figure></li><li>åˆ†ç¦»æ¨¡å¼ä¸‹è¿è¡Œ docker å®¹å™¨<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> run -d -p <span class="hljs-number">5001</span>:<span class="hljs-number">5001</span> --name saas frontend:v<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></li><li>æŸ¥çœ‹è¿è¡Œå®¹å™¨çš„ip<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> inspect a<span class="hljs-number">7</span>a<span class="hljs-number">17666</span>fdd<span class="hljs-number">9</span> | grep -i ipaddress      # inspectåä¸ºå®¹å™¨idæˆ–å®¹å™¨name<br></code></pre></td></tr></table></figure></li><li>è¿›å…¥å·²ç»è¿è¡Œçš„å®¹å™¨<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">docker</span> exec -it a<span class="hljs-number">7</span>a<span class="hljs-number">17666</span>fdd<span class="hljs-number">9</span> bash        # å‚æ•° -it åä¸ºå®¹å™¨id, å¦å¤–ä½¿ç”¨attachä¹Ÿå¯è¿›å…¥ï¼Œä¸è¿‡exitçš„æ—¶å€™å®¹å™¨ä¼šåœæ­¢ï¼Œè€Œexecä¸ä¼š<br></code></pre></td></tr></table></figure></li><li>æŒ‚è½½æ•°æ®å·,è‹¥æ·»åŠ å¤šä¸ªæ•°æ®å·,ç»§ç»­æ·»åŠ  -v å‚æ•°å³å¯<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">docker run -it -p <span class="hljs-number">5001</span>:<span class="hljs-number">5001</span> --net=host --name saas -v <span class="hljs-regexp">/share/</span>saas<span class="hljs-regexp">/frontend:/</span>frontend frontend:v1<br></code></pre></td></tr></table></figure></li></ul><h4 id="å®¹å™¨è¿æ¥å®¿ä¸»æœºredis"><a href="#å®¹å™¨è¿æ¥å®¿ä¸»æœºredis" class="headerlink" title="å®¹å™¨è¿æ¥å®¿ä¸»æœºredis"></a>å®¹å™¨è¿æ¥å®¿ä¸»æœºredis</h4><p>Dockerå¯åŠ¨å®¹å™¨çš„ç½‘ç»œæ¨¡å¼å¦‚ä¸‹</p><ul><li>Host : å®¹å™¨å°†ä¸ä¼šè™šæ‹Ÿå‡ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„IPç­‰ï¼Œè€Œæ˜¯ä½¿ç”¨å®¿ä¸»æœºçš„IPå’Œç«¯å£</li><li>Container : åˆ›å»ºçš„å®¹å™¨ä¸ä¼šåˆ›å»ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„IPï¼Œè€Œæ˜¯å’Œä¸€ä¸ªæŒ‡å®šçš„å®¹å™¨å…±äº«IPã€ç«¯å£èŒƒå›´</li><li>None : è¯¥æ¨¡å¼å…³é—­äº†å®¹å™¨çš„ç½‘ç»œåŠŸèƒ½</li><li>Bridge : é»˜è®¤ä¸ºè¯¥æ¨¡å¼ï¼Œæ­¤æ¨¡å¼ä¼šä¸ºæ¯ä¸€ä¸ªå®¹å™¨åˆ†é…ã€è®¾ç½®IPç­‰ï¼Œå¹¶å°†å®¹å™¨è¿æ¥åˆ°ä¸€ä¸ªdocker0è™šæ‹Ÿç½‘æ¡¥ï¼Œé€šè¿‡docker0ç½‘æ¡¥ä»¥åŠiptables natè¡¨é…ç½®ä¸å®¿ä¸»æœºé€šä¿¡<br>ä½¿ç”¨hostæ¨¡å¼å¯åŠ¨å®¹å™¨ï¼Œä»¥æ–¹ä¾¿è¿æ¥å®¿ä¸»æœºredisæœåŠ¡<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">docker <span class="hljs-builtin-name">run</span> -d -p 5001:5001 <span class="hljs-attribute">--net</span>=host --name saas frontend:v1<br></code></pre></td></tr></table></figure></li></ul><h4 id="dockerå¸¸ç”¨å‘½ä»¤"><a href="#dockerå¸¸ç”¨å‘½ä»¤" class="headerlink" title="dockerå¸¸ç”¨å‘½ä»¤"></a>dockerå¸¸ç”¨å‘½ä»¤</h4><ul><li>åˆ—å‡ºæ‰€æœ‰å®¹å™¨IDï¼ŒåŒ…æ‹¬åœæ­¢çš„<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">docker ps -aq</span><br></code></pre></td></tr></table></figure></li><li>åœæ­¢æ‰€æœ‰çš„container<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">docker stop <span class="hljs-constructor">$(<span class="hljs-params">docker</span> <span class="hljs-params">ps</span> -<span class="hljs-params">aq</span>)</span><br></code></pre></td></tr></table></figure></li><li>åˆ é™¤æ‰€æœ‰container<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">docker rm <span class="hljs-constructor">$(<span class="hljs-params">docker</span> <span class="hljs-params">ps</span> -<span class="hljs-params">aq</span>)</span><br></code></pre></td></tr></table></figure></li><li>åˆ é™¤tagä¸ºnoneçš„é•œåƒ<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">docker rmi <span class="hljs-constructor">$(<span class="hljs-params">docker</span> <span class="hljs-params">images</span> | <span class="hljs-params">grep</span> <span class="hljs-string">&quot;^&lt;none&gt;&quot;</span> | <span class="hljs-params">awk</span> <span class="hljs-string">&quot;&#123;print $3&#125;&quot;</span>)</span><br></code></pre></td></tr></table></figure></li><li>å°†é•œåƒä¿å­˜ä¸ºæœ¬åœ°æ–‡ä»¶<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs fortran">docker <span class="hljs-keyword">save</span> -o å­˜å‚¨æ–‡ä»¶å é•œåƒIDå·<br></code></pre></td></tr></table></figure></li><li>æ¢å¤é•œåƒ<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">docker load -<span class="hljs-selector-tag">i</span> å­˜å‚¨æ–‡ä»¶å<br></code></pre></td></tr></table></figure></li></ul><h4 id="å¸¸ç”¨-Dockerfile-æ“ä½œæŒ‡ä»¤"><a href="#å¸¸ç”¨-Dockerfile-æ“ä½œæŒ‡ä»¤" class="headerlink" title="å¸¸ç”¨ Dockerfile æ“ä½œæŒ‡ä»¤"></a>å¸¸ç”¨ Dockerfile æ“ä½œæŒ‡ä»¤</h4><ul><li>ARGâ€”â€” å®šä¹‰åˆ›å»ºé•œåƒè¿‡ç¨‹ä¸­ä½¿ç”¨çš„å˜é‡ ï¼Œå”¯ä¸€ä¸€ä¸ªå¯ä»¥åœ¨ FROM ä¹‹å‰å®šä¹‰ ã€‚</li><li>FROMâ€”â€”åŸºäºæŸä¸ªé•œåƒï¼Œ FROMå‰é¢åªèƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªARGæŒ‡ä»¤ ã€‚</li><li>MAINTAINERï¼ˆå·²å¼ƒç”¨ï¼‰ â€”â€” é•œåƒç»´æŠ¤è€…å§“åæˆ–é‚®ç®±åœ°å€ ã€‚</li><li>VOLUME â€”â€” æŒ‡å®šå®¹å™¨æŒ‚è½½ç‚¹åˆ°å®¿ä¸»æœºè‡ªåŠ¨ç”Ÿæˆçš„ç›®å½•æˆ–å…¶ä»–å®¹å™¨</li><li>RUNâ€”â€”æ‰§è¡Œé•œåƒé‡Œçš„å‘½ä»¤ï¼Œè·Ÿåœ¨ liunx æ‰§è¡Œå‘½ä»¤ä¸€æ ·ï¼Œåªéœ€è¦åœ¨å‰é¢åŠ ä¸Š RUN å…³é”®è¯å°±è¡Œã€‚</li><li>COPYâ€”â€”å¤åˆ¶æœ¬åœ°ï¼ˆå®¿ä¸»æœºï¼‰ä¸Šçš„æ–‡ä»¶åˆ°é•œåƒã€‚</li><li>ADDâ€”â€”å¤åˆ¶å¹¶è§£å‹ï¼ˆå®¿ä¸»æœºï¼‰ä¸Šçš„å‹ç¼©æ–‡ä»¶åˆ°é•œåƒã€‚</li><li>ENVâ€”â€”è®¾ç½®ç¯å¢ƒå˜é‡ã€‚</li><li>WORKDIR â€”â€” ä¸º RUNã€CMDã€ENTRYPOINTã€COPY å’Œ ADD è®¾ç½®å·¥ä½œç›®å½•ï¼Œå°±æ˜¯åˆ‡æ¢ç›®å½• ã€‚</li><li>USER â€”â€” ä¸º RUNã€CMDã€å’Œ ENTRYPOINT æ‰§è¡Œå‘½ä»¤æŒ‡å®šè¿è¡Œç”¨æˆ·ã€‚</li><li>EXPOSE â€”â€” å£°æ˜å®¹å™¨çš„æœåŠ¡ç«¯å£ï¼ˆä»…ä»…æ˜¯å£°æ˜ï¼‰ ã€‚</li><li>CMDâ€”â€” å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤ ï¼Œå¤šä¸ª CMD åªä¼šæ‰§è¡Œæœ€åä¸€ä¸ªï¼Œè·Ÿ ENTRYPOINT çš„åŒºåˆ«æ˜¯ï¼ŒCMD å¯ä»¥ä½œä¸º ENTRYPOINT çš„å‚æ•°ï¼Œä¸”ä¼šè¢« yaml æ–‡ä»¶é‡Œçš„ command è¦†ç›–ã€‚</li><li>ENTRYPOINTâ€”â€” å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤ ï¼Œå¤šä¸ªåªä¼šæ‰§è¡Œæœ€åä¸€ä¸ªã€‚</li><li>HEALTHCHECH â€”â€” å¥åº·æ£€æŸ¥ ã€‚</li><li>ONBUILDâ€”â€”å®ƒåé¢è·Ÿçš„æ˜¯å…¶å®ƒæŒ‡ä»¤ï¼Œæ¯”å¦‚ RUN, COPY ç­‰ï¼Œè€Œè¿™äº›æŒ‡ä»¤ï¼Œåœ¨å½“å‰é•œåƒæ„å»ºæ—¶å¹¶ä¸ä¼šè¢«æ‰§è¡Œã€‚åªæœ‰å½“ä»¥å½“å‰é•œåƒä¸ºåŸºç¡€é•œåƒï¼Œå»æ„å»ºä¸‹ä¸€çº§é•œåƒçš„æ—¶å€™æ‰ä¼šè¢«æ‰§è¡Œã€‚</li><li>LABELâ€”â€”LABEL æŒ‡ä»¤ç”¨æ¥ç»™é•œåƒæ·»åŠ ä¸€äº›å…ƒæ•°æ®ï¼ˆmetadataï¼‰ï¼Œä»¥é”®å€¼å¯¹çš„å½¢å¼ ï¼Œæ›¿æ¢ MAINTAINERã€‚</li></ul><p>å‚è€ƒï¼š<br>    <a href="https://mp.weixin.qq.com/s/fDBvrQl3P5wT9nP-hpQfcA">https://mp.weixin.qq.com/s/fDBvrQl3P5wT9nP-hpQfcA</a><br>    <a href="https://zhuanlan.zhihu.com/p/430989391">https://zhuanlan.zhihu.com/p/430989391</a><br>    <a href="https://www.cnblogs.com/orion-orion/p/16268011.html">https://www.cnblogs.com/orion-orion/p/16268011.html</a><br>    <a href="http://www.xiaomaidong.com/?p=1148">http://www.xiaomaidong.com/?p=1148</a><br>    <a href="https://mp.weixin.qq.com/s/jA3VZG068FlMGJbesj_MWA">https://mp.weixin.qq.com/s/jA3VZG068FlMGJbesj_MWA</a></p>]]></content>
    
    
    <categories>
      
      <category>TroubleShoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>centos7å®‰è£…openbabelè¸©å‘</title>
    <link href="/2023/03/14/centos7%E5%AE%89%E8%A3%85openbabel%E8%B8%A9%E5%9D%91/"/>
    <url>/2023/03/14/centos7%E5%AE%89%E8%A3%85openbabel%E8%B8%A9%E5%9D%91/</url>
    
    <content type="html"><![CDATA[<h2 id="openbabelè¸©å‘"><a href="#openbabelè¸©å‘" class="headerlink" title="openbabelè¸©å‘"></a>openbabelè¸©å‘</h2><span id="more"></span><h4 id="æºç å®‰è£…æŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š"><a href="#æºç å®‰è£…æŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š" class="headerlink" title="æºç å®‰è£…æŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š"></a>æºç å®‰è£…æŠ¥é”™ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</h4><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs vbnet">CMakeFiles/xtcformat.dir/xtcformat.cpp.o: <span class="hljs-keyword">In</span> <span class="hljs-keyword">function</span> `OpenBabel::XTCFormat::xdropen(XDR*, <span class="hljs-type">char</span> <span class="hljs-keyword">const</span>*, <span class="hljs-type">char</span> <span class="hljs-keyword">const</span>*)<span class="hljs-comment">&#x27;:</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>xd2): undefined reference <span class="hljs-keyword">to</span> `xdrstdio_create<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x11b): undefined reference <span class="hljs-keyword">to</span> `xdrstdio_create<span class="hljs-comment">&#x27;</span><br>CMakeFiles/xtcformat.dir/xtcformat.cpp.o: <span class="hljs-keyword">In</span> <span class="hljs-keyword">function</span> `OpenBabel::XTCFormat::xdr3dfcoord(XDR*, float*, int*, float*)<span class="hljs-comment">&#x27;:</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x888): undefined reference <span class="hljs-keyword">to</span> `xdr_int<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x8e6): undefined reference <span class="hljs-keyword">to</span> `xdr_float<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x951): undefined reference <span class="hljs-keyword">to</span> `xdr_int<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x961): undefined reference <span class="hljs-keyword">to</span> `xdr_int<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x971): undefined reference <span class="hljs-keyword">to</span> `xdr_int<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x981): undefined reference <span class="hljs-keyword">to</span> `xdr_int<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x991): undefined reference <span class="hljs-keyword">to</span> `xdr_int<span class="hljs-comment">&#x27;</span><br>CMakeFiles/xtcformat.dir/xtcformat.cpp.o:xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x9a1): more undefined references <span class="hljs-keyword">to</span> `xdr_int<span class="hljs-comment">&#x27; follow</span><br>CMakeFiles/xtcformat.dir/xtcformat.cpp.o: <span class="hljs-keyword">In</span> <span class="hljs-keyword">function</span> `OpenBabel::XTCFormat::xdr3dfcoord(XDR*, float*, int*, float*)<span class="hljs-comment">&#x27;:</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>xab7): undefined reference <span class="hljs-keyword">to</span> `xdr_opaque<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>xd33): undefined reference <span class="hljs-keyword">to</span> `xdr_int<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>xd5e): undefined reference <span class="hljs-keyword">to</span> `xdr_float<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>xd93): undefined reference <span class="hljs-keyword">to</span> `xdr_float<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>xd98): undefined reference <span class="hljs-keyword">to</span> `xdr_vector<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>xdb2): undefined reference <span class="hljs-keyword">to</span> `xdr_float<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x10ea): undefined reference <span class="hljs-keyword">to</span> `xdr_int<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x10fa): undefined reference <span class="hljs-keyword">to</span> `xdr_int<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x110a): undefined reference <span class="hljs-keyword">to</span> `xdr_int<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x111a): undefined reference <span class="hljs-keyword">to</span> `xdr_int<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x112a): undefined reference <span class="hljs-keyword">to</span> `xdr_int<span class="hljs-comment">&#x27;</span><br>CMakeFiles/xtcformat.dir/xtcformat.cpp.o:xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x113a): more undefined references <span class="hljs-keyword">to</span> `xdr_int<span class="hljs-comment">&#x27; follow</span><br>CMakeFiles/xtcformat.dir/xtcformat.cpp.o: <span class="hljs-keyword">In</span> <span class="hljs-keyword">function</span> `OpenBabel::XTCFormat::xdr3dfcoord(XDR*, float*, int*, float*)<span class="hljs-comment">&#x27;:</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x1b0c): undefined reference <span class="hljs-keyword">to</span> `xdr_opaque<span class="hljs-comment">&#x27;</span><br>CMakeFiles/xtcformat.dir/xtcformat.cpp.o: <span class="hljs-keyword">In</span> <span class="hljs-keyword">function</span> `OpenBabel::XTCFormat::ReadMolecule(OpenBabel::OBBase*, OpenBabel::OBConversion*)<span class="hljs-comment">&#x27;:</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x1d67): undefined reference <span class="hljs-keyword">to</span> `xdr_int<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x1d80): undefined reference <span class="hljs-keyword">to</span> `xdr_int<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x1da4): undefined reference <span class="hljs-keyword">to</span> `xdr_int<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x1db4): undefined reference <span class="hljs-keyword">to</span> `xdr_float<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x1dc4): undefined reference <span class="hljs-keyword">to</span> `xdr_float<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x1dd4): undefined reference <span class="hljs-keyword">to</span> `xdr_float<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x1de4): undefined reference <span class="hljs-keyword">to</span> `xdr_float<span class="hljs-comment">&#x27;</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x1df4): undefined reference <span class="hljs-keyword">to</span> `xdr_float<span class="hljs-comment">&#x27;</span><br>CMakeFiles/xtcformat.dir/xtcformat.cpp.o:xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>x1e04): more undefined references <span class="hljs-keyword">to</span> `xdr_float<span class="hljs-comment">&#x27; follow</span><br>CMakeFiles/xtcformat.dir/xtcformat.cpp.o: <span class="hljs-keyword">In</span> <span class="hljs-keyword">function</span> `OpenBabel::XTCFormat::xdr3dfcoord(XDR*, float*, int*, float*)<span class="hljs-comment">&#x27;:</span><br>xtcformat.cpp:(.<span class="hljs-keyword">text</span>+<span class="hljs-number">0</span>xd74): undefined reference <span class="hljs-keyword">to</span> `xdr_vector<span class="hljs-comment">&#x27;</span><br><span class="hljs-symbol">collect2:</span> <span class="hljs-keyword">error</span>: ld returned <span class="hljs-number">1</span> <span class="hljs-keyword">exit</span> status<br>make[<span class="hljs-number">2</span>]: *** [src/formats/CMakeFiles/xtcformat.dir/build.make:<span class="hljs-number">105</span>: <span class="hljs-keyword">lib</span>/xtcformat.so] <span class="hljs-keyword">Error</span> <span class="hljs-number">1</span><br>make[<span class="hljs-number">1</span>]: *** [CMakeFiles/Makefile2:<span class="hljs-number">4523</span>: src/formats/CMakeFiles/xtcformat.dir/all] <span class="hljs-keyword">Error</span> <span class="hljs-number">2</span><br>make[<span class="hljs-number">1</span>]: *** Waiting <span class="hljs-keyword">for</span> unfinished jobs....<br></code></pre></td></tr></table></figure><p>æ²¡æ‰¾åˆ°è§£å†³æ–¹æ³•ã€‚é‚æ”¾å¼ƒã€‚</p><h4 id="conda-å®‰è£…"><a href="#conda-å®‰è£…" class="headerlink" title="conda å®‰è£…"></a>conda å®‰è£…</h4><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">conda <span class="hljs-keyword">install</span> -y -c conda-forge openbabel<br></code></pre></td></tr></table></figure><p>å®‰è£…è¿˜æŒºå¿«ã€‚æ¥ä¸‹æ¥ç»‘å®špython<br>ä»pypiä¸Šä¸‹è½½openbabelçš„æºç åŒ…ï¼ˆpip installç›´æ¥å®‰è£…ä¼šæŠ¥é”™ï¼‰ï¼Œä¸‹è½½åœ°å€<a href="https://pypi.org/project/openbabel/#files">https://pypi.org/project/openbabel/#files</a><br>è§£å‹åå®‰è£…å‘½ä»¤å¦‚ä¸‹</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">cd openbabel-<span class="hljs-number">3.1</span>.<span class="hljs-number">1.1</span><br><span class="hljs-comment"># -I æŒ‡å®šcondaå®‰è£…openbabelçš„includeçš„è·¯å¾„ï¼Œ-L æŒ‡å®šcondaå®‰è£…openbabelçš„libçš„è·¯å¾„</span><br>python setup.py build_ext -I<span class="hljs-variable">$CURR_DIR</span><span class="hljs-regexp">/envs/</span>Sdocking<span class="hljs-regexp">/include/</span>openbabel3<span class="hljs-regexp">/ -L$CURR_DIR/</span>envs<span class="hljs-regexp">/Sdocking/</span>lib<span class="hljs-regexp">/openbabel/</span><span class="hljs-number">3.1</span>.<span class="hljs-number">0</span><br><span class="hljs-comment"># --prefixæŒ‡å®šå®‰è£…è·¯å¾„ï¼Œæœ€å¥½æŒ‡å®šä¸‹ï¼Œé»˜è®¤ä¼šå®‰è£…åˆ°å½“å‰ç›®å½•ï¼Œåç»­æ‰§è¡Œ import openbabelçš„æ—¶å€™ä¼šæŠ¥é”™æ‰¾ä¸åˆ°</span><br>python setup.py install --prefix=<span class="hljs-variable">$CURR_DIR</span><span class="hljs-regexp">/envs/</span>Sdocking<span class="hljs-regexp">/lib/</span>python3.<span class="hljs-number">7</span>/site-packages<br></code></pre></td></tr></table></figure><p>å®‰è£…å®Œç¡®è®¤æ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-title">python</span> -c &#x27;<span class="hljs-keyword">import</span> openbabel&#x27;<br></code></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_32115939/article/details/120031684">https://blog.csdn.net/qq_32115939/article/details/120031684</a></p>]]></content>
    
    
    <categories>
      
      <category>TroubleShoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>centos7</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>C++éƒ¨ç½²pytorchæ¨¡å‹ä¾‹å­</title>
    <link href="/2023/03/08/C++%E9%83%A8%E7%BD%B2pytorch%E6%A8%A1%E5%9E%8B/"/>
    <url>/2023/03/08/C++%E9%83%A8%E7%BD%B2pytorch%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><h4 id="æ­¥éª¤1ï¼šå°†PyTorchæ¨¡å‹è½¬æ¢ä¸ºTorchè„šæœ¬"><a href="#æ­¥éª¤1ï¼šå°†PyTorchæ¨¡å‹è½¬æ¢ä¸ºTorchè„šæœ¬" class="headerlink" title="æ­¥éª¤1ï¼šå°†PyTorchæ¨¡å‹è½¬æ¢ä¸ºTorchè„šæœ¬"></a>æ­¥éª¤1ï¼šå°†PyTorchæ¨¡å‹è½¬æ¢ä¸ºTorchè„šæœ¬</h4><p>æœ‰ä¸¤ç§å°†PyTorchæ¨¡å‹è½¬æ¢ä¸ºTorchè„šæœ¬çš„æ–¹æ³•ã€‚ç¬¬ä¸€ç§ç§°ä¸ºè·Ÿè¸ªï¼Œä¸€ç§æœºåˆ¶ï¼Œå…¶ä¸­é€šè¿‡ä½¿ç”¨ç¤ºä¾‹è¾“å…¥å¯¹æ¨¡å‹çš„ç»“æ„è¿›è¡Œä¸€æ¬¡è¯„ä¼°ï¼Œå¹¶è®°å½•è¿™äº› è¾“å…¥åœ¨æ¨¡å‹ä¸­çš„æµé‡ï¼Œä»è€Œæ•è·æ¨¡å‹çš„ç»“æ„ã€‚è¿™é€‚ç”¨äºæœ‰é™ä½¿ç”¨æ§åˆ¶æµçš„æ¨¡å‹ã€‚ç¬¬äºŒç§æ–¹æ³•æ˜¯åœ¨æ¨¡å‹ä¸­æ·»åŠ æ˜¾å¼æ‰¹æ³¨ï¼Œä»¥å‘ŠçŸ¥Torch Scriptç¼– è¯‘å™¨å¯ä»¥æ ¹æ®Torch Scriptè¯­è¨€æ–½åŠ çš„çº¦æŸç›´æ¥è§£æå’Œç¼–è¯‘æ¨¡å‹ä»£ç ã€‚<br>è¿™é‡Œä»¥ç¬¬äºŒç§ä¸ºä¾‹ï¼š</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-keyword">import</span> torch<br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-type">MyModule</span>(<span class="hljs-title">torch</span>.<span class="hljs-title">nn</span>.<span class="hljs-type">Module</span>):</span><br><span class="hljs-class">    def __init__(<span class="hljs-title">self</span>, <span class="hljs-type">N</span>, <span class="hljs-type">M</span>):</span><br><span class="hljs-class">        super(<span class="hljs-type">MyModule</span>, <span class="hljs-title">self</span>).__init__()</span><br><span class="hljs-class">        self.weight = torch.nn.<span class="hljs-type">Parameter</span>(<span class="hljs-title">torch</span>.<span class="hljs-title">rand</span>(<span class="hljs-type">N</span>, <span class="hljs-type">M</span>))</span><br><span class="hljs-class"></span><br><span class="hljs-class">    def forward(<span class="hljs-title">self</span>, <span class="hljs-title">input</span>):</span><br><span class="hljs-class">        if input.sum() &gt; 0:</span><br><span class="hljs-class">          output = self.weight.mv(<span class="hljs-title">input</span>)</span><br><span class="hljs-class">        else:</span><br><span class="hljs-class">          output = self.weight + input</span><br><span class="hljs-class">        return output</span><br><span class="hljs-class"></span><br><span class="hljs-class">my_module = <span class="hljs-type">MyModule</span>(10,20)</span><br><span class="hljs-class">sm = torch.jit.script(<span class="hljs-title">my_module</span>)</span><br><span class="hljs-class">sm.save(&#x27;<span class="hljs-title">model</span>.<span class="hljs-title">pt&#x27;</span>)</span><br></code></pre></td></tr></table></figure><p>ä¿å­˜ä¸Šè¿°ä»£ç ä¸ºexample-app.py, è¿è¡Œåç”Ÿæˆmodel.ptæ–‡ä»¶</p><h4 id="æ­¥éª¤2ï¼šåœ¨C-ä¸­åŠ è½½è„šæœ¬æ¨¡å—"><a href="#æ­¥éª¤2ï¼šåœ¨C-ä¸­åŠ è½½è„šæœ¬æ¨¡å—" class="headerlink" title="æ­¥éª¤2ï¼šåœ¨C++ä¸­åŠ è½½è„šæœ¬æ¨¡å—"></a>æ­¥éª¤2ï¼šåœ¨C++ä¸­åŠ è½½è„šæœ¬æ¨¡å—</h4><ul><li><p>ç¼–å†™ä¸€ä¸ªexample-app.cppæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;torch/script.h&gt;</span> <span class="hljs-comment">// One-stop header.</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;memory&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* argv[])</span> </span>&#123;<br>  <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">2</span>) &#123;<br>    std::cerr &lt;&lt; <span class="hljs-string">&quot;usage: example-app &lt;path-to-exported-script-module&gt;\n&quot;</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  &#125;<br><br><br>  torch::jit::script::Module <span class="hljs-keyword">module</span>;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-comment">// ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä»æ–‡ä»¶ä¸­ååºåˆ—åŒ–è„šæœ¬æ¨¡å—: torch::jit::load().</span><br>    <span class="hljs-keyword">module</span> = torch::jit::<span class="hljs-built_in">load</span>(argv[<span class="hljs-number">1</span>]);<br>  &#125;<br>  <span class="hljs-built_in"><span class="hljs-keyword">catch</span></span> (<span class="hljs-keyword">const</span> c10::Error&amp; e) &#123;<br>    std::cerr &lt;&lt; <span class="hljs-string">&quot;error loading the model\n&quot;</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  &#125;<br><br>  std::cout &lt;&lt; <span class="hljs-string">&quot;ok\n&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>&lt;torch/script.h&gt;</code>æ ‡å¤´åŒ…å«è¿è¡Œç¤ºä¾‹æ‰€éœ€çš„LibTorchåº“ä¸­çš„æ‰€æœ‰ç›¸å…³åŒ…å«ã€‚æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ¥å—åºåˆ—åŒ–çš„PyTorch ScriptModuleçš„æ–‡ä»¶è·¯å¾„ ä½œä¸ºå…¶å”¯ä¸€çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œç„¶åä½¿ç”¨<code>torch::jit::load()</code>å‡½æ•°ç»§ç»­å¯¹è¯¥æ¨¡å—è¿›è¡Œååºåˆ—åŒ–ï¼Œè¯¥å‡½æ•°å°†æ­¤æ–‡ä»¶è·¯å¾„ä½œä¸ºè¾“å…¥ã€‚ä½œä¸ºè¿”å›ï¼Œæˆ‘ä»¬ æ”¶åˆ°ä¸€ä¸ª<code>Torch::jit::script::Module</code>å¯¹è±¡ã€‚</p></li><li><p>ç¼–å†™ CMakeLists.txtï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">cmake_minimum_required</span><span class="hljs-params">(VERSION <span class="hljs-number">3.15</span> FATAL_ERROR)</span></span><br><span class="hljs-function"><span class="hljs-title">project</span><span class="hljs-params">(example-app)</span></span><br><br><span class="hljs-function"><span class="hljs-title">set</span><span class="hljs-params">(CMAKE_CXX_STANDARD <span class="hljs-number">14</span>)</span></span><br><br><span class="hljs-comment">// æŒ‡å®šlibtorchçš„å®‰è£…ç›®å½•ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨cmakeçš„æ—¶å€™æŒ‡å®šï¼Œcmakeå‚æ•°:-DCMAKE_PREFIX_PATH</span><br><span class="hljs-function"><span class="hljs-title">set</span><span class="hljs-params">(Torch_DIR /share/apps/libtorch/libtorch-gpu/share/cmake/Torch)</span></span><br><span class="hljs-function"><span class="hljs-title">find_package</span><span class="hljs-params">(Torch REQUIRED)</span></span><br><br><span class="hljs-function"><span class="hljs-title">add_executable</span><span class="hljs-params">(example-app example-app.cpp)</span></span><br><span class="hljs-function"><span class="hljs-title">target_link_libraries</span><span class="hljs-params">(example-app <span class="hljs-string">&quot;$&#123;TORCH_LIBRARIES&#125;&quot;</span>)</span></span><br><span class="hljs-comment">// set_property(TARGET example-app PROPERTY CXX_STANDARD 11)</span><br></code></pre></td></tr></table></figure></li><li><p>æ„å»ºåº”ç”¨ç¨‹åº</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">mkdir build<br><span class="hljs-keyword">cd</span> build<br><span class="hljs-string">//cmake</span> -DCMAKE_PREFIX_PATH=<span class="hljs-string">/path/to/libtorch</span> <span class="hljs-string">..</span><br>cmake <span class="hljs-string">..</span><br>make<br></code></pre></td></tr></table></figure></li><li><p>æœ€åæ‰§è¡Œç¨‹åº</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams">./example-app <span class="hljs-keyword">model</span>.pt<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¾“å‡ºä¸ºok</p></li></ul><p>å‚è€ƒï¼š<a href="https://pytorch.panchuang.net/EigthSection/torchScript_in_C++/">https://pytorch.panchuang.net/EigthSection/torchScript_in_C++/</a></p>]]></content>
    
    
    <categories>
      
      <category>CPP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>torch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>centos7å®‰è£…cudnn</title>
    <link href="/2023/03/08/centos7%E5%AE%89%E8%A3%85cudnn/"/>
    <url>/2023/03/08/centos7%E5%AE%89%E8%A3%85cudnn/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><h4 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h4><p>åœ°å€ï¼š<a href="https://developer.nvidia.com/rdp/cudnn-download">https://developer.nvidia.com/rdp/cudnn-download</a><br>cudnnéœ€è¦æ³¨å†Œç™»å½•æ‰èƒ½ä¸‹è½½ï¼Œç„¶åé€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬è¿›è¡Œä¸‹è½½ï¼Œæœ€å¼€å§‹æˆ‘ä¸‹è½½çš„æ˜¯<code>Local Installer for RedHat/Centos 7.1 x84_64 (RPM)</code>ï¼Œç„¶åä½¿ç”¨<code>sudo yum install</code>å‘½ä»¤å®‰è£…è¿™ä¸ªrpmåŒ…ï¼Œæœ€åå‘ç°ä¸çŸ¥é“è£…å“ªäº†ï¼Œä¹Ÿæ‰¾ä¸åˆ°cudnnçš„å¤´æ–‡ä»¶ã€‚æœ€ååªèƒ½å†ä¸‹è½½å¦ä¸€ä¸ªæ–‡ä»¶<code>Local Installer for Linux x86_64 (Tar)</code>ï¼Œå³è¿™ä¸ªtaråŒ…ã€‚<br>ä¸‹è½½ä¸‹æ¥æ˜¯ä¸ªxzæ ¼å¼å‹ç¼©åŒ…ï¼Œé¦–å…ˆè§£å‹ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">xz</span> -xzJf <span class="hljs-regexp">*.xz</span><br></code></pre></td></tr></table></figure><p>è§£å‹åä¼šæœ‰ä¸¤ä¸ªç›®å½•ï¼šinclude å’Œ lib</p><h4 id="æ‹·è´å¯¹åº”çš„æ–‡ä»¶åˆ°cudaä¸‹"><a href="#æ‹·è´å¯¹åº”çš„æ–‡ä»¶åˆ°cudaä¸‹" class="headerlink" title="æ‹·è´å¯¹åº”çš„æ–‡ä»¶åˆ°cudaä¸‹"></a>æ‹·è´å¯¹åº”çš„æ–‡ä»¶åˆ°cudaä¸‹</h4><p>å®˜ç½‘çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo cp cuda<span class="hljs-regexp">/include/</span>cudnn.h <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/cuda/i</span>nclude<br>sudo cp cuda<span class="hljs-regexp">/lib64/</span>libcudnn* <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/cuda/</span>lib64<br>sudo chmod a+r <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/cuda/i</span>nclude<span class="hljs-regexp">/cudnn.h /u</span>sr<span class="hljs-regexp">/local/</span>cuda<span class="hljs-regexp">/lib64/</span>libcudnn*<br></code></pre></td></tr></table></figure><p>æŒ‰ç…§å®˜ç½‘çš„æ–¹æ³•ä¼šå¯èƒ½ä¼šæœ‰bugï¼Œå¯èƒ½ç°åœ¨æ–°çš„cudnnç‰ˆæœ¬ä¿¡æ¯æ²¡æœ‰åŒ…å«åœ¨cudnn.hé‡Œï¼Œæ‰€ä»¥æˆ‘è¿™é‡ŒæŠŠincludeä¸‹çš„æ–‡ä»¶éƒ½è¿›è¡Œäº†æ‹·è´</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo cp cuda<span class="hljs-regexp">/include/</span>cudnn* <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/cuda/i</span>nclude<br>sudo cp cuda<span class="hljs-regexp">/lib64/</span>libcudnn* <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/cuda/</span>lib64<br>sudo chmod a+r <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/cuda/i</span>nclude<span class="hljs-regexp">/cudnn* /u</span>sr<span class="hljs-regexp">/local/</span>cuda<span class="hljs-regexp">/lib64/</span>libcudnn*<br></code></pre></td></tr></table></figure><p>æœ€åä½¿ç”¨cmakeè¿›è¡Œç¼–è¯‘ä½¿ç”¨libtorchçš„æ—¶å€™æˆåŠŸæ‰¾åˆ°äº†cudnnã€‚</p><p>å‚è€ƒï¼š<a href="https://docs.nvidia.com/deeplearning/cudnn/archives/cudnn_764/cudnn-install/index.html#install-linux">https://docs.nvidia.com/deeplearning/cudnn/archives/cudnn_764/cudnn-install/index.html#install-linux</a><br>    <a href="http://zhaoxuhui.top/blog/2021/04/13/libtorch-installation-and-use.html">http://zhaoxuhui.top/blog/2021/04/13/libtorch-installation-and-use.html</a></p>]]></content>
    
    
    <categories>
      
      <category>cuda</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cudnn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>3dmol.jså¹³ç§»ã€ç¼©æ”¾ã€æ—‹è½¬box</title>
    <link href="/2023/02/14/3dmol-js%E5%B9%B3%E7%A7%BB%E3%80%81%E7%BC%A9%E6%94%BE%E3%80%81%E6%97%8B%E8%BD%ACbox/"/>
    <url>/2023/02/14/3dmol-js%E5%B9%B3%E7%A7%BB%E3%80%81%E7%BC%A9%E6%94%BE%E3%80%81%E6%97%8B%E8%BD%ACbox/</url>
    
    <content type="html"><![CDATA[<h2 id="ä½¿ç”¨3dmol-jså±•ç¤ºè›‹ç™½pocket-box-å¹¶å¯¹boxè¿›è¡Œå¹³ç§»æ—‹è½¬ç­‰"><a href="#ä½¿ç”¨3dmol-jså±•ç¤ºè›‹ç™½pocket-box-å¹¶å¯¹boxè¿›è¡Œå¹³ç§»æ—‹è½¬ç­‰" class="headerlink" title="ä½¿ç”¨3dmol.jså±•ç¤ºè›‹ç™½pocket(box), å¹¶å¯¹boxè¿›è¡Œå¹³ç§»æ—‹è½¬ç­‰"></a>ä½¿ç”¨3dmol.jså±•ç¤ºè›‹ç™½pocket(box), å¹¶å¯¹boxè¿›è¡Œå¹³ç§»æ—‹è½¬ç­‰</h2><span id="more"></span><h5 id="é¦–å…ˆæ·»åŠ è›‹ç™½å’Œbox"><a href="#é¦–å…ˆæ·»åŠ è›‹ç™½å’Œbox" class="headerlink" title="é¦–å…ˆæ·»åŠ è›‹ç™½å’Œbox"></a>é¦–å…ˆæ·»åŠ è›‹ç™½å’Œbox</h5><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs nix">var <span class="hljs-attr">data</span> = reader.result;<br><span class="hljs-keyword">let</span> <span class="hljs-attr">element</span> = $(&#x27;<span class="hljs-comment">#protein-box&#x27;);  # htmlä¸­çš„idæ ‡ç­¾</span><br>// <span class="hljs-keyword">let</span> <span class="hljs-attr">config</span> = &#123; backgroundColor : &#x27;<span class="hljs-comment">#E0F7FA&#x27;&#125;;</span><br><br>// <span class="hljs-attr">viewer</span> = $<span class="hljs-number">3</span>Dmol.createViewer( element, config );<br><span class="hljs-attr">viewer</span> = $<span class="hljs-number">3</span>Dmol.createViewer( element);<br>var <span class="hljs-attr">ligandData</span> = subLigandPdb(data);<br><span class="hljs-attr">ligandData</span> = pdbqtToPDB(ligandData);<br><br><span class="hljs-attr">pdbMol</span> = viewer.addModel( data, <span class="hljs-string">&quot;pdb&quot;</span> );                       <span class="hljs-comment">/* load data */</span>     <br>pdbMol.setStyle(&#123;&#125;, &#123;cartoon: &#123;color: &#x27;spectrum&#x27;&#125;&#125;);  <span class="hljs-comment">/* style all atoms */</span><br>// var <span class="hljs-attr">ligandMol</span> = viewer.addModel( ligandData, <span class="hljs-string">&quot;pdb&quot;</span>, &#123;<span class="hljs-string">&quot;keepH&quot;</span>: <span class="hljs-literal">true</span>&#125;);<br>// ligandMol.setStyle(&#123;&#125;,&#123;<span class="hljs-string">&quot;stick&quot;</span>: &#123; <span class="hljs-string">&quot;radius&quot;</span>: <span class="hljs-number">0.4</span> &#125;&#125;);<br><br>        <br>var <span class="hljs-attr">atoms</span> = viewer.selectedAtoms(&#123;&#125;);<br><span class="hljs-keyword">let</span> <span class="hljs-attr">len</span> = atoms.length;<br><span class="hljs-keyword">let</span> <span class="hljs-attr">xTot</span> = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">let</span> <span class="hljs-attr">yTot</span> = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">let</span> <span class="hljs-attr">zTot</span> = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">let</span> <span class="hljs-attr">minX</span> = <span class="hljs-number">1</span>e100;<br><span class="hljs-keyword">let</span> <span class="hljs-attr">minY</span> = <span class="hljs-number">1</span>e100;<br><span class="hljs-keyword">let</span> <span class="hljs-attr">minZ</span> = <span class="hljs-number">1</span>e100;<br><span class="hljs-keyword">let</span> <span class="hljs-attr">maxX</span> = -<span class="hljs-number">1</span>e100;<br><span class="hljs-keyword">let</span> <span class="hljs-attr">maxY</span> = -<span class="hljs-number">1</span>e100;<br><span class="hljs-keyword">let</span> <span class="hljs-attr">maxZ</span> = -<span class="hljs-number">1</span>e100;<br>for (var <span class="hljs-attr">i</span> = <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">atom</span> = atoms[i];<br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">x</span> = atom.x;<br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">y</span> = atom.y;<br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">z</span> = atom.z;<br>    xTot += x;<br>    yTot += y;<br>    zTot += z;<br>    <span class="hljs-keyword">if</span> (x &gt; maxX) &#123;<br>        <span class="hljs-attr">maxX</span> = x;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (y &gt; maxY) &#123;<br>        <span class="hljs-attr">maxY</span> = y;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (z &gt; maxZ) &#123;<br>        <span class="hljs-attr">maxZ</span> = z;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (x &lt; minX) &#123;<br>        <span class="hljs-attr">minX</span> = x;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (y &lt; minY) &#123;<br>        <span class="hljs-attr">minY</span> = y;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (z &lt; minZ) &#123;<br>        <span class="hljs-attr">minZ</span> = z;<br>    &#125;<br>&#125;<br><span class="hljs-attr">centerX</span> = xTot / len;<br><span class="hljs-attr">centerY</span> = yTot / len;<br><span class="hljs-attr">centerZ</span> = zTot / len;<br><span class="hljs-attr">sizeX</span> = <span class="hljs-number">0.25</span> * (maxX - minX);<br><span class="hljs-attr">sizeY</span> = <span class="hljs-number">0.25</span> * (maxY - minY);<br><span class="hljs-attr">sizeZ</span> = <span class="hljs-number">0.25</span> * (maxZ - minZ);<br><br>//å®šä¹‰ä¸€äº›åˆå§‹å€¼<br><span class="hljs-attr">sizeWx</span> = sizeX;<br><span class="hljs-attr">sizeWx0</span> = sizeX;<br><span class="hljs-attr">sizeWy</span> = <span class="hljs-number">0</span>;<br><span class="hljs-attr">sizeWy0</span> = <span class="hljs-number">0</span>;<br><span class="hljs-attr">sizeWz</span> = <span class="hljs-number">0</span>;<br><span class="hljs-attr">sizeWz0</span> = <span class="hljs-number">0</span>;<br><span class="hljs-attr">sizeW</span> = sizeX;<br><span class="hljs-attr">rotateX</span> = <span class="hljs-number">0</span>;<br><span class="hljs-attr">sumX</span> = <span class="hljs-number">0</span>;<br><br><span class="hljs-attr">sizeHx</span> = <span class="hljs-number">0</span>;<br><span class="hljs-attr">sizeHx0</span> = <span class="hljs-number">0</span>;<br><span class="hljs-attr">sizeHy</span> = sizeY;<br><span class="hljs-attr">sizeHy0</span> = sizeY;<br><span class="hljs-attr">sizeHz</span> = <span class="hljs-number">0</span>;<br><span class="hljs-attr">sizeHz0</span> = <span class="hljs-number">0</span>;<br><span class="hljs-attr">sizeH</span> = sizeY;<br><span class="hljs-attr">rotateY</span> = <span class="hljs-number">0</span>;<br><span class="hljs-attr">sumY</span> = <span class="hljs-number">0</span>;<br><br><span class="hljs-attr">sizeDx</span> = <span class="hljs-number">0</span>;<br><span class="hljs-attr">sizeDx0</span> = <span class="hljs-number">0</span>;<br><span class="hljs-attr">sizeDy</span> = <span class="hljs-number">0</span>;<br><span class="hljs-attr">sizeDy0</span> = <span class="hljs-number">0</span>;<br><span class="hljs-attr">sizeDz</span> = sizeZ;<br><span class="hljs-attr">sizeDz0</span> = sizeZ;<br><span class="hljs-attr">sizeD</span>  = sizeZ;<br><span class="hljs-attr">rotateZ</span> = <span class="hljs-number">0</span>;<br><span class="hljs-attr">sumZ</span> = <span class="hljs-number">0</span>;<br><br>$(<span class="hljs-string">&quot;#CenterX&quot;</span>).val(centerX.toFixed(<span class="hljs-number">2</span>));<br>$(<span class="hljs-string">&quot;#rangeCenterX&quot;</span>).val(centerX);<br>$(<span class="hljs-string">&quot;#CenterY&quot;</span>).val(centerY.toFixed(<span class="hljs-number">2</span>));<br>$(<span class="hljs-string">&quot;#rangeCenterY&quot;</span>).val(centerY);<br>$(<span class="hljs-string">&quot;#CenterZ&quot;</span>).val(centerZ.toFixed(<span class="hljs-number">2</span>));<br>$(<span class="hljs-string">&quot;#rangeCenterZ&quot;</span>).val(centerZ);<br>$(&#x27;<span class="hljs-comment">#SizeX&#x27;).val(sizeX.toFixed(2));</span><br>$(<span class="hljs-string">&quot;#rangeSizeX&quot;</span>).val(sizeX);<br>$(&#x27;<span class="hljs-comment">#SizeY&#x27;).val(sizeY.toFixed(2));</span><br>$(<span class="hljs-string">&quot;#rangeSizeY&quot;</span>).val(sizeY);<br>$(&#x27;<span class="hljs-comment">#SizeZ&#x27;).val(sizeZ.toFixed(2));</span><br>$(<span class="hljs-string">&quot;#rangeSizeZ&quot;</span>).val(sizeZ);<br>$(<span class="hljs-string">&quot;#RotateX&quot;</span>).val(<span class="hljs-number">0</span>);<br>$(<span class="hljs-string">&quot;#rangeRotateX&quot;</span>).val(<span class="hljs-number">0</span>);<br>$(<span class="hljs-string">&quot;#RotateY&quot;</span>).val(<span class="hljs-number">0</span>);<br>$(<span class="hljs-string">&quot;#rangeRotateY&quot;</span>).val(<span class="hljs-number">0</span>);<br>$(<span class="hljs-string">&quot;#RotateZ&quot;</span>).val(<span class="hljs-number">0</span>);<br>$(<span class="hljs-string">&quot;#rangeRotateZ&quot;</span>).val(<span class="hljs-number">0</span>);<br><br><span class="hljs-attr">centerX0</span> = centerX;<br><span class="hljs-attr">centerY0</span> = centerY;<br><span class="hljs-attr">centerZ0</span> = centerZ;<br><br>viewer.addBox(&#123;center:&#123;x:centerX,y:centerY,z:centerZ&#125;,<br>    // dimensions: &#123;w: sizeW, h: sizeH, d: sizeD&#125;,<br>    dimensions:  &#123;&#x27;w&#x27;: &#123;&#x27;x&#x27;:sizeWx, &#x27;y&#x27;:sizeWy, &#x27;z&#x27;:sizeWz&#125;, <br>                  &#x27;h&#x27;: &#123;&#x27;x&#x27;:sizeHx, &#x27;y&#x27;:sizeHy, &#x27;z&#x27;:sizeHz&#125;,  <br>                  &#x27;d&#x27;: &#123;&#x27;x&#x27;:sizeDx, &#x27;y&#x27;:sizeDy, &#x27;z&#x27;:sizeDz&#125;&#125;, <br>    color:&#x27;yellow&#x27;, <br>    opacity: <span class="hljs-number">0.8</span>              <br>    &#125;);<br><br>viewer.addLine(&#123;color:&#x27;red&#x27;,start:&#123;x:centerX0,y:centerY0,z:centerZ0&#125;,end:&#123;x:centerX0+<span class="hljs-number">25</span>,y:centerY0,z:centerZ0&#125;&#125;);<br>viewer.addLine(&#123;color:&#x27;blue&#x27;,start:&#123;x:centerX0,y:centerY0,z:centerZ0&#125;,end:&#123;x:centerX0,y:centerY0+<span class="hljs-number">25</span>,z:centerZ0&#125;&#125;);<br>viewer.addLine(&#123;color:&#x27;green&#x27;,start:&#123;x:centerX0,y:centerY0,z:centerZ0&#125;,end:&#123;x:centerX0,y:centerY0,z:centerZ0+<span class="hljs-number">25</span>&#125;&#125;);<br><br>viewer.zoomTo();                                        <span class="hljs-comment">/* set camera */</span><br>viewer.render();                                      <span class="hljs-comment">/* render scene */</span><br>viewer.zoom(<span class="hljs-number">1.2</span>, <span class="hljs-number">1000</span>);    <br></code></pre></td></tr></table></figure><h5 id="æ›´æ–°box"><a href="#æ›´æ–°box" class="headerlink" title="æ›´æ–°box"></a>æ›´æ–°box</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// æ›´æ–°box</span><br><span class="hljs-keyword">var</span> updateBox = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-variable">$input</span></span>) </span>&#123;<br><span class="hljs-comment">/*æ‹–åŠ¨æ»‘å—çš„äº‹ä»¶ï¼Œå†…å®¹å¯è‡ªè¡Œå®šä¹‰*/</span><br>    <span class="hljs-keyword">var</span> rangeSizeArray = [<span class="hljs-string">&#x27;rangeSizeX&#x27;</span>, <span class="hljs-string">&#x27;rangeSizeY&#x27;</span>, <span class="hljs-string">&#x27;rangeSizeZ&#x27;</span>]<br>    <span class="hljs-keyword">var</span> var_type = <span class="hljs-variable">$input</span>.id;<br>    <span class="hljs-keyword">if</span> (var_type===<span class="hljs-string">&#x27;rangeCenterX&#x27;</span>)<br>    &#123;<br>        centerX = Number(<span class="hljs-variable">$input</span>.value);<br>        $(<span class="hljs-string">&quot;#CenterX&quot;</span>).val(<span class="hljs-variable">$input</span>.value);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (var_type===<span class="hljs-string">&#x27;rangeCenterY&#x27;</span>)<br>    &#123;<br>        centerY = Number(<span class="hljs-variable">$input</span>.value);<br>        $(<span class="hljs-string">&quot;#CenterY&quot;</span>).val(<span class="hljs-variable">$input</span>.value);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (var_type===<span class="hljs-string">&#x27;rangeCenterZ&#x27;</span>)<br>    &#123;<br>        centerZ = Number(<span class="hljs-variable">$input</span>.value);<br>        $(<span class="hljs-string">&quot;#CenterZ&quot;</span>).val(<span class="hljs-variable">$input</span>.value);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rangeSizeArray.indexOf(var_type) !== -<span class="hljs-number">1</span>)<br>    &#123;   <br>        <span class="hljs-keyword">var</span> axisX = <span class="hljs-keyword">new</span> $<span class="hljs-number">3</span>Dmol.Vector3(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);   <span class="hljs-comment">// X è½´</span><br>        <span class="hljs-keyword">var</span> xDegree = Number($(<span class="hljs-string">&quot;#RotateX&quot;</span>).val());<br>        <span class="hljs-keyword">var</span> radianX = (Math.PI * xDegree) / <span class="hljs-number">180</span>;<br><br>        <span class="hljs-keyword">var</span> axisY = <span class="hljs-keyword">new</span> $<span class="hljs-number">3</span>Dmol.Vector3(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);   <span class="hljs-comment">// Y è½´</span><br>        <span class="hljs-keyword">var</span> yDegree = Number($(<span class="hljs-string">&quot;#RotateY&quot;</span>).val());<br>        <span class="hljs-keyword">var</span> radianY = (Math.PI * yDegree) / <span class="hljs-number">180</span>;<br><br>        <span class="hljs-keyword">var</span> axisZ = <span class="hljs-keyword">new</span> $<span class="hljs-number">3</span>Dmol.Vector3(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>);   <span class="hljs-comment">// Z è½´</span><br>        <span class="hljs-keyword">var</span> zDegree = Number($(<span class="hljs-string">&quot;#RotateZ&quot;</span>).val());<br>        <span class="hljs-keyword">var</span> radianZ = (Math.PI * zDegree) / <span class="hljs-number">180</span>;<br><br>        <span class="hljs-keyword">if</span> (var_type===<span class="hljs-string">&#x27;rangeSizeX&#x27;</span> ) &#123;<br>            <span class="hljs-keyword">var</span> sizeW = Number(<span class="hljs-variable">$input</span>.value);<br>            <span class="hljs-keyword">var</span> vecW = <span class="hljs-keyword">new</span> $<span class="hljs-number">3</span>Dmol.Vector3(sizeW,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>            vecW.rotateAboutVector(axisX,radianX);<br>            vecW.rotateAboutVector(axisY,radianY);<br>            vecW.rotateAboutVector(axisZ,radianZ);<br><br>            sizeWx = vecW.x;<br>            sizeWy = vecW.y;<br>            sizeWz = vecW.z;<br><br>            sizeWx0 = sizeW;  <span class="hljs-comment"># æ›´æ–°å®½åº¦å¤§å°åˆå§‹å€¼</span><br>            $(<span class="hljs-string">&quot;#SizeX&quot;</span>).val(<span class="hljs-variable">$input</span>.value);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (var_type===<span class="hljs-string">&#x27;rangeSizeY&#x27;</span>) &#123;<br>            <span class="hljs-keyword">var</span> sizeH = Number(<span class="hljs-variable">$input</span>.value);                              <br>            <span class="hljs-keyword">var</span> vecH = <span class="hljs-keyword">new</span> $<span class="hljs-number">3</span>Dmol.Vector3(<span class="hljs-number">0</span>,sizeH,<span class="hljs-number">0</span>);<br>            vecH.rotateAboutVector(axisX,radianX);<br>            vecH.rotateAboutVector(axisY,radianY);<br>            vecH.rotateAboutVector(axisZ,radianZ);<br><br>            sizeHx = vecH.x;<br>            sizeHy = vecH.y;<br>            sizeHz = vecH.z;<br><br>            sizeHy0 = sizeH;  <span class="hljs-comment"># æ›´æ–°é«˜åº¦å¤§å°åˆå§‹å€¼</span><br>            $(<span class="hljs-string">&quot;#SizeY&quot;</span>).val(<span class="hljs-variable">$input</span>.value);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (var_type===<span class="hljs-string">&#x27;rangeSizeZ&#x27;</span>) &#123;<br>            <span class="hljs-keyword">var</span> sizeD = Number(<span class="hljs-variable">$input</span>.value);<br>            <span class="hljs-keyword">var</span> vecD = <span class="hljs-keyword">new</span> $<span class="hljs-number">3</span>Dmol.Vector3(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,sizeD);<br>            vecD.rotateAboutVector(axisX,radianX);<br>            vecD.rotateAboutVector(axisY,radianY);<br>            vecD.rotateAboutVector(axisZ,radianZ);<br><br>            sizeDx = vecD.x;<br>            sizeDy = vecD.y;<br>            sizeDz = vecD.z;<br><br>            sizeDz0 = sizeD; <span class="hljs-comment"># æ›´æ–°æ·±åº¦å¤§å°åˆå§‹å€¼</span><br>            $(<span class="hljs-string">&quot;#SizeZ&quot;</span>).val(<span class="hljs-variable">$input</span>.value);<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-comment">// å®šä¹‰åˆå§‹å‘é‡</span><br>        vecW = <span class="hljs-keyword">new</span> $<span class="hljs-number">3</span>Dmol.Vector3(sizeWx0,sizeWy0,sizeWz0);<br>        vecH = <span class="hljs-keyword">new</span> $<span class="hljs-number">3</span>Dmol.Vector3(sizeHx0,sizeHy0,sizeHz0);<br>        vecD = <span class="hljs-keyword">new</span> $<span class="hljs-number">3</span>Dmol.Vector3(sizeDx0,sizeDy0,sizeDz0);<br><br>        <span class="hljs-keyword">if</span> (var_type===<span class="hljs-string">&#x27;rangeRotateX&#x27;</span>)&#123;<br>            <span class="hljs-keyword">var</span> xDegree = Number(<span class="hljs-variable">$input</span>.value);<br>            <span class="hljs-keyword">var</span> yDegree = Number($(<span class="hljs-string">&quot;#RotateY&quot;</span>).val());<br>            <span class="hljs-keyword">var</span> zDegree = Number($(<span class="hljs-string">&quot;#RotateZ&quot;</span>).val());<br>            <span class="hljs-keyword">var</span> radianX = (Math.PI * xDegree) / <span class="hljs-number">180</span>;<br>            <span class="hljs-keyword">var</span> radianY = (Math.PI * yDegree) / <span class="hljs-number">180</span>;<br>            <span class="hljs-keyword">var</span> radianZ = (Math.PI * zDegree) / <span class="hljs-number">180</span>;<br>            $(<span class="hljs-string">&quot;#RotateX&quot;</span>).val(<span class="hljs-variable">$input</span>.value);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (var_type===<span class="hljs-string">&#x27;rangeRotateY&#x27;</span>) &#123;<br>            <span class="hljs-keyword">var</span> xDegree = Number($(<span class="hljs-string">&quot;#RotateX&quot;</span>).val());<br>            <span class="hljs-keyword">var</span> yDegree = Number(<span class="hljs-variable">$input</span>.value);<br>            <span class="hljs-keyword">var</span> zDegree = Number($(<span class="hljs-string">&quot;#RotateZ&quot;</span>).val());<br>            <span class="hljs-keyword">var</span> radianX = (Math.PI * xDegree) / <span class="hljs-number">180</span>;<br>            <span class="hljs-keyword">var</span> radianY = (Math.PI * yDegree) / <span class="hljs-number">180</span>;<br>            <span class="hljs-keyword">var</span> radianZ = (Math.PI * zDegree) / <span class="hljs-number">180</span>;<br>            $(<span class="hljs-string">&quot;#RotateY&quot;</span>).val(<span class="hljs-variable">$input</span>.value);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (var_type===<span class="hljs-string">&#x27;rangeRotateZ&#x27;</span>) &#123;<br>            <span class="hljs-keyword">var</span> xDegree = Number($(<span class="hljs-string">&quot;#RotateX&quot;</span>).val());<br>            <span class="hljs-keyword">var</span> yDegree = Number($(<span class="hljs-string">&quot;#RotateY&quot;</span>).val());<br>            <span class="hljs-keyword">var</span> zDegree = Number(<span class="hljs-variable">$input</span>.value);<br>            <span class="hljs-keyword">var</span> radianX = (Math.PI * xDegree) / <span class="hljs-number">180</span>;<br>            <span class="hljs-keyword">var</span> radianY = (Math.PI * yDegree) / <span class="hljs-number">180</span>;<br>            <span class="hljs-keyword">var</span> radianZ = (Math.PI * zDegree) / <span class="hljs-number">180</span>;<br>            $(<span class="hljs-string">&quot;#RotateZ&quot;</span>).val(<span class="hljs-variable">$input</span>.value);<br>        &#125;<br><br>        <span class="hljs-keyword">var</span> axisX = <span class="hljs-keyword">new</span> $<span class="hljs-number">3</span>Dmol.Vector3(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);   <span class="hljs-comment">// X è½´</span><br>        <span class="hljs-keyword">var</span> axisY = <span class="hljs-keyword">new</span> $<span class="hljs-number">3</span>Dmol.Vector3(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>);   <span class="hljs-comment">// Y è½´</span><br>        <span class="hljs-keyword">var</span> axisZ = <span class="hljs-keyword">new</span> $<span class="hljs-number">3</span>Dmol.Vector3(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>);   <span class="hljs-comment">// Z è½´</span><br><br>        vecW.rotateAboutVector(axisX,radianX);<br>        vecW.rotateAboutVector(axisY,radianY);<br>        vecW.rotateAboutVector(axisZ,radianZ);<br><br>        vecH.rotateAboutVector(axisX,radianX);<br>        vecH.rotateAboutVector(axisY,radianY);<br>        vecH.rotateAboutVector(axisZ,radianZ);<br><br>        vecD.rotateAboutVector(axisX,radianX);<br>        vecD.rotateAboutVector(axisY,radianY);<br>        vecD.rotateAboutVector(axisZ,radianZ);<br><br>        sizeWx = vecW.x;<br>        sizeWy = vecW.y;<br>        sizeWz = vecW.z;<br>        sizeHx = vecH.x;<br>        sizeHy = vecH.y;<br>        sizeHz = vecH.z;<br>        sizeDx = vecD.x;<br>        sizeDy = vecD.y;<br>        sizeDz = vecD.z;<br><br>    &#125;<br><br>    viewer.removeAllShapes();<br>    viewer.addBox(&#123;center:&#123;x:centerX,y:centerY,z:centerZ&#125;,<br>                <span class="hljs-comment">// dimensions: &#123;w: sizeW, h: sizeH, d: sizeD&#125;,</span><br>                dimensions:  &#123;<span class="hljs-string">&#x27;w&#x27;</span>: &#123;<span class="hljs-string">&#x27;x&#x27;</span>:sizeWx, <span class="hljs-string">&#x27;y&#x27;</span>:sizeWy, <span class="hljs-string">&#x27;z&#x27;</span>:sizeWz&#125;, <br>                              <span class="hljs-string">&#x27;h&#x27;</span>: &#123;<span class="hljs-string">&#x27;x&#x27;</span>:sizeHx, <span class="hljs-string">&#x27;y&#x27;</span>:sizeHy, <span class="hljs-string">&#x27;z&#x27;</span>:sizeHz&#125;,  <br>                              <span class="hljs-string">&#x27;d&#x27;</span>: &#123;<span class="hljs-string">&#x27;x&#x27;</span>:sizeDx, <span class="hljs-string">&#x27;y&#x27;</span>:sizeDy, <span class="hljs-string">&#x27;z&#x27;</span>:sizeDz&#125;&#125;,  <br>                color:<span class="hljs-string">&#x27;yellow&#x27;</span>, <br>                opacity: <span class="hljs-number">0.8</span>              <br>                &#125;);<br><br>    viewer.addLine(&#123;color:<span class="hljs-string">&#x27;red&#x27;</span>,start:&#123;x:centerX0,y:centerY0,z:centerZ0&#125;,end:&#123;x:centerX0+<span class="hljs-number">25</span>,y:centerY0,z:centerZ0&#125;&#125;);<br>    viewer.addLine(&#123;color:<span class="hljs-string">&#x27;blue&#x27;</span>,start:&#123;x:centerX0,y:centerY0,z:centerZ0&#125;,end:&#123;x:centerX0,y:centerY0+<span class="hljs-number">25</span>,z:centerZ0&#125;&#125;);<br>    viewer.addLine(&#123;color:<span class="hljs-string">&#x27;green&#x27;</span>,start:&#123;x:centerX0,y:centerY0,z:centerZ0&#125;,end:&#123;x:centerX0,y:centerY0,z:centerZ0+<span class="hljs-number">25</span>&#125;&#125;);<br><br>    viewer.render();<br><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ä½¿ç”¨æ»‘å—æ›´æ–°"><a href="#ä½¿ç”¨æ»‘å—æ›´æ–°" class="headerlink" title="ä½¿ç”¨æ»‘å—æ›´æ–°"></a>ä½¿ç”¨æ»‘å—æ›´æ–°</h5><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">$.fn.RangeSlider = <span class="hljs-keyword">function</span> (cfg) &#123;<br>    this.sliderCfg = &#123;<br>        min: cfg<span class="hljs-operator"> &amp;&amp; </span>!is<span class="hljs-constructor">NaN(<span class="hljs-params">parseFloat</span>(<span class="hljs-params">cfg</span>.<span class="hljs-params">min</span>)</span>) ? <span class="hljs-constructor">Number(<span class="hljs-params">cfg</span>.<span class="hljs-params">min</span>)</span> : null,<br>        max: cfg<span class="hljs-operator"> &amp;&amp; </span>!is<span class="hljs-constructor">NaN(<span class="hljs-params">parseFloat</span>(<span class="hljs-params">cfg</span>.<span class="hljs-params">max</span>)</span>) ? <span class="hljs-constructor">Number(<span class="hljs-params">cfg</span>.<span class="hljs-params">max</span>)</span> : null,<br>        step: cfg<span class="hljs-operator"> &amp;&amp; </span><span class="hljs-constructor">Number(<span class="hljs-params">cfg</span>.<span class="hljs-params">step</span>)</span> ? cfg.step : <span class="hljs-number">1</span>,<br>        callback: cfg<span class="hljs-operator"> &amp;&amp; </span>cfg.callback ? cfg.callback : null<br>    &#125;;<br><br>    var $input = <span class="hljs-constructor">$(<span class="hljs-params">this</span>)</span>;<br>    var min = this.sliderCfg.min;<br>    var max = this.sliderCfg.max;<br>    var step = this.sliderCfg.step;<br>    var callback = this.sliderCfg.callback;<br><br>    $input.attr(&#x27;min&#x27;, min)<br>        .attr(&#x27;max&#x27;, max)<br>        .attr(&#x27;step&#x27;, step);<br><br>    $input.bind(<span class="hljs-string">&quot;input&quot;</span>, <span class="hljs-keyword">function</span> (e) &#123;<br>        $input.attr(&#x27;value&#x27;, this.value);<br>        $input.css(&#x27;background-size&#x27;, this.value<span class="hljs-operator"> * </span><span class="hljs-number">100.0</span><span class="hljs-operator"> / </span>max + &#x27;% <span class="hljs-number">100</span>%&#x27;);<br><br>        <span class="hljs-keyword">if</span> ($.is<span class="hljs-constructor">Function(<span class="hljs-params">callback</span>)</span>) &#123;<br>            callback(this);<br>        &#125;<br>    &#125;);<br>&#125;;<br><br><span class="hljs-constructor">$(&#x27;#<span class="hljs-params">rangeCenterX</span>&#x27;)</span>.<span class="hljs-constructor">RangeSlider(&#123; <span class="hljs-params">min</span>: -50, <span class="hljs-params">max</span>: 100, <span class="hljs-params">step</span>: 0.1, <span class="hljs-params">callback</span>: <span class="hljs-params">updateBox</span> &#125;)</span>;<br><span class="hljs-constructor">$(&#x27;#<span class="hljs-params">rangeCenterY</span>&#x27;)</span>.<span class="hljs-constructor">RangeSlider(&#123; <span class="hljs-params">min</span>: -50, <span class="hljs-params">max</span>: 100, <span class="hljs-params">step</span>: 0.1, <span class="hljs-params">callback</span>: <span class="hljs-params">updateBox</span> &#125;)</span>;<br><span class="hljs-constructor">$(&#x27;#<span class="hljs-params">rangeCenterZ</span>&#x27;)</span>.<span class="hljs-constructor">RangeSlider(&#123; <span class="hljs-params">min</span>: -50, <span class="hljs-params">max</span>: 100, <span class="hljs-params">step</span>: 0.1, <span class="hljs-params">callback</span>: <span class="hljs-params">updateBox</span> &#125;)</span>;<br><br><span class="hljs-constructor">$(&#x27;#<span class="hljs-params">rangeSizeX</span>&#x27;)</span>.<span class="hljs-constructor">RangeSlider(&#123; <span class="hljs-params">min</span>: 0, <span class="hljs-params">max</span>: 100, <span class="hljs-params">step</span>: 0.1, <span class="hljs-params">callback</span>: <span class="hljs-params">updateBox</span> &#125;)</span>;<br><span class="hljs-constructor">$(&#x27;#<span class="hljs-params">rangeSizeY</span>&#x27;)</span>.<span class="hljs-constructor">RangeSlider(&#123; <span class="hljs-params">min</span>: 0, <span class="hljs-params">max</span>: 100, <span class="hljs-params">step</span>: 0.1, <span class="hljs-params">callback</span>: <span class="hljs-params">updateBox</span> &#125;)</span>;<br><span class="hljs-constructor">$(&#x27;#<span class="hljs-params">rangeSizeZ</span>&#x27;)</span>.<span class="hljs-constructor">RangeSlider(&#123; <span class="hljs-params">min</span>: 0, <span class="hljs-params">max</span>: 100, <span class="hljs-params">step</span>: 0.1, <span class="hljs-params">callback</span>: <span class="hljs-params">updateBox</span> &#125;)</span>;<br><br><span class="hljs-constructor">$(&#x27;#<span class="hljs-params">rangeRotateX</span>&#x27;)</span>.<span class="hljs-constructor">RangeSlider(&#123; <span class="hljs-params">min</span>: 0, <span class="hljs-params">max</span>: 180, <span class="hljs-params">step</span>: 0.1, <span class="hljs-params">callback</span>: <span class="hljs-params">updateBox</span> &#125;)</span>;<br><span class="hljs-constructor">$(&#x27;#<span class="hljs-params">rangeRotateY</span>&#x27;)</span>.<span class="hljs-constructor">RangeSlider(&#123; <span class="hljs-params">min</span>: 0, <span class="hljs-params">max</span>: 180, <span class="hljs-params">step</span>: 0.1, <span class="hljs-params">callback</span>: <span class="hljs-params">updateBox</span> &#125;)</span>;<br><span class="hljs-constructor">$(&#x27;#<span class="hljs-params">rangeRotateZ</span>&#x27;)</span>.<span class="hljs-constructor">RangeSlider(&#123; <span class="hljs-params">min</span>: 0, <span class="hljs-params">max</span>: 180, <span class="hljs-params">step</span>: 0.1, <span class="hljs-params">callback</span>: <span class="hljs-params">updateBox</span> &#125;)</span>;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å¤§å‰ç«¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>js,3dmol</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flaskå¼‚æ­¥ä»»åŠ¡</title>
    <link href="/2023/01/31/Flask%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1/"/>
    <url>/2023/01/31/Flask%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1/</url>
    
    <content type="html"><![CDATA[<h2 id="Flask-Executorå®ç°å¼‚æ­¥"><a href="#Flask-Executorå®ç°å¼‚æ­¥" class="headerlink" title="Flask-Executorå®ç°å¼‚æ­¥"></a>Flask-Executorå®ç°å¼‚æ­¥</h2><span id="more"></span><p>Flask æ˜¯ Python ä¸­æœ‰åçš„è½»é‡çº§åŒæ­¥ web æ¡†æ¶ï¼Œåœ¨ä¸€äº›å¼€å‘ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°éœ€è¦é•¿æ—¶é—´å¤„ç†çš„ä»»åŠ¡ï¼Œæ­¤æ—¶å°±éœ€è¦ä½¿ç”¨å¼‚æ­¥çš„æ–¹å¼æ¥å®ç°ï¼Œè®©é•¿æ—¶é—´ä»»åŠ¡åœ¨åå°è¿è¡Œï¼Œå…ˆå°†æœ¬æ¬¡è¯·æ±‚çš„å“åº”çŠ¶æ€è¿”å›ç»™å‰ç«¯ï¼Œä¸è®©å‰ç«¯ç•Œé¢ã€Œå¡é¡¿ã€ï¼Œå½“å¼‚æ­¥ä»»åŠ¡å¤„ç†å¥½åï¼Œå¦‚æœéœ€è¦è¿”å›çŠ¶æ€ï¼Œå†å°†çŠ¶æ€è¿”å›ã€‚</p><p>ç½‘ä¸Šæ•™ç¨‹å¤§å¤šæ˜¯é’ˆå¯¹ concurrent.futures çš„ ThreadPoolExecutor(å¤šçº¿ç¨‹)å’ŒProcessPoolExecutor(å¤šè¿›ç¨‹)å®ç°ï¼Œè¿™é‡Œæ¨èä½¿ç”¨<br>Flask-Executorã€‚<br>å®˜æ–¹æ–‡æ¡£ä»‹ç»ï¼šFlask-Executor is a Flask extension that makes it easy to work with concurrent.futures in your application.</p><h5 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h5><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> flask-executor<br></code></pre></td></tr></table></figure><h5 id="è®¾ç½®"><a href="#è®¾ç½®" class="headerlink" title="è®¾ç½®"></a>è®¾ç½®</h5><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs clean"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><span class="hljs-keyword">from</span> flask_executor <span class="hljs-keyword">import</span> Executor<br><br>app = Flask(__name__)<br># app.config[<span class="hljs-string">&#x27;EXECUTOR_TYPE&#x27;</span>] = <span class="hljs-string">&#x27;process&#x27;</span><br>app.config[<span class="hljs-string">&#x27;EXECUTOR_TYPE&#x27;</span>] = <span class="hljs-string">&#x27;thread&#x27;</span><br>app.config[<span class="hljs-string">&#x27;EXECUTOR_MAX_WORKERS&#x27;</span>] = <span class="hljs-number">5</span><br>app.config[<span class="hljs-string">&#x27;EXECUTOR_PROPAGATE_EXCEPTIONS&#x27;</span>] = <span class="hljs-literal">True</span>   ## æ–¹ä¾¿debug<br>executor = Executor(app)<br></code></pre></td></tr></table></figure><h5 id="å®˜æ–¹å°ä¾‹å­ï¼š"><a href="#å®˜æ–¹å°ä¾‹å­ï¼š" class="headerlink" title="å®˜æ–¹å°ä¾‹å­ï¼š"></a>å®˜æ–¹å°ä¾‹å­ï¼š</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fib</span>(<span class="hljs-params">n</span>):</span><br>    <span class="hljs-keyword">if</span> n &lt;= <span class="hljs-number">2</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> fib(n-<span class="hljs-number">1</span>) + fib(n-<span class="hljs-number">2</span>)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/run_fib&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_fib</span>():</span><br>    executor.submit(fib, <span class="hljs-number">5</span>)<br>    executor.<span class="hljs-built_in">map</span>(fib, <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>))<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;OK&#x27;</span><br></code></pre></td></tr></table></figure><h5 id="æ”¶é›†å¼‚æ­¥ä»»åŠ¡ä¿¡æ¯"><a href="#æ”¶é›†å¼‚æ­¥ä»»åŠ¡ä¿¡æ¯" class="headerlink" title="æ”¶é›†å¼‚æ­¥ä»»åŠ¡ä¿¡æ¯"></a>æ”¶é›†å¼‚æ­¥ä»»åŠ¡ä¿¡æ¯</h5><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@app</span>.route(<span class="hljs-string">&#x27;/start-task&#x27;</span>)<br>def start_task():<br>    executor.submit_stored(<span class="hljs-string">&#x27;calc_power&#x27;</span>, pow, <span class="hljs-number">323</span>, <span class="hljs-number">1235</span>)<br>    return jsonify(&#123;<span class="hljs-string">&#x27;result&#x27;</span>:<span class="hljs-string">&#x27;success&#x27;</span>&#125;)<br><br><span class="hljs-variable">@app</span>.route(<span class="hljs-string">&#x27;/get-result&#x27;</span>)<br>def get_result():<br>    if not executor.futures.done(<span class="hljs-string">&#x27;calc_power&#x27;</span>):<br>        return jsonify(&#123;<span class="hljs-string">&#x27;status&#x27;</span>: executor.futures._state(<span class="hljs-string">&#x27;calc_power&#x27;</span>)&#125;)<br>    future = executor.futures.pop(<span class="hljs-string">&#x27;calc_power&#x27;</span>)<br>    return jsonify(&#123;<span class="hljs-string">&#x27;status&#x27;</span>: done, <span class="hljs-string">&#x27;result&#x27;</span>: future.result()&#125;)<br></code></pre></td></tr></table></figure><p>è¯¦ç»†æ–‡æ¡£è¯·æŸ¥é˜…ï¼š<a href="https://flask-executor.readthedocs.io/en/latest/">https://flask-executor.readthedocs.io/en/latest/</a></p><h5 id="log"><a href="#log" class="headerlink" title="log"></a>log</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><span class="hljs-keyword">from</span> logging.handlers <span class="hljs-keyword">import</span> TimedRotatingFileHandler<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Logger</span>:</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    è‡ªå®šä¹‰æ—¥å¿—æ‰“å°ç±»ï¼Œå°†æ—¥å¿—ä¿å­˜åˆ°`../logs/`ç›®å½•</span><br><span class="hljs-string">    è®¾ç½®æ—¥å¿—ç­‰çº§å’Œå¢åŠ å¤„ç†å™¨ï¼Œè®¾ç½®å¤„ç†å™¨ä¸ºæŒ‰ç…§æ—¥æœŸåˆ‡åˆ†ï¼Œæœ€å¤§ä¿ç•™30å¤©</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-comment"># åˆ›å»ºLogger</span><br>        self.logger = logging.getLogger()<br>        self.logger.setLevel(logging.DEBUG)<br><br>        <span class="hljs-comment"># ç»ˆç«¯Handler</span><br>        console_handler = logging.StreamHandler()<br>        console_handler.setLevel(logging.DEBUG)<br><br>        <span class="hljs-comment"># æ–‡ä»¶Handler</span><br>        <span class="hljs-comment"># file_handler = logging.FileHandler(</span><br>        <span class="hljs-comment">#     filename=&#x27;./logs/app.log&#x27;,</span><br>        <span class="hljs-comment">#     mode=&#x27;a+&#x27;,</span><br>        <span class="hljs-comment">#     encoding=&#x27;UTF-8&#x27;</span><br>        <span class="hljs-comment"># )</span><br>        file_handler = TimedRotatingFileHandler(<span class="hljs-string">&#x27;./logs/app.log&#x27;</span>, when=<span class="hljs-string">&#x27;d&#x27;</span>, interval=<span class="hljs-number">1</span>, backupCount=<span class="hljs-number">30</span>,<br>                                                         encoding=<span class="hljs-string">&quot;utf8&quot;</span>, delay=<span class="hljs-literal">False</span>)<br>        file_handler.setLevel(logging.NOTSET)<br><br>        <span class="hljs-comment"># Formatter</span><br>        formatter = logging.Formatter(<br>            fmt=<span class="hljs-string">&#x27;%(asctime)s --- %(levelname)s - %(message)s&#x27;</span>,<br>            datefmt=<span class="hljs-string">&quot;%Y-%m-%d %H:%M:%S&quot;</span><br>        )<br><br>        console_handler.setFormatter(formatter)<br>        file_handler.setFormatter(formatter)<br><br>        <span class="hljs-comment"># æ·»åŠ åˆ°Loggerä¸­</span><br>        self.logger.addHandler(file_handler)<br>        self.logger.addHandler(console_handler)<br></code></pre></td></tr></table></figure><ul><li>æ·»åŠ é¢œè‰²<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> colorama <span class="hljs-keyword">import</span> Fore,Back,Style<br><br><span class="hljs-comment">#  å‰æ™¯è‰²:ç™½è‰²  èƒŒæ™¯è‰²:ç»¿è‰²</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">white_green</span>(<span class="hljs-params">s</span>):</span><br>    <span class="hljs-keyword">return</span> Fore.WHITE + Back.GREEN + s + Style.RESET_ALL<br><br> <span class="hljs-comment">#  å‰æ™¯è‰²:ç™½è‰²  èƒŒæ™¯è‰²:çº¢è‰²</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">white_red</span>(<span class="hljs-params">s</span>):</span><br>    <span class="hljs-keyword">return</span> Fore.WHITE + Back.RED + s + Style.RESET_ALL<br></code></pre></td></tr></table></figure></li><li>è°ƒç”¨æ—¥å¿—<figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">LOGGER</span> = <span class="hljs-function"><span class="hljs-title">Logger</span>()</span><br><span class="hljs-variable">LOGGER.logger.info</span>(<span class="hljs-function"><span class="hljs-title">white_green</span>(<span class="hljs-string">&#x27;hello&#x27;</span>))</span><br></code></pre></td></tr></table></figure></li></ul><h5 id="bug"><a href="#bug" class="headerlink" title="bug"></a>bug</h5><p>å¤šçº¿ç¨‹æ“ä½œsqlite:Recursive use of cursors not allowed</p><p>è§£å†³æ–¹æ¡ˆå‚è€ƒï¼š<a href="https://blog.csdn.net/counsellor/article/details/43715007">https://blog.csdn.net/counsellor/article/details/43715007</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span>(<span class="hljs-params">database, projectId</span>):</span><br>    lock = threading.Lock()<br>    <span class="hljs-keyword">try</span>:<br>        lock.acquire(<span class="hljs-literal">True</span>)<br>        tmp_sql = <span class="hljs-string">&#x27;&#x27;&#x27;update tasks set complete = ? where projectId = ?&#x27;&#x27;&#x27;</span><br>        database.execute_sql(tmp_sql, (<span class="hljs-string">&#x27;Y&#x27;</span>, projectId))<br><br>        input_path = <span class="hljs-string">f&quot;static/project/<span class="hljs-subst">&#123;projectId&#125;</span>/result&quot;</span><br>        output_path = <span class="hljs-string">f&quot;static/project/<span class="hljs-subst">&#123;projectId&#125;</span>/result.zip&quot;</span><br>        zipDir(input_path, output_path)<br><br>        tmp_sql = <span class="hljs-string">&#x27;&#x27;&#x27;update tasks set result = ? where projectId = ?&#x27;&#x27;&#x27;</span><br>        database.execute_sql(tmp_sql, (output_path, projectId))<br>    <span class="hljs-keyword">finally</span>:<br>        lock.release()<br></code></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/briblue/article/details/85220740">https://blog.csdn.net/briblue/article/details/85220740</a></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Flask</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonä»é›¶ç”ŸæˆPDF</title>
    <link href="/2023/01/13/Python%E4%BB%8E%E9%9B%B6%E7%94%9F%E6%88%90PDF/"/>
    <url>/2023/01/13/Python%E4%BB%8E%E9%9B%B6%E7%94%9F%E6%88%90PDF/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><p>ä½¿ç”¨çš„åŒ…ä¸ºfpdfï¼Œå¯ç›´æ¥ä½¿ç”¨pipå®‰è£…</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> fpdf<br></code></pre></td></tr></table></figure><h5 id="ä¸­æ–‡å­—ä½“ä¸‹è½½"><a href="#ä¸­æ–‡å­—ä½“ä¸‹è½½" class="headerlink" title="ä¸­æ–‡å­—ä½“ä¸‹è½½"></a>ä¸­æ–‡å­—ä½“ä¸‹è½½</h5><p>è¯¥åŒ…é»˜è®¤æ˜¯ä¸æ”¯æŒä¸­æ–‡çš„ï¼Œå¦‚æœæƒ³ä½¿ç”¨ä¸­æ–‡ï¼Œéœ€è¦ä¸‹è½½ä¸­æ–‡å­—ä½“ï¼Œå¯åœ¨å¦‚ä¸‹åœ°å€ä¸‹è½½<br><a href="https://github.com/Haixing-Hu/latex-chinese-fonts">https://github.com/Haixing-Hu/latex-chinese-fonts</a></p><h5 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h5><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">from</span> fpdf import FPDF<br><br>pdf = FPDF()<br>pdf.add_page()   # è¿™å¥å¿…é¡»<br>pdf.set_font(<span class="hljs-string">&#x27;Arial&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>, 16)<br>pdf.cell(40, 10, <span class="hljs-string">&#x27;Hello World!&#x27;</span>)<br><span class="hljs-comment"># æ·»åŠ ä¸­æ–‡</span><br>pdf.add_font(<span class="hljs-string">&#x27;STSong&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-string">&#x27;db/font/é»‘ä½“/STHeiti.ttf&#x27;</span>,<span class="hljs-literal">True</span>) <br>pdf.set_font(<span class="hljs-string">&#x27;STSong&#x27;</span>,<span class="hljs-attribute">size</span>=25)<br>pdf.cell(0,20,<span class="hljs-string">&#x27;ä½ å¥½&#x27;</span>, <span class="hljs-attribute">ln</span>=1, <span class="hljs-attribute">align</span>=<span class="hljs-string">&#x27;C&#x27;</span>)<br><br><span class="hljs-comment"># å•è¡Œã€å¤šè¡Œæ’å…¥</span><br>pdf.cell(0,10,<span class="hljs-string">&#x27;å•è¡Œ&#x27;</span>, <span class="hljs-attribute">ln</span>=1) #æ’å…¥æ–‡æœ¬æ¡†ï¼Œ0è¡¨ç¤ºæ–‡æ¡£æ•´ä¸ªæ¨ªå‘é•¿åº¦ï¼Œ10æ˜¯é«˜åº¦, lnæ˜¯å¦æ¢è¡Œ<br>pdf.multi_cell(0,10,<span class="hljs-string">&#x27;å¤šè¡Œ&#x27;</span><span class="hljs-number">*100</span>)#å¤šè¡Œæ’å…¥<br><br><span class="hljs-comment"># æ·»åŠ è¶…é“¾æ¥</span><br>pdf.set_text_color(255,0,0) # æ›´æ”¹é¢œè‰²<br>pdf.cell(0,10, <span class="hljs-attribute">txt</span>=<span class="hljs-string">&#x27;ç™¾åº¦&#x27;</span>, <span class="hljs-attribute">link</span>=<span class="hljs-string">&#x27;www.baidu.com&#x27;</span>, <span class="hljs-attribute">ln</span>=1) # æ’å…¥é“¾æ¥<br><br>pdf.output(<span class="hljs-string">&#x27;tuto1.pdf&#x27;</span>, <span class="hljs-string">&#x27;F&#x27;</span>)<br></code></pre></td></tr></table></figure><p>å‚è€ƒï¼š<br><a href="https://www.modb.pro/db/598830">https://www.modb.pro/db/598830</a><br><a href="https://pyfpdf.readthedocs.io/en/latest/Tutorial/index.html">https://pyfpdf.readthedocs.io/en/latest/Tutorial/index.html</a></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>pdf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¾®ä¿¡å…¬ä¼—å·æ–‡ç« çˆ¬å–</title>
    <link href="/2023/01/11/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E6%96%87%E7%AB%A0%E7%88%AC%E5%8F%96/"/>
    <url>/2023/01/11/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E6%96%87%E7%AB%A0%E7%88%AC%E5%8F%96/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><p>æ¯ä¸ªå…¬ä¼—å·æ–‡ç« ä¼šæœ‰å¾ˆå¤šï¼Œæ‰€ä»¥è¿™é‡Œåªæå–äº†æœ€è¿‘å‘å¸ƒçš„æ–‡ç« ï¼Œæ—¶é—´å¯ä»¥è‡ªå®šä¹‰ã€‚<br>å®Œæ•´codeå¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> datetime<br><br><span class="hljs-comment">## è¿™é‡Œå®šä¹‰äº†çˆ¬å–3å¤©å†…çš„æ–‡ç« </span><br>earliest = datetime.datetime.now() + datetime.timedelta(-<span class="hljs-built_in">int</span>(<span class="hljs-number">3</span>))   <br>earliest = earliest.strftime(<span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)<br>earliest = datetime.datetime.strptime(earliest, <span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)<br>earliest = datetime.datetime.timestamp(earliest)<br>earliest<br><br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> urllib3<br><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">import</span> os,sys<br><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><span class="hljs-keyword">from</span> selenium.webdriver.common.by <span class="hljs-keyword">import</span> By<br><br>BASE_DIR = os.path.abspath(<span class="hljs-string">&quot;.&quot;</span>)<br><span class="hljs-comment"># sys.path.append(BASE_DIR)</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Wechat_Crawl</span>:</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self,cookie_path</span>):</span><br>        self.cookie_path = cookie_path<br>        self.qurey = subscription_account<br>        self.url =  <span class="hljs-string">&#x27;https://mp.weixin.qq.com&#x27;</span><br>        self.search_url = <span class="hljs-string">&#x27;https://mp.weixin.qq.com/cgi-bin/searchbiz?&#x27;</span><br>        self.appmsg_url = <span class="hljs-string">&#x27;https://mp.weixin.qq.com/cgi-bin/appmsg?&#x27;</span><br>        self.header = &#123;<br>            <span class="hljs-string">&quot;HOST&quot;</span>: <span class="hljs-string">&quot;mp.weixin.qq.com&quot;</span>,<br>            <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36&quot;</span><br>        &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">wechat_login</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        Login wechat by automatically inputing accounts and keywords and manully scanning QR codeï¼Œ and then you can</span><br><span class="hljs-string">        get the cookie information, save it in local file in order to simulate loginning and crawlingâ€¦â€¦</span><br><span class="hljs-string">        :param __username:</span><br><span class="hljs-string">        :param __password:</span><br><span class="hljs-string">        :return:</span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æµè§ˆå™¨å°†è‡ªåŠ¨æ‰“å¼€å¹¶è·³è½¬è‡³å¾®ä¿¡å…¬ä¼—å·ç™»å½•é¡µé¢â€¦â€¦&quot;</span>)<br>        time.sleep(<span class="hljs-number">1</span>)<br>        driver = webdriver.Chrome()<br>        driver.get(<span class="hljs-string">&quot;https://mp.weixin.qq.com/&quot;</span>)<br>        time.sleep(<span class="hljs-number">2</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¯·æ‹¿æ‰‹æœºæ‰«ç äºŒç»´ç ç™»å½•å…¬ä¼—å·&quot;</span>)<br>        time.sleep(<span class="hljs-number">15</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç™»å½•æˆåŠŸ&quot;</span>)<br><br>        cookies = driver.get_cookies()<br>        info = &#123;&#125;<br>        <span class="hljs-keyword">for</span> cookie <span class="hljs-keyword">in</span> cookies:<br>            info[cookie[<span class="hljs-string">&#x27;name&#x27;</span>]] = cookie[<span class="hljs-string">&#x27;value&#x27;</span>]<br>        cookie_info = json.dumps(info)<br><span class="hljs-comment">#         print(cookie_info)</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(cookie_path, <span class="hljs-string">&#x27;w+&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            f.write(cookie_info)<br>            f.flush()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;cookieså·²å­˜å…¥cookie.txt&quot;</span>,flush=<span class="hljs-literal">True</span>)<br>        driver.quit()<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_cookie</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(self.cookie_path, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            cookie = f.read()<br>        self.cookies = json.loads(cookie)<br><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">_session</span>(<span class="hljs-params">self</span>):</span><br>        urllib3.disable_warnings()<br>        <span class="hljs-comment"># requestsåº“urllibç¼–å†™ï¼Œæ˜¯å¯¹urllibè¿›è¡Œäº†å°è£…ï¼Œåœ¨urllib2ç‰ˆæœ¬å¯¹httpsçš„å¤„ç†éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨è¯·æ±‚çš„æ—¶å€™åŠ ä¸Šverify = Falseå³å¯ï¼Œ</span><br>        <span class="hljs-comment"># è¿™ä¸ªå‚æ•°çš„æ„æ€æ˜¯å¿½ç•¥httpså®‰å…¨è¯ä¹¦çš„éªŒè¯ï¼Œä¹Ÿå°±æ˜¯ä¸éªŒè¯è¯ä¹¦çš„å¯é æ€§ï¼Œç›´æ¥è¯·æ±‚ï¼Œè¿™å…¶å®æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºè¯ä¹¦å¯ä»¥ä¼ªé€ ï¼Œä¸éªŒè¯çš„è¯å°±ä¸</span><br>        <span class="hljs-comment"># èƒ½ä¿è¯æ•°æ®çš„çœŸå®æ€§ã€‚</span><br>        <span class="hljs-comment"># åœ¨urllib3ç‰ˆæœ¬ï¼Œå®˜æ–¹å¼ºåˆ¶éªŒè¯httpsçš„å®‰å…¨è¯ä¹¦ï¼Œå¦‚æœæ²¡æœ‰é€šè¿‡æ˜¯ä¸èƒ½é€šè¿‡è¯·æ±‚çš„ï¼Œè™½ç„¶æ·»åŠ å¿½ç•¥éªŒè¯çš„å‚æ•°ï¼Œä½†æ˜¯ä¾ç„¶ä¼šç»™å‡ºé†’ç›®çš„Warning</span><br>        <span class="hljs-comment"># urllib3.disable_warnings()å¯ä»¥ç¦ç”¨urllib3çš„è­¦å‘Šã€‚</span><br>        session = requests.Session()<br>        session.keep_alive = <span class="hljs-literal">False</span><br>        session.adapters.DEFAULT_RETRIES = <span class="hljs-number">511</span><br>        self.session = session<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_token</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        to get the token from the loginned page.</span><br><span class="hljs-string">        :param cookie_path:</span><br><span class="hljs-string">        :return: token</span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br>        time.sleep(<span class="hljs-number">1</span>)<br>        response = self.session.get(url=self.url, cookies=self.cookies, verify=<span class="hljs-literal">False</span>)<br>        url = <span class="hljs-built_in">str</span>(response.url)<br>        pattern = <span class="hljs-string">r&#x27;token=([0-9]+)&#x27;</span><br>        self.token = re.findall(pattern,url)[<span class="hljs-number">0</span>]<br><br>        <span class="hljs-keyword">return</span> self.token<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_fakedid</span>(<span class="hljs-params">self, query</span>):</span><br>        query_id = &#123;<br>            <span class="hljs-string">&#x27;action&#x27;</span>: <span class="hljs-string">&#x27;search_biz&#x27;</span>,<br>            <span class="hljs-string">&#x27;token&#x27;</span>: self.token,<br>            <span class="hljs-string">&#x27;lang&#x27;</span>: <span class="hljs-string">&#x27;zh_CN&#x27;</span>,<br>            <span class="hljs-string">&#x27;f&#x27;</span>: <span class="hljs-string">&#x27;json&#x27;</span>,<br>            <span class="hljs-string">&#x27;ajax&#x27;</span>: <span class="hljs-string">&#x27;1&#x27;</span>,<br>            <span class="hljs-string">&#x27;random&#x27;</span>: random.random(),<br>            <span class="hljs-string">&#x27;query&#x27;</span>: query,<br>            <span class="hljs-string">&#x27;begin&#x27;</span>: <span class="hljs-string">&#x27;0&#x27;</span>,<br>            <span class="hljs-string">&#x27;count&#x27;</span>: <span class="hljs-string">&#x27;5&#x27;</span><br>        &#125;<br>        search_response = self.session.get(<br>            self.search_url,<br>            headers=self.header,<br>            cookies=self.cookies,<br>            params=query_id)<br>        lists = search_response.json()[<span class="hljs-string">&#x27;list&#x27;</span>][<span class="hljs-number">0</span>]<br><br>        self.fakeid = lists[<span class="hljs-string">&#x27;fakeid&#x27;</span>]<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_args</span>(<span class="hljs-params">self, query</span>):</span><br>        self.get_cookie()<br>        self._session()<br>        self.get_token()<br>        self.get_fakedid(query)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_info</span>(<span class="hljs-params">self,output_path</span>):</span><br>        self.begin = <span class="hljs-number">0</span><br>        self.flag = <span class="hljs-literal">True</span><br>        <br>        self.data = &#123;<br>            <span class="hljs-string">&quot;token&quot;</span>: self.token,<br>            <span class="hljs-string">&quot;lang&quot;</span>: <span class="hljs-string">&quot;zh_CN&quot;</span>,<br>            <span class="hljs-string">&quot;f&quot;</span>: <span class="hljs-string">&quot;json&quot;</span>,<br>            <span class="hljs-string">&quot;ajax&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,<br>            <span class="hljs-string">&quot;action&quot;</span>: <span class="hljs-string">&quot;list_ex&quot;</span>,<br>            <span class="hljs-string">&quot;begin&quot;</span>: self.begin,<br>            <span class="hljs-string">&quot;count&quot;</span>: <span class="hljs-string">&quot;5&quot;</span>,<br>            <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>            <span class="hljs-string">&quot;fakeid&quot;</span>: self.fakeid,<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;9&quot;</span>,<br>        &#125;<br>        <br><span class="hljs-comment">#         print(self.data)</span><br><br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            <span class="hljs-keyword">if</span> self.flag == <span class="hljs-literal">False</span>:<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-comment"># éšæœºæš‚åœå‡ ç§’ï¼Œé¿å…è¿‡å¿«çš„è¯·æ±‚å¯¼è‡´è¿‡å¿«çš„è¢«æŸ¥åˆ°</span><br>            time.sleep(random.randint(<span class="hljs-number">5</span>,<span class="hljs-number">10</span>))<br>            self.data[<span class="hljs-string">&#x27;begin&#x27;</span>] = self.begin * <span class="hljs-number">5</span><br>            res = requests.get(self.appmsg_url, cookies=self.cookies, headers=self.header, params=self.data)<br>            <span class="hljs-keyword">try</span>:<br>                json = res.json()<br>                count = json[<span class="hljs-string">&#x27;app_msg_cnt&#x27;</span>]<br><br>                <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> json[<span class="hljs-string">&quot;app_msg_list&quot;</span>]:<br>                    <span class="hljs-keyword">if</span> item[<span class="hljs-string">&#x27;create_time&#x27;</span>] &lt; earliest:<br>                        self.flag = <span class="hljs-literal">False</span><br>                        <span class="hljs-keyword">break</span><br>                    create_date = time.strftime(<span class="hljs-string">&quot;%Y-%m-%d&quot;</span>, time.localtime(item[<span class="hljs-string">&#x27;create_time&#x27;</span>]))<br><span class="hljs-comment">#                     print(create_date)</span><br>                    title = item[<span class="hljs-string">&#x27;title&#x27;</span>].replace(<span class="hljs-string">&quot;\n&quot;</span>, <span class="hljs-string">&quot;&quot;</span>)<br>                    link = item[<span class="hljs-string">&#x27;link&#x27;</span>]<br>                    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_path, <span class="hljs-string">&#x27;a+&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8-sig&#x27;</span>) <span class="hljs-keyword">as</span> fh:<br>                        article_info = <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;create_date&#125;</span>,<span class="hljs-subst">&#123;title&#125;</span>,<span class="hljs-subst">&#123;link&#125;</span>\n&#x27;</span><br>                        fh.write(article_info)<br>                        fh.flush()<br>                <br>                self.begin += <span class="hljs-number">1</span><br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;å®Œæˆç¬¬<span class="hljs-subst">&#123;self.begin&#125;</span>é¡µ&#x27;</span>)<br><br>            <span class="hljs-keyword">except</span>:<br>                <span class="hljs-built_in">print</span>(res.json()[<span class="hljs-string">&#x27;base_resp&#x27;</span>][<span class="hljs-string">&#x27;err_msg&#x27;</span>])<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Try it again after two hours.&quot;</span>)<br>                <span class="hljs-keyword">break</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>(<span class="hljs-params">self,query, output_path</span>):</span><br>        self.get_args(query)<br>        self.get_info(output_path)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment">## å¯è‡ªå®šä¹‰éœ€è¦çˆ¬å–çš„å…¬ä¼—å·</span><br>    subscription_account_list = &#123;<span class="hljs-string">&#x27;åŒ»éº¦å®¢&#x27;</span>:<span class="hljs-string">&#x27;eMedClub&#x27;</span>, <span class="hljs-string">&#x27;AIDD-Pro&#x27;</span>:<span class="hljs-string">&quot;AIDDPro&quot;</span>&#125;<br>    <br>    cookie_path = BASE_DIR + os.sep + <span class="hljs-string">&#x27;db&#x27;</span> + os.sep + <span class="hljs-string">&#x27;cookie.txt&#x27;</span><br>    wc = Wechat_Crawl(cookie_path)<br>    wc.wechat_login()<br>    <span class="hljs-keyword">for</span> k,v <span class="hljs-keyword">in</span> subscription_account_list.items():<br>        output_path = BASE_DIR + os.sep + <span class="hljs-string">&#x27;db&#x27;</span> + os.sep + <span class="hljs-string">&#x27;data&#x27;</span> + os.sep + k + <span class="hljs-string">&#x27;.csv&#x27;</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¼€å§‹çˆ¬å–å…¬ä¼—å·:&quot;</span>,k)<br>        wc.run(v, output_path)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;çˆ¬å–å®Œæˆ:&quot;</span>, k)<br></code></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://cloud.tencent.com/developer/article/1506163">https://cloud.tencent.com/developer/article/1506163</a><br>     <a href="https://zhuanlan.zhihu.com/p/379062852">https://zhuanlan.zhihu.com/p/379062852</a></p><p>å¦å¤–å¾—åˆ°çš„å…¬ä¼—å·æ–‡ç« éœ€è¦è¿›ä¸€æ­¥å¤„ç†ï¼Œè¿™é‡Œä»¥æŸç¯‡ä¸ºä¾‹ï¼š</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs clean"><span class="hljs-keyword">import</span> lxml<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br><br>url = <span class="hljs-string">&#x27;https://mp.weixin.qq.com/s/v5NtX6xr2a2-lpDG2yvgLA&#x27;</span><br>page = requests.get(url)<br><br># æœ‰äº›æ­£æ–‡è¢«éšè—<br>html = page.text.replace(<span class="hljs-string">&quot;data-src&quot;</span>, <span class="hljs-string">&quot;src&quot;</span>).replace(<span class="hljs-string">&#x27;style=&quot;visibility: hidden;&quot;&#x27;</span>,<span class="hljs-string">&quot;&quot;</span>)<br># html = re.sub(<span class="hljs-string">&quot;&lt;/html&gt;&quot;</span>,<span class="hljs-string">&quot;&quot;</span>,page.text,flags=re.S|re.IGNORECASE)+<span class="hljs-string">&quot;&lt;/html&gt;&quot;</span><br># soup = BeautifulSoup(page.content, <span class="hljs-string">&#x27;lxml&#x27;</span>)<br>soup = BeautifulSoup(html, <span class="hljs-string">&#x27;lxml&#x27;</span>)<br><br># è·å–æ­£æ–‡, é€šè¿‡idæˆ–è€…<span class="hljs-keyword">class</span>è·å–<br># wb = soup.find(<span class="hljs-string">&#x27;div&#x27;</span>, &#123;<span class="hljs-string">&#x27;class&#x27;</span>: <span class="hljs-string">&quot;rich_media_content&quot;</span>&#125;)<br>wb = soup.find(<span class="hljs-string">&#x27;div&#x27;</span>, id=<span class="hljs-string">&#x27;js_content&#x27;</span>)<br><br>## åˆ é™¤ä¸éœ€è¦çš„ä¿¡æ¯<br>tmp = <span class="hljs-number">0</span><br>for i, tag <span class="hljs-keyword">in</span> enumerate(wb.find_all(<span class="hljs-string">&#x27;section&#x27;</span>)):<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;æ‹›è˜ä¿¡æ¯&#x27;</span> <span class="hljs-keyword">in</span> tag.prettify():<br>        tmp = i<br>        break<br><br>for i, tag <span class="hljs-keyword">in</span> enumerate(wb.find_all(<span class="hljs-string">&#x27;section&#x27;</span>)):<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;å‰è¨€&#x27;</span> <span class="hljs-keyword">in</span> tag.prettify() and i&gt;=<span class="hljs-number">3</span>:<br>#         tag.extract()<br>        tag.decompose()<br>    <span class="hljs-keyword">if</span> i &gt;= tmp:<br>#         tag.extract()<br>        tag.decompose()<br>        <br># del_str = wb.find_all(<span class="hljs-string">&#x27;ol&#x27;</span>, &#123;<span class="hljs-string">&#x27;class&#x27;</span>: <span class="hljs-string">&quot;list-paddingleft-1&quot;</span>&#125;)[<span class="hljs-number">-1</span>].extract()<br>wb.find_all(<span class="hljs-string">&#x27;ol&#x27;</span>, &#123;<span class="hljs-string">&#x27;class&#x27;</span>: <span class="hljs-string">&quot;list-paddingleft-1&quot;</span>&#125;)[<span class="hljs-number">-1</span>].decompose()<br><br># ä¿å­˜æˆhtmlæ ¼å¼<br><span class="hljs-keyword">with</span> open(<span class="hljs-string">&#x27;AIè¯ç‰©å‘¨èµ„è®¯.html&#x27;</span>,<span class="hljs-string">&quot;w&quot;</span>,encoding=<span class="hljs-string">&quot;utf-8-sig&quot;</span>)<span class="hljs-keyword">as</span> f:<br>    f.write(wb.prettify(formatter=<span class="hljs-string">&#x27;html&#x27;</span>))<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>çˆ¬è™«</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¼‚è´¨å›¾é“¾æ¥é¢„æµ‹</title>
    <link href="/2022/12/15/%E5%BC%82%E8%B4%A8%E5%9B%BE%E9%93%BE%E6%8E%A5%E9%A2%84%E6%B5%8B/"/>
    <url>/2022/12/15/%E5%BC%82%E8%B4%A8%E5%9B%BE%E9%93%BE%E6%8E%A5%E9%A2%84%E6%B5%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<br><span class="hljs-title">from</span> torch <span class="hljs-keyword">import</span> nn<br><span class="hljs-keyword">import</span> copy<br><br><span class="hljs-title">from</span> torch_geometric.nn <span class="hljs-keyword">import</span> RGCNConv<br><span class="hljs-title">from</span> tqdm.notebook <span class="hljs-keyword">import</span> tqdm<br><span class="hljs-title">from</span> torch_geometric.utils <span class="hljs-keyword">import</span> negative_sampling<br><span class="hljs-title">from</span> sklearn.metrics <span class="hljs-keyword">import</span> roc_auc_score<br><span class="hljs-title">from</span> torch_geometric.<span class="hljs-class"><span class="hljs-keyword">data</span> import <span class="hljs-type">HeteroData</span></span><br><span class="hljs-title">from</span> torch_geometric.datasets <span class="hljs-keyword">import</span> DBLP<br><br><br><span class="hljs-title">dataset</span> = <span class="hljs-type">DBLP</span>(root=&#x27;./<span class="hljs-type">DBLP&#x27;</span>)<br><span class="hljs-title">graph</span> = dataset[<span class="hljs-number">0</span>]<br><br></code></pre></td></tr></table></figure><p>HeteroData(<br>  author={<br>    x=[4057, 334],<br>    y=[4057],<br>    train_mask=[4057],<br>    val_mask=[4057],<br>    test_mask=[4057]<br>  },<br>  paper={ x=[14328, 4231] },<br>  term={ x=[7723, 50] },<br>  conference={ num_nodes=20 },<br>  (author, to, paper)={ edge_index=[2, 19645] },<br>  (paper, to, author)={ edge_index=[2, 19645] },<br>  (paper, to, term)={ edge_index=[2, 85810] },<br>  (paper, to, conference)={ edge_index=[2, 14328] },<br>  (term, to, paper)={ edge_index=[2, 85810] },<br>  (conference, to, paper)={ edge_index=[2, 14328] }<br>)</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># # å› ä¸ºconferenceèŠ‚ç‚¹æ²¡æœ‰ç‰¹å¾ä¿¡æ¯ï¼Œæ‰€ä»¥å°†conferenceèŠ‚ç‚¹çš„ç‰¹å¾åˆå§‹åŒ–ä¸º1</span><br>graph[<span class="hljs-string">&#x27;conference&#x27;</span>].x = torch.ones(graph[<span class="hljs-string">&#x27;conference&#x27;</span>].num_nodes, 1)<br>graph<br><br>node_types, edge_types = graph.metadata()<br><span class="hljs-builtin-name">print</span>(<span class="hljs-string">&#x27;node_types:&#x27;</span>, node_types)<br><span class="hljs-builtin-name">print</span>(<span class="hljs-string">&#x27;edge_types:&#x27;</span>, edge_types)<br>num_relations = len(edge_types)<br><span class="hljs-builtin-name">print</span>(<span class="hljs-string">&#x27;num_relations:&#x27;</span>, num_relations)<br>init_sizes = [graph[x].x.shape[1] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> node_types]<br><span class="hljs-builtin-name">print</span>(init_sizes)<br>device = torch.device(<span class="hljs-string">&#x27;cpu&#x27;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros">train_data, val_data, test_data = T.RandomLinkSplit(<br>        <span class="hljs-attribute">num_val</span>=0.1,<br>        <span class="hljs-attribute">num_test</span>=0.1,<br>        <span class="hljs-attribute">is_undirected</span>=<span class="hljs-literal">True</span>,<br>        <span class="hljs-attribute">add_negative_train_samples</span>=<span class="hljs-literal">False</span>,<br>        <span class="hljs-attribute">disjoint_train_ratio</span>=0,<br>        edge_types=[(<span class="hljs-string">&#x27;author&#x27;</span>, <span class="hljs-string">&#x27;to&#x27;</span>, <span class="hljs-string">&#x27;paper&#x27;</span>), (<span class="hljs-string">&#x27;paper&#x27;</span>, <span class="hljs-string">&#x27;to&#x27;</span>, <span class="hljs-string">&#x27;term&#x27;</span>),<br>                    (<span class="hljs-string">&#x27;paper&#x27;</span>, <span class="hljs-string">&#x27;to&#x27;</span>, <span class="hljs-string">&#x27;conference&#x27;</span>)],<br>        rev_edge_types=[(<span class="hljs-string">&#x27;paper&#x27;</span>, <span class="hljs-string">&#x27;to&#x27;</span>, <span class="hljs-string">&#x27;author&#x27;</span>), (<span class="hljs-string">&#x27;term&#x27;</span>, <span class="hljs-string">&#x27;to&#x27;</span>, <span class="hljs-string">&#x27;paper&#x27;</span>),<br>                        (<span class="hljs-string">&#x27;conference&#x27;</span>, <span class="hljs-string">&#x27;to&#x27;</span>, <span class="hljs-string">&#x27;paper&#x27;</span>)]<br>    )(graph.to_homogeneous())<br>train_data<br></code></pre></td></tr></table></figure><p>Data(edge_index=[2, 191654], node_type=[26128], edge_type=[191654], edge_label=[95827], edge_label_index=[2, 95827])</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-title">def</span> negative_sample(<span class="hljs-class"><span class="hljs-keyword">data</span>):</span><br>    # ä»è®­ç»ƒé›†ä¸­é‡‡æ ·ä¸æ­£è¾¹ç›¸åŒæ•°é‡çš„è´Ÿè¾¹<br>    neg_edge_index = negative_sampling(<br>        edge_index=<span class="hljs-class"><span class="hljs-keyword">data</span>.edge_index, num_nodes=<span class="hljs-keyword">data</span>.num_nodes,</span><br>        num_neg_samples=<span class="hljs-class"><span class="hljs-keyword">data</span>.edge_label_index.size(1), method=&#x27;sparse&#x27;)</span><br>    # print(neg_edge_index.size(<span class="hljs-number">1</span>))   # <span class="hljs-number">3642</span>æ¡è´Ÿè¾¹ï¼Œå³æ¯æ¬¡é‡‡æ ·ä¸è®­ç»ƒé›†ä¸­æ­£è¾¹æ•°é‡ä¸€è‡´çš„è´Ÿè¾¹<br>    edge_label_index = torch.cat(<br>        [<span class="hljs-class"><span class="hljs-keyword">data</span>.edge_label_index, neg_edge_index],</span><br>        dim=<span class="hljs-number">-1</span>,<br>    )<br>    edge_label = torch.cat([<br>        <span class="hljs-class"><span class="hljs-keyword">data</span>.edge_label,</span><br>        <span class="hljs-class"><span class="hljs-keyword">data</span>.edge_label.new_zeros(<span class="hljs-title">neg_edge_index</span>.<span class="hljs-title">size</span>(1))</span><br>    ], dim=<span class="hljs-number">0</span>)<br><br>    return edge_label, edge_label_index<br></code></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RGCN_LP</span>(<span class="hljs-title">nn</span>.<span class="hljs-title">Module</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(<span class="hljs-keyword">self</span>, in_channels, hidden_channels, out_channels)</span></span>:<br>        <span class="hljs-keyword">super</span>(RGCN_LP, <span class="hljs-keyword">self</span>).__init__()<br>        <span class="hljs-keyword">self</span>.conv1 = RGCNConv(in_channels, hidden_channels,<br>                              num_relations=num_relations, num_bases=<span class="hljs-number">30</span>)<br>        <span class="hljs-keyword">self</span>.conv2 = RGCNConv(hidden_channels, out_channels,<br>                              num_relations=num_relations, num_bases=<span class="hljs-number">30</span>)<br>        <span class="hljs-keyword">self</span>.lins = torch.nn.ModuleList()<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(node_types)):<br>            lin = nn.Linear(init_sizes[i], in_channels)<br>            <span class="hljs-keyword">self</span>.lins.append(lin)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">trans_dimensions</span><span class="hljs-params">(<span class="hljs-keyword">self</span>, g)</span></span>:<br>        data = copy.deepcopy(g)<br>        <span class="hljs-keyword">for</span> node_type, lin <span class="hljs-keyword">in</span> zip(node_types, <span class="hljs-keyword">self</span>.lins):<br>            data[node_type].x = lin(data[node_type].x)<br><br>        <span class="hljs-keyword">return</span> data<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode</span><span class="hljs-params">(<span class="hljs-keyword">self</span>, data)</span></span>:<br>        data = <span class="hljs-keyword">self</span>.trans_dimensions(data)<br>        homogeneous_data = data.to_homogeneous()<br>        <span class="hljs-comment"># print(homogeneous_data)</span><br>        edge_index, edge_type = homogeneous_data.edge_index, homogeneous_data.edge_type<br>        <span class="hljs-comment"># print(edge_type)</span><br>        x = <span class="hljs-keyword">self</span>.conv1(homogeneous_data.x, edge_index, edge_type)<br>        x = <span class="hljs-keyword">self</span>.conv2(x, edge_index, edge_type)<br>        <span class="hljs-keyword">return</span> x<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode</span><span class="hljs-params">(<span class="hljs-keyword">self</span>, z, edge_label_index)</span></span>:<br>        <span class="hljs-comment"># zæ‰€æœ‰èŠ‚ç‚¹çš„è¡¨ç¤ºå‘é‡</span><br>        src = z[edge_label_index[<span class="hljs-number">0</span>]]<br>        dst = z[edge_label_index[<span class="hljs-number">1</span>]]<br>        <span class="hljs-comment"># print(dst.size())</span><br>        r = (src * dst).sum(dim=-<span class="hljs-number">1</span>)<br>        <span class="hljs-comment"># print(r.size())</span><br>        <span class="hljs-keyword">return</span> r<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span><span class="hljs-params">(<span class="hljs-keyword">self</span>, data, edge_label_index)</span></span>:<br>        z = <span class="hljs-keyword">self</span>.encode(data)<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.decode(z, edge_label_index)<br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs css">def test(model, data):<br>    model.<span class="hljs-built_in">eval</span>()<br>    with torch.<span class="hljs-built_in">no_grad</span>():<br>        edge_label, edge_label_index = <span class="hljs-built_in">negative_sample</span>(data)<br>        out = <span class="hljs-built_in">model</span>(graph, edge_label_index).<span class="hljs-built_in">view</span>(-<span class="hljs-number">1</span>)<br>        model.<span class="hljs-built_in">train</span>()<br>    return <span class="hljs-built_in">roc_auc_score</span>(edge_label.<span class="hljs-built_in">cpu</span>().<span class="hljs-built_in">numpy</span>(), out.<span class="hljs-built_in">cpu</span>().<span class="hljs-built_in">numpy</span>())<br><br><br><br>model = <span class="hljs-built_in">RGCN_LP</span>(<span class="hljs-number">128</span>, <span class="hljs-number">64</span>, <span class="hljs-number">4</span>).<span class="hljs-built_in">to</span>(device)<br>optimizer = torch.optim.<span class="hljs-built_in">Adam</span>(params=model.<span class="hljs-built_in">parameters</span>(), lr=<span class="hljs-number">0.01</span>)<br>criterion = torch.nn.<span class="hljs-built_in">BCEWithLogitsLoss</span>().<span class="hljs-built_in">to</span>(device)<br>min_epochs = <span class="hljs-number">10</span><br>best_model = None<br>best_val_auc = <span class="hljs-number">0</span><br>final_test_auc = <span class="hljs-number">0</span><br>model.<span class="hljs-built_in">train</span>()<br>for epoch in <span class="hljs-built_in">range</span>(<span class="hljs-number">500</span>):<br>    optimizer.<span class="hljs-built_in">zero_grad</span>()<br>    edge_label, edge_label_index = <span class="hljs-built_in">negative_sample</span>(train_data)<br>    out = <span class="hljs-built_in">model</span>(graph, edge_label_index).<span class="hljs-built_in">view</span>(-<span class="hljs-number">1</span>)<br>    loss = <span class="hljs-built_in">criterion</span>(out, edge_label)<br>    loss.<span class="hljs-built_in">backward</span>()<br>    optimizer.<span class="hljs-built_in">step</span>()<br>    # validation<br>    val_auc = <span class="hljs-built_in">test</span>(model, val_data)<br>    # test_auc = <span class="hljs-built_in">test</span>(model, test_data)<br>    if epoch + <span class="hljs-number">1</span> &gt; min_epochs and val_auc &gt; best_val_auc:<br>        best_val_auc = val_auc<br>        # final_test_auc = test_auc<br>    if epoch % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;epoch &#123;:03d&#125; train_loss &#123;:.8f&#125; val_auc &#123;:.4f&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(epoch, loss.<span class="hljs-built_in">item</span>(), val_auc))<br>        # <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;epoch &#123;:03d&#125; train_loss &#123;:.8f&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(epoch, loss.<span class="hljs-built_in">item</span>()))<br><br></code></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/circle2015/article/details/128004889">https://blog.csdn.net/circle2015/article/details/128004889</a><br>     <a href="https://blog.csdn.net/Cyril_KI/article/details/126186418?spm=1001.2014.3001.5502">https://blog.csdn.net/Cyril_KI/article/details/126186418?spm=1001.2014.3001.5502</a><br>     <a href="https://blog.csdn.net/Cyril_KI/article/details/126048682">https://blog.csdn.net/Cyril_KI/article/details/126048682</a><br>     <a href="https://zhuanlan.zhihu.com/p/354258797">https://zhuanlan.zhihu.com/p/354258797</a><br>     <a href="https://blog.csdn.net/PolarisRisingWar/article/details/128130870">https://blog.csdn.net/PolarisRisingWar/article/details/128130870</a><br>     <a href="https://blog.csdn.net/PolarisRisingWar/article/details/126980943">https://blog.csdn.net/PolarisRisingWar/article/details/126980943</a></p>]]></content>
    
    
    <categories>
      
      <category>å›¾ç¥ç»ç½‘ç»œ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼‚è´¨å›¾</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨çº¿è¿è¡ŒVueé¡¹ç›®</title>
    <link href="/2022/12/05/%E5%9C%A8%E7%BA%BF%E8%BF%90%E8%A1%8CVue%E9%A1%B9%E7%9B%AE/"/>
    <url>/2022/12/05/%E5%9C%A8%E7%BA%BF%E8%BF%90%E8%A1%8CVue%E9%A1%B9%E7%9B%AE/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><ul><li><p>åœ¨çº¿è¿è¡ŒVueé¡¹ç›®åœ°å€ï¼š<a href="https://stackblitz.com/">https://stackblitz.com/</a><br>æ³¨å†Œç™»å½•å³å¯ï¼Œä¹Ÿå¯ç›´æ¥ä½¿ç”¨githubè´¦æˆ·ç™»å½•ã€‚é€‰æ‹©Vue3åå°±ç›´æ¥è¿›å…¥ç¯å¢ƒäº†ã€‚è™½ç„¶æ˜¾ç¤ºå¯ä»¥ç›´æ¥å¯¼å…¥githubä»“åº“ï¼Œä¸è¿‡æµ‹è¯•å¯¼å…¥ä¸æ˜¾ç¤ºï¼Œå¯èƒ½è¿˜æœ‰bugå§</p></li><li><p>æŒ‰ç…§å‚è€ƒçš„æ–¹æ³•ä½¿ç”¨<br><a href="https://stackblitz.com/github">https://stackblitz.com/github</a> + åç§°/ä»“åº“ï¼ˆJeff-Bee/knowledgeGraphï¼‰å³ <a href="https://stackblitz.com/github/Jeff-Bee/knowledgeGraph">https://stackblitz.com/github/Jeff-Bee/knowledgeGraph</a></p></li><li><p>è¿›å»åä¼šè‡ªåŠ¨å®‰è£…ä¾èµ–ï¼Œå¦‚æœæ²¡å®‰è£…æˆåŠŸï¼Œåœ¨ç»ˆç«¯é‡æ–°æ‰§è¡Œå®‰è£…å‘½ä»¤</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">npm <span class="hljs-keyword">install</span><br></code></pre></td></tr></table></figure></li><li><p>å¯åŠ¨é¡¹ç›®</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">npm <span class="hljs-builtin-name">run</span> serve<br></code></pre></td></tr></table></figure></li></ul><p>å‚è€ƒï¼š<br><a href="https://cloud.tencent.com/developer/article/1429246">https://cloud.tencent.com/developer/article/1429246</a></p>]]></content>
    
    
    <categories>
      
      <category>å‰ç«¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç›‘æ§cpuä½¿ç”¨ç‡å¯è§†åŒ–</title>
    <link href="/2022/11/03/%E7%9B%91%E6%8E%A7cpu%E4%BD%BF%E7%94%A8%E7%8E%87%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    <url>/2022/11/03/%E7%9B%91%E6%8E%A7cpu%E4%BD%BF%E7%94%A8%E7%8E%87%E5%8F%AF%E8%A7%86%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><p>å¯è§†åŒ–ä½¿ç”¨çš„echarts</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">var</span> <span class="hljs-string">myChart</span> <span class="hljs-string">=</span> <span class="hljs-string">echarts.init(document.getElementById(&#x27;main&#x27;));</span><br><span class="hljs-string">var</span> <span class="hljs-string">data</span> <span class="hljs-string">=</span> <span class="hljs-string">parseInt(res.data);</span><br><span class="hljs-string">//</span> <span class="hljs-string">æŒ‡å®šå›¾è¡¨çš„é…ç½®é¡¹å’Œæ•°æ®</span><br><span class="hljs-string">var</span> <span class="hljs-string">option</span> <span class="hljs-string">=</span> &#123;<br>  <span class="hljs-attr">dark:</span> <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">backgroundColor:</span> <span class="hljs-string">&#x27;#001122&#x27;</span>,<br>  <span class="hljs-attr">series:</span> [<br>    &#123;<br>      <span class="hljs-attr">type:</span> <span class="hljs-string">&#x27;gauge&#x27;</span>,<br>      <span class="hljs-attr">progress:</span> &#123;<br>        <span class="hljs-attr">show:</span> <span class="hljs-literal">false</span>,<br>        <span class="hljs-attr">width:</span> <span class="hljs-number">5</span>,<br>        <span class="hljs-attr">itemStyle:</span> &#123;<br>          <span class="hljs-attr">color:</span> &#123;<br>            <span class="hljs-attr">type:</span> <span class="hljs-string">&#x27;radial&#x27;</span>,<br>            <span class="hljs-attr">global:</span> <span class="hljs-literal">true</span>,<br>            <span class="hljs-string">//</span> <span class="hljs-attr">x:</span> <span class="hljs-number">1</span>,<br>            <span class="hljs-string">//</span> <span class="hljs-attr">y:</span> <span class="hljs-number">0.5</span>,<br>            <span class="hljs-string">//</span> <span class="hljs-attr">r:</span> <span class="hljs-number">0.5</span>,<br>            <span class="hljs-attr">colorStops:</span> [<br>              &#123;<br>                <span class="hljs-attr">offset:</span> <span class="hljs-number">0</span>,<br>                <span class="hljs-attr">color:</span> <span class="hljs-string">&#x27;transparent&#x27;</span>,<br>              &#125;,<br>              &#123;<br>                <span class="hljs-attr">offset:</span> <span class="hljs-number">0.7</span>,<br>                <span class="hljs-attr">color:</span> <span class="hljs-string">&#x27;transparent&#x27;</span>,<br>              &#125;,<br>              &#123;<br>                <span class="hljs-attr">offset:</span> <span class="hljs-number">0.95</span>,<br>                <span class="hljs-attr">color:</span> <span class="hljs-string">&#x27;rgba(150, 200, 255, 0.5)&#x27;</span>,<br>              &#125;,<br>              &#123;<br>                <span class="hljs-attr">offset:</span> <span class="hljs-number">0.98</span>,<br>                <span class="hljs-attr">color:</span> <span class="hljs-string">&#x27;rgba(230, 250, 255, 0.9)&#x27;</span>,<br>              &#125;,<br>              &#123;<br>                <span class="hljs-attr">offset:</span> <span class="hljs-number">1</span>,<br>                <span class="hljs-attr">color:</span> <span class="hljs-string">&#x27;rgba(255,255,255,1)&#x27;</span>,<br>              &#125;,<br>            ],<br>          &#125;,<br>        &#125;,<br>      &#125;,<br>      <span class="hljs-attr">axisLine:</span> &#123;<br>        <span class="hljs-attr">lineStyle:</span> &#123;<br>          <span class="hljs-attr">width:</span> <span class="hljs-number">2</span>,<br>          <span class="hljs-attr">color:</span> [<br>            [<span class="hljs-number">0.8</span>, <span class="hljs-string">&#x27;#fff&#x27;</span>],<br>            [<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;red&#x27;</span>],<br>          ],<br>        &#125;,<br>      &#125;,<br>      <span class="hljs-attr">axisTick:</span> &#123;<br>        <span class="hljs-attr">lineStyle:</span> &#123;<br>            <span class="hljs-attr">color:</span> <span class="hljs-string">&#x27;#fff&#x27;</span>,<br>          &#125;,<br>      &#125;,<br>      <span class="hljs-attr">splitLine:</span> &#123;<br>        <span class="hljs-attr">length:</span> <span class="hljs-number">15</span>,<br>        <span class="hljs-attr">lineStyle:</span> &#123;<br>          <span class="hljs-attr">width:</span> <span class="hljs-number">2</span>,<br>          <span class="hljs-attr">color:</span> <span class="hljs-string">&#x27;#999&#x27;</span><br>        &#125;<br>      &#125;,<br>      <span class="hljs-attr">axisLabel:</span> &#123;<br>        <span class="hljs-attr">color:</span> <span class="hljs-string">&#x27;#fff&#x27;</span>,<br>        <span class="hljs-attr">fontSize:</span> <span class="hljs-number">20</span>,<br>      &#125;,<br>      <span class="hljs-attr">anchor:</span> &#123;<br>        <span class="hljs-attr">show:</span> <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">size:</span> <span class="hljs-number">60</span>,<br>        <span class="hljs-attr">showAbove:</span> <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">itemStyle:</span> &#123;<br>          <span class="hljs-attr">color:</span> <span class="hljs-string">&#x27;#001122&#x27;</span>,<br>          <span class="hljs-attr">opacity:</span> <span class="hljs-number">0.9</span>,<br>          <span class="hljs-attr">borderColor:</span> <span class="hljs-string">&#x27;rgba(255,255,255,0.8)&#x27;</span>,<br>          <span class="hljs-attr">borderWidth:</span> <span class="hljs-number">1</span>,<br>          <span class="hljs-attr">shadowBlur:</span> <span class="hljs-number">30</span>,<br>          <span class="hljs-attr">shadowColor:</span> <span class="hljs-string">&#x27;rgba(255, 255, 255, 0.5)&#x27;</span>,<br>        &#125;,<br>      &#125;,<br>      <span class="hljs-attr">pointer:</span> &#123;<br>        <span class="hljs-attr">offsetCenter:</span> [<span class="hljs-number">0</span>, <span class="hljs-string">&#x27;20%&#x27;</span>],<br>        <span class="hljs-attr">icon:</span> <span class="hljs-string">&#x27;path://M2090.36389,615.30999 L2090.36389,615.30999 C2091.48372,615.30999 2092.40383,616.194028 2092.44859,617.312956 L2096.90698,728.755929 C2097.05155,732.369577 2094.2393,735.416212 2090.62566,735.56078 C2090.53845,735.564269 2090.45117,735.566014 2090.36389,735.566014 L2090.36389,735.566014 C2086.74736,735.566014 2083.81557,732.63423 2083.81557,729.017692 C2083.81557,728.930412 2083.81732,728.84314 2083.82081,728.755929 L2088.2792,617.312956 C2088.32396,616.194028 2089.24407,615.30999 2090.36389,615.30999 Z&#x27;</span>,<br>        <span class="hljs-attr">length:</span> <span class="hljs-string">&#x27;110%&#x27;</span>,<br>        <span class="hljs-attr">itemStyle:</span> &#123;<br>          <span class="hljs-attr">color:</span> <span class="hljs-string">&#x27;rgba(255,255,255,0.9)&#x27;</span>,<br>        &#125;,<br>      &#125;,<br>      <span class="hljs-attr">title:</span> &#123;<br>        <span class="hljs-attr">show:</span> <span class="hljs-literal">false</span><br>      &#125;,<br>      <span class="hljs-attr">detail:</span> &#123;<br>        <span class="hljs-attr">valueAnimation:</span> <span class="hljs-literal">true</span>,<br>          <span class="hljs-string">//</span> <span class="hljs-attr">formatter:</span> <span class="hljs-string">&#x27;&#123;value&#125;\n&#123;unit|km / h&#125;&#x27;</span>,<br>          <span class="hljs-attr">offsetCenter:</span> [<span class="hljs-number">0</span>, <span class="hljs-string">&#x27;50%&#x27;</span>],<br>          <span class="hljs-attr">rich:</span> &#123;<br>            <span class="hljs-attr">unit:</span> &#123;<br>              <span class="hljs-attr">lineHeight:</span> <span class="hljs-number">80</span>,<br>              <span class="hljs-attr">color:</span> <span class="hljs-string">&#x27;#fff&#x27;</span>,<br>              <span class="hljs-attr">fontSize:</span> <span class="hljs-number">30</span>,<br>            &#125;,<br>          &#125;,<br>          <span class="hljs-attr">fontSize:</span> <span class="hljs-number">50</span>,<br>          <span class="hljs-attr">color:</span> <span class="hljs-string">&#x27;#fff&#x27;</span>,<br>      &#125;,<br>      <span class="hljs-attr">data:</span> [<br>        &#123;<br>          <span class="hljs-attr">value:</span> <span class="hljs-string">data</span><br>        &#125;<br>      ]<br>    &#125;<br>  ]<br>&#125;<span class="hljs-string">;</span><br><br><span class="hljs-string">//</span> <span class="hljs-string">ä½¿ç”¨åˆšæŒ‡å®šçš„é…ç½®é¡¹å’Œæ•°æ®æ˜¾ç¤ºå›¾è¡¨ã€‚</span><br><span class="hljs-string">myChart.setOption(option);</span><br><span class="hljs-string">&#125;);</span><br></code></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç è§ï¼š<a href="https://github.com/shubihu/Tools/tree/master/cpuMonitor">https://github.com/shubihu/Tools/tree/master/cpuMonitor</a></p><h3 id="æŠ„ä»£ç å‚è€ƒ"><a href="#æŠ„ä»£ç å‚è€ƒ" class="headerlink" title="æŠ„ä»£ç å‚è€ƒ"></a>æŠ„ä»£ç å‚è€ƒ</h3><p><a href="https://blog.csdn.net/joson1234567890/article/details/106572536">https://blog.csdn.net/joson1234567890/article/details/106572536</a><br><a href="https://www.delftstack.com/zh/howto/python/get-cpu-usage-in-python/">https://www.delftstack.com/zh/howto/python/get-cpu-usage-in-python/</a></p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RåŒ…magickå®‰è£…çš„å‘</title>
    <link href="/2022/10/09/R%E5%8C%85magick%E5%AE%89%E8%A3%85%E7%9A%84%E5%9D%91/"/>
    <url>/2022/10/09/R%E5%8C%85magick%E5%AE%89%E8%A3%85%E7%9A%84%E5%9D%91/</url>
    
    <content type="html"><![CDATA[<h2 id="Magick"><a href="#Magick" class="headerlink" title="Magick"></a>Magick</h2><span id="more"></span><p>å®‰è£…magické‡åˆ°çš„é—®é¢˜è®°å½•ä¸€ä¸‹ï¼Œæ¯•ç«ŸèŠ±äº†å¥½å¤šæ—¶é—´ã€‚<br>é—®é¢˜1:</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs smali">Configuration failed to find the Magick++ library. Try installing:<br> - deb: libmagick++-dev (Debian, Ubuntu)<br> - rpm: ImageMagick-c++-devel (Fedora, CentOS, RHEL)<br> - csw: imagemagick_dev (Solaris)<br> - brew imagemagick@6 (MacOS)<br>For Ubuntu versions Trusty (14.04)<span class="hljs-built_in"> and </span>Xenial (16.04) use our PPA:<br>   sudo<span class="hljs-built_in"> add-apt-repository </span>-y ppa:cran/imagemagick<br>   sudo apt-get update<br>   sudo apt-get install -y libmagick++-dev<br>If Magick++ is already installed,<span class="hljs-built_in"> check </span>that &#x27;pkg-config&#x27; is in your<br>PATH<span class="hljs-built_in"> and </span>PKG_CONFIG_PATH contains a Magick++.pc file. If pkg-config<br>is unavailable you can set INCLUDE_DIR<span class="hljs-built_in"> and </span>LIB_DIR manually via:<br>R CMD INSTALL --configure-vars=&#x27;INCLUDE_DIR=... LIB_DIR=...&#x27;<br></code></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•ï¼šæŒ‰ç…§å¯¹åº”çš„ç³»ç»Ÿå®‰è£… ImageMagick</p><p>è¿™ä¸ªé—®é¢˜å¥½è§£å†³ï¼Œä½†æ˜¯äº‹æƒ…å¾€å¾€æ²¡è¿™ä¹ˆç®€å•ã€‚</p><h5 id="ç»ˆæé—®é¢˜ï¼š"><a href="#ç»ˆæé—®é¢˜ï¼š" class="headerlink" title="ç»ˆæé—®é¢˜ï¼š"></a>ç»ˆæé—®é¢˜ï¼š</h5><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">Error: <span class="hljs-keyword">package</span> or namespace load failed <span class="hljs-keyword">for</span> â€˜magickâ€™ in dyn.load(<span class="hljs-keyword">file</span>, DLLpath = DLLpath, ...):<br> unable to load shared object <span class="hljs-string">&#x27;/share/apps/R/R-4.2.1/library/00LOCK-magick/00new/magick/libs/magick.so&#x27;</span>:<br>  <span class="hljs-regexp">/share/</span>apps<span class="hljs-regexp">/R/</span>R-<span class="hljs-number">4.2</span>.<span class="hljs-number">1</span><span class="hljs-regexp">/library/</span><span class="hljs-number">00</span>LOCK-magick<span class="hljs-regexp">/00new/m</span>agick<span class="hljs-regexp">/libs/m</span>agick.so: undefined symbol: _ZN6Magick5Image5writeEPNS_4BlobERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEEm<br></code></pre></td></tr></table></figure><p>å°±è¿™ä¸ªé—®é¢˜ç½‘ä¸Šæ‰¾äº†å¥½å¤šåŠæ³•éƒ½æ²¡è§£å†³ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¹‹å‰è‡ªå·±æœçš„å…³é”®è¯ä¸å¯¹ï¼Œæœ€å¼€å§‹æ£€ç´¢çš„é”™è¯¯ä¿¡æ¯ï¼ˆError: package or namespace load failed for â€˜magickâ€™ in dyn.load(file, DLLpath = DLLpath, â€¦)ï¼‰ï¼ŒæŒ–äº†åŠå¤©ä¸€ç›´è¯•é”™ã€‚æœ€åé€šè¿‡æ£€ç´¢ï¼ˆmagick.so: undefined symbol: _ZN6Magick5Image5wri)æ‰¾åˆ°äº†è§£å†³æ–¹æ³•ã€‚</p><p>è§£å†³æ–¹æ³•(å¦‚æœæ²¡æœ‰è¯¥ç›®å½•è¯·æå‰åˆ›å»º)ï¼š</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">echo <span class="hljs-string">&quot;CXX11=/usr/bin/g++&quot;</span> &gt; ~<span class="hljs-regexp">/.R/</span>Makevars<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•è¿˜æ˜¯åœ¨githubä¸Šçš„ä¸€ä¸ªissueä¸Šçœ‹åˆ°çš„ï¼ŒæŒ‰æ–¹æ³•ä¸­æ‰€è¯´åº”è¯¥æ˜¯g++ç‰ˆæœ¬çš„é—®é¢˜ï¼Œæ›´æ”¹ç¼–è¯‘çš„g++å³å¯ã€‚<br>åœ°å€å¦‚ä¸‹ï¼š<br><a href="https://github.com/ropensci/magick/issues/300">https://github.com/ropensci/magick/issues/300</a></p><p>æœ€åçš„å®‰è£…å‘½ä»¤ï¼ˆä¸‹è½½çš„æºç è¿›è¡Œå®‰è£…çš„ï¼Œåº”è¯¥ä¹Ÿå¯ä»¥ç›´æ¥å®‰è£…ä¸ç”¨æå‰ä¸‹è½½æºç ï¼‰</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lasso">install.packages(<span class="hljs-string">&quot;magick_2.7.3.tar.gz&quot;</span>,repos=<span class="hljs-built_in">NULL</span>,<span class="hljs-keyword">type</span>=<span class="hljs-string">&quot;source&quot;</span>)<br></code></pre></td></tr></table></figure><h6 id="å…¶ä»–é”™è¯¯ï¼šusr-bin-ld-cannot-find-é”™è¯¯è§£å†³æ–¹æ³•"><a href="#å…¶ä»–é”™è¯¯ï¼šusr-bin-ld-cannot-find-é”™è¯¯è§£å†³æ–¹æ³•" class="headerlink" title="å…¶ä»–é”™è¯¯ï¼šusr/bin/ld: cannot find é”™è¯¯è§£å†³æ–¹æ³•"></a>å…¶ä»–é”™è¯¯ï¼šusr/bin/ld: cannot find é”™è¯¯è§£å†³æ–¹æ³•</h6><p>é€šå¸¸åœ¨è½¯ä»¶ç¼–è¯‘æ—¶å‡ºç°çš„usr/bin/ld: cannot find -lxxxçš„é”™è¯¯ï¼Œä¸»è¦çš„åŸå› æ˜¯åº“æ–‡ä»¶å¹¶æ²¡æœ‰å¯¼å…¥çš„ldæ£€ç´¢ç›®å½•ä¸­ã€‚<br>å…¶ä¸­xxxå³è¡¨ç¤ºå‡½å¼åº“æ–‡ä»¶åç§°ï¼Œå¦‚ä¸Šä¾‹çš„ï¼šlibc.soã€libltdl.soã€libXtst.soã€‚<br>å…¶å‘½åè§„åˆ™æ˜¯ï¼šlib+åº“å(å³xxx)+.soã€‚<br>ä¼šå‘ç”Ÿè¿™æ ·çš„åŸå› æœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å½¢ï¼š<br>1 ç³»ç»Ÿæ²¡æœ‰å®‰è£…ç›¸å¯¹åº”çš„lib<br>2 ç›¸å¯¹åº”çš„libç‰ˆæœ¬ä¸å¯¹<br>3 lib(.soæ¡£)çš„symbolic link ä¸æ­£ç¡®ï¼Œæ²¡æœ‰è¿ç»“åˆ°æ­£ç¡®çš„å‡½å¼åº“æ–‡ä»¶(.so)</p><p>è§£å†³æ–¹å¼ï¼š<br>1ã€‚ç¡®è®¤åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œæ¯”å¦‚-l123, åœ¨/usr/lib, /usr/local/lib,æˆ–è€…å…¶ä»–è‡ªå®šä¹‰çš„libä¸‹æœ‰æ— lib123.so, å¦‚æœåªæ˜¯å­˜åœ¨lib123.so.1,<br>   é‚£ä¹ˆå¯ä»¥é€šè¿‡ln -sv lib123.so.1   lib123.soï¼Œå»ºç«‹ä¸€ä¸ªè¿æ¥é‡å»ºlib123.so.<br>2ã€‚æ£€æŸ¥/etc/ld.so.confä¸­çš„åº“æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœåº“æ–‡ä»¶ä¸æ˜¯ä½¿ç”¨ç³»ç»Ÿè·¯å¾„ï¼Œ/usr/lib, /usr/local/lib, é‚£ä¹ˆå¿…é¡»åœ¨æ–‡ä»¶ä¸­åŠ å…¥ã€‚<br>3ã€‚ldconfig é‡å»ºld.so.cacheæ–‡ä»¶ï¼Œldçš„åº“æ–‡ä»¶æ£€ç´¢ç›®å½•å­˜æ”¾æ–‡ä»¶ã€‚å°¤å…¶åˆšåˆšç¼–è¯‘å®‰è£…çš„è½¯ä»¶ï¼Œå¿…é¡»è¿è¡Œldconfigï¼Œæ‰èƒ½å°†æ–°å®‰è£…çš„åº“æ–‡ä»¶å¯¼å…¥ld.so.cache</p>]]></content>
    
    
    <categories>
      
      <category>TroubleShoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>TroubleShoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è‹±ä¼Ÿè¾¾(nvida)é©±åŠ¨å®‰è£…çš„å‘</title>
    <link href="/2022/09/02/%E8%8B%B1%E4%BC%9F%E8%BE%BE-nvida-%E9%A9%B1%E5%8A%A8%E5%AE%89%E8%A3%85%E7%9A%84%E5%9D%91/"/>
    <url>/2022/09/02/%E8%8B%B1%E4%BC%9F%E8%BE%BE-nvida-%E9%A9%B1%E5%8A%A8%E5%AE%89%E8%A3%85%E7%9A%84%E5%9D%91/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><p>æœ¬æ¥æœåŠ¡å™¨ä¸Šçš„é©±åŠ¨æ²¡æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºä¹‹å‰çš„cudatookitsæ˜¯é€šè¿‡condaå®‰è£…çš„ï¼Œç°åœ¨éœ€è¦ç®¡ç†å‘˜åœ¨å…¨å±€å®‰è£…ã€‚<br>cudatoolkitsä¸‹è½½ <a href="https://developer.nvidia.com/cuda-toolkit-archive">https://developer.nvidia.com/cuda-toolkit-archive</a><br>æ ¹æ®è‡ªå·±çš„ç³»ç»Ÿé€‰æ‹©å¯¹åº”çš„æ–‡ä»¶ä¸‹è½½ã€‚æ³¨æ„ï¼šè¿™é‡Œå°½é‡é€‰æ‹©runfileæ–‡ä»¶ä¸‹è½½ï¼Œå› ä¸ºrunfileæ–‡ä»¶å®‰è£…çš„æ—¶å€™å¯ä»¥è¿›è¡Œé€‰æ‹©å“ªäº›å®‰è£…å“ªäº›ä¸å®‰è£…ï¼Œå¦‚æœé€‰æ‹©rpmåŒ…ä¸‹è½½å®‰è£…å¯èƒ½å°±æ˜¯å…¨å®¶æ¡¶äº†ï¼ŒåŒ…æ‹¬æ˜¾å¡é©±åŠ¨ã€‚æˆ‘å°±æ˜¯ä¸‹çš„rpmåŒ…å®‰è£…çš„(æ²¡ç•™ç¥ä¸‹æˆæœ€æ–°çš„ç‰ˆæœ¬äº†)ï¼Œç„¶åé©±åŠ¨å°±æ›´æ–°äº†ï¼Œéšä¹‹æ˜¾å¡å°±æ‚²å‚¬çš„ä¸èƒ½ç”¨äº†ã€‚<br>æ²¡åŠæ³•åªèƒ½é‡æ–°å®‰è£…é©±åŠ¨<br>æŸ¥çœ‹æ˜¾å¡ç‰ˆæœ¬</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">cat <span class="hljs-regexp">/proc/</span>driver<span class="hljs-regexp">/nvidia/</span>version<br></code></pre></td></tr></table></figure><p>ä¸‹è½½é©±åŠ¨ <a href="http://www.nvidia.com/Download/Find.aspx">http://www.nvidia.com/Download/Find.aspx</a><br>é€‰æ‹©å’Œæ˜¾å¡ç‰ˆæœ¬ä¸€è‡´çš„é©±åŠ¨ç‰ˆæœ¬ï¼Œæˆ‘è¿™é‡Œçš„ç‰ˆæœ¬å’Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼Œå¦å¤–kernelçš„ç›®å½•3.10.0-1062.18.1.el7.x86_64æ”¹æˆè‡ªå·±çš„</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># NVIDIA-Linux-x86_64-515.57.run</span><br><span class="hljs-attribute">chmod</span> +x NVIDIA-Linux-x<span class="hljs-number">86</span>_<span class="hljs-number">64</span>-<span class="hljs-number">515</span>.<span class="hljs-number">57</span>.run<br><span class="hljs-attribute">sudo</span> ./NVIDIA-Linux-x<span class="hljs-number">86</span>_<span class="hljs-number">64</span>-<span class="hljs-number">515</span>.<span class="hljs-number">57</span>.run --kernel-source-path=/usr/src/kernels/<span class="hljs-number">3</span>.<span class="hljs-number">10</span>.<span class="hljs-number">0</span>-<span class="hljs-number">1062</span>.<span class="hljs-number">18</span>.<span class="hljs-number">1</span>.el<span class="hljs-number">7</span>.x<span class="hljs-number">86</span>_<span class="hljs-number">64</span> -k $(uname -r)<br></code></pre></td></tr></table></figure><p>ä»¥ä¸ºä¸€åˆ‡å¾ˆé¡ºåˆ©ï¼Œç„¶åå°±æŠ¥é”™äº†ã€‚</p><h5 id="ç¬¬ä¸€ä¸ªå‘"><a href="#ç¬¬ä¸€ä¸ªå‘" class="headerlink" title="ç¬¬ä¸€ä¸ªå‘"></a>ç¬¬ä¸€ä¸ªå‘</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">ERROR: You appear to be running an X server; please <span class="hljs-keyword">exit</span> X before            <br>         installing.  For further details, please see the section INSTALLING   <br>         THE NVIDIA DRIVER <span class="hljs-keyword">in</span> the README available on the Linux driver         <br>         download page at www.nvidia.com.<br></code></pre></td></tr></table></figure><p>ç½‘ä¸Šæ‰’äº†åŠå¤©æ‰’äº†ä¸€ä¸ªæœ‰æ•ˆçš„æ–¹æ³•ï¼š<a href="https://unix.stackexchange.com/questions/25668/how-to-close-x-server-to-avoid-errors-while-updating-nvidia-driver">https://unix.stackexchange.com/questions/25668/how-to-close-x-server-to-avoid-errors-while-updating-nvidia-driver</a></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> init <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><h5 id="ç¬¬äºŒä¸ªå‘"><a href="#ç¬¬äºŒä¸ªå‘" class="headerlink" title="ç¬¬äºŒä¸ªå‘"></a>ç¬¬äºŒä¸ªå‘</h5><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs applescript">ERROR: An NVIDIA kernel module &#x27;nvidia-uvm&#x27; appears <span class="hljs-keyword">to</span> already be loaded <span class="hljs-keyword">in</span> your kernel.  This may be because <span class="hljs-keyword">it</span> <span class="hljs-keyword">is</span> <br><span class="hljs-keyword">in</span> use (<span class="hljs-keyword">for</span> example, <span class="hljs-keyword">by</span> an X server, a CUDA program, <span class="hljs-keyword">or</span> <span class="hljs-keyword">the</span> NVIDIA Persistence Daemon), <span class="hljs-keyword">but</span> this may also happen <span class="hljs-keyword">if</span> <br>your kernel was configured <span class="hljs-keyword">without</span> support <span class="hljs-keyword">for</span> module unloading.  Please be sure <span class="hljs-keyword">to</span> <span class="hljs-keyword">exit</span> any programs <span class="hljs-keyword">that</span> may be us<br>ing <span class="hljs-keyword">the</span> GPU(s) <span class="hljs-keyword">before</span> attempting <span class="hljs-keyword">to</span> upgrade your driver.  If no GPU-based programs are <span class="hljs-built_in">running</span>, you know <span class="hljs-keyword">that</span> your k<br>ernel supports module unloading, <span class="hljs-keyword">and</span> you still receive this message, <span class="hljs-keyword">then</span> an <span class="hljs-keyword">error</span> may have occurred <span class="hljs-keyword">that</span> has corrup<br>ted an NVIDIA kernel module&#x27;s usage <span class="hljs-built_in">count</span>, <span class="hljs-keyword">for</span> which <span class="hljs-keyword">the</span> simplest remedy <span class="hljs-keyword">is</span> <span class="hljs-keyword">to</span> reboot your computer.<br></code></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•å‚è€ƒ <a href="https://www.cnblogs.com/1016391912pm/p/16494815.html">https://www.cnblogs.com/1016391912pm/p/16494815.html</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># æŸ¥çœ‹æ˜¾å¡ä¸Šçš„è¿›ç¨‹ </span><br>lsof <span class="hljs-regexp">/dev/</span>nvidia*<br><span class="hljs-comment"># kill æ‰æ‰€æœ‰è¿›ç¨‹</span><br>kill -<span class="hljs-number">9</span> xxx<br></code></pre></td></tr></table></figure><p>å†æ¬¡è¿è¡Œå®‰è£…æ˜¾å¡é©±åŠ¨å‘½ä»¤ç»ˆäºå¯ä»¥å¾€ä¸‹è¿›è¡Œäº†ã€‚</p><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/gollong/p/12655424.html">https://www.cnblogs.com/gollong/p/12655424.html</a><br>    <a href="https://www.cnblogs.com/shenggang/p/12133220.html">https://www.cnblogs.com/shenggang/p/12133220.html</a><br>    <a href="https://eipi10.cn/deep-learning/2019/11/28/centos_cuda_cudnn/">https://eipi10.cn/deep-learning/2019/11/28/centos_cuda_cudnn/</a></p>]]></content>
    
    
    <categories>
      
      <category>TroubleShoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>TroubleShoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>jupyterhubè¸©å‘</title>
    <link href="/2022/08/30/jupyterhub%E8%B8%A9%E5%9D%91/"/>
    <url>/2022/08/30/jupyterhub%E8%B8%A9%E5%9D%91/</url>
    
    <content type="html"><![CDATA[<h2 id="å‘"><a href="#å‘" class="headerlink" title="å‘"></a>å‘</h2><span id="more"></span><h5 id="å®‰è£…Jupyterhub"><a href="#å®‰è£…Jupyterhub" class="headerlink" title="å®‰è£…Jupyterhub"></a>å®‰è£…Jupyterhub</h5><p>ä½¿ç”¨ conda å®‰è£…ï¼Œå¦å¤–å®˜ç½‘æä¾›äº†pipå®‰è£…æ–¹æ³•ï¼Œå‚è€ƒï¼š<a href="https://jupyterhub.readthedocs.io/en/latest/quickstart.html#prerequisites">https://jupyterhub.readthedocs.io/en/latest/quickstart.html#prerequisites</a></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">conda <span class="hljs-keyword">install </span>-c conda-forge <span class="hljs-keyword">jupyterhub </span> <span class="hljs-comment"># installs jupyterhub and proxy</span><br>conda <span class="hljs-keyword">install </span><span class="hljs-keyword">jupyterlab </span>notebook  <span class="hljs-comment"># needed if running the notebook servers in the same environment</span><br></code></pre></td></tr></table></figure><p>æµ‹è¯•å®‰è£…æ˜¯å¦æˆåŠŸ</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">jupyterhub -h</span><br><span class="hljs-attribute">configurable-http-proxy -h</span><br></code></pre></td></tr></table></figure><h5 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h5><p>ä½¿ç”¨sudoæƒé™å¯åŠ¨ï¼Œè¿™æ ·å¯ä»¥å¤šç”¨æˆ·ä½¿ç”¨jupyter</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs verilog">jupyterhub --<span class="hljs-keyword">generate</span>-<span class="hljs-keyword">config</span> #ç”Ÿæˆé…ç½®æ–‡ä»¶<br>sudo jupyterhub<br></code></pre></td></tr></table></figure><p>å¦‚æœæœ‰å‘ï¼Œå°±éœ€è¦å¯¹é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹<br>æˆ‘è¿™é‡Œé‡åˆ°çš„å‘ä¹Ÿæ˜¯å¯¹condaå‡çº§é€ æˆçš„ï¼Œå³ conda update conda, æ‰€ä»¥æ²¡å•¥äº‹è¿˜æ˜¯ä¸è¦å‡çº§çš„å¥½ã€‚</p><h5 id="conda-ç‰ˆæœ¬å›é€€"><a href="#conda-ç‰ˆæœ¬å›é€€" class="headerlink" title="conda ç‰ˆæœ¬å›é€€"></a>conda ç‰ˆæœ¬å›é€€</h5><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">conda list <span class="hljs-comment">--revisions</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥æ˜¾ç¤ºä¹‹å‰æ‰€æœ‰çš„å®‰è£…ç‰ˆæœ¬ï¼Œä»¥åŠç›¸åº”çš„æ—¶é—´ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªæ­£å¸¸çš„ç‰ˆæœ¬è¿›è¡Œå›é€€(æˆ‘è¿™é‡Œé€‰æ‹©ç¬¬16ä¸ªç‰ˆæœ¬)</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">conda install <span class="hljs-comment">--revision 16</span><br></code></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://chowdera.com/2022/01/202201151540272854.html">https://chowdera.com/2022/01/202201151540272854.html</a></p><h5 id="å„ç§å‘"><a href="#å„ç§å‘" class="headerlink" title="å„ç§å‘"></a>å„ç§å‘</h5><p>æœ€å¼€å§‹ä¸€ç›´é‡åˆ°çš„é—®é¢˜æ˜¯<br>    Spawn failed:Server at xxxxxxxxx respond in 30 seconds<br>ç»è¿‡ä¸æ–­æµ‹è¯•ï¼ˆä¸€å¤©è¿‡å»äº†ï¼‰<br>é…ç½®æ–‡ä»¶é‡Œæ·»åŠ äº†ä¸ªå‚æ•°ï¼Œå¦‚ä¸‹ï¼Œå€’æ˜¯å¯ä»¥è¿è¡Œäº†ï¼Œä½†æ˜¯åæ¥å‘ç°è¿™ä¸ªå‚æ•°æ˜¯ç»™åˆ°rootæƒé™äº†ï¼Œæ‰€ä»¥åšå†³å»æ‰ï¼Œä¸ç„¶å¤ªå±é™©äº†ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">c<span class="hljs-selector-class">.Spawner</span><span class="hljs-selector-class">.args</span> = <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;--allow-root&#x27;</span>]</span><br></code></pre></td></tr></table></figure><p>åæ¥åœ¨ <a href="https://github.com/jupyterhub/jupyterhub/issues/294">https://github.com/jupyterhub/jupyterhub/issues/294</a> è¿™é‡Œæ‰¾åˆ°äº†ç­”æ¡ˆ<br>åŸæ¥æ˜¯ç”¨æˆ·å®¶ç›®å½•çš„ .jupyter ç›®å½•æƒ¹çš„ç¥¸ï¼Œ åˆ é™¤æˆ–è€…æ”¹ä¸ªåå­—å°±OKäº†ã€‚</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">rm -rf ~<span class="hljs-string">/.jupyter</span><br></code></pre></td></tr></table></figure><p>å½“ç„¶äº†å‘ä¸æ­¢è¿™ä¸€ä¸ªï¼Œæ€»ä¹‹ä¸€è¨€éš¾å°½ï¼Œæœ€åæ•´ä½“ä¸€ä¸ªé…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">c.PAMAuthenticator.encoding</span> = <span class="hljs-string">&#x27;utf8&#x27;</span><br><span class="hljs-attr">c.LocalAuthenticator.create_system_users</span> = <span class="hljs-literal">True</span><br><span class="hljs-attr">c.Authenticator.admin_users</span> = &#123;<span class="hljs-string">&#x27;dg&#x27;</span>&#125;<br><span class="hljs-attr">c.Authenticator.allowed_users</span> = &#123;<span class="hljs-string">&#x27;dg&#x27;</span>&#125;<br><span class="hljs-attr">c.JupyterHub.authenticator_class</span> = <span class="hljs-string">&#x27;dummyauthenticator.DummyAuthenticator&#x27;</span><br><span class="hljs-comment">#c.JupyterHub.authenticator_class = &#x27;jupyterhub.auth.DummyAuthenticator&#x27;</span><br><span class="hljs-comment">#c.JupyterHub.spawner_class = &#x27;jupyterhub.spawner.SimpleLocalProcessSpawner&#x27;</span><br><span class="hljs-attr">c.LocalProcessSpawner.shell_cmd</span> = [<span class="hljs-string">&quot;bash&quot;</span>, <span class="hljs-string">&quot;-l&quot;</span>, <span class="hljs-string">&quot;-c&quot;</span>]<br><span class="hljs-attr">c.Spawner.notebook_dir</span> = <span class="hljs-string">&#x27;/share/home/&#123;username&#125;&#x27;</span><br><span class="hljs-attr">c.LabBuildApp.minimize</span> = <span class="hljs-literal">False</span><br><span class="hljs-attr">c.LabBuildApp.dev_build</span> = <span class="hljs-literal">False</span><br><br><span class="hljs-comment">### è¿™å‡ é¡¹åº”è¯¥æ²¡å•¥ç”¨ ###</span><br><span class="hljs-comment">#c.Spawner.cmd=[&#x27;jupyterhub-singleuser&#x27;]</span><br><span class="hljs-comment">#c.JupyterHub.admin_access = True</span><br><span class="hljs-comment">#c.PAMAuthenticator.open_sessions = False</span><br></code></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/childheart/p/15570915.html">https://www.cnblogs.com/childheart/p/15570915.html</a></p><p>å¦å¤–å…³äºconda</p><h4 id="åˆ‡æ¢ä¸åŒçš„é•œåƒç«™ç‚¹æ—¶è®°å¾—æ¸…é™¤ç¼“å­˜"><a href="#åˆ‡æ¢ä¸åŒçš„é•œåƒç«™ç‚¹æ—¶è®°å¾—æ¸…é™¤ç¼“å­˜" class="headerlink" title="åˆ‡æ¢ä¸åŒçš„é•œåƒç«™ç‚¹æ—¶è®°å¾—æ¸…é™¤ç¼“å­˜"></a>åˆ‡æ¢ä¸åŒçš„é•œåƒç«™ç‚¹æ—¶è®°å¾—æ¸…é™¤ç¼“å­˜</h4><p>åˆ é™¤ç´¢å¼•ç¼“å­˜ã€é”å®šæ–‡ä»¶ã€æœªä½¿ç”¨è¿‡çš„åŒ…å’ŒtaråŒ…</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">conda clean -<span class="hljs-selector-tag">a</span><br></code></pre></td></tr></table></figure><p>å½“ä»ä¸€ä¸ªç«™ç‚¹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªç«™ç‚¹çš„æ—¶å€™è®°å¾—è¿è¡Œä¸€ä¸‹ä¸Šé¢è¿™ä¸ªå‘½ä»¤ï¼Œå¦åˆ™å³ä½¿æ›´æ–°äº†~/.condarcï¼Œè½¯ä»¶è¿˜æ˜¯ä¼šä»ä¹‹å‰çš„ç«™ç‚¹ä¸‹è½½ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>jupyter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python + Seleniumçˆ¬å–drugbankè¯ç‰©é¶ç‚¹ä¿¡æ¯</title>
    <link href="/2022/08/19/Python-Selenium%E7%88%AC%E5%8F%96drugbank%E8%8D%AF%E7%89%A9%E9%9D%B6%E7%82%B9%E4%BF%A1%E6%81%AF/"/>
    <url>/2022/08/19/Python-Selenium%E7%88%AC%E5%8F%96drugbank%E8%8D%AF%E7%89%A9%E9%9D%B6%E7%82%B9%E4%BF%A1%E6%81%AF/</url>
    
    <content type="html"><![CDATA[<h2 id="Seleniumçˆ¬è™«"><a href="#Seleniumçˆ¬è™«" class="headerlink" title="Seleniumçˆ¬è™«"></a>Seleniumçˆ¬è™«</h2><span id="more"></span><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨seleniumæ¥è¿›è¡Œçˆ¬å–ï¼Œå› ä¸ºæœ‰çš„ç½‘ç«™æœ‰åçˆ¬æœºåˆ¶ï¼Œå¹³å¸¸çš„requestsç­‰æ— æ³•çˆ¬å–ã€‚<br>Seleniumå¯ä½¿ç”¨pipè¿›è¡Œå®‰è£…</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> selenium<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨chromeæµè§ˆå™¨è¿›è¡Œçˆ¬å–ï¼Œæ‰€ä»¥éœ€è¦ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„chromedriverï¼Œä¸‹è½½åœ°å€å¦‚ä¸‹<br><a href="https://chromedriver.storage.googleapis.com/index.html">https://chromedriver.storage.googleapis.com/index.html</a></p><p>åœ¨drugbankç½‘ç«™è¾“å…¥ä¸€ä¸ªdrugIDæˆ–è€…drugçš„åå­—å³å¯æŸ¥åˆ°è¯¥è¯ç‰©çš„ç›¸å…³ä¿¡æ¯ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œæå–ã€‚æˆ‘ä¸»è¦æ˜¯éœ€è¦é¶ç‚¹çš„ä¿¡æ¯å³targetsã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><span class="hljs-keyword">from</span> selenium.webdriver.common.by <span class="hljs-keyword">import</span> By<br><br><span class="hljs-comment"># ä¸‹è½½çš„chromedriveråœ°å€</span><br>chromedriver = <span class="hljs-string">r&#x27;/Users/xxx/Desktop/drugbank-spider/chromedriver&#x27;</span><br>os.environ[<span class="hljs-string">&#x27;webdriver.chrome.driver&#x27;</span>] = chromedriver<br>driver = webdriver.Chrome(chromedriver)<br><br><span class="hljs-comment"># ä½¿ç”¨ä»£ç çˆ¬è™«çš„æ—¶å€™åªèƒ½è¾“å…¥drugID,å¦‚æœæœ‰å¾ˆå¤šä¸ªdrugIDï¼Œç½‘å€ä¿¡æ¯åªéœ€è¦æ”¹å˜drugIDå³å¯</span><br>drugID = <span class="hljs-string">&#x27;DB00635&#x27;</span><br>site = <span class="hljs-string">&#x27;https://go.drugbank.com/drugs/&#x27;</span> + drugID<br>driver.get(site)<br></code></pre></td></tr></table></figure><p>è¿è¡Œä»£ç ä¼šæ‰“å¼€ä¸€ä¸ªchromeçª—å£æ˜¾ç¤ºå¯¹åº”çš„drugçš„ä¿¡æ¯ï¼Œå°±å¦‚åŒè‡ªå·±è¾“å…¥ä¸€æ ·ã€‚<br>å¦‚æœæƒ³è·å–æˆ–è€…ä¿å­˜æ•´ä¸ªç½‘é¡µçš„æºä»£ç ï¼Œå¯é€šè¿‡å¦‚ä¸‹ä»£ç </p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqf"><span class="hljs-built_in">driver</span>.page_source<br></code></pre></td></tr></table></figure><p>å¦‚æœåªæ˜¯æƒ³è·å–æŸä¸€éƒ¨åˆ†ä¿¡æ¯ï¼Œå°±éœ€è¦è¿›è¡Œæå–äº†ã€‚<br>åœ¨ç½‘é¡µä¸Šé€‰ä¸­è‡ªå·±æ„Ÿå…´è¶£çš„ä¿¡æ¯ç‚¹å‡»å³é”®ï¼Œé€‰æ‹©æ£€æŸ¥å°±å¯ä»¥ç›´æ¥å®šä½åˆ°htmlä¸­ã€‚<br>åœ¨ WebDriver ä¸­ç°åœ¨æœ‰ä¸¤ç§ç”¨æ³•ï¼Œfind_element()å’Œfind_elements()ã€‚éœ€è¦é€šè¿‡å‚æ•°ä¼ å…¥å®šä½æ–¹å¼å’Œå®šä½è¯­å¥ã€‚<br>æ¯”å¦‚è¿™é‡Œé€šè¿‡IDå®šä½æŸ¥æ‰¾å…ƒç´ </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">driver.find_element(<span class="hljs-keyword">By</span>.ID, <span class="hljs-string">&#x27;uniprot-id&#x27;</span>)<br>#è·å–æ–‡æœ¬å†…å®¹éœ€è¦åŠ ä¸ª.textå³å¯ï¼Œå¦‚ä¸‹<br>driver.find_element(<span class="hljs-keyword">By</span>.ID, <span class="hljs-string">&#x27;uniprot-id&#x27;</span>).text<br></code></pre></td></tr></table></figure><p>find_elements()æŸ¥åˆ°çš„ä¿¡æ¯æ˜¯ä¸ªåˆ—è¡¨<br>æ¯”å¦‚é€šè¿‡class åå­—è¿›è¡Œå®šä½æŸ¥æ‰¾ï¼ˆtargetsä¿¡æ¯)</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">driver</span><span class="hljs-selector-class">.find_elements</span>(By.CLASS_NAME, <span class="hljs-string">&#x27;col-md-7&#x27;</span>)<br># è¿™é‡Œ<span class="hljs-selector-tag">targets</span>çš„ä¿¡æ¯å¦‚ä¸‹(å¦‚æœtargetsæœ‰å¤šä¸ªï¼Œå¯èƒ½ä½ç½®ç´¢å¼•å°±ä¼šå˜ï¼Œè€Œä¸æ˜¯<span class="hljs-number">8</span>äº†)<br><span class="hljs-selector-tag">driver</span><span class="hljs-selector-class">.find_elements</span>(By.CLASS_NAME, <span class="hljs-string">&#x27;col-md-7&#x27;</span>)<span class="hljs-selector-attr">[8]</span><span class="hljs-selector-class">.text</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šè·å–çš„æ˜¯æ‰€æœ‰classåå­—ä¸ºcol-md-7 çš„æ‰€æœ‰å†…å®¹ï¼Œè¿˜éœ€è¦æ‰‹åŠ¨ç¡®è®¤åˆ—è¡¨ä¸­å“ªä¸€é¡¹æ˜¯è‡ªå·±éœ€è¦çš„ã€‚å½“ç„¶äº†ï¼Œä»¥è¿™ç§æ–¹å¼è·å–å¯èƒ½ä¼šå­˜åœ¨bugï¼Œå› ä¸ºä¸èƒ½ä¿è¯è‡ªå·±éœ€è¦çš„ä¿¡æ¯ä¸€å®šåœ¨åˆ—è¡¨ä¸­çš„æŸä¸€å›ºå®šä½ç½®ã€‚</p><p>ä»¥ä¸‹æ˜¯å®šä½æ–¹å¼ä¸ By ä¸­çš„å±æ€§å¯¹åº”æ¸…å•ï¼š</p><table><thead><tr><th>å®šä½æ–¹å¼</th><th>By</th></tr></thead><tbody><tr><td>id</td><td>By.ID</td></tr><tr><td>name</td><td>By.NAME</td></tr><tr><td>class_name</td><td>By.CLASS_NAME</td></tr><tr><td>tag_name</td><td>By.TAG_NAME</td></tr><tr><td>link_text</td><td>By.LINK_TEXT</td></tr><tr><td>partial_link_text</td><td>By.PARTIAL_LINK_TEXT</td></tr><tr><td>css_selector</td><td>By.CSS_SELECTOR</td></tr><tr><td>xpath</td><td>By.XPATH</td></tr></tbody></table><p>é¡ºä¾¿è´´ä¸€ä¸‹å¦ä¸€ä¸ªæ•°æ®åº“ç½‘ç«™ï¼ˆè¯æ™ºæ•°æ®ï¼Œåº”è¯¥æ˜¯è¿™ä¸ªå…¬å¸è‡ªå·±æ•´ç†çš„æ•°æ®åº“ï¼Œåªå¯¹äººæ°‘å¸ç©å®¶å¼€æ”¾ï¼Œæ‰€ä»¥åªèƒ½ä¸åšé“äº†ï¼‰çš„ä»£ç </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># è¯¥å…¬å¸çš„æ•°æ®åº“å¯è¾“å…¥drugçš„åå­—è¿›è¡ŒæŸ¥è¯¢</span><br><span class="hljs-attribute">drugName</span> = &#x27;Esmolol&#x27;<br><span class="hljs-attribute">site</span> = &#x27;https://db.yaozh.com/targets?durg_name=&#x27; + drugName + &#x27;&amp;type=%E<span class="hljs-number">5</span>%<span class="hljs-number">85</span>%A<span class="hljs-number">8</span>%E<span class="hljs-number">9</span>%<span class="hljs-number">83</span>%A<span class="hljs-number">8</span>&amp;durg_targets=&amp;groups=%E<span class="hljs-number">5</span>%<span class="hljs-number">85</span>%A<span class="hljs-number">8</span>%E<span class="hljs-number">9</span>%<span class="hljs-number">83</span>%A<span class="hljs-number">8</span>&amp;durg_indication=&amp;cas=&#x27;<br><span class="hljs-attribute">driver</span> = webdriver.Chrome(chromedriver)<br><span class="hljs-attribute">driver</span>.get(site)<br><span class="hljs-comment">#th = driver.find_elements(By.TAG_NAME, &#x27;th&#x27;)</span><br><span class="hljs-attribute">td</span> = driver.find_elements(By.TAG_NAME, &#x27;td&#x27;)<br><span class="hljs-attribute">target</span> = td[<span class="hljs-number">3</span>].text<br><span class="hljs-attribute">driver</span>.close()<br><br></code></pre></td></tr></table></figure><p>æœ€åå°±æ˜¯ä½¿ç”¨è„šæœ¬æ‰¹é‡çˆ¬å–çš„æ—¶å€™ç”µè„‘éœ€è¦ä¸€ç›´å¼€æœºï¼Œè€Œä¸”ä¼šä¸€ç›´è‡ªåŠ¨æ‰“å¼€å…³é—­chromeçª—å£ï¼Œæ‰€ä»¥åœ¨çˆ¬å–çš„æ—¶å€™å°±æ— æ³•è¿›è¡Œå…¶ä»–å·¥ä½œã€‚<br>åœ¨ç½‘ä¸Šæ‰¾äº†ä¸‹æ— å¤´æ“ä½œï¼ˆå³ä¸æ˜¾ç¤ºçª—å£ï¼‰ï¼Œä½†æ˜¯ç»“æœå´ï¼ˆå¤´æ˜¯æ²¡äº†ï¼Œç»“æœä¹Ÿæ²¡äº†ï¼‰ï¼Œï¼Œï¼Œå¯èƒ½è¿˜æ˜¯æœ‰bugï¼Œä¸è¿‡ä¹Ÿå¥½ï¼Œåœ¨çˆ¬å–çš„æ—¶å€™æ­£å¥½æ‘¸ä¸ªé±¼ä¼‘æ¯ä¼‘æ¯ä¹Ÿä¸é”™ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">from selenium.webdriver.chrome.options import Options<br>chrome_options = <span class="hljs-constructor">Options()</span><br>chrome_options.add<span class="hljs-constructor">_argument(&#x27;--<span class="hljs-params">headless</span>&#x27;)</span><br>driver = webdriver.<span class="hljs-constructor">Chrome(<span class="hljs-params">chromedriver</span>, <span class="hljs-params">chrome_options</span> = <span class="hljs-params">chrome_options</span>)</span><br></code></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://blog.csdn.net/minzhung/category_9416023.html">https://blog.csdn.net/minzhung/category_9416023.html</a></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>çˆ¬è™«</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Rstudio Serverè®¾ç½®å…¬å…±åº“</title>
    <link href="/2022/08/16/Rstudio-Server%E8%AE%BE%E7%BD%AE%E5%85%AC%E5%85%B1%E5%BA%93/"/>
    <url>/2022/08/16/Rstudio-Server%E8%AE%BE%E7%BD%AE%E5%85%AC%E5%85%B1%E5%BA%93/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><p>åœ¨ç½‘é¡µç‰ˆç™»å½•è¿œç¨‹Rstudioåè¾“å…¥å‘½ä»¤</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-title">.libPaths()</span><br></code></pre></td></tr></table></figure><p>æ˜¾ç¤ºå½“å‰ç¯å¢ƒçš„Rå®‰è£…åŒ…è·¯å¾„ï¼Œä¸ºäº†æ–¹ä¾¿å¤§å®¶å…±äº«å®‰è£…åŒ…å¯ä»¥è®¾ç½®ä¸€ä¸ªå…¬å…±è·¯å¾„ï¼Œå½“ç„¶æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ç›´æ¥åœ¨å½“å‰ç¯å¢ƒè¿›è¡Œè®¾ç½®ï¼Œå¦‚</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-class">.libPaths</span>(<span class="hljs-string">&quot;/share/apps/R/R-4.2.1/library&quot;</span>)<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™å°±å¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ¯ä¸ªç”¨æˆ·éƒ½è¦æ‰‹åŠ¨è¿›è¡Œè®¾ç½®ï¼Œå¦‚æœRstudio server å’Œ session é‡å¯ï¼Œå¯èƒ½å°±éœ€è¦é‡æ–°è®¾ç½®ï¼Œè™½ç„¶ä¹Ÿä¸æ˜¯å¾ˆéº»çƒ¦ï¼Œä½†æœ‰å¯èƒ½ä¼šå¿˜ã€‚</p><p>å¦‚ä½•ä¸€åŠ³æ°¸é€¸çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<br>ç¼–è¾‘ /etc/rstudio/rsession.conf</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">r-libs-user=<span class="hljs-regexp">/share/</span>apps<span class="hljs-regexp">/R/</span>R-<span class="hljs-number">4.2</span>.<span class="hljs-number">1</span>/library<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè¸©äº†å¾ˆå¤šå‘ï¼Œä¸å¤ªç¡®å®šæ˜¯ä¸æ˜¯åªéœ€è¦è®¾ç½®è¿™ä¸ªæ–‡ä»¶å°±å¯ä»¥äº†ï¼Œè®¾ç½®å®Œé‡å¯ rstudio server å’Œç½‘é¡µç‰ˆçš„session</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">sudo systemctl <span class="hljs-keyword">restart</span> rstudio-<span class="hljs-keyword">server</span>.service<br></code></pre></td></tr></table></figure><p>è¿™é‡Œåªæ˜¯è®¾ç½®äº†rsessionçš„ç¯å¢ƒï¼Œä½†æ˜¯å¦‚æœåœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨ Rscript è¿è¡Œ R è„šæœ¬å¯èƒ½æ‰¾ä¸åˆ°åˆšæ‰è®¾ç½®çš„åº“è·¯å¾„ï¼Œè¿™é‡Œéœ€è¦åœ¨è®¾ç½®ä¸€ä¸‹æœåŠ¡å™¨ä¸Šçš„Råº“è·¯å¾„<br>ç¼–è¾‘ /etc/profile å†™å…¥ä»¥ä¸‹ä»£ç ï¼ˆéšæ„é€‰æ‹©ä¸€ä¸ªå°±å¯ä»¥ï¼‰</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">R_LIBS</span>=<span class="hljs-string">&quot;/usr/local/hdf5-1.8.17/lib:/share/apps/R/R-4.2.1/library:<span class="hljs-variable">$R_LIBS</span>&quot;</span><br></code></pre></td></tr></table></figure><p>ä¿å­˜é€€å‡ºåä½¿ç”¨source å‘½ä»¤é‡æ–°åŠ è½½</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">source</span> <span class="hljs-regexp">/etc/</span>profile<br></code></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨ä»¥ä¸Šæ–¹æ³•å·²ç»å¯ä»¥è§£å†³Rsessioné‡Œçš„libPathï¼Œé‚£å°±ä¸ç”¨å¾€ä¸‹çœ‹äº†ã€‚å¦‚æœæ²¡æœ‰å°±æ¥ç€è®¾ç½®å…¶ä»–æ–‡ä»¶<br>ç¼–è¾‘ /etc/rstudio/rserver.conf æ·»åŠ ä»¥ä¸‹ä»£ç </p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">rsession-ld-library-path=<span class="hljs-regexp">/usr/local</span><span class="hljs-regexp">/hdf5-1.8.17/lib</span><span class="hljs-symbol">:/share/apps/R/R-</span><span class="hljs-number">4.2</span>.<span class="hljs-number">1</span>/library<br></code></pre></td></tr></table></figure><p>ç¼–è¾‘ /share/apps/R/R-4.2.1/src/gnuwin32/fixed/etc/Rprofile.site æ·»åŠ ä»¥ä¸‹ä»£ç   è¿™ä¸ªæ–‡ä»¶æ¯ä¸ªäººçš„ç›®å½•åº”è¯¥ä¸ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨ locate Rprofile.site æŸ¥æ‰¾è‡ªå·±çš„ç›®å½•</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-class">.libPaths</span>(<span class="hljs-string">&quot;/share/apps/R/R-4.2.1/library&quot;</span>)<br></code></pre></td></tr></table></figure><p>ç»ˆç«¯æ‰§è¡Œå‘½ä»¤</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arduino">sudo rstudio-server test-config<br>sudo ldconfig<br></code></pre></td></tr></table></figure><p>æ‰€æœ‰é…ç½®è®¾ç½®å®Œåé‡å¯ rstudio server å’Œç½‘é¡µç‰ˆçš„session<br>å¦‚æœè¿™äº›è¿˜æ²¡è§£å†³ï¼Œï¼Œï¼Œï¼Œï¼Œï¼Œé»”é©´ä¹Ÿæœ‰æŠ€ç©·çš„æ—¶å€™å‘€ã€‚</p><p>hdf5råŒ…å®‰è£…å‚è€ƒï¼š<br><a href="https://codeleading.com/article/76914236347/">https://codeleading.com/article/76914236347/</a><br><a href="https://blog.csdn.net/qq_36608036/article/details/106537556">https://blog.csdn.net/qq_36608036/article/details/106537556</a></p>]]></content>
    
    
    <categories>
      
      <category>R</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Rstudio</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>jupyterhubé…ç½®condaç¯å¢ƒ</title>
    <link href="/2022/08/15/jupyterhub%E9%85%8D%E7%BD%AEconda%E7%8E%AF%E5%A2%83/"/>
    <url>/2022/08/15/jupyterhub%E9%85%8D%E7%BD%AEconda%E7%8E%AF%E5%A2%83/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><p>JupyterHubæ˜¯ä¸€ä¸ªæ”¯æŒå¤šç”¨æˆ·çš„NotebookæœåŠ¡å™¨ï¼Œç”¨äºåˆ›å»ºã€ç®¡ç†å’Œä»£ç†å¤šä¸ªJupyter Notebookå®ä¾‹ã€‚<br>jupyter notebook é…ç½®condaç¯å¢ƒå¯å‚è€ƒ <a href="https://shixiangwang.github.io/blog/4-jupyter-notebook-conda/">https://shixiangwang.github.io/blog/4-jupyter-notebook-conda/</a></p><p>ä½¿ç”¨jupyterhub é…ç½®condaç¯å¢ƒä¸ä½¿ç”¨jupyter notebook é…ç½®condaç¯å¢ƒå¤§ä½“ä¸€è‡´ã€‚<br>å¦‚æœæ˜¯ç®¡ç†å‘˜ä½¿ç”¨jupyterhubé…ç½®çš„condaç¯å¢ƒï¼Œå…¶å®ƒç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨ï¼Œå¦‚æœæ˜¯æ™®é€šç”¨æˆ·è‡ªå·±é…ç½®çš„condaç¯å¢ƒï¼Œåˆ™åªèƒ½è¯¥ç”¨æˆ·è‡ªå·±ä½¿ç”¨ã€‚<br>1ã€é¦–å…ˆä½¿ç”¨condaåˆ›å»ºç¯å¢ƒ</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">conda</span> create -n py<span class="hljs-number">38</span> python=<span class="hljs-number">3</span>.<span class="hljs-number">8</span><br></code></pre></td></tr></table></figure><p>2ã€ç¯å¢ƒå»ºå¥½ä»¥åè¿›å…¥ç¯å¢ƒ</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">source</span> activate py<span class="hljs-number">38</span><br></code></pre></td></tr></table></figure><p>3ã€è¿›å…¥ç¯å¢ƒåå®‰è£…å’Œé…ç½®ipykernel</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gradle">conda install -c conda-forge ipykernel<br>python -m ipykernel install --name=py38 --prefix=<span class="hljs-regexp">/home/</span>xxx/.local<br># --prefix æŒ‡å®šå®‰è£…è·¯å¾„<br># ç®¡ç†å‘˜å¯å®‰è£…åˆ° <span class="hljs-regexp">/usr/</span>local ä¸‹æˆ–è€…å…¶ä»–è‡ªå®šä¹‰è·¯å¾„<br># æ¯”å¦‚ <span class="hljs-regexp">/share/</span>apps<span class="hljs-regexp">/miniconda3/</span>envs<span class="hljs-regexp">/py38/</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨æ‰“å¼€jupyterhubè¿›å…¥è‡ªå·±çš„labå°±å¯ä»¥çœ‹åˆ°å¤šäº†ä¸€ä¸ªcondaçš„kernelã€‚<br>å‚è€ƒï¼š<a href="https://jupyterhub.readthedocs.io/en/stable/reference/config-user-env.html">https://jupyterhub.readthedocs.io/en/stable/reference/config-user-env.html</a></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>jupyter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ·±åº¦å­¦ä¹ ç‚¼ä¸¹è¸©å‘</title>
    <link href="/2022/07/20/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%82%BC%E4%B8%B9%E8%B8%A9%E5%9D%91/"/>
    <url>/2022/07/20/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%82%BC%E4%B8%B9%E8%B8%A9%E5%9D%91/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><h4 id="GPUæ˜¾å­˜"><a href="#GPUæ˜¾å­˜" class="headerlink" title="GPUæ˜¾å­˜"></a>GPUæ˜¾å­˜</h4><p>ä½¿ç”¨GPUè¿›è¡Œç‚¼ä¸¹çš„æ—¶å€™ï¼Œå‘ç°äº†äº›ghostè¿›ç¨‹ï¼Œå¦‚å›¾ä¸­æ‰€ç¤º<br><img src="/img/article/DL1.jpg"><br>è¿™äº›è¿›ç¨‹ä¸ä»…å ç”¨äº†å¤§é‡çš„GPUæ˜¾å­˜ï¼Œè€Œä¸”ä½¿ç”¨ ps æŸ¥è¯¢è¯¥è¿›ç¨‹çš„æ—¶å€™ç«Ÿç„¶éƒ½æŸ¥ä¸åˆ°ã€‚<br>å¥½åœ¨äº’è”ç½‘ä¸ŠæŸ¥åˆ°äº†è§£å†³çš„åŠæ³•</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo fuser -v <span class="hljs-regexp">/dev/</span>nvidia*<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨è¯¥å‘½ä»¤æŸ¥è¯¢å‡ºæ‰€æœ‰åœ¨GPUæ˜¾å¡ä¸Šçš„è¿›ç¨‹ï¼Œç„¶åkillæ‰å·²ç»ä¸å­˜åœ¨çš„è¿›ç¨‹å³å¯é‡Šæ”¾æ˜¾å­˜ã€‚</p><h4 id="learning-rate"><a href="#learning-rate" class="headerlink" title="learning rate"></a>learning rate</h4><p>åœ¨ç½‘ä¸Šæ‰¾äº†å¼ å›¾<br><img src="/img/article/DL2.jpg"><br>LRåœ¨ä¼˜åŒ–ç®—æ³•ä¸­æ›´æ–°ç½‘ç»œæƒé‡çš„å¹…åº¦å¤§å°ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æ·±åº¦å­¦ä¹ ä¸­éœ€è¦è°ƒçš„ç¬¬ä¸€å¤§å‚æ•°äº†å§ã€‚ä¸€èˆ¬å­¦ä¹ ç‡ä»0.1æˆ–0.01å¼€å§‹å°è¯•ï¼Œå¦‚æœå¤ªå¤§lossä¼šå¾ˆéœ‡è¡ç”šè‡³ç›´æ¥NAï¼Œå¤ªå°äº†æ”¶æ•›å°±ä¼šå¾ˆæ…¢ã€‚å­¦ä¹ ç‡ä¸€èˆ¬è¦éšç€è®­ç»ƒè¿›è¡Œè¡°å‡ã€‚è¡°å‡ç³»æ•°è®¾0.1ï¼Œ0.3ï¼Œ0.5å‡å¯ï¼Œè¡°å‡æ—¶æœºï¼Œå¯ä»¥æ˜¯éªŒè¯é›†å‡†ç¡®ç‡ä¸å†ä¸Šå‡æ—¶ï¼Œæˆ–å›ºå®šè®­ç»ƒå¤šå°‘ä¸ªå‘¨æœŸä»¥åè‡ªåŠ¨è¿›è¡Œè¡°å‡ã€‚å½“ç„¶äº†ä¹Ÿå¯ä»¥ä¸€ä¸ªå­¦ä¹ ç‡èµ°åˆ°åº•ï¼ˆä¸è¡°å‡ï¼‰ã€‚</p><h4 id="batch-size"><a href="#batch-size" class="headerlink" title="batch size"></a>batch size</h4><p>æ·±åº¦å­¦ä¹ ä¸­ä¸€ç›´éƒ½æœ‰ä¸€äº›å‚æ•°æœ‰ç€ç„å­¦èˆ¬çš„å­˜åœ¨ï¼Œæ¯”å¦‚ random seed = 42ï¼Œbatch size è®¾ç½®ä¸º 2 çš„å€æ•°ï¼Œæˆ–è€… 8 çš„å€æ•°ç­‰ç­‰ã€‚ä½†æ˜¯æœ€è¿‘æœ‰å¤§ä½¬å¯¹ batch size è¿™ä¸ªç„å­¦é—®é¢˜åšäº†å®éªŒï¼Œç»“æœå‘¢å°±æ˜¯ä¹Ÿä¸ç”¨éè¦æŒ‰ 2 çš„å€æ•°è¿™æ ·å»è®¾ç½®ã€‚æ—¢ç„¶ç„å­¦è¢«æ‰“ç ´é‚£å°±éšå¿ƒå¥½äº†ï¼Œåœ¨GPUæ˜¾å­˜å…è®¸çš„èŒƒå›´å†…å¯ä»¥å°½é‡è®¾ç½®å¤§ç‚¹ï¼Œè¿™æ ·å¯ä»¥èŠ‚çº¦ä¸å°‘æ—¶é—´ã€‚å½“ç„¶äº†ä¹Ÿä¸èƒ½ç›²ç›®çš„ä½¿ç”¨ä¸€ä¸ªå¤§çš„batch sizeï¼Œå¦‚æœæ¨¡å‹æ•ˆæœä¸å¥½ï¼Œè¯¥æ”¹è¿˜æ˜¯è¦æ”¹çš„ï¼Œæ¯•ç«Ÿç„å­¦ç»ˆç©¶æ˜¯ç„å­¦ã€‚</p><h4 id="optimizer"><a href="#optimizer" class="headerlink" title="optimizer"></a>optimizer</h4><p>ç›®å‰çš„ä¼˜åŒ–å™¨æœ‰ Adagrad, Adadelta, RMSprop, Adamç­‰ï¼Œè¿™ä¹ˆå¤šè¯¥æ€ä¹ˆé€‰å‘¢ï¼Œæ•´ä½“æ¥è®²ï¼ŒAdamæ˜¯æœ€å¥½çš„é€‰æ‹©ï¼Œä¹Ÿå°±æ˜¯åƒæˆ‘è¿™æ ·çš„å°ç™½ç›´æ¥æ— è„‘ Adam å°±å¥½äº†ã€‚å¤§ä½¬è¯·éšæ„ã€‚</p><p>å½“ç„¶äº†è¿˜æœ‰ä¸€äº›å…¶ä»–çš„å‚æ•°ï¼Œæ¯”å¦‚ weight decay, epoch, drop out ç­‰ç­‰ï¼Œepoch ä¸»è¦å°±æ˜¯è®­ç»ƒçš„è½®æ•°ï¼Œåªè¦æ²¡è¿‡æ‹Ÿåˆï¼Œlossæ²¡æ”¶æ•›ï¼Œé‚£epochå°±åªèƒ½å¾€å¤§äº†æ”¹ã€‚å¦‚æœè¿‡æ‹Ÿåˆäº†å°±å¯ä»¥å¢åŠ  weight decay, drop outçš„å‚æ•°ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–çš„æ­£åˆ™åŒ–æˆ–è€…å‡å°‘è¿‡æ‹Ÿåˆçš„æ–¹æ³•ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
    <tags>
      
      <tag>DL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>neo4jä¸­èŠ‚ç‚¹åŠå…³ç³»çš„æŸ¥è¯¢ã€åˆ é™¤ç­‰</title>
    <link href="/2022/03/01/neo4j%E4%B8%AD%E9%87%8D%E5%A4%8D%E8%8A%82%E7%82%B9%E5%8F%8A%E5%85%B3%E7%B3%BB%E7%9A%84%E6%9F%A5%E6%89%BE%E3%80%81%E5%88%A0%E9%99%A4/"/>
    <url>/2022/03/01/neo4j%E4%B8%AD%E9%87%8D%E5%A4%8D%E8%8A%82%E7%82%B9%E5%8F%8A%E5%85%B3%E7%B3%BB%E7%9A%84%E6%9F%A5%E6%89%BE%E3%80%81%E5%88%A0%E9%99%A4/</url>
    
    <content type="html"><![CDATA[<h2 id="Neo4j-æŸ¥è¯¢ã€åˆ é™¤"><a href="#Neo4j-æŸ¥è¯¢ã€åˆ é™¤" class="headerlink" title="Neo4j æŸ¥è¯¢ã€åˆ é™¤"></a>Neo4j æŸ¥è¯¢ã€åˆ é™¤</h2><span id="more"></span><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs hsp">MATCH (n)-[r]-(m) <span class="hljs-keyword">RETURN</span> * <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">100</span>  ç­‰ä»·äº MATCH p=()--() <span class="hljs-keyword">RETURN</span> p <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">100</span><br></code></pre></td></tr></table></figure><p>nå’Œmä»£è¡¨èŠ‚ç‚¹ï¼Œrä»£è¡¨relationshipå…³ç³»<br>(n)-[r]-(m)ä»£è¡¨ä¸€ç§æ¨¡å¼ï¼Œå³nèŠ‚ç‚¹å’ŒmèŠ‚ç‚¹ç”±rå…³ç³»è”ç³»èµ·æ¥<br>MATCH (n)-[r]-(m) RETURNçš„æ„æ€æ˜¯æŸ¥è¯¢å¹¶è¿”å›æ‰€æœ‰ä¸(n)-[r]-(m)æ¨¡å¼åŒ¹é…çš„èŠ‚ç‚¹å’Œå…³ç³»ã€‚<br>* LIMIT 100æ˜¯é™åˆ¶æ¡ä»¶ï¼Œæ„æ€æ˜¯ä»…éœ€è¿”å›å‰100ä¸ªåŒ¹é…åˆ°çš„ç»“æœï¼ˆèŠ‚ç‚¹å’Œå…³ç³»ï¼‰ã€‚</p><h5 id="æŸ¥è¯¢é‡å¤èŠ‚ç‚¹"><a href="#æŸ¥è¯¢é‡å¤èŠ‚ç‚¹" class="headerlink" title="æŸ¥è¯¢é‡å¤èŠ‚ç‚¹"></a>æŸ¥è¯¢é‡å¤èŠ‚ç‚¹</h5><p>å¯ä»¥åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤è§£å†³ï¼š</p><ul><li><p> 1ã€å…ˆæŸ¥çœ‹ä¸‹æŸä¸ªæ ‡ç­¾ä¸‹çš„èŠ‚ç‚¹æ€»æ•°</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">match</span> (n:PERSON) <span class="hljs-keyword">return</span> <span class="hljs-built_in">count</span>(n)<br></code></pre></td></tr></table></figure></li><li><p> 2ã€æ¯”è¾ƒæ€»æ•°å’Œå»é‡åæ€»æ•°ï¼Œå¯åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›¸åŒnameçš„èŠ‚ç‚¹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">match</span> (n:PERSON) <span class="hljs-keyword">return</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">distinct</span> n.name)<br></code></pre></td></tr></table></figure></li></ul><p>è‹¥æ‰§è¡Œæ­¥éª¤1å’Œæ­¥éª¤2ï¼Œå¾—åˆ°çš„æ•°é‡ç›¸åŒï¼Œåˆ™è¯æ˜æ²¡æœ‰é‡å¤çš„èŠ‚ç‚¹</p><ul><li><p> 3ã€è‹¥é‡å¤èŠ‚ç‚¹è¾ƒå°‘ï¼Œå¯é€šè¿‡è®¾ç½®idæ¡ä»¶è¿›è¡Œåˆ é™¤</p></li><li><p> 4ã€è‹¥é‡å¤èŠ‚ç‚¹è¾ƒå¤šï¼Œå¯ç”¨apocæ¥è¿›è¡Œæ“ä½œ(éœ€è¦å®‰è£…apocæ’ä»¶ï¼Œåœ°å€ï¼š<a href="https://github.com/neo4j-contrib/neo4j-apoc-procedures/releases">https://github.com/neo4j-contrib/neo4j-apoc-procedures/releases</a>)</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">MATCH (n:Tag) <br><span class="hljs-keyword">WITH</span> n.name <span class="hljs-keyword">AS</span> <span class="hljs-type">name</span>, <br>    COLLECT(n) <span class="hljs-keyword">AS</span> nodelist, <br>    COUNT(*) <span class="hljs-keyword">AS</span> count <br><span class="hljs-keyword">WHERE</span> count &gt; <span class="hljs-number">1</span> <br><span class="hljs-keyword">CALL</span> apoc.refactor.mergeNodes(nodelist) YIELD node <br><span class="hljs-keyword">RETURN</span> node<br></code></pre></td></tr></table></figure></li></ul><h5 id="æŸ¥è¯¢é‡å¤å…³ç³»"><a href="#æŸ¥è¯¢é‡å¤å…³ç³»" class="headerlink" title="æŸ¥è¯¢é‡å¤å…³ç³»"></a>æŸ¥è¯¢é‡å¤å…³ç³»</h5><ul><li><p>æŸ¥è¯¢</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">MATCH (<span class="hljs-keyword">a</span>)-[r]-(b) <br><span class="hljs-keyword">with</span> count(type(r)) <span class="hljs-keyword">as</span> <span class="hljs-built_in">num</span>,<span class="hljs-keyword">a</span>,b <br>where <span class="hljs-built_in">num</span> &gt;= <span class="hljs-number">2</span> <span class="hljs-literal">return</span> <span class="hljs-built_in">num</span>,<span class="hljs-keyword">a</span>,b LIMIT <span class="hljs-number">25</span><br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">MATCH</span> (a)<span class="hljs-selector-tag">-</span><span class="hljs-selector-attr">[r]</span><span class="hljs-selector-tag">-</span>(b) <br><span class="hljs-selector-tag">WITH</span> <span class="hljs-selector-tag">a</span>, <span class="hljs-selector-tag">b</span>, <span class="hljs-selector-tag">TAIL</span> (COLLECT (r)) <span class="hljs-selector-tag">as</span> <span class="hljs-selector-tag">rr</span> <br><span class="hljs-selector-tag">WHERE</span> <span class="hljs-selector-tag">size</span>(rr)&gt;<span class="hljs-selector-tag">0</span> <br><span class="hljs-selector-tag">FOREACH</span> (r IN rr | DELETE r)<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹èŠ‚ç‚¹çš„ label ï¼Œå¯ä»¥å…ˆæ–°åŠ  label ï¼Œå†åˆ é™¤æ—§çš„çš„label</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs oxygene">match (n:<span class="hljs-keyword">old</span>) <span class="hljs-keyword">set</span> n:<span class="hljs-keyword">NEW</span> <span class="hljs-keyword">remove</span> n:<span class="hljs-keyword">old</span><br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹å…³ç³»çš„ label</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">MATCH</span> (<span class="hljs-attribute">n</span>:drug)<span class="hljs-selector-tag">-</span><span class="hljs-selector-attr">[r:indication]</span><span class="hljs-selector-tag">-</span>(<span class="hljs-attribute">m</span>:disease)<br><span class="hljs-selector-tag">CREATE</span> (n)<span class="hljs-selector-tag">-</span><span class="hljs-selector-attr">[r2:drug_disease]</span><span class="hljs-selector-tag">-</span>&gt;(m)<br><span class="hljs-selector-tag">DELETE</span> <span class="hljs-selector-tag">r</span><br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤æŸä¸ªèŠ‚ç‚¹åŠå¯¹åº”çš„å…³ç³»</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">MATCH (n:Disease)-[r]-() <span class="hljs-keyword">where</span> n.name=&quot;&#123;f&#125;&quot; <span class="hljs-keyword">DELETE</span> n,r<br></code></pre></td></tr></table></figure></li><li><p>èŠ‚ç‚¹æ·»åŠ å±æ€§</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">MATCH (n &#123; <span class="hljs-type">name</span>: <span class="hljs-string">&#x27;Andres&#x27;</span> &#125;) <span class="hljs-keyword">SET</span> n.surname = <span class="hljs-string">&#x27;Taylor&#x27;</span> <span class="hljs-keyword">RETURN</span> n.name, n.surname<br></code></pre></td></tr></table></figure></li><li><p>å…³ç³»æ·»åŠ å±æ€§</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas">MATCH p=()-[r:`å°¾éƒ¨`]-&gt;() <span class="hljs-meta">SET</span> r=&#123;<span class="hljs-meta">title</span>:<span class="hljs-string">&quot;å°¾éƒ¨&quot;</span>&#125; <span class="hljs-meta">RETURN</span> p<br></code></pre></td></tr></table></figure></li></ul><h5 id="æŸ¥è¯¢æŸèŠ‚ç‚¹æ·±åº¦å…³ç³»"><a href="#æŸ¥è¯¢æŸèŠ‚ç‚¹æ·±åº¦å…³ç³»" class="headerlink" title="æŸ¥è¯¢æŸèŠ‚ç‚¹æ·±åº¦å…³ç³»"></a>æŸ¥è¯¢æŸèŠ‚ç‚¹æ·±åº¦å…³ç³»</h5><p>å˜é•¿è·¯å¾„çš„æ¨¡å¼</p><ul><li><p>(a)-[*2]-&gt;(b) : è¡¨ç¤ºè·¯å¾„é•¿åº¦ä¸º2ï¼Œ èµ·å§‹èŠ‚ç‚¹æ˜¯aï¼Œç»ˆæ­¢èŠ‚ç‚¹æ˜¯bï¼›</p></li><li><p>(a)-[*3..5]-&gt;(b) : è¡¨ç¤ºè·¯å¾„é•¿åº¦æœ€å°ä¸º2ï¼Œæœ€å¤§ä¸º5ï¼Œ èµ·å§‹èŠ‚ç‚¹æ˜¯aï¼Œç»ˆæ­¢èŠ‚ç‚¹æ˜¯bï¼›</p></li><li><p>(a)-[*..5]-&gt;(b) : è¡¨ç¤ºè·¯å¾„é•¿åº¦æœ€å¤§ä¸º5ï¼Œ èµ·å§‹èŠ‚ç‚¹æ˜¯aï¼Œç»ˆæ­¢èŠ‚ç‚¹æ˜¯bï¼›</p></li><li><p>(a)-[*3..]-&gt;(b) : è¡¨ç¤ºè·¯å¾„é•¿åº¦æœ€å°ä¸º3ï¼Œ èµ·å§‹èŠ‚ç‚¹æ˜¯aï¼Œç»ˆæ­¢èŠ‚ç‚¹æ˜¯bï¼›</p></li><li><p>(a)-[*]-&gt;(b) : è¡¨ç¤ºä¸é™åˆ¶è·¯å¾„é•¿åº¦ï¼Œ èµ·å§‹èŠ‚ç‚¹æ˜¯aï¼Œç»ˆæ­¢èŠ‚ç‚¹æ˜¯bï¼›</p></li></ul><ul><li><p>æ‰€æœ‰æ·±åº¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">match(n:TargetGene&#123;name:<span class="hljs-string">&#x27;TOP2A&#x27;</span>&#125;)-[r*]-(m) <span class="hljs-built_in">return</span> n,r,m <span class="hljs-built_in">limit</span> 100  <span class="hljs-comment">## æŸèŠ‚ç‚¹çš„æ‰€æœ‰å…³ç³»</span><br>match p=()--() <span class="hljs-built_in">return</span> p <span class="hljs-built_in">limit</span> 25   <span class="hljs-comment">## æ‰€æœ‰èŠ‚ç‚¹æ‰€æœ‰å…³ç³»</span><br></code></pre></td></tr></table></figure></li><li><p>ä¸€çº§æ·±åº¦ï¼ˆæŸèŠ‚ç‚¹å…³è”çš„ä¸€çº§æ‰€æœ‰èŠ‚ç‚¹åŠå…³ç³»ï¼‰</p><figure class="highlight rsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rsl"><span class="hljs-built_in">match</span> p=(n:TargetGene&#123;name:<span class="hljs-string">&#x27;TOP2A&#x27;</span>&#125;) -[]-() <span class="hljs-keyword">return</span> p    <span class="hljs-meta">## [] å‰åçš„ - ä»£è¡¨å…³ç³»çš„æ–¹å‘ï¼Œå¦‚æœæ²¡æœ‰ç®­å¤´è¡¨ç¤ºæ‰€æœ‰æ–¹å‘(ä¸­æ‹¬å·[]å¯çœç•¥)</span><br><span class="hljs-built_in">match</span>(n:TargetGene&#123;name:<span class="hljs-string">&#x27;TOP2A&#x27;</span>&#125;)-[r]-(m) <span class="hljs-keyword">return</span> n,r,m  <span class="hljs-meta">## ä¸ä¸Šæ¡å‘½ä»¤æ•ˆæœç›¸åŒ</span><br><br><span class="hljs-built_in">match</span> p=(n:TargetGene&#123;name:<span class="hljs-string">&#x27;TOP2A&#x27;</span>&#125;) -[]-&gt;() <span class="hljs-keyword">return</span> p   <span class="hljs-meta">##  è¡¨ç¤ºTOP2AæŒ‡å‘å¤–éƒ¨çš„æ‰€æœ‰èŠ‚ç‚¹åŠå…³ç³»</span><br><span class="hljs-built_in">match</span> p=(n:TargetGene&#123;name:<span class="hljs-string">&#x27;TOP2A&#x27;</span>&#125;) &lt;-[]-() <span class="hljs-keyword">return</span> p   <span class="hljs-meta">##  è¡¨ç¤ºæŒ‡å‘TOP2Açš„æ‰€æœ‰èŠ‚ç‚¹åŠå…³ç³»</span><br></code></pre></td></tr></table></figure></li><li><p>æŒ‡å®šæ·±åº¦</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">match</span><span class="hljs-params">(n:TargetGene&#123;name:<span class="hljs-string">&#x27;TOP2A&#x27;</span>&#125;)</span></span>-<span class="hljs-selector-attr">[r*..3]</span>-(m) return n,r,m limit <span class="hljs-number">100</span><br></code></pre></td></tr></table></figure></li></ul><h5 id="æŸ¥è¯¢æŸä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦æœ‰å…³ç³»"><a href="#æŸ¥è¯¢æŸä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦æœ‰å…³ç³»" class="headerlink" title="æŸ¥è¯¢æŸä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦æœ‰å…³ç³»"></a>æŸ¥è¯¢æŸä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦æœ‰å…³ç³»</h5><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">match (:èŠ‚ç‚¹æ ‡ç­¾<span class="hljs-number">1</span>&#123;<span class="hljs-type">name</span>:<span class="hljs-string">&#x27;xx&#x27;</span>&#125;)-[r]-(:èŠ‚ç‚¹æ ‡ç­¾<span class="hljs-number">2</span>&#123;<span class="hljs-type">name</span>:<span class="hljs-string">&#x27;xx&#x27;</span>&#125;) <span class="hljs-keyword">return</span> r,<span class="hljs-keyword">type</span>(r)<br></code></pre></td></tr></table></figure><ul><li><p>æŸ¥è¯¢æ·±åº¦å…³ç³»ï¼ˆr*3è¡¨ç¤º3çº§ï¼‰</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">match p=(n:TargetGene&#123;<span class="hljs-type">name</span>:<span class="hljs-string">&#x27;MIR7-1&#x27;</span>&#125;)-[r*<span class="hljs-number">3</span>]-(m:Disease&#123;<span class="hljs-type">name</span>:<span class="hljs-string">&#x27;breast cancer&#x27;</span>&#125;) <span class="hljs-keyword">return</span> p<br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨whereè¿›è¡ŒæŸ¥è¯¢</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">match p=(n:TargetGene)-[r*<span class="hljs-number">3</span>]-(m:Disease) <span class="hljs-keyword">where</span> n.<span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;MIR7-1&quot;</span> <span class="hljs-keyword">and</span> m.<span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;breast cancer&quot;</span> <span class="hljs-literal">return</span> p<br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨æ­£åˆ™å¿½ç•¥å¤§å°å†™  <del>â€œ(?i)stringsâ€  å…¶è¯­æ³•ä¸º : =</del> â€œregexpâ€  åŒºåˆ†å¤§å°å†™çš„æ¨¡ç³ŠåŒ¹é…; =~â€(?i)regexpâ€ ä¸åŒºåˆ†å¤§å°å†™çš„æ¨¡ç³ŠåŒ¹é…</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">match p=(n:TargetGene)-[r*<span class="hljs-number">3</span>]-(m:Disease) <span class="hljs-keyword">where</span> n.<span class="hljs-built_in">name</span>=~<span class="hljs-string">&quot;(?i)mir7-1&quot;</span> <span class="hljs-keyword">and</span> m.<span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;breast cancer&quot;</span> <span class="hljs-literal">return</span> p<br></code></pre></td></tr></table></figure></li><li><p>æœ€çŸ­è·¯å¾„æŸ¥è¯¢<br>æ–¹æ³•ä¸€ï¼š</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lisp">match p=shortestPath((<span class="hljs-name">n</span><span class="hljs-symbol">:TargetGene</span>&#123;name:<span class="hljs-string">&quot;MIR7-1&quot;</span>&#125;)-[r*]-(<span class="hljs-name">m</span><span class="hljs-symbol">:Disease</span>&#123;name:<span class="hljs-string">&quot;breast cancer&quot;</span>&#125;))  return p<br></code></pre></td></tr></table></figure><p>æ–¹æ³•äºŒï¼š<br>åŠ å…¥äº†å¿½ç•¥å¤§å°å†™</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">match (n:TargetGene),(m:Disease) <span class="hljs-keyword">where</span> n.<span class="hljs-built_in">name</span>=~<span class="hljs-string">&quot;(?i)mir7-1&quot;</span> <span class="hljs-keyword">and</span> m.<span class="hljs-built_in">name</span>=<span class="hljs-string">&quot;breast cancer&quot;</span><br><span class="hljs-keyword">with</span> n,m match p=shortestpath((n)-[r*]-(m)) <span class="hljs-literal">return</span> p;<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥è¯¢å¤šä¸ªè¯ç‰©ä¸æŸä¸ªç–¾ç—…çš„æœ€çŸ­è·¯å¾„</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq"><span class="hljs-keyword">match</span> (m:Drug), (n:Disease) <span class="hljs-keyword">where</span> m.name=~&#x27;(?i)DOXYLAMINE|<span class="hljs-type">FESOTERODINE</span>|<span class="hljs-type">TROPICAMIDE</span>|<span class="hljs-type">Dexmedetomidine</span>&#x27; and n.name=~&#x27;(?i)Systemic sclerosis&#x27; <span class="hljs-built_in">with</span> n,m <span class="hljs-keyword">match</span> p=shortestpath((n)-[r*]-(m)) <span class="hljs-keyword">return</span> p<br></code></pre></td></tr></table></figure></li></ul><h5 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h5><ul><li><p>é€šè¿‡ name å±æ€§  åˆ é™¤è¿™ä¸€ä¸ªèŠ‚ç‚¹</p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs excel"><span class="hljs-built_in">MATCH</span> (<span class="hljs-symbol">n:TE</span>ST1&#123;<span class="hljs-built_in">na</span><span class="hljs-symbol">me:</span>&#x27;temp&#x27;&#125;) delete <span class="hljs-built_in">n</span><br></code></pre></td></tr></table></figure></li><li><p>é€šè¿‡ id å±æ€§ åˆ é™¤è¿™ä¸€ä¸ªèŠ‚ç‚¹</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">MATCH (<span class="hljs-built_in">r</span>) <span class="hljs-built_in">WHERE</span> id(<span class="hljs-built_in">r</span>) = <span class="hljs-number">492</span> DELETE <span class="hljs-built_in">r</span><br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹åŠå…¶æ‰€æœ‰çš„å…³ç³»</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">MATCH (<span class="hljs-built_in">r</span>) <span class="hljs-built_in">WHERE</span> id(<span class="hljs-built_in">r</span>) = <span class="hljs-number">493</span> DETACH DELETE <span class="hljs-built_in">r</span><br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤æ‰€æœ‰èŠ‚ç‚¹å’Œæ‰€æœ‰çš„å…³ç³»</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">MATCH (<span class="hljs-built_in">r</span>) DETACH DELETE <span class="hljs-built_in">r</span><br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤ä¸€ä¸ªæ ‡ç­¾ä¸­æ‰€æœ‰çš„èŠ‚ç‚¹</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">MATCH</span> (<span class="hljs-attribute">r</span>:Loc) <span class="hljs-selector-tag">DETACH</span> <span class="hljs-selector-tag">DELETE</span> <span class="hljs-selector-tag">r</span><br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤æ ‡ç­¾</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clean">:schema    ### æŸ¥è¯¢æ ‡ç­¾æ‰€å¯¹åº”çš„ç´¢å¼•<br></code></pre></td></tr></table></figure></li></ul><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">index</span> ç´¢å¼•åå­—<br></code></pre></td></tr></table></figure><p>å‚è€ƒï¼š<a href="https://python.iitter.com/other/191720.html">https://python.iitter.com/other/191720.html</a></p>]]></content>
    
    
    <categories>
      
      <category>Neo4j</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Neo4j</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>cppå­¦ä¹ ç¬”è®°03</title>
    <link href="/2022/03/01/cpp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003/"/>
    <url>/2022/03/01/cpp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B003/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;string&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><br><span class="hljs-comment">//åœ†å‘¨é•¿</span><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">double</span> pi = <span class="hljs-number">3.14</span>;<br><br><br><span class="hljs-comment">// struct é»˜è®¤æƒé™ä¸º å…¬å…± public</span><br><span class="hljs-comment">// class é»˜è®¤æƒé™ä¸º ç§æœ‰ private</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C1</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-keyword">int</span> m1; <span class="hljs-comment">// é»˜è®¤ç§æœ‰</span><br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">C2</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-keyword">int</span> m2; <span class="hljs-comment">// é»˜è®¤å…¬å…± </span><br>&#125;;<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Circle</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-comment">//è®¿é—®æƒé™ï¼šå…¬å…±æƒé™publicã€ä¿æŠ¤æƒé™protectedã€ç§æœ‰æƒé™private</span><br>    <span class="hljs-comment">//å…¬å…±æƒé™</span><br><span class="hljs-keyword">public</span>:   <span class="hljs-comment">//ç±»å†…å¤–éƒ½å¯è®¿é—®</span><br>    <span class="hljs-comment">//ç±»ä¸­å±æ€§å’Œè¡Œä¸ºç»Ÿä¸€ç§°ä¸ºæˆå‘˜</span><br>    <span class="hljs-comment">// å±æ€§  æˆå‘˜å±æ€§ æˆå‘˜å˜é‡</span><br>    <span class="hljs-keyword">int</span> r;<br><br>    <span class="hljs-comment">//è¡Œä¸º  æˆå‘˜è¡Œä¸º æˆå‘˜å‡½æ•°</span><br>    <span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">calculate</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span> * pi * r;<br>    &#125;<br><br><span class="hljs-keyword">protected</span>:  <span class="hljs-comment">//ç±»å†…å¯è®¿é—®ï¼Œç±»å¤–ä¸å¯    å­ç±»å¯è®¿é—®</span><br>    <span class="hljs-keyword">int</span> r1;<br><br><br><span class="hljs-keyword">private</span>:   <span class="hljs-comment">// ç±»å†…å¯è®¿é—®ï¼Œç±»å¤–ä¸å¯   å­ç±»ä¸å¯è®¿é—®</span><br>    <span class="hljs-keyword">int</span> r2;<br>    <br>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> <span class="hljs-keyword">const</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    Circle c1;<br>    c1.r = <span class="hljs-number">10</span>;<br><br>    cout &lt;&lt; c1.<span class="hljs-built_in">calculate</span>() &lt;&lt; endl;<br><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CPP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CPP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>cppå­¦ä¹ ç¬”è®°02</title>
    <link href="/2022/03/01/cpp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B002/"/>
    <url>/2022/03/01/cpp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B002/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;string&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><br><span class="hljs-comment">//å€¼ä¼ é€’, å½¢å‚ä¸ä¼šä¿®é¥°å®å‚</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">swap1</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> tmp = a;<br>    a = b;<br>    b = tmp;<br><br>&#125;<br><br><span class="hljs-comment">//åœ°å€ä¼ é€’ï¼Œå½¢å‚ä¼šä¿®é¥°å®å‚</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">swap2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *a, <span class="hljs-keyword">int</span> *b)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> tmp = *a;<br>    *a = *b;<br>    *b = tmp;<br>&#125;<br><br><span class="hljs-comment">//å¸¸é‡å¼•ç”¨ï¼Œç”¨æ¥ä¿®é¥°å½¢å‚ï¼Œé˜²æ­¢è¯¯æ“ä½œ</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">showValue</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> &amp;val)</span></span><br><span class="hljs-function"></span>&#123;<br>    cout &lt;&lt; val &lt;&lt; endl; <span class="hljs-comment">// valçš„å€¼æ— æ³•ä¿®æ”¹</span><br>&#125;<br><br><br><span class="hljs-comment">//å¼•ç”¨çš„æœ¬è´¨æ˜¯æŒ‡é’ˆå¸¸é‡</span><br><span class="hljs-comment">//å¼•ç”¨ä¼ é€’ï¼Œå½¢å‚ä¼šä¿®é¥°å®å‚</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">swap3</span><span class="hljs-params">(<span class="hljs-keyword">int</span> &amp;a, <span class="hljs-keyword">int</span> &amp;b)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> tmp = a;<br>    a = b;<br>    b = tmp;<br>&#125;<br><br><span class="hljs-comment">// ä¸è¦è¿”å›å±€éƒ¨å˜é‡çš„å¼•ç”¨</span><br><span class="hljs-comment">// int&amp; test1()</span><br><span class="hljs-comment">// &#123;</span><br><span class="hljs-comment">//  int a = 10; // å±€éƒ¨å˜é‡å­˜æ”¾åœ¨æ ˆåŒº</span><br><span class="hljs-comment">//  // return a; // è¿”å›å¼•ç”¨ä¼šå¸¦æ¥éšæ‚£</span><br><span class="hljs-comment">// &#125;</span><br><br><span class="hljs-comment">// å‡½æ•°çš„è°ƒç”¨å¯ä»¥ä½œä¸ºå·¦å€¼</span><br><span class="hljs-function"><span class="hljs-keyword">int</span>&amp; <span class="hljs-title">test2</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> a = <span class="hljs-number">10</span>; <span class="hljs-comment">// é™æ€å˜é‡å­˜æ”¾åœ¨å…¨å±€åŒº</span><br>    <span class="hljs-keyword">return</span> a; <br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> <span class="hljs-keyword">const</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">//å¼•ç”¨çš„åŸºæœ¬ä½¿ç”¨</span><br>    <span class="hljs-comment">//ä½œç”¨ï¼šç»™å˜é‡èµ·åˆ«å</span><br>    <span class="hljs-comment">//è¯­æ³•ï¼šæ•°æ®ç±»å‹ &amp;åˆ«å = åŸå</span><br>    <span class="hljs-keyword">int</span> a = <span class="hljs-number">10</span>;<br>    <span class="hljs-comment">// åˆ›å»ºå¼•ç”¨</span><br>    <span class="hljs-keyword">int</span> &amp;b = a;   <span class="hljs-comment">// å¼•ç”¨åˆå§‹åŒ–(å¿…é¡»)ï¼Œåˆå§‹åŒ–åä¸å¯æ”¹å˜ï¼Œbçš„å€¼ä¹Ÿæ˜¯10</span><br><br>    <span class="hljs-keyword">int</span> &amp;aa = <span class="hljs-built_in">test2</span>();<br>    <span class="hljs-built_in">test2</span>() = <span class="hljs-number">100</span>;       <span class="hljs-comment">// å‡½æ•°çš„è°ƒç”¨å¯ä»¥ä½œä¸ºå·¦å€¼</span><br>    cout &lt;&lt; aa &lt;&lt; endl;<br><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-meta">#include&lt;iostream&gt;</span><br><span class="hljs-meta">#include&lt;string&gt;</span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-title">std</span>;<br><br><span class="hljs-comment">//å£°æ˜å’Œå®ç°åªèƒ½æœ‰ä¸€ä¸ªæœ‰é»˜è®¤å‚æ•°,å³å¦‚æœå‡½æ•°å£°æ˜æœ‰é»˜è®¤å‚æ•°ï¼Œå‡½æ•°å®ç°å°±ä¸èƒ½æœ‰é»˜è®¤å‚æ•°ï¼Œåä¹‹äº¦ç„¶</span><br><span class="hljs-comment">//å‡½æ•°å£°æ˜</span><br><span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">func1</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> a, <span class="hljs-built_in">int</span> b=<span class="hljs-number">10</span></span>)</span>;<br><br><span class="hljs-comment">//å‡½æ•°å®ç°</span><br><span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">func1</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> a, <span class="hljs-built_in">int</span> b</span>)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> a + b<br>&#125;<br><br><span class="hljs-comment">// å ä½å‚æ•°</span><br><span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">func2</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> a, <span class="hljs-built_in">int</span></span>)  <span class="hljs-comment">// ç¬¬äºŒä¸ª int ä¸ºå ä½ç¬¦ï¼Œå ä½ç¬¦ä¹Ÿå¯æœ‰é»˜è®¤å€¼, å¦‚ int func2(int a, int = 10);</span></span><br>&#123;<br>    <span class="hljs-keyword">return</span> a<br>&#125;<br><br><span class="hljs-comment">//å‡½æ•°é‡è½½</span><br><span class="hljs-comment">//åŒä¸€ä¸ªä½œç”¨åŸŸä¸‹</span><br><span class="hljs-comment">//å‡½æ•°åç§°ç›¸åŒ</span><br><span class="hljs-comment">//å‡½æ•°å‚æ•°ç±»å‹ä¸åŒï¼Œæˆ–è€…ä¸ªæ•°ä¸åŒï¼Œæˆ–è€…é¡ºåºä¸åŒ</span><br><span class="hljs-comment">// å‡½æ•°çš„è¿”å›å€¼ä¸å¯ä»¥åšä¸ºå‡½æ•°é‡è½½çš„æ¡ä»¶</span><br><br><span class="hljs-comment">//å¼•ç”¨åšä¸ºé‡è½½æ¡ä»¶</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">func3</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> &amp;a</span>)</span><br>&#123;<br>    cout &lt;&lt; <span class="hljs-string">&#x27;&#x27;</span> &lt;&lt; endl;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">func3</span>(<span class="hljs-params"><span class="hljs-keyword">const</span> <span class="hljs-built_in">int</span> &amp;a</span>)</span><br>&#123;<br>    cout &lt;&lt; <span class="hljs-string">&#x27;const&#x27;</span> &lt;&lt; endl;<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">main</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> argc, <span class="hljs-built_in">char</span> <span class="hljs-keyword">const</span> *argv[]</span>)</span><br>&#123;<br>    func3(<span class="hljs-number">10</span>); <span class="hljs-comment">// è¿è¡Œ func3(const int &amp;a), å› ä¸º int &amp;a = 10 ä¸åˆæ³•</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CPP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CPP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>cppå­¦ä¹ ç¬”è®°01</title>
    <link href="/2022/03/01/cpp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B001/"/>
    <url>/2022/03/01/cpp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B001/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;string&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><br><span class="hljs-comment">// å‡½æ•°åˆ†æ–‡ä»¶</span><br><span class="hljs-comment">// 1ã€åˆ›å»º .h åç¼€åçš„å¤´æ–‡ä»¶</span><br><span class="hljs-comment">// 2ã€åˆ›å»º .cpp åç¼€åçš„æºæ–‡ä»¶</span><br><span class="hljs-comment">// 3ã€åœ¨å¤´æ–‡ä»¶ä¸­å†™å‡½æ•°çš„å£°æ˜</span><br><span class="hljs-comment">// 4ã€åœ¨æºæ–‡ä»¶ä¸­å†™å‡½æ•°å®šä¹‰</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;swap.h&quot;</span></span><br><br><span class="hljs-comment">//å¸¸é‡å®šä¹‰æ–¹å¼</span><br><span class="hljs-comment">//1ã€ #define å®å¸¸é‡</span><br><span class="hljs-comment">//2ã€ const ä¿®é¥°çš„å˜é‡</span><br><br><span class="hljs-comment">//1ã€ #define å®šä¹‰å¸¸é‡</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> Day 7</span><br><br><span class="hljs-comment">// struct è‡ªå®šä¹‰æ•°æ®ç»“æ„å…³é”®å­—ï¼Œç»“æ„ä½“æŒ‡é’ˆé€šè¿‡ -&gt; è·å–å±æ€§æ•°æ®</span><br><br><span class="hljs-comment">//æ ˆåŒºæ•°æ®(å±€éƒ¨å˜é‡ã€å½¢å‚ç­‰)ç”±ç¼–è¯‘å™¨ç®¡ç†ï¼Œå †åŒºæ•°æ®(newå…³é”®å­—å¼€è¾Ÿå†…å­˜å­˜æ”¾æ•°æ®ï¼Œå¯ä½¿ç”¨deleteåˆ é™¤)ç”±ç¨‹åºå‘˜ç®¡ç†</span><br><br><span class="hljs-comment">// ä½¿ç”¨newåˆ›å»ºæ•°æ®ï¼šnewè¿”å›çš„æ˜¯ è¯¥æ•°æ®ç±»å‹çš„æŒ‡é’ˆ</span><br><span class="hljs-keyword">int</span> *p = <span class="hljs-keyword">new</span> <span class="hljs-built_in"><span class="hljs-keyword">int</span></span>(<span class="hljs-number">10</span>);<br><br><span class="hljs-comment">// å‡½æ•°å£°æ˜ï¼šå¯ä»¥æå‰å‘Šè¯‰ç¼–è¯‘å™¨å‡½æ•°çš„å­˜åœ¨, å£°æ˜å¯ä»¥å¤šæ¬¡ï¼Œå®šä¹‰åªæœ‰ä¸€æ¬¡</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">max</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span></span>;<br><br><span class="hljs-comment">// å‡½æ•°ï¼šå€¼ä¼ é€’ä¸ä¿®æ”¹å®å‚ï¼Œåœ°å€ä¼ é€’ä¿®æ”¹å®å‚</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">swap1</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span></span>; <span class="hljs-comment">// å€¼ä¼ é€’</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">swap2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *p1, <span class="hljs-keyword">int</span> *p2)</span></span>; <span class="hljs-comment">// åœ°å€ä¼ é€’ swap2(&amp;a, &amp;b)</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">bubbleSort</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arr[], <span class="hljs-keyword">int</span> len)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; len - <span class="hljs-number">1</span>; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; len -i <span class="hljs-number">-1</span>; j++)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (arr[j] &gt; arr[j+<span class="hljs-number">1</span>])<br>            &#123;<br>                <span class="hljs-keyword">int</span> tmp = arr[j];<br>                arr[j] = arr[j+<span class="hljs-number">1</span>];<br>                arr[j+<span class="hljs-number">1</span>] = tmp;<br>            &#125;<br>                <br>        &#125;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> <span class="hljs-keyword">const</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;   <br>    <span class="hljs-comment">//2ã€ const ä¿®é¥°çš„å˜é‡</span><br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> month = <span class="hljs-number">12</span>;  <span class="hljs-comment">// const ä¿®é¥°çš„å˜é‡ä¹Ÿæ˜¯å¸¸é‡</span><br>    cout &lt;&lt; Day &lt;&lt; month &lt;&lt; endl;<br><br>    <span class="hljs-comment">// int a = 10;</span><br>    <span class="hljs-comment">// sizeof è®¡ç®—å†…å­˜å¤§å°</span><br>    <span class="hljs-comment">// cout &lt;&lt; sizeof(a) &lt;&lt; endl;</span><br><br>    <span class="hljs-comment">// é»˜è®¤æƒ…å†µå°æ•°æ˜¾ç¤º6ä½æœ‰æ•ˆæ•°å­—</span><br>    <span class="hljs-keyword">float</span> f = <span class="hljs-number">3.14f</span>; <span class="hljs-comment">// é»˜è®¤åŒç²¾åº¦ï¼Œæ•°å­—ååŠ fä¸ºå•ç²¾åº¦</span><br><br>    <span class="hljs-comment">//å­—ç¬¦å‹å˜é‡ç”¨äºæ˜¾ç¤ºå•ä¸ªå­—ç¬¦</span><br>    <span class="hljs-keyword">char</span> c = <span class="hljs-string">&#x27;a&#x27;</span>; <span class="hljs-comment">// åªèƒ½å•å¼•å·</span><br>    cout &lt;&lt; (<span class="hljs-keyword">int</span>)c &lt;&lt; endl; <span class="hljs-comment">// (int) è½¬æ¢ c ä¸º ascii å€¼</span><br><br>    cout &lt;&lt; <span class="hljs-string">&quot;aa\tbb&quot;</span> &lt;&lt; endl;<br><br>    <span class="hljs-comment">// c é£æ ¼å­—ç¬¦ä¸²  chat å­—ç¬¦ä¸²å []</span><br>    <span class="hljs-keyword">char</span> str1[] = <span class="hljs-string">&quot;hello&quot;</span>;<br>    <span class="hljs-comment">// c++ é£æ ¼å­—ç¬¦ä¸²</span><br>    string str2 = <span class="hljs-string">&quot;hello&quot;</span>;<br>    cout &lt;&lt; str1 &lt;&lt; <span class="hljs-string">&quot;\t&quot;</span> &lt;&lt; str2 &lt;&lt;endl;<br><br>    <span class="hljs-comment">// ä¸¤ä¸ªæ•´æ•°ç›¸é™¤ç»“æœè¿˜æ˜¯æ•´æ•°ï¼ˆå‘ä¸‹å–æ•´ï¼‰</span><br>    cout &lt;&lt; <span class="hljs-number">10</span> / <span class="hljs-number">20</span> &lt;&lt; endl;<br>    <span class="hljs-comment">// % å–è†œè¿ç®—ï¼ˆå–ä½™æ•°ï¼‰</span><br><br>    <span class="hljs-comment">// ä¸‰ç›®è¿ç®—ç¬¦</span><br>    <span class="hljs-comment">// è¡¨è¾¾å¼1 ï¼Ÿè¡¨è¾¾å¼2 ï¼šè¡¨è¾¾å¼3  1çœŸ æ‰§è¡Œ2 ,å¦åˆ™ æ‰§è¡Œ3</span><br>    <span class="hljs-comment">// c++ ä¸­ ä¸‰ç›®è¿ç®—ç¬¦è¿”å›çš„æ˜¯å˜é‡ï¼Œå¯ä»¥ç»§ç»­èµ‹å€¼</span><br>    <span class="hljs-keyword">int</span> a = <span class="hljs-number">10</span>; <span class="hljs-keyword">int</span> b = <span class="hljs-number">20</span>;<br>    (a &gt; b ? a : b) = <span class="hljs-number">100</span>; <span class="hljs-comment">// å¯¹ b é‡æ–°èµ‹å€¼ 100</span><br><br>    <span class="hljs-comment">// goto è¯­å¥</span><br>    <span class="hljs-comment">// å¦‚æœgotoçš„æ ‡è®°å­˜åœ¨ï¼Œåˆ™ç›´æ¥è·³è½¬åˆ°æ ‡è®°å¤„</span><br>    <span class="hljs-keyword">goto</span> FLAG;<br>    cout &lt;&lt; <span class="hljs-string">&quot;è·³è¿‡äº†&quot;</span> &lt;&lt; endl; <span class="hljs-comment">// è¯¥è¯­å¥ä¸æ‰§è¡Œ</span><br>    FLAG:<br>    cout &lt;&lt; <span class="hljs-string">&quot;æ‰§è¡Œ&quot;</span> &lt;&lt; endl;<br><br>    <span class="hljs-comment">// æ•°æ®ç±»å‹ æ•°ç»„å[æ•°ç»„é•¿åº¦];</span><br>    <span class="hljs-keyword">int</span> arr[<span class="hljs-number">2</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;;  <span class="hljs-comment">// æ•°ç»„å arr æ˜¯å¸¸é‡ï¼Œä¸å¯è¿›è¡Œèµ‹å€¼æ“ä½œï¼Œå¦‚ arr = 10</span><br><br>    <span class="hljs-comment">// äºŒç»´æ•°ç»„</span><br>    <span class="hljs-comment">// 1ã€æ•°æ®ç±»å‹ æ•°ç»„å[è¡Œæ•°][åˆ—æ•°];</span><br>    <span class="hljs-comment">// 2ã€æ•°æ®ç±»å‹ æ•°ç»„å[è¡Œæ•°][åˆ—æ•°] = &#123;&#123;æ•°æ®1ï¼Œæ•°æ®2&#125;, &#123;æ•°æ®3ï¼Œæ•°æ®4&#125;&#125;;</span><br>    <span class="hljs-comment">// 3ã€æ•°æ®ç±»å‹ æ•°ç»„å[è¡Œæ•°][åˆ—æ•°] = &#123;æ•°æ®1ï¼Œæ•°æ®2, æ•°æ®3ï¼Œæ•°æ®4&#125;;</span><br>    <span class="hljs-comment">// 4ã€æ•°æ®ç±»å‹ æ•°ç»„å[][åˆ—æ•°] = &#123;æ•°æ®1ï¼Œæ•°æ®2, æ•°æ®3ï¼Œæ•°æ®4&#125;;</span><br><br>    <span class="hljs-comment">// æŒ‡é’ˆå®šä¹‰ï¼šæ•°æ®ç±»å‹ * æŒ‡é’ˆå˜é‡å;</span><br>    <span class="hljs-comment">// è®©æŒ‡é’ˆè®°å½•å˜é‡çš„åœ°å€</span><br>    <span class="hljs-keyword">int</span> g = <span class="hljs-number">10</span>;<br>    <span class="hljs-keyword">int</span> *p = &amp;g; <span class="hljs-comment">// ç­‰åŒäºä¸‹é¢ä¸¤è¡Œä»£ç </span><br>    <span class="hljs-comment">// int *p;</span><br>    <span class="hljs-comment">// p = &amp;g;</span><br><br>    <span class="hljs-comment">// æŒ‡é’ˆå‰åŠ  * å·ä»£è¡¨ è§£å¼•ç”¨</span><br>    cout &lt;&lt; *p &lt;&lt; endl;<br>    *p = <span class="hljs-number">100</span>; <span class="hljs-comment">// å¯ä»¥è¿›è¡Œèµ‹å€¼ä¿®æ”¹å˜é‡çš„å€¼</span><br>    cout &lt;&lt; g &lt;&lt; endl;<br><br>    <span class="hljs-comment">// ç©ºæŒ‡é’ˆï¼šæŒ‡é’ˆå˜é‡æŒ‡å‘å†…å­˜ä¸­ç¼–å·ä¸º0çš„ç©ºé—´</span><br>    <span class="hljs-comment">// ç”¨é€”ï¼šåˆå§‹åŒ–å˜é‡</span><br>    <span class="hljs-comment">// æ³¨ï¼šç©ºæŒ‡é’ˆä¸å¯ä»¥è¿›è¡Œè®¿é—®(0-255å†…å­˜ç¼–å·ä¸ºç³»ç»Ÿå ç”¨)</span><br>    <span class="hljs-keyword">int</span> *p1 = <span class="hljs-literal">NULL</span>;<br><br>    <span class="hljs-comment">// é‡æŒ‡é’ˆï¼šæŒ‡å‘éæ³•çš„å†…å­˜ç©ºé—´</span><br><br>    <span class="hljs-comment">// constä¿®é¥°æŒ‡é’ˆ </span><br>    <span class="hljs-comment">// å¸¸é‡æŒ‡é’ˆ:æŒ‡é’ˆçš„æŒ‡å‘å¯ä»¥ä¿®æ”¹ï¼ŒæŒ‡é’ˆæŒ‡çš„å€¼ä¸å¯ä»¥ä¿®æ”¹</span><br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> *p2 = &amp;a;  <span class="hljs-comment">// *n = 20 é”™è¯¯ï¼Œ n = &amp;b; æ­£ç¡®</span><br><br>    <span class="hljs-comment">// æŒ‡é’ˆå¸¸é‡ï¼šæŒ‡é’ˆçš„æŒ‡å‘ä¸å¯ä»¥ä¿®æ”¹ï¼ŒæŒ‡é’ˆæŒ‡çš„å€¼å¯ä»¥ä¿®æ”¹</span><br>    <span class="hljs-keyword">int</span> * <span class="hljs-keyword">const</span> p3 = &amp;a;<br><br>    <span class="hljs-comment">// constä¿®é¥°æŒ‡é’ˆï¼Œåˆä¿®é¥°å¸¸é‡ï¼š æŒ‡é’ˆçš„æŒ‡å‘ä¸å¯ä»¥ä¿®æ”¹ï¼ŒæŒ‡é’ˆæŒ‡çš„å€¼ä¸å¯ä»¥ä¿®æ”¹</span><br>    <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> * <span class="hljs-keyword">const</span> p4 = &amp;a;<br><br>    <span class="hljs-comment">// æŒ‡é’ˆå’Œæ•°ç»„</span><br>    <span class="hljs-keyword">int</span> arr2[<span class="hljs-number">2</span>] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>&#125;;<br>    <span class="hljs-keyword">int</span> *p5 = arr2; <span class="hljs-comment">// arr2 æ•°ç»„é¦–åœ°å€</span><br><br>    cout &lt;&lt; *p5 &lt;&lt; endl; <span class="hljs-comment">//å¯è·å–arrç¬¬ä¸€ä¸ªå€¼</span><br>    p5++;<br>    cout &lt;&lt; *p5 &lt;&lt; endl; <span class="hljs-comment">//å¯è·å–arrç¬¬2ä¸ªå€¼</span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">max</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span></span>&#123;<br>    <span class="hljs-keyword">return</span> a &gt; b ? a : b;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CPP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CPP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å›¾æ•°æ®åº“neo4j-Echartså¯è§†åŒ–</title>
    <link href="/2022/02/23/%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93neo4j-Echarts%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    <url>/2022/02/23/%E5%9B%BE%E6%95%B0%E6%8D%AE%E5%BA%93neo4j-Echarts%E5%8F%AF%E8%A7%86%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h2 id="Neo4j-Flask-Echarts"><a href="#Neo4j-Flask-Echarts" class="headerlink" title="Neo4j Flask Echarts"></a>Neo4j Flask Echarts</h2><span id="more"></span><h5 id="å®‰è£…-Neo4j"><a href="#å®‰è£…-Neo4j" class="headerlink" title="å®‰è£… Neo4j"></a>å®‰è£… Neo4j</h5><p>Neo4jä¾èµ–Javaç¯å¢ƒï¼Œæ‰€ä»¥éœ€è¦å…ˆå®‰è£…JDKï¼Œ JDKä¸‹è½½åœ°å€å¦‚ä¸‹ï¼š</p><ul><li><a href="https://www.oracle.com/java/technologies/downloads/">https://www.oracle.com/java/technologies/downloads/</a><br>æœ€æ–°ç‰ˆçš„Neo4jéœ€è¦java11ç‰ˆæœ¬ä»¥ä¸Šï¼Œæ‰€ä»¥æŒ‰éœ€æ±‚å®‰è£…å¯¹åº”çš„ç‰ˆæœ¬å³å¯ã€‚</li></ul><p>Neo4jä¸‹è½½åœ°å€å¦‚ä¸‹ï¼š</p><ul><li><a href="https://neo4j.com/download-center/#community">https://neo4j.com/download-center/#community</a></li></ul><p>ç¤¾åŒºç‰ˆæ˜¯å…è´¹çš„ï¼Œæ‰€ä»¥é€‰æ‹©ç¤¾åŒºç‰ˆå®‰è£…æœ€æ–°ç‰ˆå³å¯ã€‚<br>å¦ï¼šNeo4j æ’ä»¶ apoc å®‰è£…åœ°å€å¦‚ä¸‹ï¼ˆæ’ä»¶æ ¹æ®éœ€æ±‚å®‰è£…ï¼‰ï¼š</p><ul><li><a href="https://github.com/neo4j-contrib/neo4j-apoc-procedures/releases">https://github.com/neo4j-contrib/neo4j-apoc-procedures/releases</a></li></ul><p>æ’ä»¶è¿™é‡Œæœ‰ä¸ªå°å‘ï¼Œå°±æ˜¯ç‰ˆæœ¬ä¹‹é—´çš„ä¾èµ–ï¼Œå¦‚æœNeo4jä¸‹è½½çš„æ˜¯æœ€æ–°ç‰ˆï¼Œæ’ä»¶ä¹Ÿæœ€å¥½é€‰æ‹©æœ€æ–°ç‰ˆè¿›è¡Œå®‰è£…ã€‚<br>ä¸‹è½½å®Œåç›´æ¥æ”¾åœ¨ neo4j-community-4.4.4/plugins ç›®å½•ä¸‹ï¼Œå¹¶ä¸”éœ€è¦åœ¨é…ç½®æ–‡ä»¶é‡Œè¿›è¡Œè®¾ç½®ã€‚</p><h5 id="å¯åŠ¨-Neo4j"><a href="#å¯åŠ¨-Neo4j" class="headerlink" title="å¯åŠ¨ Neo4j"></a>å¯åŠ¨ Neo4j</h5><p>å¦‚æœæ˜¯æ¡Œé¢ç«¯ç›´æ¥è¿è¡Œç¨‹åºå³å¯ï¼Œå¦‚æœæ˜¯serverç«¯é…ç½®å¥½ç¯å¢ƒåè¿è¡Œ neo4j start å³å¯å¯åŠ¨ï¼Œåœæ­¢è¿è¡Œå‘½ä»¤ï¼šneo4j stop<br>å¯åŠ¨åå¯ä»¥åœ¨æµè§ˆå™¨è¾“å…¥ <a href="http://localhost:7474/">http://localhost:7474/</a> è¿›å…¥æ•°æ®åº“ï¼Œåˆå§‹ç”¨æˆ·åå’Œå¯†ç å‡æ˜¯ï¼šneo4jï¼Œç¬¬ä¸€æ¬¡è¿›å…¥éœ€è¦ä¿®æ”¹å¯†ç ï¼Œè‡ªè¡Œä¿®æ”¹å³å¯ã€‚<br>å¦å¤–neo4jè‡ªå¸¦çš„æ•°æ®åº“ä¸º system å’Œ neo4jã€‚å¦‚æœæƒ³åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“éœ€è¦åœ¨é…ç½®æ–‡ä»¶é‡Œä¿®æ”¹ï¼Œé…ç½®æ–‡ä»¶åœ°å€ä¸ºï¼š</p><ul><li>neo4j-community-4.4.4/conf/neo4j.conf</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">ä¿®æ”¹é»˜è®¤æ•°æ®åº“<br><span class="hljs-meta">#The name of the default database</span><br><span class="hljs-meta">#dbms.default_database=neo4j</span><br>dbms.default_database=test<br><br>ä¿®æ”¹æ’ä»¶é…ç½®<br># A comma separated list <span class="hljs-keyword">of</span> <span class="hljs-keyword">procedures</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">user</span> defined <span class="hljs-keyword">functions</span> that are allowed<br># <span class="hljs-keyword">full</span> <span class="hljs-keyword">access</span> <span class="hljs-keyword">to</span> the <span class="hljs-keyword">database</span> through unsupported/insecure <span class="hljs-type">internal</span> APIs.<br><span class="hljs-meta">#dbms.security.procedures.unrestricted=my.extensions.example,my.procedures.*</span><br>dbms.<span class="hljs-keyword">security</span>.<span class="hljs-keyword">procedures</span>.unrestricted=apoc.*<br><br>ä¿®æ”¹å…å¯†ç™»é™†ï¼ˆæµ‹è¯•éœ€æ±‚ï¼‰<br># Whether requests <span class="hljs-keyword">to</span> Neo4j are authenticated.<br># <span class="hljs-keyword">To</span> <span class="hljs-keyword">disable</span> authentication, uncomment this <span class="hljs-type">line</span><br>dbms.<span class="hljs-keyword">security</span>.auth_enabled=<span class="hljs-keyword">false</span><br></code></pre></td></tr></table></figure><p>å…¶å®ƒé…ç½®æœ‰éœ€æ±‚å†è¿›è¡Œä¿®æ”¹ã€‚</p><h5 id="Neo4j-èŠ‚ç‚¹å’Œå…³ç³»åˆ›å»º"><a href="#Neo4j-èŠ‚ç‚¹å’Œå…³ç³»åˆ›å»º" class="headerlink" title="Neo4j èŠ‚ç‚¹å’Œå…³ç³»åˆ›å»º"></a>Neo4j èŠ‚ç‚¹å’Œå…³ç³»åˆ›å»º</h5><ul><li>å‚è€ƒæ•™ç¨‹ï¼š<a href="https://www.w3cschool.cn/neo4j/">https://www.w3cschool.cn/neo4j/</a></li><li>pythonæ–¹æ³•</li></ul><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-comment">## pip install py2neo </span><br>from py2neo <span class="hljs-built_in">import</span> *<br><br><span class="hljs-comment"># è¿æ¥neo4jæ•°æ®åº“ï¼Œè¾“å…¥åœ°å€ã€ç”¨æˆ·åã€å¯†ç </span><br><span class="hljs-attr">graph</span> = Graph(<span class="hljs-string">&quot;bolt://localhost:7687&quot;</span>, <span class="hljs-attr">auth=(&#x27;neo4j&#x27;,&#x27;neo4j&#x27;))</span><br>graph.delete_all() <span class="hljs-comment">#æ¸…é™¤neo4jä¸­åŸæœ‰çš„ç»“ç‚¹ç­‰æ‰€æœ‰ä¿¡æ¯</span><br><br><span class="hljs-comment"># éšæœºç”Ÿæˆ100ä¸ªèŠ‚ç‚¹</span><br><span class="hljs-attr">N</span> = <span class="hljs-number">100</span><br><span class="hljs-attr">node_ls</span> = []<br>for i <span class="hljs-keyword">in</span> range(N):<br><span class="hljs-attr">random_name</span> = <span class="hljs-string">&quot;P&quot;</span>+str(round(random.random()*N*<span class="hljs-number">2</span>))<br><span class="hljs-attr">random_age</span> = round(random.random()*<span class="hljs-number">15</span>)<br><span class="hljs-attr">node</span> = Node(<span class="hljs-string">&quot;Person&quot;</span>, <span class="hljs-attr">name=random_name,</span> <span class="hljs-attr">age=random_age)</span><br>node_ls.append(node)<br><br><span class="hljs-attr">subgraph</span> = Subgraph(node_ls, [])    <span class="hljs-comment">## [] ä»£è¡¨å…³ç³»ä¸ºç©º</span><br><span class="hljs-attr">tx</span> = graph.begin() <br>tx.create(subgraph)<br>graph.commit(tx)<br></code></pre></td></tr></table></figure><p>è¯¦æƒ…å¯å‚è€ƒï¼š<a href="https://mp.weixin.qq.com/s/1DnMHOx6jPi0j0GhZwNPqw">https://mp.weixin.qq.com/s/1DnMHOx6jPi0j0GhZwNPqw</a></p><h5 id="Echartså¯è§†åŒ–"><a href="#Echartså¯è§†åŒ–" class="headerlink" title="Echartså¯è§†åŒ–"></a>Echartså¯è§†åŒ–</h5><p>neo4jæœ¬èº«æœ‰è‡ªå·±çš„å¯è§†åŒ–ç³»ç»Ÿï¼Œæ¯”å¦‚browserã€Bloomç­‰ï¼Œä½†æ˜¯blowseré¢å‘å¼€å‘è€…ï¼ŒBloomåˆæ˜¯æ”¶è´¹çš„ï¼Œæ‰€ä»¥åªèƒ½è‡ªå·±åŠ¨æ‰‹äº†ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">## ä¸»è¦å°±æ˜¯ optionçš„è®¾ç½®</span><br><span class="hljs-string">var</span> <span class="hljs-string">categories</span> <span class="hljs-string">=</span> [&#123;<span class="hljs-string">name:&quot;DrugName&quot;</span>&#125;,&#123;<span class="hljs-string">name:&quot;TargetGene&quot;</span>&#125;,&#123;<span class="hljs-string">name:&quot;DiseaseLabel&quot;</span>&#125;]<span class="hljs-string">;</span><br><br><span class="hljs-string">option</span> <span class="hljs-string">=</span> &#123;<br>    <span class="hljs-string">//</span> <span class="hljs-string">color:</span>[<span class="hljs-string">&#x27;#5470c6&#x27;</span>, <span class="hljs-string">&#x27;#91cc75&#x27;</span>, <span class="hljs-string">&#x27;#fac858&#x27;</span>, <span class="hljs-string">&#x27;#ee6666&#x27;</span>, <span class="hljs-string">&#x27;#73c0de&#x27;</span>, <span class="hljs-string">&#x27;#3ba272&#x27;</span>, <span class="hljs-string">&#x27;#fc8452&#x27;</span>, <span class="hljs-string">&#x27;#9a60b4&#x27;</span>, <span class="hljs-string">&#x27;#ea7ccc&#x27;</span>],<br>    <span class="hljs-attr">tooltip:</span> &#123;<br>     <span class="hljs-attr">trigger:</span> <span class="hljs-string">&#x27;item&#x27;</span>,<br>     <span class="hljs-attr">triggerOn:</span> <span class="hljs-string">&#x27;mousemove&#x27;</span>,<br>         <span class="hljs-string">enterable:true</span>,<span class="hljs-string">//é¼ æ ‡æ˜¯å¦å¯è¿›å…¥æç¤ºæ¡†æµ®å±‚ä¸­</span><br>          <span class="hljs-string">formatter:formatterHover</span>,<span class="hljs-string">//ä¿®æ”¹é¼ æ ‡æ‚¬åœæ˜¾ç¤ºçš„å†…å®¹</span><br>    &#125;,<br>    <span class="hljs-string">color:</span>[<span class="hljs-string">&quot;#c12e34&quot;</span>, <span class="hljs-string">&quot;#e6b600&quot;</span>, <span class="hljs-string">&quot;#0098d9&quot;</span>,],<br>    <span class="hljs-string">textStyle:</span>&#123;<br>        <span class="hljs-attr">fontFamily:</span> <span class="hljs-string">&quot;sans-serif&quot;</span>,<br>        <span class="hljs-attr">fontSize:</span> <span class="hljs-number">12</span>,<br>        <span class="hljs-attr">fontStyle:</span> <span class="hljs-string">&quot;normal&quot;</span>,<br>        <span class="hljs-attr">fontWeight:</span> <span class="hljs-string">&quot;normal&quot;</span>,<br>    &#125;,<br>    <span class="hljs-attr">legend:</span> &#123;<br>        <span class="hljs-attr">data:</span> [<span class="hljs-string">&#x27;DrugName&#x27;</span>, <span class="hljs-string">&#x27;TargetGene&#x27;</span>, <span class="hljs-string">&#x27;DiseaseLabel&#x27;</span>] <span class="hljs-string">//æ­¤å¤„çš„æ•°æ®å¿…é¡»å’Œå…³ç³»ç½‘ç±»åˆ«ä¸­nameç›¸å¯¹åº”</span>  <br>    &#125;,<br>    <span class="hljs-attr">series:</span> [&#123;<br>        <span class="hljs-attr">type:</span> <span class="hljs-string">&#x27;graph&#x27;</span>,<br>        <span class="hljs-attr">layout:</span> <span class="hljs-string">&#x27;force&#x27;</span>,     <span class="hljs-comment"># åŠ›å¯¼å›¾</span><br>        <span class="hljs-attr">animation:</span> <span class="hljs-literal">false</span>,<br>        <span class="hljs-attr">symbolSize:</span> <span class="hljs-number">25</span>,<br>        <span class="hljs-attr">label:</span> &#123;<br>            <span class="hljs-attr">normal:</span> &#123;<br>                <span class="hljs-attr">show:</span> <span class="hljs-literal">false</span>,<br>                <span class="hljs-attr">position:</span> <span class="hljs-string">&#x27;right&#x27;</span>,<br>                <span class="hljs-attr">textStyle:</span> &#123;<br>                    <span class="hljs-attr">fontSize:</span> <span class="hljs-number">10</span><br>                &#125;,<br>            &#125;,<br>        &#125;,<br>        <span class="hljs-attr">labelLayout:</span> &#123;<br>            <span class="hljs-attr">hideOverlap:</span> <span class="hljs-literal">true</span><br>        &#125;,<br>        <span class="hljs-attr">draggable:</span> <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">roam:</span> <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">focusNodeAdjacency:</span> <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">force:</span> &#123;<br>            <span class="hljs-attr">edgeLength:</span> <span class="hljs-number">80</span>, <span class="hljs-string">//è¿çº¿çš„é•¿åº¦</span>  <br>            <span class="hljs-attr">repulsion:</span> <span class="hljs-number">100</span>, <span class="hljs-string">//å­èŠ‚ç‚¹ä¹‹é—´çš„é—´è·</span>  <br>            <span class="hljs-string">//</span> <span class="hljs-attr">gravity:</span> <span class="hljs-number">0.2</span><br>        &#125;,<br>        <span class="hljs-attr">categories:</span> <span class="hljs-string">categories</span>,<br>        <span class="hljs-attr">data:</span> <span class="hljs-string">data.nodes</span>,<br>        <span class="hljs-attr">edges:</span> <span class="hljs-string">data.edges</span>,<br><br>        <span class="hljs-attr">edgeSymbol:</span> [<span class="hljs-string">&#x27;circle&#x27;</span>, <span class="hljs-string">&#x27;arrow&#x27;</span>],<br>        <span class="hljs-attr">edgeSymbolSize:</span> [<span class="hljs-number">4</span>, <span class="hljs-number">4</span>],<br>        <span class="hljs-attr">edgeLabel:</span> &#123;<br>            <span class="hljs-attr">normal:</span> &#123;<br>                <span class="hljs-attr">show:</span> <span class="hljs-literal">false</span>,<br>                <span class="hljs-attr">formatter:</span> <span class="hljs-string">function</span> <span class="hljs-string">(x)</span> &#123;<br>                    <span class="hljs-string">return</span> <span class="hljs-string">x.data.relationship;</span><br>                &#125;,<br>                <span class="hljs-attr">textStyle:</span> &#123;<br>                    <span class="hljs-attr">fontSize:</span> <span class="hljs-number">10</span><br>                &#125;<br>            &#125;<br>        &#125;,<br>        <span class="hljs-attr">lineStyle:</span> &#123;<br>            <span class="hljs-attr">normal:</span> &#123;<br>                <span class="hljs-attr">width:</span> <span class="hljs-number">2</span>,<br>                <span class="hljs-attr">color:</span> <span class="hljs-string">&#x27;#4b565b&#x27;</span>,<br>            &#125;<br>        &#125;,<br>    &#125;]<br>&#125;<span class="hljs-string">;</span><br></code></pre></td></tr></table></figure><p>å‰©ä¸‹çš„å°±æ˜¯æŠŠ data å’Œ edges çš„æ•°æ®ä¼ äººå³å¯ã€‚<br>åŒæ ·å¯ä»¥ç”¨pythonè¿›è¡Œè¯·æ±‚è·å–</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><br>login_url = <span class="hljs-string">&#x27;http://localhost:7474/db/data/transaction/commit&#x27;</span><br>headers = &#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>:<span class="hljs-string">&#x27;application/json&#x27;</span>&#125;<br>name_pwd = &#123;<span class="hljs-string">&#x27;username&#x27;</span>:<span class="hljs-string">&#x27;neo4j&#x27;</span>,<br>      <span class="hljs-string">&#x27;password&#x27;</span>:<span class="hljs-string">&#x27;neo4j&#x27;</span>,<br>      &#125;<br><br><br>def request_result(login_url, query_cql, headers):<br><br>    nodes, edges = [], []<br><br>    query_json = &#123;<br>        <span class="hljs-string">&quot;statements&quot;</span> : [ &#123;<br>        <span class="hljs-string">&quot;statement&quot;</span> : query_cql,<br>        <span class="hljs-string">&quot;resultDataContents&quot;</span> : [ <span class="hljs-string">&quot;row&quot;</span>, <span class="hljs-string">&quot;graph&quot;</span> ]<br>        &#125;]<br>    &#125;<br><br>    response = requests.post(url=login_url, json= query_json, headers=headers)<br>    print(response.status_code) <br><br>    result = json.loads(response.text)[<span class="hljs-string">&#x27;results&#x27;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;data&#x27;</span>]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(result)):<br>        <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> result[i][<span class="hljs-string">&#x27;graph&#x27;</span>][<span class="hljs-string">&#x27;nodes&#x27;</span>]:<br>            <span class="hljs-keyword">if</span> n not <span class="hljs-keyword">in</span> nodes:<br>                nodes.append(n)<br><br>        <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> result[i][<span class="hljs-string">&#x27;graph&#x27;</span>][<span class="hljs-string">&#x27;relationships&#x27;</span>]:<br>            <span class="hljs-keyword">if</span> r not <span class="hljs-keyword">in</span> edges:<br>                edges.append(r)<br><br>    <span class="hljs-keyword">return</span> nodes, edges<br><br><br>def query_all():<br>    query_cql = <span class="hljs-string">&#x27;match p=()--&gt;() return p&#x27;</span><br><br>    nodes, edges = request_result(login_url, query_cql, headers)<br>    <br>    <span class="hljs-keyword">return</span> nodes, edges<br><br><br>## ä¿®æ”¹æˆ Echarts éœ€è¦çš„æ ¼å¼<br>def buildNodes(nodeRecord):<br>    <span class="hljs-keyword">data</span> = &#123;<span class="hljs-string">&quot;id&quot;</span>: str(nodeRecord[<span class="hljs-string">&#x27;id&#x27;</span>]), <span class="hljs-string">&quot;label&quot;</span>: next(iter(nodeRecord[<span class="hljs-string">&#x27;labels&#x27;</span>]))&#125;<br>    <span class="hljs-keyword">data</span>.update(nodeRecord[<span class="hljs-string">&#x27;properties&#x27;</span>])<br><br>    tradeNames = <span class="hljs-keyword">data</span>.<span class="hljs-keyword">get</span>(<span class="hljs-string">&#x27;TradeNames&#x27;</span>)<br>    <span class="hljs-keyword">if</span> tradeNames and len(tradeNames) &gt; <span class="hljs-number">20</span>:<br>        tradeNames = tradeNames[:<span class="hljs-number">20</span>] + <span class="hljs-string">&#x27;...&#x27;</span><br>        <span class="hljs-keyword">data</span>[<span class="hljs-string">&#x27;TradeNames&#x27;</span>] = tradeNames<br><br>    <span class="hljs-keyword">data</span>[<span class="hljs-string">&#x27;category&#x27;</span>] = category_dict.<span class="hljs-keyword">get</span>(<span class="hljs-keyword">data</span>[<span class="hljs-string">&#x27;label&#x27;</span>])<br>    # newdata = &#123;<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-keyword">data</span>[<span class="hljs-string">&#x27;name&#x27;</span>], <span class="hljs-string">&#x27;category&#x27;</span>: category_dict.<span class="hljs-keyword">get</span>(<span class="hljs-keyword">data</span>[<span class="hljs-string">&#x27;label&#x27;</span>])&#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">data</span><br><br>def buildEdges(relationRecord):<br>    <span class="hljs-keyword">data</span> = &#123;<span class="hljs-string">&quot;source&quot;</span>: str(relationRecord[<span class="hljs-string">&#x27;startNode&#x27;</span>]), <br>            <span class="hljs-string">&quot;target&quot;</span>: str(relationRecord[<span class="hljs-string">&#x27;endNode&#x27;</span>]), <br>            <span class="hljs-string">&quot;relationship&quot;</span>: relationRecord[<span class="hljs-string">&#x27;type&#x27;</span>]&#125;<br>    # <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;links&quot;</span>: <span class="hljs-keyword">data</span>&#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">data</span><br><br><br>nodes, edges = query_all()<br>nodes = [buildNodes(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> nodes]<br>edges = [buildEdges(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> edges]<br><br></code></pre></td></tr></table></figure><p>æ•´ä½“å‰ç«¯æ¡†æ¶å‚è€ƒ</p><ul><li><a href="https://github.com/chizhu/KGQA_HLM">https://github.com/chizhu/KGQA_HLM</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Neo4j</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorchå­¦ä¹ ç¬”è®°17-æ—¶é—´åºåˆ—æ•°æ®å»ºæ¨¡æµç¨‹èŒƒä¾‹</title>
    <link href="/2022/02/09/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B017-%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1%E6%B5%81%E7%A8%8B%E8%8C%83%E4%BE%8B/"/>
    <url>/2022/02/09/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B017-%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1%E6%B5%81%E7%A8%8B%E8%8C%83%E4%BE%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="æ—¶é—´åºåˆ—æ•°æ®"><a href="#æ—¶é—´åºåˆ—æ•°æ®" class="headerlink" title="æ—¶é—´åºåˆ—æ•°æ®"></a>æ—¶é—´åºåˆ—æ•°æ®</h2><span id="more"></span><p>æœ¬æ–‡åŸºäºä¸­å›½2020å¹´3æœˆä¹‹å‰çš„ç–«æƒ…æ•°æ®ï¼Œå»ºç«‹æ—¶é—´åºåˆ—RNNæ¨¡å‹ï¼Œå¯¹ä¸­å›½çš„æ–°å† è‚ºç‚ç–«æƒ…ç»“æŸæ—¶é—´è¿›è¡Œé¢„æµ‹ã€‚</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">import</span> importlib <br><span class="hljs-keyword">import</span> torchkeras<br><br><span class="hljs-meta">#æ‰“å°æ—¶é—´</span><br><span class="hljs-title">def</span> printbar():<br>    nowtime = datetime.datetime.now().strftime(&#x27;%<span class="hljs-type">Y</span>-%m-%d %<span class="hljs-type">H</span>:%<span class="hljs-type">M</span>:%<span class="hljs-type">S&#x27;</span>)<br>    print(<span class="hljs-string">&quot;\n&quot;</span>+<span class="hljs-string">&quot;==========&quot;</span>*<span class="hljs-number">8</span> + <span class="hljs-string">&quot;%s&quot;</span>%nowtime)<br><br><span class="hljs-meta">#macç³»ç»Ÿä¸Špytorchå’Œmatplotlibåœ¨jupyterä¸­åŒæ—¶è·‘éœ€è¦æ›´æ”¹ç¯å¢ƒå˜é‡</span><br><span class="hljs-title">os</span>.environ[<span class="hljs-string">&quot;KMP_DUPLICATE_LIB_OK&quot;</span>]=<span class="hljs-string">&quot;TRUE&quot;</span> <br></code></pre></td></tr></table></figure><h4 id="ä¸€ï¼Œå‡†å¤‡æ•°æ®"><a href="#ä¸€ï¼Œå‡†å¤‡æ•°æ®" class="headerlink" title="ä¸€ï¼Œå‡†å¤‡æ•°æ®"></a>ä¸€ï¼Œå‡†å¤‡æ•°æ®</h4><p>æœ¬æ–‡çš„æ•°æ®é›†å–è‡ªtushareï¼Œè·å–è¯¥æ•°æ®é›†çš„æ–¹æ³•å‚è€ƒäº†ä»¥ä¸‹æ–‡ç« ã€‚</p><ul><li>ã€Š<a href="https://zhuanlan.zhihu.com/p/109556102%E3%80%8B">https://zhuanlan.zhihu.com/p/109556102ã€‹</a></li></ul><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-built_in">import</span> numpy as np<br><span class="hljs-built_in">import</span> pandas as pd <br><span class="hljs-built_in">import</span> matplotlib.pyplot as plt<br><br><br>%matplotlib inline<br>%config InlineBackend.<span class="hljs-attr">figure_format</span> = &#x27;svg&#x27;<br><br><span class="hljs-attr">df</span> = pd.read_csv(<span class="hljs-string">&quot;/home/kesci/input/data6936/data/covid-19.csv&quot;</span>,<span class="hljs-attr">sep</span> = <span class="hljs-string">&quot;\t&quot;</span>)<br>df.plot(<span class="hljs-attr">x</span> = <span class="hljs-string">&quot;date&quot;</span>,<span class="hljs-attr">y</span> = [<span class="hljs-string">&quot;confirmed_num&quot;</span>,<span class="hljs-string">&quot;cured_num&quot;</span>,<span class="hljs-string">&quot;dead_num&quot;</span>],<span class="hljs-attr">figsize=(10,6))</span><br>plt.xticks(<span class="hljs-attr">rotation=60)</span><br><br><span class="hljs-attr">dfdata</span> = df.set_index(<span class="hljs-string">&quot;date&quot;</span>)<br><span class="hljs-attr">dfdiff</span> = dfdata.diff(<span class="hljs-attr">periods=1).dropna()</span><br><span class="hljs-attr">dfdiff</span> = dfdiff.reset_index(<span class="hljs-string">&quot;date&quot;</span>)<br><br>dfdiff.plot(<span class="hljs-attr">x</span> = <span class="hljs-string">&quot;date&quot;</span>,<span class="hljs-attr">y</span> = [<span class="hljs-string">&quot;confirmed_num&quot;</span>,<span class="hljs-string">&quot;cured_num&quot;</span>,<span class="hljs-string">&quot;dead_num&quot;</span>],<span class="hljs-attr">figsize=(10,6))</span><br>plt.xticks(<span class="hljs-attr">rotation=60)</span><br><span class="hljs-attr">dfdiff</span> = dfdiff.drop(<span class="hljs-string">&quot;date&quot;</span>,<span class="hljs-attr">axis</span> = <span class="hljs-number">1</span>).astype(<span class="hljs-string">&quot;float32&quot;</span>)<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡ç»§æ‰¿torch.utils.data.Datasetå®ç°è‡ªå®šä¹‰æ—¶é—´åºåˆ—æ•°æ®é›†ã€‚</p><p>torch.utils.data.Datasetæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç”¨æˆ·æƒ³è¦åŠ è½½è‡ªå®šä¹‰çš„æ•°æ®åªéœ€è¦ç»§æ‰¿è¿™ä¸ªç±»ï¼Œå¹¶ä¸”è¦†å†™å…¶ä¸­çš„ä¸¤ä¸ªæ–¹æ³•å³å¯ï¼š</p><ul><li>__len__:å®ç°len(dataset)è¿”å›æ•´ä¸ªæ•°æ®é›†çš„å¤§å°ã€‚</li><li>__getitem__:ç”¨æ¥è·å–ä¸€äº›ç´¢å¼•çš„æ•°æ®ï¼Œä½¿dataset[i]è¿”å›æ•°æ®é›†ä¸­ç¬¬iä¸ªæ ·æœ¬ã€‚<br>ä¸è¦†å†™è¿™ä¸¤ä¸ªæ–¹æ³•ä¼šç›´æ¥è¿”å›é”™è¯¯ã€‚</li></ul><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-keyword">import</span> torch <br><span class="hljs-title">from</span> torch <span class="hljs-keyword">import</span> nn <br><span class="hljs-title">from</span> torch.utils.<span class="hljs-class"><span class="hljs-keyword">data</span> import <span class="hljs-type">Dataset</span>,<span class="hljs-type">DataLoader</span>,<span class="hljs-type">TensorDataset</span></span><br><br><br><span class="hljs-meta">#ç”¨æŸæ—¥å‰8å¤©çª—å£æ•°æ®ä½œä¸ºè¾“å…¥é¢„æµ‹è¯¥æ—¥æ•°æ®</span><br><span class="hljs-type">WINDOW_SIZE</span> = <span class="hljs-number">8</span><br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-type">Covid19Dataset</span>(<span class="hljs-type">Dataset</span>):</span><br><span class="hljs-class">        </span><br><span class="hljs-class">    def __len__(<span class="hljs-title">self</span>):</span><br><span class="hljs-class">        return len(<span class="hljs-title">dfdiff</span>) - <span class="hljs-type">WINDOW_SIZE</span></span><br><span class="hljs-class">    </span><br><span class="hljs-class">    def __getitem__(<span class="hljs-title">self</span>,<span class="hljs-title">i</span>):</span><br><span class="hljs-class">        x = dfdiff.loc[i:i+<span class="hljs-type">WINDOW_SIZE</span>-1,:]</span><br><span class="hljs-class">        feature = torch.tensor(<span class="hljs-title">x</span>.<span class="hljs-title">values</span>)</span><br><span class="hljs-class">        y = dfdiff.loc[i+<span class="hljs-type">WINDOW_SIZE</span>,:]</span><br><span class="hljs-class">        label = torch.tensor(<span class="hljs-title">y</span>.<span class="hljs-title">values</span>)</span><br><span class="hljs-class">        return (<span class="hljs-title">feature</span>,<span class="hljs-title">label</span>)</span><br><span class="hljs-class">    </span><br><span class="hljs-class">ds_train = <span class="hljs-type">Covid19Dataset</span>()</span><br><span class="hljs-class"></span><br><span class="hljs-class">#æ•°æ®è¾ƒå°ï¼Œå¯ä»¥å°†å…¨éƒ¨è®­ç»ƒæ•°æ®æ”¾å…¥åˆ°ä¸€ä¸ªbatchä¸­ï¼Œæå‡æ€§èƒ½</span><br><span class="hljs-class">dl_train = <span class="hljs-type">DataLoader</span>(<span class="hljs-title">ds_train</span>,<span class="hljs-title">batch_size</span> = 38)</span><br></code></pre></td></tr></table></figure><h4 id="äºŒï¼Œå®šä¹‰æ¨¡å‹"><a href="#äºŒï¼Œå®šä¹‰æ¨¡å‹" class="headerlink" title="äºŒï¼Œå®šä¹‰æ¨¡å‹"></a>äºŒï¼Œå®šä¹‰æ¨¡å‹</h4><p>ä½¿ç”¨Pytorché€šå¸¸æœ‰ä¸‰ç§æ–¹å¼æ„å»ºæ¨¡å‹ï¼šä½¿ç”¨nn.SequentialæŒ‰å±‚é¡ºåºæ„å»ºæ¨¡å‹ï¼Œç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºè‡ªå®šä¹‰æ¨¡å‹ï¼Œç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºæ¨¡å‹å¹¶è¾…åŠ©åº”ç”¨æ¨¡å‹å®¹å™¨è¿›è¡Œå°è£…ã€‚</p><p>æ­¤å¤„é€‰æ‹©ç¬¬äºŒç§æ–¹å¼æ„å»ºæ¨¡å‹ã€‚</p><p>ç”±äºæ¥ä¸‹æ¥ä½¿ç”¨ç±»å½¢å¼çš„è®­ç»ƒå¾ªç¯ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥å°†æ¨¡å‹å°è£…æˆtorchkerasä¸­çš„Modelç±»æ¥è·å¾—ç±»ä¼¼Kerasä¸­é«˜é˜¶æ¨¡å‹æ¥å£çš„åŠŸèƒ½ã€‚</p><p>Modelç±»å®é™…ä¸Šç»§æ‰¿è‡ªnn.Moduleç±»ã€‚</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-keyword">import</span> torch<br><span class="hljs-title">from</span> torch <span class="hljs-keyword">import</span> nn <br><span class="hljs-keyword">import</span> importlib <br><span class="hljs-keyword">import</span> torchkeras <br><br><span class="hljs-title">torch</span>.random.seed()<br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-type">Block</span>(<span class="hljs-title">nn</span>.<span class="hljs-type">Module</span>):</span><br><span class="hljs-class">    def __init__(<span class="hljs-title">self</span>):</span><br><span class="hljs-class">        super(<span class="hljs-type">Block</span>,<span class="hljs-title">self</span>).__init__()</span><br><span class="hljs-class">    </span><br><span class="hljs-class">    def forward(<span class="hljs-title">self</span>,<span class="hljs-title">x</span>,<span class="hljs-title">x_input</span>):</span><br><span class="hljs-class">        x_out = torch.max((1+<span class="hljs-title">x</span>)*x_input[:,-1,:],torch.tensor(0.0))</span><br><span class="hljs-class">        return x_out</span><br><span class="hljs-class">    </span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-type">Net</span>(<span class="hljs-title">nn</span>.<span class="hljs-type">Module</span>):</span><br><span class="hljs-class">    def __init__(<span class="hljs-title">self</span>):</span><br><span class="hljs-class">        super(<span class="hljs-type">Net</span>, <span class="hljs-title">self</span>).__init__()</span><br><span class="hljs-class">        # 3å±‚lstm</span><br><span class="hljs-class">        self.lstm = nn.<span class="hljs-type">LSTM</span>(<span class="hljs-title">input_size</span> = 3,<span class="hljs-title">hidden_size</span> = 3,<span class="hljs-title">num_layers</span> = 5,<span class="hljs-title">batch_first</span> = <span class="hljs-type">True</span>)</span><br><span class="hljs-class">        self.linear = nn.<span class="hljs-type">Linear</span>(3,3)</span><br><span class="hljs-class">        self.block = <span class="hljs-type">Block</span>()</span><br><span class="hljs-class">        </span><br><span class="hljs-class">    def forward(<span class="hljs-title">self</span>,<span class="hljs-title">x_input</span>):</span><br><span class="hljs-class">        x = self.lstm(<span class="hljs-title">x_input</span>)[0][:,-1,:]</span><br><span class="hljs-class">        x = self.linear(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        y = self.block(<span class="hljs-title">x</span>,<span class="hljs-title">x_input</span>)</span><br><span class="hljs-class">        return y</span><br><span class="hljs-class">        </span><br><span class="hljs-class">net = <span class="hljs-type">Net</span>()</span><br><span class="hljs-class">model = torchkeras.<span class="hljs-type">Model</span>(<span class="hljs-title">net</span>)</span><br><span class="hljs-class">print(<span class="hljs-title">model</span>)</span><br><span class="hljs-class"></span><br><span class="hljs-class">model.summary(<span class="hljs-title">input_shape</span>=(8,3),input_dtype = torch.<span class="hljs-type">FloatTensor</span>)</span><br></code></pre></td></tr></table></figure><h4 id="ä¸‰ï¼Œè®­ç»ƒæ¨¡å‹"><a href="#ä¸‰ï¼Œè®­ç»ƒæ¨¡å‹" class="headerlink" title="ä¸‰ï¼Œè®­ç»ƒæ¨¡å‹"></a>ä¸‰ï¼Œè®­ç»ƒæ¨¡å‹</h4><p>è®­ç»ƒPytorché€šå¸¸éœ€è¦ç”¨æˆ·ç¼–å†™è‡ªå®šä¹‰è®­ç»ƒå¾ªç¯ï¼Œè®­ç»ƒå¾ªç¯çš„ä»£ç é£æ ¼å› äººè€Œå¼‚ã€‚</p><p>æœ‰3ç±»å…¸å‹çš„è®­ç»ƒå¾ªç¯ä»£ç é£æ ¼ï¼šè„šæœ¬å½¢å¼è®­ç»ƒå¾ªç¯ï¼Œå‡½æ•°å½¢å¼è®­ç»ƒå¾ªç¯ï¼Œç±»å½¢å¼è®­ç»ƒå¾ªç¯ã€‚</p><p>æ­¤å¤„ä»‹ç»ä¸€ç§ç±»å½¢å¼çš„è®­ç»ƒå¾ªç¯ã€‚</p><p>æˆ‘ä»¬ä»¿ç…§Keraså®šä¹‰äº†ä¸€ä¸ªé«˜é˜¶çš„æ¨¡å‹æ¥å£Model,å®ç° fit, validateï¼Œpredict, summary æ–¹æ³•ï¼Œç›¸å½“äºç”¨æˆ·è‡ªå®šä¹‰é«˜é˜¶APIã€‚</p><p>æ³¨ï¼šå¾ªç¯ç¥ç»ç½‘ç»œè°ƒè¯•è¾ƒä¸ºå›°éš¾ï¼Œéœ€è¦è®¾ç½®å¤šä¸ªä¸åŒçš„å­¦ä¹ ç‡å¤šæ¬¡å°è¯•ï¼Œä»¥å–å¾—è¾ƒå¥½çš„æ•ˆæœã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">def</span> mspe(y_pred,y_true):<br>    <span class="hljs-attribute">err_percent</span> = (y_true - y_pred)**<span class="hljs-number">2</span>/(torch.max(y_true**<span class="hljs-number">2</span>,torch.tensor(<span class="hljs-number">1</span>e-<span class="hljs-number">7</span>)))<br>    <span class="hljs-attribute">return</span> torch.mean(err_percent)<br><br><span class="hljs-attribute">model</span>.compile(loss_func = mspe,optimizer = torch.optim.Adagrad(model.parameters(),lr = <span class="hljs-number">0</span>.<span class="hljs-number">1</span>))<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">dfhistory</span> = model.fit(<span class="hljs-number">100</span>,dl_train,log_step_freq=<span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><h4 id="å››ï¼Œè¯„ä¼°æ¨¡å‹"><a href="#å››ï¼Œè¯„ä¼°æ¨¡å‹" class="headerlink" title="å››ï¼Œè¯„ä¼°æ¨¡å‹"></a>å››ï¼Œè¯„ä¼°æ¨¡å‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python">%matplotlib inline<br>%config InlineBackend.figure_format = <span class="hljs-string">&#x27;svg&#x27;</span><br><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_metric</span>(<span class="hljs-params">dfhistory, metric</span>):</span><br>    train_metrics = dfhistory[metric]<br>    epochs = <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(train_metrics) + <span class="hljs-number">1</span>)<br>    plt.plot(epochs, train_metrics, <span class="hljs-string">&#x27;bo--&#x27;</span>)<br>    plt.title(<span class="hljs-string">&#x27;Training &#x27;</span>+ metric)<br>    plt.xlabel(<span class="hljs-string">&quot;Epochs&quot;</span>)<br>    plt.ylabel(metric)<br>    plt.legend([<span class="hljs-string">&quot;train_&quot;</span>+metric])<br>    plt.show()<br><br>plot_metric(dfhistory,<span class="hljs-string">&quot;loss&quot;</span>)<br><br></code></pre></td></tr></table></figure><h4 id="äº”ï¼Œä½¿ç”¨æ¨¡å‹"><a href="#äº”ï¼Œä½¿ç”¨æ¨¡å‹" class="headerlink" title="äº”ï¼Œä½¿ç”¨æ¨¡å‹"></a>äº”ï¼Œä½¿ç”¨æ¨¡å‹</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">#ä½¿ç”¨dfresultè®°å½•ç°æœ‰æ•°æ®ä»¥åŠæ­¤åé¢„æµ‹çš„ç–«æƒ…æ•°æ®<br>dfresult = dfdiff<span class="hljs-selector-attr">[[<span class="hljs-string">&quot;confirmed_num&quot;</span>,<span class="hljs-string">&quot;cured_num&quot;</span>,<span class="hljs-string">&quot;dead_num&quot;</span>]</span>]<span class="hljs-selector-class">.copy</span>()<br>dfresult<span class="hljs-selector-class">.tail</span>()<br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css">#é¢„æµ‹æ­¤å<span class="hljs-number">500</span>å¤©çš„æ–°å¢èµ°åŠ¿,å°†å…¶ç»“æœæ·»åŠ åˆ°dfresultä¸­<br>for <span class="hljs-selector-tag">i</span> in range(<span class="hljs-number">500</span>):<br>    arr_input = torch.<span class="hljs-built_in">unsqueeze</span>(torch.<span class="hljs-built_in">from_numpy</span>(dfresult.values[-<span class="hljs-number">38</span>:,:]),axis=<span class="hljs-number">0</span>)<br>    arr_predict = model.<span class="hljs-built_in">forward</span>(arr_input)<br><br>    dfpredict = pd.<span class="hljs-built_in">DataFrame</span>(torch.<span class="hljs-built_in">floor</span>(arr_predict).data.<span class="hljs-built_in">numpy</span>(),<br>                columns = dfresult.columns)<br>    dfresult = dfresult.<span class="hljs-built_in">append</span>(dfpredict,ignore_index=True)<br></code></pre></td></tr></table></figure><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vala">dfresult.query(<span class="hljs-string">&quot;confirmed_num==0&quot;</span>).head()<br><br><span class="hljs-meta"># ç¬¬50å¤©å¼€å§‹æ–°å¢ç¡®è¯Šé™ä¸º0ï¼Œç¬¬45å¤©å¯¹åº”3æœˆ10æ—¥ï¼Œä¹Ÿå°±æ˜¯5å¤©åï¼Œå³é¢„è®¡3æœˆ15æ—¥æ–°å¢ç¡®è¯Šé™ä¸º0</span><br><span class="hljs-meta"># æ³¨ï¼šè¯¥é¢„æµ‹åä¹è§‚</span><br></code></pre></td></tr></table></figure><h4 id="å…­ï¼Œä¿å­˜æ¨¡å‹"><a href="#å…­ï¼Œä¿å­˜æ¨¡å‹" class="headerlink" title="å…­ï¼Œä¿å­˜æ¨¡å‹"></a>å…­ï¼Œä¿å­˜æ¨¡å‹</h4><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"># ä¿å­˜æ¨¡å‹å‚æ•°<br><br>torch.save(model.net.state<span class="hljs-constructor">_dict()</span>, <span class="hljs-string">&quot;./data/model_parameter.pkl&quot;</span>)<br><br>net_clone = <span class="hljs-constructor">Net()</span><br>net_clone.load<span class="hljs-constructor">_state_dict(<span class="hljs-params">torch</span>.<span class="hljs-params">load</span>(<span class="hljs-string">&quot;./data/model_parameter.pkl&quot;</span>)</span>)<br>model_clone = torchkeras.<span class="hljs-constructor">Model(<span class="hljs-params">net_clone</span>)</span><br>model_clone.compile(loss_func = mspe)<br><br># è¯„ä¼°æ¨¡å‹<br>model_clone.evaluate(dl_train)<br></code></pre></td></tr></table></figure><p>æ¬è¿è‡ªï¼š</p><ul><li><a href="https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1">https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorchå­¦ä¹ ç¬”è®°16-æ–‡æœ¬æ•°æ®å»ºæ¨¡æµç¨‹èŒƒä¾‹</title>
    <link href="/2022/02/09/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B016-%E6%96%87%E6%9C%AC%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1%E6%B5%81%E7%A8%8B%E8%8C%83%E4%BE%8B/"/>
    <url>/2022/02/09/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B016-%E6%96%87%E6%9C%AC%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1%E6%B5%81%E7%A8%8B%E8%8C%83%E4%BE%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="æ–‡æœ¬æ•°æ®"><a href="#æ–‡æœ¬æ•°æ®" class="headerlink" title="æ–‡æœ¬æ•°æ®"></a>æ–‡æœ¬æ•°æ®</h2><span id="more"></span><h4 id="ä¸€ï¼Œå‡†å¤‡æ•°æ®"><a href="#ä¸€ï¼Œå‡†å¤‡æ•°æ®" class="headerlink" title="ä¸€ï¼Œå‡†å¤‡æ•°æ®"></a>ä¸€ï¼Œå‡†å¤‡æ•°æ®</h4><p>imdbæ•°æ®é›†çš„ç›®æ ‡æ˜¯æ ¹æ®ç”µå½±è¯„è®ºçš„æ–‡æœ¬å†…å®¹é¢„æµ‹è¯„è®ºçš„æƒ…æ„Ÿæ ‡ç­¾ã€‚</p><p>è®­ç»ƒé›†æœ‰20000æ¡ç”µå½±è¯„è®ºæ–‡æœ¬ï¼Œæµ‹è¯•é›†æœ‰5000æ¡ç”µå½±è¯„è®ºæ–‡æœ¬ï¼Œå…¶ä¸­æ­£é¢è¯„è®ºå’Œè´Ÿé¢è¯„è®ºéƒ½å„å ä¸€åŠã€‚</p><p>æ–‡æœ¬æ•°æ®é¢„å¤„ç†è¾ƒä¸ºç¹çï¼ŒåŒ…æ‹¬ä¸­æ–‡åˆ‡è¯ï¼ˆæœ¬ç¤ºä¾‹ä¸æ¶‰åŠï¼‰ï¼Œæ„å»ºè¯å…¸ï¼Œç¼–ç è½¬æ¢ï¼Œåºåˆ—å¡«å……ï¼Œæ„å»ºæ•°æ®ç®¡é“ç­‰ç­‰ã€‚</p><p>åœ¨torchä¸­é¢„å¤„ç†æ–‡æœ¬æ•°æ®ä¸€èˆ¬ä½¿ç”¨torchtextæˆ–è€…è‡ªå®šä¹‰Datasetï¼ŒtorchtextåŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå¯ä»¥æ„å»ºæ–‡æœ¬åˆ†ç±»ï¼Œåºåˆ—æ ‡æ³¨ï¼Œé—®ç­”æ¨¡å‹ï¼Œæœºå™¨ç¿»è¯‘ç­‰NLPä»»åŠ¡çš„æ•°æ®é›†ã€‚</p><p>ä¸‹é¢ä»…æ¼”ç¤ºä½¿ç”¨å®ƒæ¥æ„å»ºæ–‡æœ¬åˆ†ç±»æ•°æ®é›†çš„æ–¹æ³•ã€‚</p><p>è¾ƒå®Œæ•´çš„æ•™ç¨‹å¯ä»¥å‚è€ƒä»¥ä¸‹çŸ¥ä¹æ–‡ç« ï¼šã€Špytorchå­¦ä¹ ç¬”è®°â€”Torchtextã€‹</p><ul><li><a href="https://zhuanlan.zhihu.com/p/65833208">https://zhuanlan.zhihu.com/p/65833208</a></li></ul><p>torchtextå¸¸è§APIä¸€è§ˆ</p><ul><li>torchtext.data.Example : ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªæ ·æœ¬ï¼Œæ•°æ®å’Œæ ‡ç­¾</li><li>torchtext.vocab.Vocab: è¯æ±‡è¡¨ï¼Œå¯ä»¥å¯¼å…¥ä¸€äº›é¢„è®­ç»ƒè¯å‘é‡</li><li>torchtext.data.Datasets: æ•°æ®é›†ç±»ï¼Œ__getitem__è¿”å› Exampleå®ä¾‹, torchtext.data.TabularDatasetæ˜¯å…¶å­ç±»ã€‚</li><li>torchtext.data.Field : ç”¨æ¥å®šä¹‰å­—æ®µçš„å¤„ç†æ–¹æ³•ï¼ˆæ–‡æœ¬å­—æ®µï¼Œæ ‡ç­¾å­—æ®µï¼‰åˆ›å»º Exampleæ—¶çš„ é¢„å¤„ç†ï¼Œbatch æ—¶çš„ä¸€äº›å¤„ç†æ“ä½œã€‚</li><li>torchtext.data.Iterator: è¿­ä»£å™¨ï¼Œç”¨æ¥ç”Ÿæˆ batch</li><li>torchtext.datasets: åŒ…å«äº†å¸¸è§çš„æ•°æ®é›†.</li></ul><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np <br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd <br><span class="hljs-title">from</span> collections <span class="hljs-keyword">import</span> OrderedDict<br><span class="hljs-keyword">import</span> re,string<br><span class="hljs-type">MAX_WORDS</span> = <span class="hljs-number">10000</span>  # ä»…è€ƒè™‘æœ€é«˜é¢‘çš„<span class="hljs-number">10000</span>ä¸ªè¯<br><span class="hljs-type">MAX_LEN</span> = <span class="hljs-number">200</span>  # æ¯ä¸ªæ ·æœ¬ä¿ç•™<span class="hljs-number">200</span>ä¸ªè¯çš„é•¿åº¦<br><span class="hljs-type">BATCH_SIZE</span> = <span class="hljs-number">20</span> <br><span class="hljs-title">train_data_path</span> = &#x27;/home/kesci/input/data6936/<span class="hljs-class"><span class="hljs-keyword">data</span>/imdb/train.tsv&#x27;</span><br><span class="hljs-title">test_data_path</span> = &#x27;/home/kesci/input/data6936/<span class="hljs-class"><span class="hljs-keyword">data</span>/imdb/test.tsv&#x27;</span><br><span class="hljs-title">train_token_path</span> = &#x27;/home/kesci/input/data6936/<span class="hljs-class"><span class="hljs-keyword">data</span>/imdb/train_token.tsv&#x27;</span><br><span class="hljs-title">test_token_path</span> =  &#x27;/home/kesci/input/data6936/<span class="hljs-class"><span class="hljs-keyword">data</span>/imdb/test_token.tsv&#x27;</span><br><span class="hljs-title">train_samples_path</span> = &#x27;/home/kesci/input/data6936/<span class="hljs-class"><span class="hljs-keyword">data</span>/imdb/train_samples/&#x27;</span><br><span class="hljs-title">test_samples_path</span> =  &#x27;/home/kesci/input/data6936/<span class="hljs-class"><span class="hljs-keyword">data</span>/imdb/test_samples/&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment">##æ„å»ºè¯å…¸</span><br><br>word_count_dict = &#123;&#125;<br><br><span class="hljs-comment">#æ¸…æ´—æ–‡æœ¬</span><br>def clean_text(<span class="hljs-built_in">text</span>):<br>    lowercase = <span class="hljs-built_in">text</span>.lower().replace(<span class="hljs-string">&quot;\n&quot;</span>,<span class="hljs-string">&quot; &quot;</span>)<br>    stripped_html = re.sub(&#x27;&lt;br /&gt;&#x27;, &#x27; &#x27;,lowercase)<br>    cleaned_punctuation = re.sub(&#x27;[%s]&#x27;%re.escape(<span class="hljs-built_in">string</span>.punctuation),&#x27;&#x27;,stripped_html)<br><span class="hljs-built_in">    return</span> cleaned_punctuation<br><br><span class="hljs-keyword">with</span> open(train_data_path,<span class="hljs-string">&quot;r&quot;</span>,encoding = &#x27;utf<span class="hljs-number">-8</span>&#x27;) <span class="hljs-keyword">as</span> f:<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:<br>        label,<span class="hljs-built_in">text</span> = line.split(<span class="hljs-string">&quot;\t&quot;</span>)<br>        cleaned_text = clean_text(<span class="hljs-built_in">text</span>)<br>        <span class="hljs-keyword">for</span> <span class="hljs-built_in">word</span> <span class="hljs-keyword">in</span> cleaned_text.split(<span class="hljs-string">&quot; &quot;</span>):<br>            word_count_dict[<span class="hljs-built_in">word</span>] = word_count_dict.<span class="hljs-keyword">get</span>(<span class="hljs-built_in">word</span>,<span class="hljs-number">0</span>)+<span class="hljs-number">1</span> <br><br>df_word_dict = pd.DataFrame(pd.Series(word_count_dict,<span class="hljs-built_in">name</span> = <span class="hljs-string">&quot;count&quot;</span>))<br>df_word_dict = df_word_dict.sort_values(<span class="hljs-keyword">by</span> = <span class="hljs-string">&quot;count&quot;</span>,ascending =False)<br><br>df_word_dict = df_word_dict[<span class="hljs-number">0</span>:MAX_WORDS<span class="hljs-number">-2</span>] <span class="hljs-comment">#  </span><br>df_word_dict[<span class="hljs-string">&quot;word_id&quot;</span>] = range(<span class="hljs-number">2</span>,MAX_WORDS) <span class="hljs-comment">#ç¼–å·0å’Œ1åˆ†åˆ«ç•™ç»™æœªçŸ¥è¯&lt;unkown&gt;å’Œå¡«å……&lt;padding&gt;</span><br><br>word_id_dict = df_word_dict[<span class="hljs-string">&quot;word_id&quot;</span>].to_dict()<br><br>df_word_dict.head(<span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨æ„å»ºå¥½çš„è¯å…¸ï¼Œå°†æ–‡æœ¬è½¬æ¢æˆtokenåºå·ã€‚</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-comment">#è½¬æ¢token</span><br><br><span class="hljs-comment"># å¡«å……æ–‡æœ¬</span><br>def pad(data_list,pad_length):<br>    padded_list = data_list.copy()<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data_list)&gt; pad_length:<br>         padded_list = data_list[-pad_length:]<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data_list)&lt; pad_length:<br>         padded_list = [<span class="hljs-number">1</span>]*(pad_length-<span class="hljs-built_in">len</span>(data_list))+data_list<br>    <span class="hljs-literal">return</span> padded_list<br><br>def text_to_token(text_file,token_file):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(text_file,<span class="hljs-string">&quot;r&quot;</span>,encoding = <span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> fin,\<br>      <span class="hljs-built_in">open</span>(token_file,<span class="hljs-string">&quot;w&quot;</span>,encoding = <span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> fout:<br>        <span class="hljs-keyword">for</span> <span class="hljs-built_in">line</span> <span class="hljs-keyword">in</span> fin:<br>            label,<span class="hljs-keyword">text</span> = <span class="hljs-built_in">line</span>.<span class="hljs-built_in">split</span>(<span class="hljs-string">&quot;\t&quot;</span>)<br>            cleaned_text = clean_text(<span class="hljs-keyword">text</span>)<br>            word_token_list = [word_id_dict.<span class="hljs-built_in">get</span>(<span class="hljs-built_in">word</span>, <span class="hljs-number">0</span>) <span class="hljs-keyword">for</span> <span class="hljs-built_in">word</span> <span class="hljs-keyword">in</span> cleaned_text.<span class="hljs-built_in">split</span>(<span class="hljs-string">&quot; &quot;</span>)]<br>            pad_list = pad(word_token_list,MAX_LEN)<br>            out_line = label+<span class="hljs-string">&quot;\t&quot;</span>+<span class="hljs-string">&quot; &quot;</span>.join([str(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> pad_list])<br>            fout.<span class="hljs-built_in">write</span>(out_line+<span class="hljs-string">&quot;\n&quot;</span>)<br>        <br>text_to_token(train_data_path,train_token_path)<br>text_to_token(test_data_path,test_token_path)<br></code></pre></td></tr></table></figure><p>æ¥ç€å°†tokenæ–‡æœ¬æŒ‰ç…§æ ·æœ¬åˆ†å‰²ï¼Œæ¯ä¸ªæ–‡ä»¶å­˜æ”¾ä¸€ä¸ªæ ·æœ¬çš„æ•°æ®ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"># åˆ†å‰²æ ·æœ¬<br>import os<br><br><span class="hljs-keyword">if</span> not os.path.exists(train_samples_path):<br>    os.mkdir(train_samples_path)<br>    <br><span class="hljs-keyword">if</span> not os.path.exists(test_samples_path):<br>    os.mkdir(test_samples_path)<br>    <br>    <br>def split<span class="hljs-constructor">_samples(<span class="hljs-params">token_path</span>,<span class="hljs-params">samples_dir</span>)</span>:<br>    <span class="hljs-keyword">with</span> <span class="hljs-keyword">open</span>(token_path,<span class="hljs-string">&quot;r&quot;</span>,encoding = &#x27;utf-<span class="hljs-number">8</span>&#x27;) <span class="hljs-keyword">as</span> fin:<br>        i = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> fin:<br>            <span class="hljs-keyword">with</span> <span class="hljs-keyword">open</span>(samples_dir+<span class="hljs-string">&quot;%d.txt&quot;</span>%i,<span class="hljs-string">&quot;w&quot;</span>,encoding = <span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> fout:<br>                fout.write(line)<br>            i = i+<span class="hljs-number">1</span><br><br>split<span class="hljs-constructor">_samples(<span class="hljs-params">train_token_path</span>,<span class="hljs-params">train_samples_path</span>)</span><br>split<span class="hljs-constructor">_samples(<span class="hljs-params">test_token_path</span>,<span class="hljs-params">test_samples_path</span>)</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºæ•°æ®é›†Dataset, ä»æ–‡ä»¶åç§°åˆ—è¡¨ä¸­è¯»å–æ–‡ä»¶å†…å®¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> Dataset,DataLoader <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">imdbDataset</span>(<span class="hljs-params">Dataset</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self,samples_dir</span>):</span><br>        self.samples_dir = samples_dir<br>        self.samples_paths = os.listdir(samples_dir)<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__len__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.samples_paths)<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__getitem__</span>(<span class="hljs-params">self,index</span>):</span><br>        path = self.samples_dir + self.samples_paths[index]<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path,<span class="hljs-string">&quot;r&quot;</span>,encoding = <span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>            line = f.readline()<br>            label,tokens = line.split(<span class="hljs-string">&quot;\t&quot;</span>)<br>            label = torch.tensor([<span class="hljs-built_in">float</span>(label)],dtype = torch.<span class="hljs-built_in">float</span>)<br>            feature = torch.tensor([<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> tokens.split(<span class="hljs-string">&quot; &quot;</span>)],dtype = torch.long)<br>            <span class="hljs-keyword">return</span>  (feature,label)<br>ds_train = imdbDataset(train_samples_path)<br>ds_test = imdbDataset(test_samples_path)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(ds_train))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(ds_test))<br><br>dl_train = DataLoader(ds_train,batch_size = BATCH_SIZE,shuffle = <span class="hljs-literal">True</span>,num_workers=<span class="hljs-number">4</span>)<br>dl_test = DataLoader(ds_test,batch_size = BATCH_SIZE,num_workers=<span class="hljs-number">4</span>)<br><br><span class="hljs-keyword">for</span> features,labels <span class="hljs-keyword">in</span> dl_train:<br>    <span class="hljs-built_in">print</span>(features)<br>    <span class="hljs-built_in">print</span>(labels)<br>    <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><h4 id="äºŒï¼Œå®šä¹‰æ¨¡å‹"><a href="#äºŒï¼Œå®šä¹‰æ¨¡å‹" class="headerlink" title="äºŒï¼Œå®šä¹‰æ¨¡å‹"></a>äºŒï¼Œå®šä¹‰æ¨¡å‹</h4><p>ä½¿ç”¨Pytorché€šå¸¸æœ‰ä¸‰ç§æ–¹å¼æ„å»ºæ¨¡å‹ï¼šä½¿ç”¨nn.SequentialæŒ‰å±‚é¡ºåºæ„å»ºæ¨¡å‹ï¼Œç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºè‡ªå®šä¹‰æ¨¡å‹ï¼Œç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºæ¨¡å‹å¹¶è¾…åŠ©åº”ç”¨æ¨¡å‹å®¹å™¨(nn.Sequential,nn.ModuleList,nn.ModuleDict)è¿›è¡Œå°è£…ã€‚</p><p>æ­¤å¤„é€‰æ‹©ä½¿ç”¨ç¬¬ä¸‰ç§æ–¹å¼è¿›è¡Œæ„å»ºã€‚</p><p>ç”±äºæ¥ä¸‹æ¥ä½¿ç”¨ç±»å½¢å¼çš„è®­ç»ƒå¾ªç¯ï¼Œæˆ‘ä»¬å°†æ¨¡å‹å°è£…æˆtorchkeras.Modelç±»æ¥è·å¾—ç±»ä¼¼Kerasä¸­é«˜é˜¶æ¨¡å‹æ¥å£çš„åŠŸèƒ½ã€‚</p><p>Modelç±»å®é™…ä¸Šç»§æ‰¿è‡ªnn.Moduleç±»ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">import torch<br>from torch import nn <br>import torchkeras<br><br>torch.random.seed<span class="hljs-literal">()</span><br>import torch<br>from torch import nn <br><br><span class="hljs-keyword">class</span> <span class="hljs-constructor">Net(<span class="hljs-params">torchkeras</span>.Model)</span>:<br>    <br>    def <span class="hljs-constructor">__init__(<span class="hljs-params">self</span>)</span>:<br>        super(Net, self).<span class="hljs-constructor">__init__()</span><br>        <br>        #è®¾ç½®padding_idxå‚æ•°åå°†åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å°†å¡«å……çš„tokenå§‹ç»ˆèµ‹å€¼ä¸º<span class="hljs-number">0</span>å‘é‡<br>        self.embedding = nn.<span class="hljs-constructor">Embedding(<span class="hljs-params">num_embeddings</span> = MAX_WORDS,<span class="hljs-params">embedding_dim</span> = 3,<span class="hljs-params">padding_idx</span> = 1)</span><br>        self.conv = nn.<span class="hljs-constructor">Sequential()</span><br>        self.conv.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;conv_1&quot;</span>,<span class="hljs-params">nn</span>.Conv1d(<span class="hljs-params">in_channels</span> = 3,<span class="hljs-params">out_channels</span> = 16,<span class="hljs-params">kernel_size</span> = 5)</span>)<br>        self.conv.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;pool_1&quot;</span>,<span class="hljs-params">nn</span>.MaxPool1d(<span class="hljs-params">kernel_size</span> = 2)</span>)<br>        self.conv.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;relu_1&quot;</span>,<span class="hljs-params">nn</span>.ReLU()</span>)<br>        self.conv.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;conv_2&quot;</span>,<span class="hljs-params">nn</span>.Conv1d(<span class="hljs-params">in_channels</span> = 16,<span class="hljs-params">out_channels</span> = 128,<span class="hljs-params">kernel_size</span> = 2)</span>)<br>        self.conv.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;pool_2&quot;</span>,<span class="hljs-params">nn</span>.MaxPool1d(<span class="hljs-params">kernel_size</span> = 2)</span>)<br>        self.conv.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;relu_2&quot;</span>,<span class="hljs-params">nn</span>.ReLU()</span>)<br>        <br>        self.dense = nn.<span class="hljs-constructor">Sequential()</span><br>        self.dense.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;flatten&quot;</span>,<span class="hljs-params">nn</span>.Flatten()</span>)<br>        self.dense.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;linear&quot;</span>,<span class="hljs-params">nn</span>.Linear(6144,1)</span>)<br>        self.dense.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;sigmoid&quot;</span>,<span class="hljs-params">nn</span>.Sigmoid()</span>)<br>        <br>    def forward(self,x):<br>        x = self.embedding(x).transpose(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)<br>        x = self.conv(x)<br>        y = self.dense(x)<br>        return y<br>        <br><br>model = <span class="hljs-constructor">Net()</span><br>print(model)<br><br>model.summary(input_shape = (<span class="hljs-number">200</span>,),input_dtype = torch.LongTensor)<br></code></pre></td></tr></table></figure><h4 id="è®­ç»ƒæ¨¡å‹"><a href="#è®­ç»ƒæ¨¡å‹" class="headerlink" title="è®­ç»ƒæ¨¡å‹"></a>è®­ç»ƒæ¨¡å‹</h4><p>è®­ç»ƒPytorché€šå¸¸éœ€è¦ç”¨æˆ·ç¼–å†™è‡ªå®šä¹‰è®­ç»ƒå¾ªç¯ï¼Œè®­ç»ƒå¾ªç¯çš„ä»£ç é£æ ¼å› äººè€Œå¼‚ã€‚</p><p>æœ‰3ç±»å…¸å‹çš„è®­ç»ƒå¾ªç¯ä»£ç é£æ ¼ï¼šè„šæœ¬å½¢å¼è®­ç»ƒå¾ªç¯ï¼Œå‡½æ•°å½¢å¼è®­ç»ƒå¾ªç¯ï¼Œç±»å½¢å¼è®­ç»ƒå¾ªç¯ã€‚</p><p>æ­¤å¤„ä»‹ç»ä¸€ç§ç±»å½¢å¼çš„è®­ç»ƒå¾ªç¯ã€‚</p><p>æˆ‘ä»¬ä»¿ç…§Keraså®šä¹‰äº†ä¸€ä¸ªé«˜é˜¶çš„æ¨¡å‹æ¥å£Model,å®ç° fit, validateï¼Œpredict, summary æ–¹æ³•ï¼Œç›¸å½“äºç”¨æˆ·è‡ªå®šä¹‰é«˜é˜¶APIã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"># å‡†ç¡®ç‡<br>def accuracy(y_pred,y_true):<br>    y_pred = torch.where(y_pred&gt;<span class="hljs-number">0.5</span>,torch.ones<span class="hljs-constructor">_like(<span class="hljs-params">y_pred</span>,<span class="hljs-params">dtype</span> = <span class="hljs-params">torch</span>.<span class="hljs-params">float32</span>)</span>,<br>                      torch.zeros<span class="hljs-constructor">_like(<span class="hljs-params">y_pred</span>,<span class="hljs-params">dtype</span> = <span class="hljs-params">torch</span>.<span class="hljs-params">float32</span>)</span>)<br>    acc = torch.mean(<span class="hljs-number">1</span>-torch.abs(y_true-y_pred))<br>    return acc<br><br>model.compile(loss_func = nn.<span class="hljs-constructor">BCELoss()</span>,optimizer= torch.optim.<span class="hljs-constructor">Adagrad(<span class="hljs-params">model</span>.<span class="hljs-params">parameters</span>()</span>,lr = <span class="hljs-number">0.02</span>),<br>             metrics_dict=&#123;<span class="hljs-string">&quot;accuracy&quot;</span>:accuracy&#125;)<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># æœ‰æ—¶å€™æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­ä¸æ”¶æ•›ï¼Œéœ€è¦å¤šè¯•å‡ æ¬¡</span><br><span class="hljs-attribute">dfhistory</span> = model.fit(<span class="hljs-number">20</span>,dl_train,dl_val=dl_test,log_step_freq= <span class="hljs-number">200</span>)<br></code></pre></td></tr></table></figure><h4 id="å››ï¼Œè¯„ä¼°æ¨¡å‹"><a href="#å››ï¼Œè¯„ä¼°æ¨¡å‹" class="headerlink" title="å››ï¼Œè¯„ä¼°æ¨¡å‹"></a>å››ï¼Œè¯„ä¼°æ¨¡å‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python">%matplotlib inline<br>%config InlineBackend.figure_format = <span class="hljs-string">&#x27;svg&#x27;</span><br><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_metric</span>(<span class="hljs-params">dfhistory, metric</span>):</span><br>    train_metrics = dfhistory[metric]<br>    val_metrics = dfhistory[<span class="hljs-string">&#x27;val_&#x27;</span>+metric]<br>    epochs = <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(train_metrics) + <span class="hljs-number">1</span>)<br>    plt.plot(epochs, train_metrics, <span class="hljs-string">&#x27;bo--&#x27;</span>)<br>    plt.plot(epochs, val_metrics, <span class="hljs-string">&#x27;ro-&#x27;</span>)<br>    plt.title(<span class="hljs-string">&#x27;Training and validation &#x27;</span>+ metric)<br>    plt.xlabel(<span class="hljs-string">&quot;Epochs&quot;</span>)<br>    plt.ylabel(metric)<br>    plt.legend([<span class="hljs-string">&quot;train_&quot;</span>+metric, <span class="hljs-string">&#x27;val_&#x27;</span>+metric])<br>    plt.show()<br><br>plot_metric(dfhistory,<span class="hljs-string">&quot;loss&quot;</span>)<br>plot_metric(dfhistory,<span class="hljs-string">&quot;accuracy&quot;</span>)<br><br><span class="hljs-comment"># è¯„ä¼°</span><br>model.evaluate(dl_test)<br></code></pre></td></tr></table></figure><h4 id="äº”ï¼Œä½¿ç”¨æ¨¡å‹"><a href="#äº”ï¼Œä½¿ç”¨æ¨¡å‹" class="headerlink" title="äº”ï¼Œä½¿ç”¨æ¨¡å‹"></a>äº”ï¼Œä½¿ç”¨æ¨¡å‹</h4><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-keyword">model</span>.predict(dl_test)<br></code></pre></td></tr></table></figure><h4 id="å…­ï¼Œä¿å­˜æ¨¡å‹"><a href="#å…­ï¼Œä¿å­˜æ¨¡å‹" class="headerlink" title="å…­ï¼Œä¿å­˜æ¨¡å‹"></a>å…­ï¼Œä¿å­˜æ¨¡å‹</h4><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"># ä¿å­˜æ¨¡å‹å‚æ•°<br><br>torch.save(model.state<span class="hljs-constructor">_dict()</span>, <span class="hljs-string">&quot;./data/model_parameter.pkl&quot;</span>)<br><br>model_clone = <span class="hljs-constructor">Net()</span><br>model_clone.load<span class="hljs-constructor">_state_dict(<span class="hljs-params">torch</span>.<span class="hljs-params">load</span>(<span class="hljs-string">&quot;./data/model_parameter.pkl&quot;</span>)</span>)<br><br>model_clone.compile(loss_func = nn.<span class="hljs-constructor">BCELoss()</span>,optimizer= torch.optim.<span class="hljs-constructor">Adagrad(<span class="hljs-params">model</span>.<span class="hljs-params">parameters</span>()</span>,lr = <span class="hljs-number">0.02</span>),<br>             metrics_dict=&#123;<span class="hljs-string">&quot;accuracy&quot;</span>:accuracy&#125;)<br><br># è¯„ä¼°æ¨¡å‹<br>model_clone.evaluate(dl_test)<br></code></pre></td></tr></table></figure><p>æ¬è¿è‡ªï¼š</p><ul><li><a href="https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1">https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorchå­¦ä¹ ç¬”è®°15-å›¾ç‰‡æ•°æ®å»ºæ¨¡æµç¨‹èŒƒä¾‹</title>
    <link href="/2022/02/08/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B015-%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1%E6%B5%81%E7%A8%8B%E8%8C%83%E4%BE%8B/"/>
    <url>/2022/02/08/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B015-%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1%E6%B5%81%E7%A8%8B%E8%8C%83%E4%BE%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="å›¾ç‰‡æ•°æ®"><a href="#å›¾ç‰‡æ•°æ®" class="headerlink" title="å›¾ç‰‡æ•°æ®"></a>å›¾ç‰‡æ•°æ®</h2><span id="more"></span><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cos">import os<br>import datetime<br><br>#æ‰“å°æ—¶é—´<br>def printbar():<br>    nowtime = datetime.datetime.now().strftime(&#x27;<span class="hljs-built_in">%Y</span>-<span class="hljs-built_in">%m</span>-<span class="hljs-built_in">%d</span> <span class="hljs-built_in">%H</span>:<span class="hljs-built_in">%M</span>:<span class="hljs-built_in">%S</span>&#x27;)<br>    <span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;\n&quot;</span>+<span class="hljs-string">&quot;==========&quot;</span>*<span class="hljs-number">8</span> + <span class="hljs-string">&quot;%s&quot;</span><span class="hljs-built_in">%nowtime</span>)<br><br>#macç³»ç»Ÿä¸Špytorchå’Œmatplotlibåœ¨jupyterä¸­åŒæ—¶è·‘éœ€è¦æ›´æ”¹ç¯å¢ƒå˜é‡<br>os.environ[<span class="hljs-string">&quot;KMP_DUPLICATE_LIB_OK&quot;</span>]=<span class="hljs-string">&quot;TRUE&quot;</span> <br></code></pre></td></tr></table></figure><h4 id="ä¸€ï¼Œå‡†å¤‡æ•°æ®"><a href="#ä¸€ï¼Œå‡†å¤‡æ•°æ®" class="headerlink" title="ä¸€ï¼Œå‡†å¤‡æ•°æ®"></a>ä¸€ï¼Œå‡†å¤‡æ•°æ®</h4><p>cifar2æ•°æ®é›†ä¸ºcifar10æ•°æ®é›†çš„å­é›†ï¼ŒåªåŒ…æ‹¬å‰ä¸¤ç§ç±»åˆ«airplaneå’Œautomobileã€‚</p><p>è®­ç»ƒé›†æœ‰airplaneå’Œautomobileå›¾ç‰‡å„5000å¼ ï¼Œæµ‹è¯•é›†æœ‰airplaneå’Œautomobileå›¾ç‰‡å„1000å¼ ã€‚</p><p>cifar2ä»»åŠ¡çš„ç›®æ ‡æ˜¯è®­ç»ƒä¸€ä¸ªæ¨¡å‹æ¥å¯¹é£æœºairplaneå’ŒæœºåŠ¨è½¦automobileä¸¤ç§å›¾ç‰‡è¿›è¡Œåˆ†ç±»ã€‚</p><p>åœ¨Pytorchä¸­æ„å»ºå›¾ç‰‡æ•°æ®ç®¡é“é€šå¸¸æœ‰ä¸¤ç§æ–¹æ³•ã€‚</p><p>ç¬¬ä¸€ç§æ˜¯ä½¿ç”¨ torchvisionä¸­çš„datasets.ImageFolderæ¥è¯»å–å›¾ç‰‡ç„¶åç”¨ DataLoaderæ¥å¹¶è¡ŒåŠ è½½ã€‚</p><p>ç¬¬äºŒç§æ˜¯é€šè¿‡ç»§æ‰¿ torch.utils.data.Dataset å®ç°ç”¨æˆ·è‡ªå®šä¹‰è¯»å–é€»è¾‘ç„¶åç”¨ DataLoaderæ¥å¹¶è¡ŒåŠ è½½ã€‚</p><p>ç¬¬äºŒç§æ–¹æ³•æ˜¯è¯»å–ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®é›†çš„é€šç”¨æ–¹æ³•ï¼Œæ—¢å¯ä»¥è¯»å–å›¾ç‰‡æ•°æ®é›†ï¼Œä¹Ÿå¯ä»¥è¯»å–æ–‡æœ¬æ•°æ®é›†ã€‚</p><p>æœ¬ç¯‡æˆ‘ä»¬ä»‹ç»ç¬¬ä¸€ç§æ–¹æ³•ã€‚</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-built_in">import</span> torch <br>from torch <span class="hljs-built_in">import</span> nn<br>from torch.utils.data <span class="hljs-built_in">import</span> Dataset,DataLoader<br>from torchvision <span class="hljs-built_in">import</span> transforms,datasets <br><br><br><span class="hljs-attr">transform_train</span> = transforms.Compose(<br>    [transforms.ToTensor()])<br><span class="hljs-attr">transform_valid</span> = transforms.Compose(<br>    [transforms.ToTensor()])<br><br><br><span class="hljs-attr">ds_train</span> = datasets.ImageFolder(<span class="hljs-string">&quot;/home/kesci/input/data6936/data/cifar2/train/&quot;</span>,<br>            <span class="hljs-attr">transform</span> = transform_train,<span class="hljs-attr">target_transform=</span> lambda t:torch.tensor([t]).float())<br><span class="hljs-attr">ds_valid</span> = datasets.ImageFolder(<span class="hljs-string">&quot;/home/kesci/input/data6936/data/cifar2/test/&quot;</span>,<br>            <span class="hljs-attr">transform</span> = transform_train,<span class="hljs-attr">target_transform=</span> lambda t:torch.tensor([t]).float())<br><br>print(ds_train.class_to_idx)<br></code></pre></td></tr></table></figure><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">dl_train = <span class="hljs-constructor">DataLoader(<span class="hljs-params">ds_train</span>,<span class="hljs-params">batch_size</span> = 50,<span class="hljs-params">shuffle</span> = True,<span class="hljs-params">num_workers</span>=3)</span><br>dl_valid = <span class="hljs-constructor">DataLoader(<span class="hljs-params">ds_valid</span>,<span class="hljs-params">batch_size</span> = 50,<span class="hljs-params">shuffle</span> = True,<span class="hljs-params">num_workers</span>=3)</span><br></code></pre></td></tr></table></figure><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">%matplotlib inline<br>%config <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InlineBackend</span>.</span></span>figure_format = &#x27;svg&#x27;<br><br>#æŸ¥çœ‹éƒ¨åˆ†æ ·æœ¬<br>from matplotlib import pyplot <span class="hljs-keyword">as</span> plt <br><br>plt.figure(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">8</span>)) <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">9</span>):<br>    img,label = ds_train<span class="hljs-literal">[<span class="hljs-identifier">i</span>]</span><br>    img = img.permute(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>)<br>    ax=plt.subplot(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,i+<span class="hljs-number">1</span>)<br>    ax.imshow(img.numpy<span class="hljs-literal">()</span>)<br>    ax.set<span class="hljs-constructor">_title(<span class="hljs-string">&quot;label = %d&quot;</span>%<span class="hljs-params">label</span>.<span class="hljs-params">item</span>()</span>)<br>    ax.set<span class="hljs-constructor">_xticks([])</span><br>    ax.set<span class="hljs-constructor">_yticks([])</span> <br>plt.show<span class="hljs-literal">()</span><br></code></pre></td></tr></table></figure><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs processing"># Pytorchçš„å›¾ç‰‡é»˜è®¤é¡ºåºæ˜¯ Batch,Channel,Width,Height<br><span class="hljs-keyword">for</span> x,y in dl_train:<br>    <span class="hljs-built_in">print</span>(x.<span class="hljs-built_in">shape</span>,y.<span class="hljs-built_in">shape</span>) <br>    <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><h4 id="äºŒï¼Œå®šä¹‰æ¨¡å‹"><a href="#äºŒï¼Œå®šä¹‰æ¨¡å‹" class="headerlink" title="äºŒï¼Œå®šä¹‰æ¨¡å‹"></a>äºŒï¼Œå®šä¹‰æ¨¡å‹</h4><p>ä½¿ç”¨Pytorché€šå¸¸æœ‰ä¸‰ç§æ–¹å¼æ„å»ºæ¨¡å‹ï¼šä½¿ç”¨nn.SequentialæŒ‰å±‚é¡ºåºæ„å»ºæ¨¡å‹ï¼Œç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºè‡ªå®šä¹‰æ¨¡å‹ï¼Œç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºæ¨¡å‹å¹¶è¾…åŠ©åº”ç”¨æ¨¡å‹å®¹å™¨(nn.Sequential,nn.ModuleList,nn.ModuleDict)è¿›è¡Œå°è£…ã€‚</p><p>æ­¤å¤„é€‰æ‹©é€šè¿‡ç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºè‡ªå®šä¹‰æ¨¡å‹ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#æµ‹è¯•AdaptiveMaxPool2dçš„æ•ˆæœ</span><br><span class="hljs-attribute">pool</span> = nn.AdaptiveMaxPool<span class="hljs-number">2</span>d((<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))<br><span class="hljs-attribute">t</span> = torch.randn(<span class="hljs-number">10</span>,<span class="hljs-number">8</span>,<span class="hljs-number">32</span>,<span class="hljs-number">32</span>)<br><span class="hljs-attribute">pool</span>(t).shape <br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">class</span> Net(nn.Module):<br>    <br>    <span class="hljs-attribute">def</span> __init__(self):<br>        <span class="hljs-attribute">super</span>(Net, self).__init__()<br>        <span class="hljs-attribute">self</span>.conv<span class="hljs-number">1</span> = nn.Conv<span class="hljs-number">2</span>d(in_channels=<span class="hljs-number">3</span>,out_channels=<span class="hljs-number">32</span>,kernel_size = <span class="hljs-number">3</span>)<br>        <span class="hljs-attribute">self</span>.pool = nn.MaxPool<span class="hljs-number">2</span>d(kernel_size = <span class="hljs-number">2</span>,stride = <span class="hljs-number">2</span>)<br>        <span class="hljs-attribute">self</span>.conv<span class="hljs-number">2</span> = nn.Conv<span class="hljs-number">2</span>d(in_channels=<span class="hljs-number">32</span>,out_channels=<span class="hljs-number">64</span>,kernel_size = <span class="hljs-number">5</span>)<br>        <span class="hljs-attribute">self</span>.dropout = nn.Dropout<span class="hljs-number">2</span>d(p = <span class="hljs-number">0</span>.<span class="hljs-number">1</span>)<br>        <span class="hljs-attribute">self</span>.adaptive_pool = nn.AdaptiveMaxPool<span class="hljs-number">2</span>d((<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))<br>        <span class="hljs-attribute">self</span>.flatten = nn.Flatten()<br>        <span class="hljs-attribute">self</span>.linear<span class="hljs-number">1</span> = nn.Linear(<span class="hljs-number">64</span>,<span class="hljs-number">32</span>)<br>        <span class="hljs-attribute">self</span>.relu = nn.ReLU()<br>        <span class="hljs-attribute">self</span>.linear<span class="hljs-number">2</span> = nn.Linear(<span class="hljs-number">32</span>,<span class="hljs-number">1</span>)<br>        <span class="hljs-attribute">self</span>.sigmoid = nn.Sigmoid()<br>        <br>    <span class="hljs-attribute">def</span> forward(self,x):<br>        <span class="hljs-attribute">x</span> = self.conv<span class="hljs-number">1</span>(x)<br>        <span class="hljs-attribute">x</span> = self.pool(x)<br>        <span class="hljs-attribute">x</span> = self.conv<span class="hljs-number">2</span>(x)<br>        <span class="hljs-attribute">x</span> = self.pool(x)<br>        <span class="hljs-attribute">x</span> = self.dropout(x)<br>        <span class="hljs-attribute">x</span> = self.adaptive_pool(x)<br>        <span class="hljs-attribute">x</span> = self.flatten(x)<br>        <span class="hljs-attribute">x</span> = self.linear<span class="hljs-number">1</span>(x)<br>        <span class="hljs-attribute">x</span> = self.relu(x)<br>        <span class="hljs-attribute">x</span> = self.linear<span class="hljs-number">2</span>(x)<br>        <span class="hljs-attribute">y</span> = self.sigmoid(x)<br>        <span class="hljs-attribute">return</span> y<br>        <br><span class="hljs-attribute">net</span> = Net()<br><span class="hljs-attribute">print</span>(net)<br><br><span class="hljs-attribute">import</span> torchkeras<br><span class="hljs-attribute">torchkeras</span>.summary(net,input_shape= (<span class="hljs-number">3</span>,<span class="hljs-number">32</span>,<span class="hljs-number">32</span>))<br></code></pre></td></tr></table></figure><h4 id="ä¸‰ï¼Œè®­ç»ƒæ¨¡å‹"><a href="#ä¸‰ï¼Œè®­ç»ƒæ¨¡å‹" class="headerlink" title="ä¸‰ï¼Œè®­ç»ƒæ¨¡å‹"></a>ä¸‰ï¼Œè®­ç»ƒæ¨¡å‹</h4><p>Pytorché€šå¸¸éœ€è¦ç”¨æˆ·ç¼–å†™è‡ªå®šä¹‰è®­ç»ƒå¾ªç¯ï¼Œè®­ç»ƒå¾ªç¯çš„ä»£ç é£æ ¼å› äººè€Œå¼‚ã€‚</p><p>æœ‰3ç±»å…¸å‹çš„è®­ç»ƒå¾ªç¯ä»£ç é£æ ¼ï¼šè„šæœ¬å½¢å¼è®­ç»ƒå¾ªç¯ï¼Œå‡½æ•°å½¢å¼è®­ç»ƒå¾ªç¯ï¼Œç±»å½¢å¼è®­ç»ƒå¾ªç¯ã€‚</p><p>æ­¤å¤„ä»‹ç»ä¸€ç§è¾ƒé€šç”¨çš„å‡½æ•°å½¢å¼è®­ç»ƒå¾ªç¯ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus">import pandas as pd <br>from sklearn<span class="hljs-selector-class">.metrics</span> import roc_auc_score<br><br>model = net<br>model<span class="hljs-selector-class">.optimizer</span> = torch<span class="hljs-selector-class">.optim</span><span class="hljs-selector-class">.SGD</span>(model<span class="hljs-selector-class">.parameters</span>(),lr = <span class="hljs-number">0.01</span>)<br>model<span class="hljs-selector-class">.loss_func</span> = torch<span class="hljs-selector-class">.nn</span><span class="hljs-selector-class">.BCELoss</span>()<br>model<span class="hljs-selector-class">.metric_func</span> = lambda y_pred,y_true: roc_auc_score(y_true<span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.numpy</span>(),y_pred<span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.numpy</span>())<br>model<span class="hljs-selector-class">.metric_name</span> = <span class="hljs-string">&quot;auc&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">def train<span class="hljs-constructor">_step(<span class="hljs-params">model</span>,<span class="hljs-params">features</span>,<span class="hljs-params">labels</span>)</span>:<br>    <br>    # è®­ç»ƒæ¨¡å¼ï¼Œdropoutå±‚å‘ç”Ÿä½œç”¨<br>    model.train<span class="hljs-literal">()</span><br>    <br>    # æ¢¯åº¦æ¸…é›¶<br>    model.optimizer.zero<span class="hljs-constructor">_grad()</span><br>    <br>    # æ­£å‘ä¼ æ’­æ±‚æŸå¤±<br>    predictions = model(features)<br>    loss = model.loss<span class="hljs-constructor">_func(<span class="hljs-params">predictions</span>,<span class="hljs-params">labels</span>)</span><br>    metric = model.metric<span class="hljs-constructor">_func(<span class="hljs-params">predictions</span>,<span class="hljs-params">labels</span>)</span><br><br>    # åå‘ä¼ æ’­æ±‚æ¢¯åº¦<br>    loss.backward<span class="hljs-literal">()</span><br>    model.optimizer.step<span class="hljs-literal">()</span><br><br>    return loss.item<span class="hljs-literal">()</span>,metric.item<span class="hljs-literal">()</span><br><br>def valid<span class="hljs-constructor">_step(<span class="hljs-params">model</span>,<span class="hljs-params">features</span>,<span class="hljs-params">labels</span>)</span>:<br>    <br>    # é¢„æµ‹æ¨¡å¼ï¼Œdropoutå±‚ä¸å‘ç”Ÿä½œç”¨<br>    model.eval<span class="hljs-literal">()</span><br>    # å…³é—­æ¢¯åº¦è®¡ç®—<br>    <span class="hljs-keyword">with</span> torch.no<span class="hljs-constructor">_grad()</span>:<br>        predictions = model(features)<br>        loss = model.loss<span class="hljs-constructor">_func(<span class="hljs-params">predictions</span>,<span class="hljs-params">labels</span>)</span><br>        metric = model.metric<span class="hljs-constructor">_func(<span class="hljs-params">predictions</span>,<span class="hljs-params">labels</span>)</span><br>    <br>    return loss.item<span class="hljs-literal">()</span>, metric.item<span class="hljs-literal">()</span><br><br><br># æµ‹è¯•train_stepæ•ˆæœ<br>features,labels = next(iter(dl_train))<br>train<span class="hljs-constructor">_step(<span class="hljs-params">model</span>,<span class="hljs-params">features</span>,<span class="hljs-params">labels</span>)</span><br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs routeros">def train_model(model,epochs,dl_train,dl_valid,log_step_freq):<br><br>    metric_name = model.metric_name<br>    dfhistory = pd.DataFrame(columns = [<span class="hljs-string">&quot;epoch&quot;</span>,<span class="hljs-string">&quot;loss&quot;</span>,metric_name,<span class="hljs-string">&quot;val_loss&quot;</span>,<span class="hljs-string">&quot;val_&quot;</span>+metric_name]) <br>    <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;Start Training...&quot;</span>)<br>    nowtime = datetime.datetime.now().strftime(<span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)<br>    <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;==========&quot;</span><span class="hljs-number">*8</span> + <span class="hljs-string">&quot;%s&quot;</span>%nowtime)<br><br>    <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> range(1,epochs+1):  <br><br>        # 1ï¼Œè®­ç»ƒå¾ªç¯-------------------------------------------------<br>        loss_sum = 0.0<br>        metric_sum = 0.0<br>        <span class="hljs-keyword">step</span> = 1<br><br>        <span class="hljs-keyword">for</span> <span class="hljs-keyword">step</span>, (features,labels) <span class="hljs-keyword">in</span> enumerate(dl_train, 1):<br><br>            loss,metric = train_step(model,features,labels)<br><br>            # æ‰“å°batchçº§åˆ«æ—¥å¿—<br>            loss_sum += loss<br>            metric_sum += metric<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">step</span>%log_step_freq == 0:   <br>                <span class="hljs-builtin-name">print</span>((<span class="hljs-string">&quot;[step = %d] loss: %.3f, &quot;</span>+metric_name+<span class="hljs-string">&quot;: %.3f&quot;</span>) %<br>                      (<span class="hljs-keyword">step</span>, loss_sum/<span class="hljs-keyword">step</span>, metric_sum/<span class="hljs-keyword">step</span>))<br><br>        # 2ï¼ŒéªŒè¯å¾ªç¯-------------------------------------------------<br>        val_loss_sum = 0.0<br>        val_metric_sum = 0.0<br>        val_step = 1<br><br>        <span class="hljs-keyword">for</span> val_step, (features,labels) <span class="hljs-keyword">in</span> enumerate(dl_valid, 1):<br><br>            val_loss,val_metric = valid_step(model,features,labels)<br><br>            val_loss_sum += val_loss<br>            val_metric_sum += val_metric<br><br>        # 3ï¼Œè®°å½•æ—¥å¿—-------------------------------------------------<br>        <span class="hljs-builtin-name">info</span> = (epoch, loss_sum/<span class="hljs-keyword">step</span>, metric_sum/<span class="hljs-keyword">step</span>, <br>                val_loss_sum/val_step, val_metric_sum/val_step)<br>        dfhistory.loc[epoch-1] = <span class="hljs-builtin-name">info</span><br><br>        # æ‰“å°epochçº§åˆ«æ—¥å¿—<br>        <span class="hljs-builtin-name">print</span>((<span class="hljs-string">&quot;\nEPOCH = %d, loss = %.3f,&quot;</span>+ metric_name + \<br>              <span class="hljs-string">&quot;  = %.3f, val_loss = %.3f, &quot;</span>+<span class="hljs-string">&quot;val_&quot;</span>+ metric_name+<span class="hljs-string">&quot; = %.3f&quot;</span>) <br>              %info)<br>        nowtime = datetime.datetime.now().strftime(<span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)<br>        <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;\n&quot;</span>+<span class="hljs-string">&quot;==========&quot;</span><span class="hljs-number">*8</span> + <span class="hljs-string">&quot;%s&quot;</span>%nowtime)<br><br>    <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&#x27;Finished Training...&#x27;</span>)<br>    <br>    return dfhistory<br></code></pre></td></tr></table></figure><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">epochs = <span class="hljs-number">20</span><br><br>dfhistory = train<span class="hljs-constructor">_model(<span class="hljs-params">model</span>,<span class="hljs-params">epochs</span>,<span class="hljs-params">dl_train</span>,<span class="hljs-params">dl_valid</span>,<span class="hljs-params">log_step_freq</span> = 50)</span><br><br></code></pre></td></tr></table></figure><h4 id="å››ï¼Œè¯„ä¼°æ¨¡å‹"><a href="#å››ï¼Œè¯„ä¼°æ¨¡å‹" class="headerlink" title="å››ï¼Œè¯„ä¼°æ¨¡å‹"></a>å››ï¼Œè¯„ä¼°æ¨¡å‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python">%matplotlib inline<br>%config InlineBackend.figure_format = <span class="hljs-string">&#x27;svg&#x27;</span><br><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_metric</span>(<span class="hljs-params">dfhistory, metric</span>):</span><br>    train_metrics = dfhistory[metric]<br>    val_metrics = dfhistory[<span class="hljs-string">&#x27;val_&#x27;</span>+metric]<br>    epochs = <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(train_metrics) + <span class="hljs-number">1</span>)<br>    plt.plot(epochs, train_metrics, <span class="hljs-string">&#x27;bo--&#x27;</span>)<br>    plt.plot(epochs, val_metrics, <span class="hljs-string">&#x27;ro-&#x27;</span>)<br>    plt.title(<span class="hljs-string">&#x27;Training and validation &#x27;</span>+ metric)<br>    plt.xlabel(<span class="hljs-string">&quot;Epochs&quot;</span>)<br>    plt.ylabel(metric)<br>    plt.legend([<span class="hljs-string">&quot;train_&quot;</span>+metric, <span class="hljs-string">&#x27;val_&#x27;</span>+metric])<br>    plt.show()<br><br><br>plot_metric(dfhistory,<span class="hljs-string">&quot;loss&quot;</span>)<br>plot_metric(dfhistory,<span class="hljs-string">&quot;auc&quot;</span>)<br></code></pre></td></tr></table></figure><h4 id="äº”ï¼Œä½¿ç”¨æ¨¡å‹"><a href="#äº”ï¼Œä½¿ç”¨æ¨¡å‹" class="headerlink" title="äº”ï¼Œä½¿ç”¨æ¨¡å‹"></a>äº”ï¼Œä½¿ç”¨æ¨¡å‹</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs css">def predict(model,<span class="hljs-selector-tag">dl</span>):<br>    model.<span class="hljs-built_in">eval</span>()<br>    with torch.<span class="hljs-built_in">no_grad</span>():<br>        result = torch.<span class="hljs-built_in">cat</span>([model.<span class="hljs-built_in">forward</span>(t[<span class="hljs-number">0</span>]) for t in dl])<br>    <span class="hljs-built_in">return</span>(result.data)<br><br><br>#é¢„æµ‹æ¦‚ç‡<br>y_pred_probs = <span class="hljs-built_in">predict</span>(model,dl_valid)<br>y_pred_probs<br><br>#é¢„æµ‹ç±»åˆ«<br>y_pred = torch.<span class="hljs-built_in">where</span>(y_pred_probs&gt;<span class="hljs-number">0.5</span>,<br>        torch.<span class="hljs-built_in">ones_like</span>(y_pred_probs),torch.<span class="hljs-built_in">zeros_like</span>(y_pred_probs))<br>y_pred<br></code></pre></td></tr></table></figure><h4 id="å…­ï¼Œä¿å­˜æ¨¡å‹"><a href="#å…­ï¼Œä¿å­˜æ¨¡å‹" class="headerlink" title="å…­ï¼Œä¿å­˜æ¨¡å‹"></a>å…­ï¼Œä¿å­˜æ¨¡å‹</h4><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">print(model.state<span class="hljs-constructor">_dict()</span>.keys<span class="hljs-literal">()</span>)<br><br># ä¿å­˜æ¨¡å‹å‚æ•°<br><br>torch.save(model.state<span class="hljs-constructor">_dict()</span>, <span class="hljs-string">&quot;./data/model_parameter.pkl&quot;</span>)<br><br>net_clone = <span class="hljs-constructor">Net()</span><br>net_clone.load<span class="hljs-constructor">_state_dict(<span class="hljs-params">torch</span>.<span class="hljs-params">load</span>(<span class="hljs-string">&quot;./data/model_parameter.pkl&quot;</span>)</span>)<br><br>predict(net_clone,dl_valid)<br></code></pre></td></tr></table></figure><p>æ¬è¿è‡ªï¼š</p><ul><li><a href="https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1">https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorchå­¦ä¹ ç¬”è®°14-ç»“æ„åŒ–æ•°æ®å»ºæ¨¡æµç¨‹èŒƒä¾‹</title>
    <link href="/2022/02/08/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B014-%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1%E6%B5%81%E7%A8%8B%E8%8C%83%E4%BE%8B/"/>
    <url>/2022/02/08/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B014-%E7%BB%93%E6%9E%84%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1%E6%B5%81%E7%A8%8B%E8%8C%83%E4%BE%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="ç»“æ„åŒ–æ•°æ®"><a href="#ç»“æ„åŒ–æ•°æ®" class="headerlink" title="ç»“æ„åŒ–æ•°æ®"></a>ç»“æ„åŒ–æ•°æ®</h2><span id="more"></span><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cos">import os<br>import datetime<br><br>#æ‰“å°æ—¶é—´<br>def printbar():<br>    nowtime = datetime.datetime.now().strftime(&#x27;<span class="hljs-built_in">%Y</span>-<span class="hljs-built_in">%m</span>-<span class="hljs-built_in">%d</span> <span class="hljs-built_in">%H</span>:<span class="hljs-built_in">%M</span>:<span class="hljs-built_in">%S</span>&#x27;)<br>    <span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;\n&quot;</span>+<span class="hljs-string">&quot;==========&quot;</span>*<span class="hljs-number">8</span> + <span class="hljs-string">&quot;%s&quot;</span><span class="hljs-built_in">%nowtime</span>)<br><br>#macç³»ç»Ÿä¸Špytorchå’Œmatplotlibåœ¨jupyterä¸­åŒæ—¶è·‘éœ€è¦æ›´æ”¹ç¯å¢ƒå˜é‡<br>os.environ[<span class="hljs-string">&quot;KMP_DUPLICATE_LIB_OK&quot;</span>]=<span class="hljs-string">&quot;TRUE&quot;</span> <br></code></pre></td></tr></table></figure><h4 id="ä¸€ï¼Œå‡†å¤‡æ•°æ®"><a href="#ä¸€ï¼Œå‡†å¤‡æ•°æ®" class="headerlink" title="ä¸€ï¼Œå‡†å¤‡æ•°æ®"></a>ä¸€ï¼Œå‡†å¤‡æ•°æ®</h4><p>titanicæ•°æ®é›†çš„ç›®æ ‡æ˜¯æ ¹æ®ä¹˜å®¢ä¿¡æ¯é¢„æµ‹ä»–ä»¬åœ¨Titanicå·æ’å‡»å†°å±±æ²‰æ²¡åèƒ½å¦ç”Ÿå­˜ã€‚</p><p>ç»“æ„åŒ–æ•°æ®ä¸€èˆ¬ä¼šä½¿ç”¨Pandasä¸­çš„DataFrameè¿›è¡Œé¢„å¤„ç†ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">import numpy <span class="hljs-keyword">as</span> np <br>import pandas <span class="hljs-keyword">as</span> pd <br>import matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br>import torch <br>from torch import nn <br>from torch.utils.data import Dataset,DataLoader,TensorDataset<br><br>dftrain_raw = pd.read<span class="hljs-constructor">_csv(&#x27;<span class="hljs-operator">/</span><span class="hljs-params">home</span><span class="hljs-operator">/</span><span class="hljs-params">kesci</span><span class="hljs-operator">/</span><span class="hljs-params">input</span><span class="hljs-operator">/</span><span class="hljs-params">data6936</span><span class="hljs-operator">/</span><span class="hljs-params">data</span><span class="hljs-operator">/</span><span class="hljs-params">titanic</span><span class="hljs-operator">/</span><span class="hljs-params">train</span>.<span class="hljs-params">csv</span>&#x27;)</span><br>dftest_raw = pd.read<span class="hljs-constructor">_csv(&#x27;<span class="hljs-operator">/</span><span class="hljs-params">home</span><span class="hljs-operator">/</span><span class="hljs-params">kesci</span><span class="hljs-operator">/</span><span class="hljs-params">input</span><span class="hljs-operator">/</span><span class="hljs-params">data6936</span><span class="hljs-operator">/</span><span class="hljs-params">data</span><span class="hljs-operator">/</span><span class="hljs-params">titanic</span><span class="hljs-operator">/</span><span class="hljs-params">test</span>.<span class="hljs-params">csv</span>&#x27;)</span><br>dftrain_raw.head(<span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨Pandasçš„æ•°æ®å¯è§†åŒ–åŠŸèƒ½æˆ‘ä»¬å¯ä»¥ç®€å•åœ°è¿›è¡Œæ¢ç´¢æ€§æ•°æ®åˆ†æEDAï¼ˆExploratory Data Analysisï¼‰ã€‚</p><p>labelåˆ†å¸ƒæƒ…å†µ</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">%matplotlib inline<br>%config InlineBackend.figure_format = &#x27;png&#x27;<br>ax = dftrain_raw[&#x27;Survived&#x27;]<span class="hljs-string">.value_counts</span><span class="hljs-params">()</span><span class="hljs-string">.plot</span><span class="hljs-params">(<span class="hljs-attr">kind</span> = &#x27;bar&#x27;,</span><br><span class="hljs-params">     <span class="hljs-attr">figsize</span> = (12,8)</span>,fontsize=15,rot = 0)<br>ax.<span class="hljs-keyword">set</span>_ylabel<span class="hljs-params">(&#x27;Counts&#x27;,<span class="hljs-attr">fontsize</span> = 15)</span><br>ax.<span class="hljs-keyword">set</span>_xlabel<span class="hljs-params">(&#x27;Survived&#x27;,<span class="hljs-attr">fontsize</span> = 15)</span><br>plt.show<span class="hljs-params">()</span><br></code></pre></td></tr></table></figure><p>æ•°æ®é¢„å¤„ç†</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs prolog">def preprocessing(dfdata):<br><br>    dfresult= pd.<span class="hljs-symbol">DataFrame</span>()<br><br>    #<span class="hljs-symbol">Pclass</span><br>    dfPclass = pd.get_dummies(dfdata[<span class="hljs-string">&#x27;Pclass&#x27;</span>])<br>    dfPclass.columns = [<span class="hljs-string">&#x27;Pclass_&#x27;</span> +str(x) for x in dfPclass.columns ]<br>    dfresult = pd.concat([dfresult,dfPclass],axis = <span class="hljs-number">1</span>)<br><br>    #<span class="hljs-symbol">Sex</span><br>    dfSex = pd.get_dummies(dfdata[<span class="hljs-string">&#x27;Sex&#x27;</span>])<br>    dfresult = pd.concat([dfresult,dfSex],axis = <span class="hljs-number">1</span>)<br><br>    #<span class="hljs-symbol">Age</span><br>    dfresult[<span class="hljs-string">&#x27;Age&#x27;</span>] = dfdata[<span class="hljs-string">&#x27;Age&#x27;</span>].fillna(<span class="hljs-number">0</span>)<br>    dfresult[<span class="hljs-string">&#x27;Age_null&#x27;</span>] = pd.isna(dfdata[<span class="hljs-string">&#x27;Age&#x27;</span>]).astype(<span class="hljs-string">&#x27;int32&#x27;</span>)<br><br>    #<span class="hljs-symbol">SibSp</span>,<span class="hljs-symbol">Parch</span>,<span class="hljs-symbol">Fare</span><br>    dfresult[<span class="hljs-string">&#x27;SibSp&#x27;</span>] = dfdata[<span class="hljs-string">&#x27;SibSp&#x27;</span>]<br>    dfresult[<span class="hljs-string">&#x27;Parch&#x27;</span>] = dfdata[<span class="hljs-string">&#x27;Parch&#x27;</span>]<br>    dfresult[<span class="hljs-string">&#x27;Fare&#x27;</span>] = dfdata[<span class="hljs-string">&#x27;Fare&#x27;</span>]<br><br>    #<span class="hljs-symbol">Carbin</span><br>    dfresult[<span class="hljs-string">&#x27;Cabin_null&#x27;</span>] =  pd.isna(dfdata[<span class="hljs-string">&#x27;Cabin&#x27;</span>]).astype(<span class="hljs-string">&#x27;int32&#x27;</span>)<br><br>    #<span class="hljs-symbol">Embarked</span><br>    dfEmbarked = pd.get_dummies(dfdata[<span class="hljs-string">&#x27;Embarked&#x27;</span>],dummy_na=<span class="hljs-symbol">True</span>)<br>    dfEmbarked.columns = [<span class="hljs-string">&#x27;Embarked_&#x27;</span> + str(x) for x in dfEmbarked.columns]<br>    dfresult = pd.concat([dfresult,dfEmbarked],axis = <span class="hljs-number">1</span>)<br><br>    return(dfresult)<br><br>x_train = preprocessing(dftrain_raw).values<br>y_train = dftrain_raw[[<span class="hljs-string">&#x27;Survived&#x27;</span>]].values<br><br>x_test = preprocessing(dftest_raw).values<br>y_test = dftest_raw[[<span class="hljs-string">&#x27;Survived&#x27;</span>]].values<br><br>print(<span class="hljs-string">&quot;x_train.shape =&quot;</span>, x_train.shape )<br>print(<span class="hljs-string">&quot;x_test.shape =&quot;</span>, x_test.shape )<br><br>print(<span class="hljs-string">&quot;y_train.shape =&quot;</span>, y_train.shape )<br>print(<span class="hljs-string">&quot;y_test.shape =&quot;</span>, y_test.shape )<br></code></pre></td></tr></table></figure><p>è¿›ä¸€æ­¥ä½¿ç”¨DataLoaderå’ŒTensorDatasetå°è£…æˆå¯ä»¥è¿­ä»£çš„æ•°æ®ç®¡é“ã€‚</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs lisp">dl_train = DataLoader(<span class="hljs-name">TensorDataset</span>(<span class="hljs-name">torch</span>.tensor(<span class="hljs-name">x_train</span>).float(),torch.tensor(<span class="hljs-name">y_train</span>).float()),<br>                     shuffle = True, batch_size = <span class="hljs-number">8</span>)<br>dl_valid = DataLoader(<span class="hljs-name">TensorDataset</span>(<span class="hljs-name">torch</span>.tensor(<span class="hljs-name">x_test</span>).float(),torch.tensor(<span class="hljs-name">y_test</span>).float()),<br>                     shuffle = False, batch_size = <span class="hljs-number">8</span>)<br></code></pre></td></tr></table></figure><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs maxima"># æµ‹è¯•æ•°æ®ç®¡é“<br><span class="hljs-keyword">for</span> <span class="hljs-built_in">features</span>,<span class="hljs-built_in">labels</span> <span class="hljs-keyword">in</span> dl_train:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">features</span>,<span class="hljs-built_in">labels</span>)<br>    <span class="hljs-built_in">break</span><br></code></pre></td></tr></table></figure><h4 id="äºŒï¼Œå®šä¹‰æ¨¡å‹"><a href="#äºŒï¼Œå®šä¹‰æ¨¡å‹" class="headerlink" title="äºŒï¼Œå®šä¹‰æ¨¡å‹"></a>äºŒï¼Œå®šä¹‰æ¨¡å‹</h4><p>ä½¿ç”¨Pytorché€šå¸¸æœ‰ä¸‰ç§æ–¹å¼æ„å»ºæ¨¡å‹ï¼šä½¿ç”¨nn.SequentialæŒ‰å±‚é¡ºåºæ„å»ºæ¨¡å‹ï¼Œç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºè‡ªå®šä¹‰æ¨¡å‹ï¼Œç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºæ¨¡å‹å¹¶è¾…åŠ©åº”ç”¨æ¨¡å‹å®¹å™¨è¿›è¡Œå°è£…ã€‚</p><p>æ­¤å¤„é€‰æ‹©ä½¿ç”¨æœ€ç®€å•çš„nn.Sequentialï¼ŒæŒ‰å±‚é¡ºåºæ¨¡å‹ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs css">def create_net():<br>    net = nn.<span class="hljs-built_in">Sequential</span>()<br>    net.<span class="hljs-built_in">add_module</span>(<span class="hljs-string">&quot;linear1&quot;</span>,nn.<span class="hljs-built_in">Linear</span>(<span class="hljs-number">15</span>,<span class="hljs-number">20</span>))<br>    net.<span class="hljs-built_in">add_module</span>(<span class="hljs-string">&quot;relu1&quot;</span>,nn.<span class="hljs-built_in">ReLU</span>())<br>    net.<span class="hljs-built_in">add_module</span>(<span class="hljs-string">&quot;linear2&quot;</span>,nn.<span class="hljs-built_in">Linear</span>(<span class="hljs-number">20</span>,<span class="hljs-number">15</span>))<br>    net.<span class="hljs-built_in">add_module</span>(<span class="hljs-string">&quot;relu2&quot;</span>,nn.<span class="hljs-built_in">ReLU</span>())<br>    net.<span class="hljs-built_in">add_module</span>(<span class="hljs-string">&quot;linear3&quot;</span>,nn.<span class="hljs-built_in">Linear</span>(<span class="hljs-number">15</span>,<span class="hljs-number">1</span>))<br>    net.<span class="hljs-built_in">add_module</span>(<span class="hljs-string">&quot;sigmoid&quot;</span>,nn.<span class="hljs-built_in">Sigmoid</span>())<br>    return net<br>    <br>net = <span class="hljs-built_in">create_net</span>()<br><span class="hljs-built_in">print</span>(net)<br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">from</span> torchkeras <span class="hljs-keyword">import</span> <span class="hljs-keyword">summary</span><br><span class="hljs-keyword">summary</span>(net,input_shape=(<span class="hljs-number">15</span>,))<br></code></pre></td></tr></table></figure><h4 id="ä¸‰ï¼Œè®­ç»ƒæ¨¡å‹"><a href="#ä¸‰ï¼Œè®­ç»ƒæ¨¡å‹" class="headerlink" title="ä¸‰ï¼Œè®­ç»ƒæ¨¡å‹"></a>ä¸‰ï¼Œè®­ç»ƒæ¨¡å‹</h4><p>Pytorché€šå¸¸éœ€è¦ç”¨æˆ·ç¼–å†™è‡ªå®šä¹‰è®­ç»ƒå¾ªç¯ï¼Œè®­ç»ƒå¾ªç¯çš„ä»£ç é£æ ¼å› äººè€Œå¼‚ã€‚</p><p>æœ‰3ç±»å…¸å‹çš„è®­ç»ƒå¾ªç¯ä»£ç é£æ ¼ï¼šè„šæœ¬å½¢å¼è®­ç»ƒå¾ªç¯ï¼Œå‡½æ•°å½¢å¼è®­ç»ƒå¾ªç¯ï¼Œç±»å½¢å¼è®­ç»ƒå¾ªç¯ã€‚</p><p>æ­¤å¤„ä»‹ç»ä¸€ç§è¾ƒé€šç”¨çš„è„šæœ¬å½¢å¼ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">from sklearn.metrics import accuracy_score<br><br>loss_func = nn.<span class="hljs-constructor">BCELoss()</span><br>optimizer = torch.optim.<span class="hljs-constructor">Adam(<span class="hljs-params">params</span>=<span class="hljs-params">net</span>.<span class="hljs-params">parameters</span>()</span>,lr = <span class="hljs-number">0.01</span>)<br>metric_func = lambda y_pred,y_true: accuracy<span class="hljs-constructor">_score(<span class="hljs-params">y_true</span>.<span class="hljs-params">data</span>.<span class="hljs-params">numpy</span>()</span>,y_pred.data.numpy<span class="hljs-literal">()</span>&gt;<span class="hljs-number">0.5</span>)<br>metric_name = <span class="hljs-string">&quot;accuracy&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs maxima">epochs = <span class="hljs-number">10</span><br>log_step_freq = <span class="hljs-number">30</span><br><br>dfhistory = pd.DataFrame(<span class="hljs-built_in">columns</span> = [<span class="hljs-string">&quot;epoch&quot;</span>,<span class="hljs-string">&quot;loss&quot;</span>,metric_name,<span class="hljs-string">&quot;val_loss&quot;</span>,<span class="hljs-string">&quot;val_&quot;</span>+metric_name]) <br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Start Training...&quot;</span>)<br>nowtime = datetime.datetime.now().strftime(&#x27;%Y-<span class="hljs-built_in">%m</span>-%d %H:%M:%S&#x27;)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;==========&quot;</span>*<span class="hljs-number">8</span> + <span class="hljs-string">&quot;%s&quot;</span>%nowtime)<br><br><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,epochs+<span class="hljs-number">1</span>):  <br><br>    # <span class="hljs-number">1</span>ï¼Œè®­ç»ƒå¾ªç¯-------------------------------------------------<br>    net.train()<br>    loss_sum = <span class="hljs-number">0.0</span><br>    metric_sum = <span class="hljs-number">0.0</span><br>    <span class="hljs-keyword">step</span> = <span class="hljs-number">1</span><br>    <br>    <span class="hljs-keyword">for</span> <span class="hljs-keyword">step</span>, (<span class="hljs-built_in">features</span>,<span class="hljs-built_in">labels</span>) <span class="hljs-keyword">in</span> enumerate(dl_train, <span class="hljs-number">1</span>):<br>    <br>        # æ¢¯åº¦æ¸…é›¶<br>        optimizer.zero_grad()<br><br>        # æ­£å‘ä¼ æ’­æ±‚æŸå¤±<br>        predictions = net(<span class="hljs-built_in">features</span>)<br>        loss = loss_func(predictions,<span class="hljs-built_in">labels</span>)<br>        metric = metric_func(predictions,<span class="hljs-built_in">labels</span>)<br>        <br>        # åå‘ä¼ æ’­æ±‚æ¢¯åº¦<br>        loss.backward()<br>        optimizer.<span class="hljs-keyword">step</span>()<br><br>        # æ‰“å°<span class="hljs-built_in">batch</span>çº§åˆ«æ—¥å¿—<br>        loss_sum += loss.item()<br>        metric_sum += metric.item()<br>        <span class="hljs-keyword">if</span> step%log_step_freq == <span class="hljs-number">0</span>:   <br>            <span class="hljs-built_in">print</span>((<span class="hljs-string">&quot;[step = %d] loss: %.3f, &quot;</span>+metric_name+<span class="hljs-string">&quot;: %.3f&quot;</span>) <span class="hljs-symbol">%</span><br>                  (<span class="hljs-keyword">step</span>, loss_sum/<span class="hljs-keyword">step</span>, metric_sum/<span class="hljs-keyword">step</span>))<br>            <br>    # <span class="hljs-number">2</span>ï¼ŒéªŒè¯å¾ªç¯-------------------------------------------------<br>    net.<span class="hljs-built_in">eval</span>()<br>    val_loss_sum = <span class="hljs-number">0.0</span><br>    val_metric_sum = <span class="hljs-number">0.0</span><br>    val_step = <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">for</span> val_step, (<span class="hljs-built_in">features</span>,<span class="hljs-built_in">labels</span>) <span class="hljs-keyword">in</span> enumerate(dl_valid, <span class="hljs-number">1</span>):<br>        # å…³é—­æ¢¯åº¦è®¡ç®—<br>        with torch.no_grad():<br>            predictions = net(<span class="hljs-built_in">features</span>)<br>            val_loss = loss_func(predictions,<span class="hljs-built_in">labels</span>)<br>            val_metric = metric_func(predictions,<span class="hljs-built_in">labels</span>)<br>        val_loss_sum += val_loss.item()<br>        val_metric_sum += val_metric.item()<br><br>    # <span class="hljs-number">3</span>ï¼Œè®°å½•æ—¥å¿—-------------------------------------------------<br>    info = (epoch, loss_sum/<span class="hljs-keyword">step</span>, metric_sum/<span class="hljs-keyword">step</span>, <br>            val_loss_sum/val_step, val_metric_sum/val_step)<br>    dfhistory.loc[epoch-<span class="hljs-number">1</span>] = info<br>    <br>    # æ‰“å°epochçº§åˆ«æ—¥å¿—<br>    <span class="hljs-built_in">print</span>((<span class="hljs-string">&quot;\nEPOCH = %d, loss = %.3f,&quot;</span>+ metric_name + \<br>          <span class="hljs-string">&quot;  = %.3f, val_loss = %.3f, &quot;</span>+<span class="hljs-string">&quot;val_&quot;</span>+ metric_name+<span class="hljs-string">&quot; = %.3f&quot;</span>) <br>          %info)<br>    nowtime = datetime.datetime.now().strftime(&#x27;%Y-<span class="hljs-built_in">%m</span>-%d %H:%M:%S&#x27;)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span>+<span class="hljs-string">&quot;==========&quot;</span>*<span class="hljs-number">8</span> + <span class="hljs-string">&quot;%s&quot;</span>%nowtime)<br>        <br><span class="hljs-built_in">print</span>(&#x27;Finished Training...&#x27;)<br></code></pre></td></tr></table></figure><h4 id="å››ï¼Œè¯„ä¼°æ¨¡å‹"><a href="#å››ï¼Œè¯„ä¼°æ¨¡å‹" class="headerlink" title="å››ï¼Œè¯„ä¼°æ¨¡å‹"></a>å››ï¼Œè¯„ä¼°æ¨¡å‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python">%matplotlib inline<br>%config InlineBackend.figure_format = <span class="hljs-string">&#x27;svg&#x27;</span><br><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_metric</span>(<span class="hljs-params">dfhistory, metric</span>):</span><br>    train_metrics = dfhistory[metric]<br>    val_metrics = dfhistory[<span class="hljs-string">&#x27;val_&#x27;</span>+metric]<br>    epochs = <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(train_metrics) + <span class="hljs-number">1</span>)<br>    plt.plot(epochs, train_metrics, <span class="hljs-string">&#x27;bo--&#x27;</span>)<br>    plt.plot(epochs, val_metrics, <span class="hljs-string">&#x27;ro-&#x27;</span>)<br>    plt.title(<span class="hljs-string">&#x27;Training and validation &#x27;</span>+ metric)<br>    plt.xlabel(<span class="hljs-string">&quot;Epochs&quot;</span>)<br>    plt.ylabel(metric)<br>    plt.legend([<span class="hljs-string">&quot;train_&quot;</span>+metric, <span class="hljs-string">&#x27;val_&#x27;</span>+metric])<br>    plt.show()<br><br>plot_metric(dfhistory,<span class="hljs-string">&quot;loss&quot;</span>)<br>plot_metric(dfhistory,<span class="hljs-string">&quot;accuracy&quot;</span>)<br></code></pre></td></tr></table></figure><h4 id="äº”ï¼Œä½¿ç”¨æ¨¡å‹"><a href="#äº”ï¼Œä½¿ç”¨æ¨¡å‹" class="headerlink" title="äº”ï¼Œä½¿ç”¨æ¨¡å‹"></a>äº”ï¼Œä½¿ç”¨æ¨¡å‹</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus">#é¢„æµ‹æ¦‚ç‡<br>y_pred_probs = net(torch<span class="hljs-selector-class">.tensor</span>(x_test<span class="hljs-selector-attr">[0:10]</span>)<span class="hljs-selector-class">.float</span>())<span class="hljs-selector-class">.data</span><br>y_pred_probs<br><br>#é¢„æµ‹ç±»åˆ«<br>y_pred = torch<span class="hljs-selector-class">.where</span>(y_pred_probs&gt;<span class="hljs-number">0.5</span>,<br>        torch<span class="hljs-selector-class">.ones_like</span>(y_pred_probs),torch<span class="hljs-selector-class">.zeros_like</span>(y_pred_probs))<br>y_pred<br></code></pre></td></tr></table></figure><h4 id="å…­ï¼Œä¿å­˜æ¨¡å‹"><a href="#å…­ï¼Œä¿å­˜æ¨¡å‹" class="headerlink" title="å…­ï¼Œä¿å­˜æ¨¡å‹"></a>å…­ï¼Œä¿å­˜æ¨¡å‹</h4><p>Pytorch æœ‰ä¸¤ç§ä¿å­˜æ¨¡å‹çš„æ–¹å¼ï¼Œéƒ½æ˜¯é€šè¿‡è°ƒç”¨pickleåºåˆ—åŒ–æ–¹æ³•å®ç°çš„ã€‚</p><p>ç¬¬ä¸€ç§æ–¹æ³•åªä¿å­˜æ¨¡å‹å‚æ•°ã€‚</p><p>ç¬¬äºŒç§æ–¹æ³•ä¿å­˜å®Œæ•´æ¨¡å‹ã€‚</p><p>æ¨èä½¿ç”¨ç¬¬ä¸€ç§ï¼Œç¬¬äºŒç§æ–¹æ³•å¯èƒ½åœ¨åˆ‡æ¢è®¾å¤‡å’Œç›®å½•çš„æ—¶å€™å‡ºç°å„ç§é—®é¢˜ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(net.state_dict()</span></span><span class="hljs-selector-class">.keys</span>())<br></code></pre></td></tr></table></figure><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"># ä¿å­˜æ¨¡å‹å‚æ•°<br><br>torch.save(net.state<span class="hljs-constructor">_dict()</span>, <span class="hljs-string">&quot;./data/net_parameter.pkl&quot;</span>)<br><br>net_clone = create<span class="hljs-constructor">_net()</span><br>net_clone.load<span class="hljs-constructor">_state_dict(<span class="hljs-params">torch</span>.<span class="hljs-params">load</span>(<span class="hljs-string">&quot;./data/net_parameter.pkl&quot;</span>)</span>)<br><br>net_clone.forward(torch.tensor(x_test<span class="hljs-literal">[<span class="hljs-number">0</span>:<span class="hljs-number">10</span>]</span>).<span class="hljs-built_in">float</span><span class="hljs-literal">()</span>).data<br></code></pre></td></tr></table></figure><p>æ¬è¿è‡ªï¼š</p><ul><li><a href="https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1">https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorchå­¦ä¹ ç¬”è®°13-ä½¿ç”¨GPUè®­ç»ƒæ¨¡å‹</title>
    <link href="/2022/02/07/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B013-%E4%BD%BF%E7%94%A8GPU%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/"/>
    <url>/2022/02/07/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B013-%E4%BD%BF%E7%94%A8GPU%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><p>è®­ç»ƒè¿‡ç¨‹çš„è€—æ—¶ä¸»è¦æ¥è‡ªäºä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ¥è‡ªæ•°æ®å‡†å¤‡ï¼Œå¦ä¸€éƒ¨åˆ†æ¥è‡ªå‚æ•°è¿­ä»£ã€‚</p><p>å½“æ•°æ®å‡†å¤‡è¿‡ç¨‹è¿˜æ˜¯æ¨¡å‹è®­ç»ƒæ—¶é—´çš„ä¸»è¦ç“¶é¢ˆæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ›´å¤šè¿›ç¨‹æ¥å‡†å¤‡æ•°æ®ã€‚</p><p>å½“å‚æ•°è¿­ä»£è¿‡ç¨‹æˆä¸ºè®­ç»ƒæ—¶é—´çš„ä¸»è¦ç“¶é¢ˆæ—¶ï¼Œæˆ‘ä»¬é€šå¸¸çš„æ–¹æ³•æ˜¯åº”ç”¨GPUæ¥è¿›è¡ŒåŠ é€Ÿã€‚</p><p>Pytorchä¸­ä½¿ç”¨GPUåŠ é€Ÿæ¨¡å‹éå¸¸ç®€å•ï¼Œåªè¦å°†æ¨¡å‹å’Œæ•°æ®ç§»åŠ¨åˆ°GPUä¸Šã€‚æ ¸å¿ƒä»£ç åªæœ‰ä»¥ä¸‹å‡ è¡Œã€‚</p><figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs monkey"><span class="hljs-meta"># å®šä¹‰æ¨¡å‹  </span><br>...   <br><br>device = torch.device(<span class="hljs-string">&quot;cuda:0&quot;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;cpu&quot;</span>)  <br>model.<span class="hljs-keyword">to</span>(device)<span class="hljs-meta"> # ç§»åŠ¨æ¨¡å‹åˆ°cuda  </span><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta"># è®­ç»ƒæ¨¡å‹  </span><br>...  <br><br>features = features.<span class="hljs-keyword">to</span>(device)<span class="hljs-meta"> # ç§»åŠ¨æ•°æ®åˆ°cuda  </span><br>labels = labels.<span class="hljs-keyword">to</span>(device)<span class="hljs-meta"> # æˆ–è€…  labels = labels.cuda() <span class="hljs-meta-keyword">if</span> torch.cuda.is_available() <span class="hljs-meta-keyword">else</span> labels  </span><br>...<br></code></pre></td></tr></table></figure><p>å¦‚æœè¦ä½¿ç”¨å¤šä¸ªGPUè®­ç»ƒæ¨¡å‹ï¼Œä¹Ÿéå¸¸ç®€å•ã€‚åªéœ€è¦åœ¨å°†æ¨¡å‹è®¾ç½®ä¸ºæ•°æ®å¹¶è¡Œé£æ ¼æ¨¡å‹ã€‚<br>åˆ™æ¨¡å‹ç§»åŠ¨åˆ°GPUä¸Šä¹‹åï¼Œä¼šåœ¨æ¯ä¸€ä¸ªGPUä¸Šæ‹·è´ä¸€ä¸ªå‰¯æœ¬ï¼Œå¹¶æŠŠæ•°æ®å¹³åˆ†åˆ°å„ä¸ªGPUä¸Šè¿›è¡Œè®­ç»ƒã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ã€‚</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs maxima"># å®šä¹‰æ¨¡å‹  <br>...   <br><br><span class="hljs-keyword">if</span> torch.cuda.device_count() &gt; <span class="hljs-number">1</span>:  <br>    model = nn.DataParallel(model) # åŒ…è£…ä¸ºå¹¶è¡Œé£æ ¼æ¨¡å‹  <br><br># è®­ç»ƒæ¨¡å‹  <br>...  <br><span class="hljs-built_in">features</span> = <span class="hljs-built_in">features</span>.to(device) # ç§»åŠ¨æ•°æ®åˆ°cuda  <br><span class="hljs-built_in">labels</span> = <span class="hljs-built_in">labels</span>.to(device) # æˆ–è€… <span class="hljs-built_in">labels</span> = <span class="hljs-built_in">labels</span>.cuda() <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-built_in">labels</span>  <br></code></pre></td></tr></table></figure><h4 id="ä¸€äº›å’ŒGPUæœ‰å…³çš„åŸºæœ¬æ“ä½œæ±‡æ€»"><a href="#ä¸€äº›å’ŒGPUæœ‰å…³çš„åŸºæœ¬æ“ä½œæ±‡æ€»" class="headerlink" title="ä¸€äº›å’ŒGPUæœ‰å…³çš„åŸºæœ¬æ“ä½œæ±‡æ€»"></a>ä¸€äº›å’ŒGPUæœ‰å…³çš„åŸºæœ¬æ“ä½œæ±‡æ€»</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs routeros">import torch <br><span class="hljs-keyword">from</span> torch import nn <br><br><span class="hljs-comment"># 1ï¼ŒæŸ¥çœ‹gpuä¿¡æ¯</span><br>if_cuda = torch.cuda.is_available()<br><span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;if_cuda=&quot;</span>,if_cuda)<br><br>gpu_count = torch.cuda.device_count()<br><span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;gpu_count=&quot;</span>,gpu_count)<br><br><br><span class="hljs-comment"># 2ï¼Œå°†å¼ é‡åœ¨gpuå’Œcpué—´ç§»åŠ¨</span><br>tensor = torch.rand((100,100))<br>tensor_gpu = tensor.<span class="hljs-keyword">to</span>(<span class="hljs-string">&quot;cuda:0&quot;</span>) # æˆ–è€… tensor_gpu = tensor.cuda()<br><span class="hljs-builtin-name">print</span>(tensor_gpu.device)<br><span class="hljs-builtin-name">print</span>(tensor_gpu.is_cuda)<br><br>tensor_cpu = tensor_gpu.<span class="hljs-keyword">to</span>(<span class="hljs-string">&quot;cpu&quot;</span>) # æˆ–è€… tensor_cpu = tensor_gpu.cpu() <br><span class="hljs-builtin-name">print</span>(tensor_cpu.device)<br><br><span class="hljs-comment"># 3ï¼Œå°†æ¨¡å‹ä¸­çš„å…¨éƒ¨å¼ é‡ç§»åŠ¨åˆ°gpuä¸Š</span><br>net = nn.Linear(2,1)<br><span class="hljs-builtin-name">print</span>(next(net.parameters()).is_cuda)<br>net.<span class="hljs-keyword">to</span>(<span class="hljs-string">&quot;cuda:0&quot;</span>) # å°†æ¨¡å‹ä¸­çš„å…¨éƒ¨å‚æ•°å¼ é‡ä¾æ¬¡åˆ°GPUä¸Šï¼Œæ³¨æ„ï¼Œæ— éœ€é‡æ–°èµ‹å€¼ä¸º net = net.<span class="hljs-keyword">to</span>(<span class="hljs-string">&quot;cuda:0&quot;</span>)<br><span class="hljs-comment">#æŸ¥çœ‹æ¨¡å‹æ˜¯å¦å·²ç»ç§»åŠ¨åˆ°GPUä¸Š</span><br><span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;if on cuda:&quot;</span>,next(net.parameters()).is_cuda)<br><span class="hljs-comment">#print(next(net.parameters()).is_cuda)</span><br><span class="hljs-builtin-name">print</span>(next(net.parameters()).device)<br><br><span class="hljs-comment"># 4ï¼Œåˆ›å»ºæ”¯æŒå¤šä¸ªgpuæ•°æ®å¹¶è¡Œçš„æ¨¡å‹</span><br>linear = nn.Linear(2,1)<br><span class="hljs-builtin-name">print</span>(next(linear.parameters()).device)<br><br>model = nn.DataParallel(linear)<br><span class="hljs-builtin-name">print</span>(model.device_ids)<br><span class="hljs-builtin-name">print</span>(next(model.module.parameters()).device) <br><br><span class="hljs-comment">#æ³¨æ„ä¿å­˜å‚æ•°æ—¶è¦æŒ‡å®šä¿å­˜model.moduleçš„å‚æ•°</span><br>torch.save(model.module.state_dict(), <span class="hljs-string">&quot;model_parameter.pkl&quot;</span>) <br><br>linear = nn.Linear(2,1)<br>linear.load_state_dict(torch.load(<span class="hljs-string">&quot;model_parameter.pkl&quot;</span>)) <br><br><br><span class="hljs-comment"># 5ï¼Œæ¸…ç©ºcudaç¼“å­˜</span><br><br><span class="hljs-comment"># è¯¥æ–¹æ³•åœ¨cudaè¶…å†…å­˜æ—¶ååˆ†æœ‰ç”¨</span><br>torch.cuda.empty_cache()<br></code></pre></td></tr></table></figure><p>æ¬è¿è‡ªï¼š</p><ul><li><a href="https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1">https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorchå­¦ä¹ ç¬”è®°12-è®­ç»ƒæ¨¡å‹çš„3ç§æ–¹æ³•</title>
    <link href="/2022/02/07/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B012-%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E7%9A%843%E7%A7%8D%E6%96%B9%E6%B3%95/"/>
    <url>/2022/02/07/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B012-%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B%E7%9A%843%E7%A7%8D%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><h4 id="ã€‡ï¼Œå‡†å¤‡æ•°æ®"><a href="#ã€‡ï¼Œå‡†å¤‡æ•°æ®" class="headerlink" title="ã€‡ï¼Œå‡†å¤‡æ•°æ®"></a>ã€‡ï¼Œå‡†å¤‡æ•°æ®</h4><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs routeros">import torch <br><span class="hljs-keyword">from</span> torch import nn <br><span class="hljs-keyword">from</span> torchkeras import summary,Model <br><br>import torchvision <br><span class="hljs-keyword">from</span> torchvision import transforms<br><br>transform = transforms.Compose([transforms.ToTensor()])<br><br>ds_train = torchvision.datasets.MNIST(<span class="hljs-attribute">root</span>=<span class="hljs-string">&quot;/home/kesci/input/data6936/data/minist/&quot;</span>,train=True,download=True,transform=transform)<br>ds_valid = torchvision.datasets.MNIST(<span class="hljs-attribute">root</span>=<span class="hljs-string">&quot;/home/kesci/input/data6936/data/minist/&quot;</span>,train=False,download=True,transform=transform)<br><br>dl_train =  torch.utils.data.DataLoader(ds_train, <span class="hljs-attribute">batch_size</span>=128, <span class="hljs-attribute">shuffle</span>=<span class="hljs-literal">True</span>, <span class="hljs-attribute">num_workers</span>=4)<br>dl_valid =  torch.utils.data.DataLoader(ds_valid, <span class="hljs-attribute">batch_size</span>=128, <span class="hljs-attribute">shuffle</span>=<span class="hljs-literal">False</span>, <span class="hljs-attribute">num_workers</span>=4)<br><br><span class="hljs-builtin-name">print</span>(len(ds_train))<br><span class="hljs-builtin-name">print</span>(len(ds_valid))<br></code></pre></td></tr></table></figure><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sas"><span class="hljs-name">%matplotlib</span> inline<br><span class="hljs-name">%config</span> InlineBackend.figure_format = <span class="hljs-string">&#x27;svg&#x27;</span><br><br>#æŸ¥çœ‹éƒ¨åˆ†æ ·æœ¬<br><span class="hljs-meta">from</span> matplotlib import pyplot <span class="hljs-meta">as</span> plt <br><br>plt.figure(figsize=(8,8)) <br>for i <span class="hljs-meta">in</span><span class="hljs-meta"> range(</span>9):<br>    img,<span class="hljs-meta">label</span> = ds_train[i]<br>    img = torch.squeeze(img)<br>    ax=plt.subplot(3,3,i+1)<br>    ax.imshow(img.numpy())<br>    ax.set_title(<span class="hljs-string">&quot;label = %d&quot;</span><span class="hljs-built_in">%label</span>)<br>    ax.set_xticks([])<br>    ax.set_yticks([]) <br>plt.show()<br></code></pre></td></tr></table></figure><h4 id="ä¸€ï¼Œè„šæœ¬é£æ ¼"><a href="#ä¸€ï¼Œè„šæœ¬é£æ ¼" class="headerlink" title="ä¸€ï¼Œè„šæœ¬é£æ ¼"></a>ä¸€ï¼Œè„šæœ¬é£æ ¼</h4><p>è„šæœ¬é£æ ¼çš„è®­ç»ƒå¾ªç¯æœ€ä¸ºå¸¸è§ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">net = nn.<span class="hljs-constructor">Sequential()</span><br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;conv1&quot;</span>,<span class="hljs-params">nn</span>.Conv2d(<span class="hljs-params">in_channels</span>=1,<span class="hljs-params">out_channels</span>=32,<span class="hljs-params">kernel_size</span> = 3)</span>)<br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;pool1&quot;</span>,<span class="hljs-params">nn</span>.MaxPool2d(<span class="hljs-params">kernel_size</span> = 2,<span class="hljs-params">stride</span> = 2)</span>)<br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;conv2&quot;</span>,<span class="hljs-params">nn</span>.Conv2d(<span class="hljs-params">in_channels</span>=32,<span class="hljs-params">out_channels</span>=64,<span class="hljs-params">kernel_size</span> = 5)</span>)<br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;pool2&quot;</span>,<span class="hljs-params">nn</span>.MaxPool2d(<span class="hljs-params">kernel_size</span> = 2,<span class="hljs-params">stride</span> = 2)</span>)<br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;dropout&quot;</span>,<span class="hljs-params">nn</span>.Dropout2d(<span class="hljs-params">p</span> = 0.1)</span>)<br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;adaptive_pool&quot;</span>,<span class="hljs-params">nn</span>.AdaptiveMaxPool2d((1,1)</span>))<br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;flatten&quot;</span>,<span class="hljs-params">nn</span>.Flatten()</span>)<br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;linear1&quot;</span>,<span class="hljs-params">nn</span>.Linear(64,32)</span>)<br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;relu&quot;</span>,<span class="hljs-params">nn</span>.ReLU()</span>)<br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;linear2&quot;</span>,<span class="hljs-params">nn</span>.Linear(32,10)</span>)<br><br>print(net)<br></code></pre></td></tr></table></figure><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np <br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd <br><span class="hljs-title">from</span> sklearn.metrics <span class="hljs-keyword">import</span> accuracy_score<br><br><span class="hljs-title">def</span> accuracy(y_pred,y_true):<br>    y_pred_cls = torch.argmax(nn.<span class="hljs-type">Softmax</span>(dim=<span class="hljs-number">1</span>)(y_pred),dim=<span class="hljs-number">1</span>).<span class="hljs-class"><span class="hljs-keyword">data</span></span><br>    return accuracy_score(y_true,y_pred_cls)<br><br><span class="hljs-title">loss_func</span> = nn.<span class="hljs-type">CrossEntropyLoss</span>()<br><span class="hljs-title">optimizer</span> = torch.optim.<span class="hljs-type">Adam</span>(params=net.parameters(),lr = <span class="hljs-number">0.01</span>)<br><span class="hljs-title">metric_func</span> = accuracy<br><span class="hljs-title">metric_name</span> = <span class="hljs-string">&quot;accuracy&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs maxima">epochs = <span class="hljs-number">3</span><br>log_step_freq = <span class="hljs-number">100</span><br><br>dfhistory = pd.DataFrame(<span class="hljs-built_in">columns</span> = [<span class="hljs-string">&quot;epoch&quot;</span>,<span class="hljs-string">&quot;loss&quot;</span>,metric_name,<span class="hljs-string">&quot;val_loss&quot;</span>,<span class="hljs-string">&quot;val_&quot;</span>+metric_name]) <br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Start Training...&quot;</span>)<br>nowtime = datetime.datetime.now().strftime(&#x27;%Y-<span class="hljs-built_in">%m</span>-%d %H:%M:%S&#x27;)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;==========&quot;</span>*<span class="hljs-number">8</span> + <span class="hljs-string">&quot;%s&quot;</span>%nowtime)<br><br><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,epochs+<span class="hljs-number">1</span>):  <br><br>    # <span class="hljs-number">1</span>ï¼Œè®­ç»ƒå¾ªç¯-------------------------------------------------<br>    net.train()<br>    loss_sum = <span class="hljs-number">0.0</span><br>    metric_sum = <span class="hljs-number">0.0</span><br>    <span class="hljs-keyword">step</span> = <span class="hljs-number">1</span><br>    <br>    <span class="hljs-keyword">for</span> <span class="hljs-keyword">step</span>, (<span class="hljs-built_in">features</span>,<span class="hljs-built_in">labels</span>) <span class="hljs-keyword">in</span> enumerate(dl_train, <span class="hljs-number">1</span>):<br>    <br>        # æ¢¯åº¦æ¸…é›¶<br>        optimizer.zero_grad()<br><br>        # æ­£å‘ä¼ æ’­æ±‚æŸå¤±<br>        predictions = net(<span class="hljs-built_in">features</span>)<br>        loss = loss_func(predictions,<span class="hljs-built_in">labels</span>)<br>        metric = metric_func(predictions,<span class="hljs-built_in">labels</span>)<br>        <br>        # åå‘ä¼ æ’­æ±‚æ¢¯åº¦<br>        loss.backward()<br>        optimizer.<span class="hljs-keyword">step</span>()<br><br>        # æ‰“å°<span class="hljs-built_in">batch</span>çº§åˆ«æ—¥å¿—<br>        loss_sum += loss.item()<br>        metric_sum += metric.item()<br>        <span class="hljs-keyword">if</span> step%log_step_freq == <span class="hljs-number">0</span>:   <br>            <span class="hljs-built_in">print</span>((<span class="hljs-string">&quot;[step = %d] loss: %.3f, &quot;</span>+metric_name+<span class="hljs-string">&quot;: %.3f&quot;</span>) <span class="hljs-symbol">%</span><br>                  (<span class="hljs-keyword">step</span>, loss_sum/<span class="hljs-keyword">step</span>, metric_sum/<span class="hljs-keyword">step</span>))<br>            <br>    # <span class="hljs-number">2</span>ï¼ŒéªŒè¯å¾ªç¯-------------------------------------------------<br>    net.<span class="hljs-built_in">eval</span>()<br>    val_loss_sum = <span class="hljs-number">0.0</span><br>    val_metric_sum = <span class="hljs-number">0.0</span><br>    val_step = <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">for</span> val_step, (<span class="hljs-built_in">features</span>,<span class="hljs-built_in">labels</span>) <span class="hljs-keyword">in</span> enumerate(dl_valid, <span class="hljs-number">1</span>):<br>        with torch.no_grad():<br>            predictions = net(<span class="hljs-built_in">features</span>)<br>            val_loss = loss_func(predictions,<span class="hljs-built_in">labels</span>)<br>            val_metric = metric_func(predictions,<span class="hljs-built_in">labels</span>)<br><br>        val_loss_sum += val_loss.item()<br>        val_metric_sum += val_metric.item()<br><br>    # <span class="hljs-number">3</span>ï¼Œè®°å½•æ—¥å¿—-------------------------------------------------<br>    info = (epoch, loss_sum/<span class="hljs-keyword">step</span>, metric_sum/<span class="hljs-keyword">step</span>, <br>            val_loss_sum/val_step, val_metric_sum/val_step)<br>    dfhistory.loc[epoch-<span class="hljs-number">1</span>] = info<br>    <br>    # æ‰“å°epochçº§åˆ«æ—¥å¿—<br>    <span class="hljs-built_in">print</span>((<span class="hljs-string">&quot;\nEPOCH = %d, loss = %.3f,&quot;</span>+ metric_name + \<br>          <span class="hljs-string">&quot;  = %.3f, val_loss = %.3f, &quot;</span>+<span class="hljs-string">&quot;val_&quot;</span>+ metric_name+<span class="hljs-string">&quot; = %.3f&quot;</span>) <br>          %info)<br>    nowtime = datetime.datetime.now().strftime(&#x27;%Y-<span class="hljs-built_in">%m</span>-%d %H:%M:%S&#x27;)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\n&quot;</span>+<span class="hljs-string">&quot;==========&quot;</span>*<span class="hljs-number">8</span> + <span class="hljs-string">&quot;%s&quot;</span>%nowtime)<br>        <br><span class="hljs-built_in">print</span>(&#x27;Finished Training...&#x27;)<br></code></pre></td></tr></table></figure><h4 id="äºŒï¼Œå‡½æ•°é£æ ¼"><a href="#äºŒï¼Œå‡½æ•°é£æ ¼" class="headerlink" title="äºŒï¼Œå‡½æ•°é£æ ¼"></a>äºŒï¼Œå‡½æ•°é£æ ¼</h4><p>è¯¥é£æ ¼åœ¨è„šæœ¬å½¢å¼ä¸Šä½œäº†ç®€å•çš„å‡½æ•°å°è£…ã€‚</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-type">Net</span>(<span class="hljs-title">nn</span>.<span class="hljs-type">Module</span>):</span><br><span class="hljs-class">    def __init__(<span class="hljs-title">self</span>):</span><br><span class="hljs-class">        super(<span class="hljs-type">Net</span>, <span class="hljs-title">self</span>).__init__()</span><br><span class="hljs-class">        self.layers = nn.<span class="hljs-type">ModuleList</span>([</span><br><span class="hljs-class">            <span class="hljs-title">nn</span>.<span class="hljs-type">Conv2d</span>(<span class="hljs-title">in_channels</span>=1,<span class="hljs-title">out_channels</span>=32,<span class="hljs-title">kernel_size</span> = 3),</span><br><span class="hljs-class">            nn.<span class="hljs-type">MaxPool2d</span>(<span class="hljs-title">kernel_size</span> = 2,<span class="hljs-title">stride</span> = 2),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Conv2d</span>(<span class="hljs-title">in_channels</span>=32,<span class="hljs-title">out_channels</span>=64,<span class="hljs-title">kernel_size</span> = 5),</span><br><span class="hljs-class">            nn.<span class="hljs-type">MaxPool2d</span>(<span class="hljs-title">kernel_size</span> = 2,<span class="hljs-title">stride</span> = 2),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Dropout2d</span>(<span class="hljs-title">p</span> = 0.1),</span><br><span class="hljs-class">            nn.<span class="hljs-type">AdaptiveMaxPool2d</span>((1,1)),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Flatten</span>(),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Linear</span>(64,32),</span><br><span class="hljs-class">            nn.<span class="hljs-type">ReLU</span>(),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Linear</span>(32,10)]</span><br><span class="hljs-class">        )</span><br><span class="hljs-class">    def forward(<span class="hljs-title">self</span>,<span class="hljs-title">x</span>):</span><br><span class="hljs-class">        for layer in self.layers:</span><br><span class="hljs-class">            x = layer(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        return x</span><br><span class="hljs-class">net = <span class="hljs-type">Net</span>()</span><br><span class="hljs-class">print(<span class="hljs-title">net</span>)</span><br></code></pre></td></tr></table></figure><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np <br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd <br><span class="hljs-title">from</span> sklearn.metrics <span class="hljs-keyword">import</span> accuracy_score<br><br><span class="hljs-title">def</span> accuracy(y_pred,y_true):<br>    y_pred_cls = torch.argmax(nn.<span class="hljs-type">Softmax</span>(dim=<span class="hljs-number">1</span>)(y_pred),dim=<span class="hljs-number">1</span>).<span class="hljs-class"><span class="hljs-keyword">data</span></span><br>    return accuracy_score(y_true,y_pred_cls)<br><br><span class="hljs-title">model</span> = net<br><span class="hljs-title">model</span>.optimizer = torch.optim.<span class="hljs-type">SGD</span>(model.parameters(),lr = <span class="hljs-number">0.01</span>)<br><span class="hljs-title">model</span>.loss_func = nn.<span class="hljs-type">CrossEntropyLoss</span>()<br><span class="hljs-title">model</span>.metric_func = accuracy<br><span class="hljs-title">model</span>.metric_name = <span class="hljs-string">&quot;accuracy&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">def train<span class="hljs-constructor">_step(<span class="hljs-params">model</span>,<span class="hljs-params">features</span>,<span class="hljs-params">labels</span>)</span>:<br>    <br>    # è®­ç»ƒæ¨¡å¼ï¼Œdropoutå±‚å‘ç”Ÿä½œç”¨<br>    model.train<span class="hljs-literal">()</span><br>    <br>    # æ¢¯åº¦æ¸…é›¶<br>    model.optimizer.zero<span class="hljs-constructor">_grad()</span><br>    <br>    # æ­£å‘ä¼ æ’­æ±‚æŸå¤±<br>    predictions = model(features)<br>    loss = model.loss<span class="hljs-constructor">_func(<span class="hljs-params">predictions</span>,<span class="hljs-params">labels</span>)</span><br>    metric = model.metric<span class="hljs-constructor">_func(<span class="hljs-params">predictions</span>,<span class="hljs-params">labels</span>)</span><br><br>    # åå‘ä¼ æ’­æ±‚æ¢¯åº¦<br>    loss.backward<span class="hljs-literal">()</span><br>    model.optimizer.step<span class="hljs-literal">()</span><br><br>    return loss.item<span class="hljs-literal">()</span>,metric.item<span class="hljs-literal">()</span><br><br>@torch.no<span class="hljs-constructor">_grad()</span><br>def valid<span class="hljs-constructor">_step(<span class="hljs-params">model</span>,<span class="hljs-params">features</span>,<span class="hljs-params">labels</span>)</span>:<br>    <br>    # é¢„æµ‹æ¨¡å¼ï¼Œdropoutå±‚ä¸å‘ç”Ÿä½œç”¨<br>    model.eval<span class="hljs-literal">()</span><br>    <br>    predictions = model(features)<br>    loss = model.loss<span class="hljs-constructor">_func(<span class="hljs-params">predictions</span>,<span class="hljs-params">labels</span>)</span><br>    metric = model.metric<span class="hljs-constructor">_func(<span class="hljs-params">predictions</span>,<span class="hljs-params">labels</span>)</span><br>    <br>    return loss.item<span class="hljs-literal">()</span>, metric.item<span class="hljs-literal">()</span><br><br><br># æµ‹è¯•train_stepæ•ˆæœ<br>features,labels = next(iter(dl_train))<br>train<span class="hljs-constructor">_step(<span class="hljs-params">model</span>,<span class="hljs-params">features</span>,<span class="hljs-params">labels</span>)</span><br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs routeros">def train_model(model,epochs,dl_train,dl_valid,log_step_freq):<br><br>    metric_name = model.metric_name<br>    dfhistory = pd.DataFrame(columns = [<span class="hljs-string">&quot;epoch&quot;</span>,<span class="hljs-string">&quot;loss&quot;</span>,metric_name,<span class="hljs-string">&quot;val_loss&quot;</span>,<span class="hljs-string">&quot;val_&quot;</span>+metric_name]) <br>    <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;Start Training...&quot;</span>)<br>    nowtime = datetime.datetime.now().strftime(<span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)<br>    <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;==========&quot;</span><span class="hljs-number">*8</span> + <span class="hljs-string">&quot;%s&quot;</span>%nowtime)<br><br>    <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> range(1,epochs+1):  <br><br>        # 1ï¼Œè®­ç»ƒå¾ªç¯-------------------------------------------------<br>        loss_sum = 0.0<br>        metric_sum = 0.0<br>        <span class="hljs-keyword">step</span> = 1<br><br>        <span class="hljs-keyword">for</span> <span class="hljs-keyword">step</span>, (features,labels) <span class="hljs-keyword">in</span> enumerate(dl_train, 1):<br><br>            loss,metric = train_step(model,features,labels)<br><br>            # æ‰“å°batchçº§åˆ«æ—¥å¿—<br>            loss_sum += loss<br>            metric_sum += metric<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">step</span>%log_step_freq == 0:   <br>                <span class="hljs-builtin-name">print</span>((<span class="hljs-string">&quot;[step = %d] loss: %.3f, &quot;</span>+metric_name+<span class="hljs-string">&quot;: %.3f&quot;</span>) %<br>                      (<span class="hljs-keyword">step</span>, loss_sum/<span class="hljs-keyword">step</span>, metric_sum/<span class="hljs-keyword">step</span>))<br><br>        # 2ï¼ŒéªŒè¯å¾ªç¯-------------------------------------------------<br>        val_loss_sum = 0.0<br>        val_metric_sum = 0.0<br>        val_step = 1<br><br>        <span class="hljs-keyword">for</span> val_step, (features,labels) <span class="hljs-keyword">in</span> enumerate(dl_valid, 1):<br><br>            val_loss,val_metric = valid_step(model,features,labels)<br><br>            val_loss_sum += val_loss<br>            val_metric_sum += val_metric<br><br>        # 3ï¼Œè®°å½•æ—¥å¿—-------------------------------------------------<br>        <span class="hljs-builtin-name">info</span> = (epoch, loss_sum/<span class="hljs-keyword">step</span>, metric_sum/<span class="hljs-keyword">step</span>, <br>                val_loss_sum/val_step, val_metric_sum/val_step)<br>        dfhistory.loc[epoch-1] = <span class="hljs-builtin-name">info</span><br><br>        # æ‰“å°epochçº§åˆ«æ—¥å¿—<br>        <span class="hljs-builtin-name">print</span>((<span class="hljs-string">&quot;\nEPOCH = %d, loss = %.3f,&quot;</span>+ metric_name + \<br>              <span class="hljs-string">&quot;  = %.3f, val_loss = %.3f, &quot;</span>+<span class="hljs-string">&quot;val_&quot;</span>+ metric_name+<span class="hljs-string">&quot; = %.3f&quot;</span>) <br>              %info)<br>        nowtime = datetime.datetime.now().strftime(<span class="hljs-string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)<br>        <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;\n&quot;</span>+<span class="hljs-string">&quot;==========&quot;</span><span class="hljs-number">*8</span> + <span class="hljs-string">&quot;%s&quot;</span>%nowtime)<br><br>    <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&#x27;Finished Training...&#x27;</span>)<br>    return dfhistory<br></code></pre></td></tr></table></figure><h4 id="ä¸‰ï¼Œç±»é£æ ¼"><a href="#ä¸‰ï¼Œç±»é£æ ¼" class="headerlink" title="ä¸‰ï¼Œç±»é£æ ¼"></a>ä¸‰ï¼Œç±»é£æ ¼</h4><p>æ­¤å¤„ä½¿ç”¨torchkerasä¸­å®šä¹‰çš„æ¨¡å‹æ¥å£æ„å»ºæ¨¡å‹ï¼Œå¹¶è°ƒç”¨compileæ–¹æ³•å’Œfitæ–¹æ³•è®­ç»ƒæ¨¡å‹ã€‚</p><p>ä½¿ç”¨è¯¥å½¢å¼è®­ç»ƒæ¨¡å‹éå¸¸ç®€æ´æ˜äº†ã€‚æ¨èä½¿ç”¨è¯¥å½¢å¼ã€‚</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-keyword">import</span> torchkeras <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-type">CnnModel</span>(<span class="hljs-title">nn</span>.<span class="hljs-type">Module</span>):</span><br><span class="hljs-class">    def __init__(<span class="hljs-title">self</span>):</span><br><span class="hljs-class">        super().__init__()</span><br><span class="hljs-class">        self.layers = nn.<span class="hljs-type">ModuleList</span>([</span><br><span class="hljs-class">            <span class="hljs-title">nn</span>.<span class="hljs-type">Conv2d</span>(<span class="hljs-title">in_channels</span>=1,<span class="hljs-title">out_channels</span>=32,<span class="hljs-title">kernel_size</span> = 3),</span><br><span class="hljs-class">            nn.<span class="hljs-type">MaxPool2d</span>(<span class="hljs-title">kernel_size</span> = 2,<span class="hljs-title">stride</span> = 2),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Conv2d</span>(<span class="hljs-title">in_channels</span>=32,<span class="hljs-title">out_channels</span>=64,<span class="hljs-title">kernel_size</span> = 5),</span><br><span class="hljs-class">            nn.<span class="hljs-type">MaxPool2d</span>(<span class="hljs-title">kernel_size</span> = 2,<span class="hljs-title">stride</span> = 2),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Dropout2d</span>(<span class="hljs-title">p</span> = 0.1),</span><br><span class="hljs-class">            nn.<span class="hljs-type">AdaptiveMaxPool2d</span>((1,1)),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Flatten</span>(),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Linear</span>(64,32),</span><br><span class="hljs-class">            nn.<span class="hljs-type">ReLU</span>(),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Linear</span>(32,10)]</span><br><span class="hljs-class">        )</span><br><span class="hljs-class">    def forward(<span class="hljs-title">self</span>,<span class="hljs-title">x</span>):</span><br><span class="hljs-class">        for layer in self.layers:</span><br><span class="hljs-class">            x = layer(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        return x</span><br><span class="hljs-class">model = torchkeras.<span class="hljs-type">Model</span>(<span class="hljs-type">CnnModel</span>())</span><br><span class="hljs-class">print(<span class="hljs-title">model</span>)</span><br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">from</span> sklearn<span class="hljs-selector-class">.metrics</span> import accuracy_score<br><br>def accuracy(y_pred,y_true):<br>    y_pred_cls = torch.<span class="hljs-built_in">argmax</span>(nn.<span class="hljs-built_in">Softmax</span>(dim=<span class="hljs-number">1</span>)(y_pred),dim=<span class="hljs-number">1</span>).data<br>    return <span class="hljs-built_in">accuracy_score</span>(y_true.<span class="hljs-built_in">numpy</span>(),y_pred_cls.<span class="hljs-built_in">numpy</span>())<br><br>model.<span class="hljs-built_in">compile</span>(loss_func = nn.<span class="hljs-built_in">CrossEntropyLoss</span>(),<br>             optimizer= torch.optim.<span class="hljs-built_in">Adam</span>(model.<span class="hljs-built_in">parameters</span>(),lr = <span class="hljs-number">0.02</span>),<br>             metrics_dict=&#123;<span class="hljs-string">&quot;accuracy&quot;</span>:accuracy&#125;)<br></code></pre></td></tr></table></figure><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-attr">dfhistory</span> = model.fit(<span class="hljs-number">3</span>,<span class="hljs-attr">dl_train</span> = dl_train, <span class="hljs-attr">dl_val=dl_valid,</span> <span class="hljs-attr">log_step_freq=100)</span> <br></code></pre></td></tr></table></figure><p>æ¬è¿è‡ªï¼š</p><ul><li><a href="https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1">https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorchå­¦ä¹ ç¬”è®°11-æ„å»ºæ¨¡å‹çš„3ç§æ–¹æ³•</title>
    <link href="/2022/02/07/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B011-%E6%9E%84%E5%BB%BA%E6%A8%A1%E5%9E%8B%E7%9A%843%E7%A7%8D%E6%96%B9%E6%B3%95/"/>
    <url>/2022/02/07/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B011-%E6%9E%84%E5%BB%BA%E6%A8%A1%E5%9E%8B%E7%9A%843%E7%A7%8D%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹3ç§æ–¹å¼æ„å»ºæ¨¡å‹ï¼š</p><ul><li><p>1ï¼Œç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºè‡ªå®šä¹‰æ¨¡å‹ã€‚</p></li><li><p>2ï¼Œä½¿ç”¨nn.SequentialæŒ‰å±‚é¡ºåºæ„å»ºæ¨¡å‹ã€‚</p></li><li><p>3ï¼Œç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºæ¨¡å‹å¹¶è¾…åŠ©åº”ç”¨æ¨¡å‹å®¹å™¨è¿›è¡Œå°è£…(nn.Sequential,nn.ModuleList,nn.ModuleDict)ã€‚</p></li></ul><p>å…¶ä¸­ ç¬¬1ç§æ–¹å¼æœ€ä¸ºå¸¸è§ï¼Œç¬¬2ç§æ–¹å¼æœ€ç®€å•ï¼Œç¬¬3ç§æ–¹å¼æœ€ä¸ºçµæ´»ä¹Ÿè¾ƒä¸ºå¤æ‚ã€‚</p><p>æ¨èä½¿ç”¨ç¬¬1ç§æ–¹å¼æ„å»ºæ¨¡å‹ã€‚</p><h4 id="ä¸€ï¼Œç»§æ‰¿nn-ModuleåŸºç±»æ„å»ºè‡ªå®šä¹‰æ¨¡å‹"><a href="#ä¸€ï¼Œç»§æ‰¿nn-ModuleåŸºç±»æ„å»ºè‡ªå®šä¹‰æ¨¡å‹" class="headerlink" title="ä¸€ï¼Œç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºè‡ªå®šä¹‰æ¨¡å‹"></a>ä¸€ï¼Œç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºè‡ªå®šä¹‰æ¨¡å‹</h4><p>ä»¥ä¸‹æ˜¯ç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºè‡ªå®šä¹‰æ¨¡å‹çš„ä¸€ä¸ªèŒƒä¾‹ã€‚æ¨¡å‹ä¸­çš„ç”¨åˆ°çš„å±‚ä¸€èˆ¬åœ¨__init__å‡½æ•°ä¸­å®šä¹‰ï¼Œç„¶ååœ¨forwardæ–¹æ³•ä¸­å®šä¹‰æ¨¡å‹çš„æ­£å‘ä¼ æ’­é€»è¾‘ã€‚</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-keyword">import</span> torch <br><span class="hljs-title">from</span> torch <span class="hljs-keyword">import</span> nn<br><span class="hljs-title">from</span> torchkeras <span class="hljs-keyword">import</span> summary<br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-type">Net</span>(<span class="hljs-title">nn</span>.<span class="hljs-type">Module</span>):</span><br><span class="hljs-class">    </span><br><span class="hljs-class">    def __init__(<span class="hljs-title">self</span>):</span><br><span class="hljs-class">        super(<span class="hljs-type">Net</span>, <span class="hljs-title">self</span>).__init__()</span><br><span class="hljs-class">        self.conv1 = nn.<span class="hljs-type">Conv2d</span>(<span class="hljs-title">in_channels</span>=3,<span class="hljs-title">out_channels</span>=32,<span class="hljs-title">kernel_size</span> = 3)</span><br><span class="hljs-class">        self.pool1 = nn.<span class="hljs-type">MaxPool2d</span>(<span class="hljs-title">kernel_size</span> = 2,<span class="hljs-title">stride</span> = 2)</span><br><span class="hljs-class">        self.conv2 = nn.<span class="hljs-type">Conv2d</span>(<span class="hljs-title">in_channels</span>=32,<span class="hljs-title">out_channels</span>=64,<span class="hljs-title">kernel_size</span> = 5)</span><br><span class="hljs-class">        self.pool2 = nn.<span class="hljs-type">MaxPool2d</span>(<span class="hljs-title">kernel_size</span> = 2,<span class="hljs-title">stride</span> = 2)</span><br><span class="hljs-class">        self.dropout = nn.<span class="hljs-type">Dropout2d</span>(<span class="hljs-title">p</span> = 0.1)</span><br><span class="hljs-class">        self.adaptive_pool = nn.<span class="hljs-type">AdaptiveMaxPool2d</span>((1,1))</span><br><span class="hljs-class">        self.flatten = nn.<span class="hljs-type">Flatten</span>()</span><br><span class="hljs-class">        self.linear1 = nn.<span class="hljs-type">Linear</span>(64,32)</span><br><span class="hljs-class">        self.relu = nn.<span class="hljs-type">ReLU</span>()</span><br><span class="hljs-class">        self.linear2 = nn.<span class="hljs-type">Linear</span>(32,1)</span><br><span class="hljs-class">        self.sigmoid = nn.<span class="hljs-type">Sigmoid</span>()</span><br><span class="hljs-class">        </span><br><span class="hljs-class">    def forward(<span class="hljs-title">self</span>,<span class="hljs-title">x</span>):</span><br><span class="hljs-class">        x = self.conv1(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        x = self.pool1(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        x = self.conv2(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        x = self.pool2(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        x = self.dropout(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        x = self.adaptive_pool(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        x = self.flatten(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        x = self.linear1(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        x = self.relu(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        x = self.linear2(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        y = self.sigmoid(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        return y</span><br><span class="hljs-class">        </span><br><span class="hljs-class">net = <span class="hljs-type">Net</span>()</span><br><span class="hljs-class">print(<span class="hljs-title">net</span>)</span><br></code></pre></td></tr></table></figure><h4 id="äºŒï¼Œä½¿ç”¨nn-SequentialæŒ‰å±‚é¡ºåºæ„å»ºæ¨¡å‹"><a href="#äºŒï¼Œä½¿ç”¨nn-SequentialæŒ‰å±‚é¡ºåºæ„å»ºæ¨¡å‹" class="headerlink" title="äºŒï¼Œä½¿ç”¨nn.SequentialæŒ‰å±‚é¡ºåºæ„å»ºæ¨¡å‹"></a>äºŒï¼Œä½¿ç”¨nn.SequentialæŒ‰å±‚é¡ºåºæ„å»ºæ¨¡å‹</h4><p>ä½¿ç”¨nn.SequentialæŒ‰å±‚é¡ºåºæ„å»ºæ¨¡å‹æ— éœ€å®šä¹‰forwardæ–¹æ³•ã€‚ä»…ä»…é€‚åˆäºç®€å•çš„æ¨¡å‹ã€‚</p><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨nn.Sequentialæ­å»ºæ¨¡å‹çš„ä¸€äº›ç­‰ä»·æ–¹æ³•ã€‚</p><h5 id="1ï¼Œåˆ©ç”¨add-moduleæ–¹æ³•"><a href="#1ï¼Œåˆ©ç”¨add-moduleæ–¹æ³•" class="headerlink" title="1ï¼Œåˆ©ç”¨add_moduleæ–¹æ³•"></a>1ï¼Œåˆ©ç”¨add_moduleæ–¹æ³•</h5><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">net = nn.<span class="hljs-constructor">Sequential()</span><br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;conv1&quot;</span>,<span class="hljs-params">nn</span>.Conv2d(<span class="hljs-params">in_channels</span>=3,<span class="hljs-params">out_channels</span>=32,<span class="hljs-params">kernel_size</span> = 3)</span>)<br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;pool1&quot;</span>,<span class="hljs-params">nn</span>.MaxPool2d(<span class="hljs-params">kernel_size</span> = 2,<span class="hljs-params">stride</span> = 2)</span>)<br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;conv2&quot;</span>,<span class="hljs-params">nn</span>.Conv2d(<span class="hljs-params">in_channels</span>=32,<span class="hljs-params">out_channels</span>=64,<span class="hljs-params">kernel_size</span> = 5)</span>)<br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;pool2&quot;</span>,<span class="hljs-params">nn</span>.MaxPool2d(<span class="hljs-params">kernel_size</span> = 2,<span class="hljs-params">stride</span> = 2)</span>)<br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;dropout&quot;</span>,<span class="hljs-params">nn</span>.Dropout2d(<span class="hljs-params">p</span> = 0.1)</span>)<br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;adaptive_pool&quot;</span>,<span class="hljs-params">nn</span>.AdaptiveMaxPool2d((1,1)</span>))<br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;flatten&quot;</span>,<span class="hljs-params">nn</span>.Flatten()</span>)<br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;linear1&quot;</span>,<span class="hljs-params">nn</span>.Linear(64,32)</span>)<br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;relu&quot;</span>,<span class="hljs-params">nn</span>.ReLU()</span>)<br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;linear2&quot;</span>,<span class="hljs-params">nn</span>.Linear(32,1)</span>)<br>net.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;sigmoid&quot;</span>,<span class="hljs-params">nn</span>.Sigmoid()</span>)<br><br>print(net)<br></code></pre></td></tr></table></figure><h5 id="2ï¼Œåˆ©ç”¨å˜é•¿å‚æ•°"><a href="#2ï¼Œåˆ©ç”¨å˜é•¿å‚æ•°" class="headerlink" title="2ï¼Œåˆ©ç”¨å˜é•¿å‚æ•°"></a>2ï¼Œåˆ©ç”¨å˜é•¿å‚æ•°</h5><p>è¿™ç§æ–¹å¼æ„å»ºæ—¶ä¸èƒ½ç»™æ¯ä¸ªå±‚æŒ‡å®šåç§°ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs stylus">net = nn<span class="hljs-selector-class">.Sequential</span>(<br>    nn<span class="hljs-selector-class">.Conv2d</span>(in_channels=<span class="hljs-number">3</span>,out_channels=<span class="hljs-number">32</span>,kernel_size = <span class="hljs-number">3</span>),<br>    nn<span class="hljs-selector-class">.MaxPool2d</span>(kernel_size = <span class="hljs-number">2</span>,stride = <span class="hljs-number">2</span>),<br>    nn<span class="hljs-selector-class">.Conv2d</span>(in_channels=<span class="hljs-number">32</span>,out_channels=<span class="hljs-number">64</span>,kernel_size = <span class="hljs-number">5</span>),<br>    nn<span class="hljs-selector-class">.MaxPool2d</span>(kernel_size = <span class="hljs-number">2</span>,stride = <span class="hljs-number">2</span>),<br>    nn<span class="hljs-selector-class">.Dropout2d</span>(<span class="hljs-selector-tag">p</span> = <span class="hljs-number">0.1</span>),<br>    nn<span class="hljs-selector-class">.AdaptiveMaxPool2d</span>((<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)),<br>    nn<span class="hljs-selector-class">.Flatten</span>(),<br>    nn<span class="hljs-selector-class">.Linear</span>(<span class="hljs-number">64</span>,<span class="hljs-number">32</span>),<br>    nn<span class="hljs-selector-class">.ReLU</span>(),<br>    nn<span class="hljs-selector-class">.Linear</span>(<span class="hljs-number">32</span>,<span class="hljs-number">1</span>),<br>    nn<span class="hljs-selector-class">.Sigmoid</span>()<br>)<br><br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(net)</span></span><br></code></pre></td></tr></table></figure><h5 id="3ï¼Œåˆ©ç”¨OrderedDict"><a href="#3ï¼Œåˆ©ç”¨OrderedDict" class="headerlink" title="3ï¼Œåˆ©ç”¨OrderedDict"></a>3ï¼Œåˆ©ç”¨OrderedDict</h5><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs vim">from collections import OrderedDict<br><br>net = <span class="hljs-keyword">nn</span>.Sequential(OrderedDict(<br>          [(<span class="hljs-string">&quot;conv1&quot;</span>,<span class="hljs-keyword">nn</span>.Conv2d(in_channels=<span class="hljs-number">3</span>,out_channels=<span class="hljs-number">32</span>,kernel_size = <span class="hljs-number">3</span>)),<br>            (<span class="hljs-string">&quot;pool1&quot;</span>,<span class="hljs-keyword">nn</span>.MaxPool2d(kernel_size = <span class="hljs-number">2</span>,stride = <span class="hljs-number">2</span>)),<br>            (<span class="hljs-string">&quot;conv2&quot;</span>,<span class="hljs-keyword">nn</span>.Conv2d(in_channels=<span class="hljs-number">32</span>,out_channels=<span class="hljs-number">64</span>,kernel_size = <span class="hljs-number">5</span>)),<br>            (<span class="hljs-string">&quot;pool2&quot;</span>,<span class="hljs-keyword">nn</span>.MaxPool2d(kernel_size = <span class="hljs-number">2</span>,stride = <span class="hljs-number">2</span>)),<br>            (<span class="hljs-string">&quot;dropout&quot;</span>,<span class="hljs-keyword">nn</span>.Dropout2d(<span class="hljs-keyword">p</span> = <span class="hljs-number">0.1</span>)),<br>            (<span class="hljs-string">&quot;adaptive_pool&quot;</span>,<span class="hljs-keyword">nn</span>.AdaptiveMaxPool2d((<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))),<br>            (<span class="hljs-string">&quot;flatten&quot;</span>,<span class="hljs-keyword">nn</span>.Flatten()),<br>            (<span class="hljs-string">&quot;linear1&quot;</span>,<span class="hljs-keyword">nn</span>.Linear(<span class="hljs-number">64</span>,<span class="hljs-number">32</span>)),<br>            (<span class="hljs-string">&quot;relu&quot;</span>,<span class="hljs-keyword">nn</span>.ReLU()),<br>            (<span class="hljs-string">&quot;linear2&quot;</span>,<span class="hljs-keyword">nn</span>.Linear(<span class="hljs-number">32</span>,<span class="hljs-number">1</span>)),<br>            (<span class="hljs-string">&quot;sigmoid&quot;</span>,<span class="hljs-keyword">nn</span>.Sigmoid())<br>          ])<br>        )<br><span class="hljs-keyword">print</span>(net)<br></code></pre></td></tr></table></figure><h4 id="ä¸‰ï¼Œç»§æ‰¿nn-ModuleåŸºç±»æ„å»ºæ¨¡å‹å¹¶è¾…åŠ©åº”ç”¨æ¨¡å‹å®¹å™¨è¿›è¡Œå°è£…"><a href="#ä¸‰ï¼Œç»§æ‰¿nn-ModuleåŸºç±»æ„å»ºæ¨¡å‹å¹¶è¾…åŠ©åº”ç”¨æ¨¡å‹å®¹å™¨è¿›è¡Œå°è£…" class="headerlink" title="ä¸‰ï¼Œç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºæ¨¡å‹å¹¶è¾…åŠ©åº”ç”¨æ¨¡å‹å®¹å™¨è¿›è¡Œå°è£…"></a>ä¸‰ï¼Œç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºæ¨¡å‹å¹¶è¾…åŠ©åº”ç”¨æ¨¡å‹å®¹å™¨è¿›è¡Œå°è£…</h4><p>å½“æ¨¡å‹çš„ç»“æ„æ¯”è¾ƒå¤æ‚æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åº”ç”¨æ¨¡å‹å®¹å™¨(nn.Sequential,nn.ModuleList,nn.ModuleDict)å¯¹æ¨¡å‹çš„éƒ¨åˆ†ç»“æ„è¿›è¡Œå°è£…ã€‚</p><p>è¿™æ ·åšä¼šè®©æ¨¡å‹æ•´ä½“æ›´åŠ æœ‰å±‚æ¬¡æ„Ÿï¼Œæœ‰æ—¶å€™ä¹Ÿèƒ½å‡å°‘ä»£ç é‡ã€‚</p><p>æ³¨æ„ï¼Œåœ¨ä¸‹é¢çš„èŒƒä¾‹ä¸­æˆ‘ä»¬æ¯æ¬¡ä»…ä»…ä½¿ç”¨ä¸€ç§æ¨¡å‹å®¹å™¨ï¼Œä½†å®é™…ä¸Šè¿™äº›æ¨¡å‹å®¹å™¨çš„ä½¿ç”¨æ˜¯éå¸¸çµæ´»çš„ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªæ¨¡å‹ä¸­ä»»æ„ç»„åˆä»»æ„åµŒå¥—ä½¿ç”¨ã€‚</p><h5 id="1ï¼Œnn-Sequentialä½œä¸ºæ¨¡å‹å®¹å™¨"><a href="#1ï¼Œnn-Sequentialä½œä¸ºæ¨¡å‹å®¹å™¨" class="headerlink" title="1ï¼Œnn.Sequentialä½œä¸ºæ¨¡å‹å®¹å™¨"></a>1ï¼Œnn.Sequentialä½œä¸ºæ¨¡å‹å®¹å™¨</h5><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-type">Net</span>(<span class="hljs-title">nn</span>.<span class="hljs-type">Module</span>):</span><br><span class="hljs-class">    </span><br><span class="hljs-class">    def __init__(<span class="hljs-title">self</span>):</span><br><span class="hljs-class">        super(<span class="hljs-type">Net</span>, <span class="hljs-title">self</span>).__init__()</span><br><span class="hljs-class">        self.conv = nn.<span class="hljs-type">Sequential</span>(</span><br><span class="hljs-class">            <span class="hljs-title">nn</span>.<span class="hljs-type">Conv2d</span>(<span class="hljs-title">in_channels</span>=3,<span class="hljs-title">out_channels</span>=32,<span class="hljs-title">kernel_size</span> = 3),</span><br><span class="hljs-class">            nn.<span class="hljs-type">MaxPool2d</span>(<span class="hljs-title">kernel_size</span> = 2,<span class="hljs-title">stride</span> = 2),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Conv2d</span>(<span class="hljs-title">in_channels</span>=32,<span class="hljs-title">out_channels</span>=64,<span class="hljs-title">kernel_size</span> = 5),</span><br><span class="hljs-class">            nn.<span class="hljs-type">MaxPool2d</span>(<span class="hljs-title">kernel_size</span> = 2,<span class="hljs-title">stride</span> = 2),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Dropout2d</span>(<span class="hljs-title">p</span> = 0.1),</span><br><span class="hljs-class">            nn.<span class="hljs-type">AdaptiveMaxPool2d</span>((1,1))</span><br><span class="hljs-class">        )</span><br><span class="hljs-class">        self.dense = nn.<span class="hljs-type">Sequential</span>(</span><br><span class="hljs-class">            <span class="hljs-title">nn</span>.<span class="hljs-type">Flatten</span>(),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Linear</span>(64,32),</span><br><span class="hljs-class">            nn.<span class="hljs-type">ReLU</span>(),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Linear</span>(32,1),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Sigmoid</span>()</span><br><span class="hljs-class">        )</span><br><span class="hljs-class">    def forward(<span class="hljs-title">self</span>,<span class="hljs-title">x</span>):</span><br><span class="hljs-class">        x = self.conv(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        y = self.dense(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        return y </span><br><span class="hljs-class">    </span><br><span class="hljs-class">net = <span class="hljs-type">Net</span>()</span><br><span class="hljs-class">print(<span class="hljs-title">net</span>)</span><br></code></pre></td></tr></table></figure><h5 id="2ï¼Œnn-ModuleListä½œä¸ºæ¨¡å‹å®¹å™¨"><a href="#2ï¼Œnn-ModuleListä½œä¸ºæ¨¡å‹å®¹å™¨" class="headerlink" title="2ï¼Œnn.ModuleListä½œä¸ºæ¨¡å‹å®¹å™¨"></a>2ï¼Œnn.ModuleListä½œä¸ºæ¨¡å‹å®¹å™¨</h5><p>æ³¨æ„ä¸‹é¢ä¸­çš„ModuleListä¸èƒ½ç”¨Pythonä¸­çš„åˆ—è¡¨ä»£æ›¿ã€‚</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-type">Net</span>(<span class="hljs-title">nn</span>.<span class="hljs-type">Module</span>):</span><br><span class="hljs-class">    </span><br><span class="hljs-class">    def __init__(<span class="hljs-title">self</span>):</span><br><span class="hljs-class">        super(<span class="hljs-type">Net</span>, <span class="hljs-title">self</span>).__init__()</span><br><span class="hljs-class">        self.layers = nn.<span class="hljs-type">ModuleList</span>([</span><br><span class="hljs-class">            <span class="hljs-title">nn</span>.<span class="hljs-type">Conv2d</span>(<span class="hljs-title">in_channels</span>=3,<span class="hljs-title">out_channels</span>=32,<span class="hljs-title">kernel_size</span> = 3),</span><br><span class="hljs-class">            nn.<span class="hljs-type">MaxPool2d</span>(<span class="hljs-title">kernel_size</span> = 2,<span class="hljs-title">stride</span> = 2),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Conv2d</span>(<span class="hljs-title">in_channels</span>=32,<span class="hljs-title">out_channels</span>=64,<span class="hljs-title">kernel_size</span> = 5),</span><br><span class="hljs-class">            nn.<span class="hljs-type">MaxPool2d</span>(<span class="hljs-title">kernel_size</span> = 2,<span class="hljs-title">stride</span> = 2),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Dropout2d</span>(<span class="hljs-title">p</span> = 0.1),</span><br><span class="hljs-class">            nn.<span class="hljs-type">AdaptiveMaxPool2d</span>((1,1)),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Flatten</span>(),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Linear</span>(64,32),</span><br><span class="hljs-class">            nn.<span class="hljs-type">ReLU</span>(),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Linear</span>(32,1),</span><br><span class="hljs-class">            nn.<span class="hljs-type">Sigmoid</span>()]</span><br><span class="hljs-class">        )</span><br><span class="hljs-class">    def forward(<span class="hljs-title">self</span>,<span class="hljs-title">x</span>):</span><br><span class="hljs-class">        for layer in self.layers:</span><br><span class="hljs-class">            x = layer(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        return x</span><br><span class="hljs-class">net = <span class="hljs-type">Net</span>()</span><br><span class="hljs-class">print(<span class="hljs-title">net</span>)</span><br></code></pre></td></tr></table></figure><h5 id="3ï¼Œnn-ModuleDictä½œä¸ºæ¨¡å‹å®¹å™¨"><a href="#3ï¼Œnn-ModuleDictä½œä¸ºæ¨¡å‹å®¹å™¨" class="headerlink" title="3ï¼Œnn.ModuleDictä½œä¸ºæ¨¡å‹å®¹å™¨"></a>3ï¼Œnn.ModuleDictä½œä¸ºæ¨¡å‹å®¹å™¨</h5><p>æ³¨æ„ä¸‹é¢ä¸­çš„ModuleDictä¸èƒ½ç”¨Pythonä¸­çš„å­—å…¸ä»£æ›¿ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs css">class Net(nn<span class="hljs-selector-class">.Module</span>):<br>    <br>    def <span class="hljs-built_in">__init__</span>(self):<br>        <span class="hljs-built_in">super</span>(Net, self).<span class="hljs-built_in">__init__</span>()<br>        self.layers_dict = nn.<span class="hljs-built_in">ModuleDict</span>(&#123;<span class="hljs-string">&quot;conv1&quot;</span>:nn.<span class="hljs-built_in">Conv2d</span>(in_channels=<span class="hljs-number">3</span>,out_channels=<span class="hljs-number">32</span>,kernel_size = <span class="hljs-number">3</span>),<br>               <span class="hljs-string">&quot;pool&quot;</span>: nn.<span class="hljs-built_in">MaxPool2d</span>(kernel_size = <span class="hljs-number">2</span>,stride = <span class="hljs-number">2</span>),<br>               <span class="hljs-string">&quot;conv2&quot;</span>:nn.<span class="hljs-built_in">Conv2d</span>(in_channels=<span class="hljs-number">32</span>,out_channels=<span class="hljs-number">64</span>,kernel_size = <span class="hljs-number">5</span>),<br>               <span class="hljs-string">&quot;dropout&quot;</span>: nn.<span class="hljs-built_in">Dropout2d</span>(p = <span class="hljs-number">0.1</span>),<br>               <span class="hljs-string">&quot;adaptive&quot;</span>:nn.<span class="hljs-built_in">AdaptiveMaxPool2d</span>((<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)),<br>               <span class="hljs-string">&quot;flatten&quot;</span>: nn.<span class="hljs-built_in">Flatten</span>(),<br>               <span class="hljs-string">&quot;linear1&quot;</span>: nn.<span class="hljs-built_in">Linear</span>(<span class="hljs-number">64</span>,<span class="hljs-number">32</span>),<br>               <span class="hljs-string">&quot;relu&quot;</span>:nn.<span class="hljs-built_in">ReLU</span>(),<br>               <span class="hljs-string">&quot;linear2&quot;</span>: nn.<span class="hljs-built_in">Linear</span>(<span class="hljs-number">32</span>,<span class="hljs-number">1</span>),<br>               <span class="hljs-string">&quot;sigmoid&quot;</span>: nn.<span class="hljs-built_in">Sigmoid</span>()<br>              &#125;)<br>    def forward(self,x):<br>        layers = [<span class="hljs-string">&quot;conv1&quot;</span>,<span class="hljs-string">&quot;pool&quot;</span>,<span class="hljs-string">&quot;conv2&quot;</span>,<span class="hljs-string">&quot;pool&quot;</span>,<span class="hljs-string">&quot;dropout&quot;</span>,<span class="hljs-string">&quot;adaptive&quot;</span>,<br>                  <span class="hljs-string">&quot;flatten&quot;</span>,<span class="hljs-string">&quot;linear1&quot;</span>,<span class="hljs-string">&quot;relu&quot;</span>,<span class="hljs-string">&quot;linear2&quot;</span>,<span class="hljs-string">&quot;sigmoid&quot;</span>]<br>        for layer in layers:<br>            x = self.layers_dict[layer](x)<br>        return x<br>net = <span class="hljs-built_in">Net</span>()<br><span class="hljs-built_in">print</span>(net)<br></code></pre></td></tr></table></figure><p>æ¬è¿è‡ªï¼š</p><ul><li><a href="https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1">https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorchå­¦ä¹ ç¬”è®°10-TensorBoardå¯è§†åŒ–</title>
    <link href="/2022/01/29/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B010-TensorBoard%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    <url>/2022/01/29/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B010-TensorBoard%E5%8F%AF%E8%A7%86%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><p>Pytorchä¸­åˆ©ç”¨TensorBoardå¯è§†åŒ–çš„å¤§æ¦‚è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆåœ¨Pytorchä¸­æŒ‡å®šä¸€ä¸ªç›®å½•åˆ›å»ºä¸€ä¸ªtorch.utils.tensorboard.SummaryWriteræ—¥å¿—å†™å…¥å™¨ã€‚</p><p>ç„¶åæ ¹æ®éœ€è¦å¯è§†åŒ–çš„ä¿¡æ¯ï¼Œåˆ©ç”¨æ—¥å¿—å†™å…¥å™¨å°†ç›¸åº”ä¿¡æ¯æ—¥å¿—å†™å…¥æˆ‘ä»¬æŒ‡å®šçš„ç›®å½•ã€‚</p><p>æœ€åå°±å¯ä»¥ä¼ å…¥æ—¥å¿—ç›®å½•ä½œä¸ºå‚æ•°å¯åŠ¨TensorBoardï¼Œç„¶åå°±å¯ä»¥åœ¨TensorBoardä¸­æ„‰å¿«åœ°çœ‹ç‰‡äº†ã€‚</p><p>æˆ‘ä»¬ä¸»è¦ä»‹ç»Pytorchä¸­åˆ©ç”¨TensorBoardè¿›è¡Œå¦‚ä¸‹æ–¹é¢ä¿¡æ¯çš„å¯è§†åŒ–çš„æ–¹æ³•ã€‚</p><ul><li><p>å¯è§†åŒ–æ¨¡å‹ç»“æ„ï¼š writer.add_graph</p></li><li><p>å¯è§†åŒ–æŒ‡æ ‡å˜åŒ–ï¼š writer.add_scalar</p></li><li><p>å¯è§†åŒ–å‚æ•°åˆ†å¸ƒï¼š writer.add_histogram</p></li><li><p>å¯è§†åŒ–åŸå§‹å›¾åƒï¼š writer.add_image æˆ– writer.add_images</p></li><li><p>å¯è§†åŒ–äººå·¥ç»˜å›¾ï¼š writer.add_figure</p></li></ul><h4 id="å¯è§†åŒ–æ¨¡å‹ç»“æ„"><a href="#å¯è§†åŒ–æ¨¡å‹ç»“æ„" class="headerlink" title="å¯è§†åŒ–æ¨¡å‹ç»“æ„"></a>å¯è§†åŒ–æ¨¡å‹ç»“æ„</h4><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-keyword">import</span> torch <br><span class="hljs-title">from</span> torch <span class="hljs-keyword">import</span> nn<br><span class="hljs-title">from</span> torch.utils.tensorboard <span class="hljs-keyword">import</span> SummaryWriter<br><span class="hljs-title">from</span> torchkeras <span class="hljs-keyword">import</span> Model,summary<br><span class="hljs-class"></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-type">Net</span>(<span class="hljs-title">nn</span>.<span class="hljs-type">Module</span>):</span><br><span class="hljs-class">    </span><br><span class="hljs-class">    def __init__(<span class="hljs-title">self</span>):</span><br><span class="hljs-class">        super(<span class="hljs-type">Net</span>, <span class="hljs-title">self</span>).__init__()</span><br><span class="hljs-class">        self.conv1 = nn.<span class="hljs-type">Conv2d</span>(<span class="hljs-title">in_channels</span>=3,<span class="hljs-title">out_channels</span>=32,<span class="hljs-title">kernel_size</span> = 3)</span><br><span class="hljs-class">        self.pool = nn.<span class="hljs-type">MaxPool2d</span>(<span class="hljs-title">kernel_size</span> = 2,<span class="hljs-title">stride</span> = 2)</span><br><span class="hljs-class">        self.conv2 = nn.<span class="hljs-type">Conv2d</span>(<span class="hljs-title">in_channels</span>=32,<span class="hljs-title">out_channels</span>=64,<span class="hljs-title">kernel_size</span> = 5)</span><br><span class="hljs-class">        self.dropout = nn.<span class="hljs-type">Dropout2d</span>(<span class="hljs-title">p</span> = 0.1)</span><br><span class="hljs-class">        self.adaptive_pool = nn.<span class="hljs-type">AdaptiveMaxPool2d</span>((1,1))</span><br><span class="hljs-class">        self.flatten = nn.<span class="hljs-type">Flatten</span>()</span><br><span class="hljs-class">        self.linear1 = nn.<span class="hljs-type">Linear</span>(64,32)</span><br><span class="hljs-class">        self.relu = nn.<span class="hljs-type">ReLU</span>()</span><br><span class="hljs-class">        self.linear2 = nn.<span class="hljs-type">Linear</span>(32,1)</span><br><span class="hljs-class">        self.sigmoid = nn.<span class="hljs-type">Sigmoid</span>()</span><br><span class="hljs-class">        </span><br><span class="hljs-class">    def forward(<span class="hljs-title">self</span>,<span class="hljs-title">x</span>):</span><br><span class="hljs-class">        x = self.conv1(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        x = self.pool(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        x = self.conv2(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        x = self.pool(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        x = self.dropout(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        x = self.adaptive_pool(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        x = self.flatten(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        x = self.linear1(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        x = self.relu(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        x = self.linear2(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        y = self.sigmoid(<span class="hljs-title">x</span>)</span><br><span class="hljs-class">        return y</span><br><span class="hljs-class">        </span><br><span class="hljs-class">net = <span class="hljs-type">Net</span>()</span><br><span class="hljs-class">print(<span class="hljs-title">net</span>)</span><br><span class="hljs-class"></span><br><span class="hljs-class">writer = <span class="hljs-type">SummaryWriter</span>(&#x27;./<span class="hljs-title">data</span>/<span class="hljs-title">tensorboard&#x27;</span>)</span><br><span class="hljs-class">writer.add_graph(<span class="hljs-title">net</span>,<span class="hljs-title">input_to_model</span> = <span class="hljs-title">torch</span>.<span class="hljs-title">rand</span>(1,3,32,32))</span><br><span class="hljs-class">writer.close()</span><br></code></pre></td></tr></table></figure><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cos"><span class="hljs-built_in">%load</span>_ext tensorboard<br>#<span class="hljs-built_in">%tensorboard</span> --logdir ./data/tensorboard<br></code></pre></td></tr></table></figure><figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs capnproto"><span class="hljs-keyword">from</span> tensorboard <span class="hljs-keyword">import</span> notebook<br><span class="hljs-comment">#æŸ¥çœ‹å¯åŠ¨çš„tensorboardç¨‹åº</span><br>notebook.list() <br></code></pre></td></tr></table></figure><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vala"><span class="hljs-meta">#å¯åŠ¨tensorboardç¨‹åº</span><br>notebook.start(<span class="hljs-string">&quot;--logdir ./data/tensorboard&quot;</span>)<br><span class="hljs-meta">#ç­‰ä»·äºåœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ tensorboard --logdir ./data/tensorboard</span><br><span class="hljs-meta">#å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:6006/ æŸ¥çœ‹</span><br></code></pre></td></tr></table></figure><h4 id="å¯è§†åŒ–æŒ‡æ ‡å˜åŒ–"><a href="#å¯è§†åŒ–æŒ‡æ ‡å˜åŒ–" class="headerlink" title="å¯è§†åŒ–æŒ‡æ ‡å˜åŒ–"></a>å¯è§†åŒ–æŒ‡æ ‡å˜åŒ–</h4><p>æœ‰æ—¶å€™åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œå¦‚æœèƒ½å¤Ÿå®æ—¶åŠ¨æ€åœ°æŸ¥çœ‹losså’Œå„ç§metricçš„å˜åŒ–æ›²çº¿ï¼Œé‚£ä¹ˆæ— ç–‘å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´åŠ ç›´è§‚åœ°äº†è§£æ¨¡å‹çš„è®­ç»ƒæƒ…å†µã€‚</p><p>æ³¨æ„ï¼Œwriter.add_scalarä»…èƒ½å¯¹æ ‡é‡çš„å€¼çš„å˜åŒ–è¿›è¡Œå¯è§†åŒ–ã€‚å› æ­¤å®ƒä¸€èˆ¬ç”¨äºå¯¹losså’Œmetricçš„å˜åŒ–è¿›è¡Œå¯è§†åŒ–åˆ†æã€‚</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-built_in">import</span> numpy as np <br><span class="hljs-built_in">import</span> torch <br>from torch.utils.tensorboard <span class="hljs-built_in">import</span> SummaryWriter<br><br><span class="hljs-comment"># f(x) = a*x**2 + b*x + cçš„æœ€å°å€¼</span><br><span class="hljs-attr">x</span> = torch.tensor(<span class="hljs-number">0.0</span>,<span class="hljs-attr">requires_grad</span> = True) <span class="hljs-comment"># xéœ€è¦è¢«æ±‚å¯¼</span><br><span class="hljs-attr">a</span> = torch.tensor(<span class="hljs-number">1.0</span>)<br><span class="hljs-attr">b</span> = torch.tensor(-<span class="hljs-number">2.0</span>)<br><span class="hljs-attr">c</span> = torch.tensor(<span class="hljs-number">1.0</span>)<br><br><span class="hljs-attr">optimizer</span> = torch.optim.SGD(<span class="hljs-attr">params=[x],lr</span> = <span class="hljs-number">0.01</span>)<br><br><br>def f(x):<br>    <span class="hljs-attr">result</span> = a*torch.pow(x,<span class="hljs-number">2</span>) + b*x + c <br>    return(result)<br><br><span class="hljs-attr">writer</span> = SummaryWriter(&#x27;./data/tensorboard&#x27;)<br>for i <span class="hljs-keyword">in</span> range(<span class="hljs-number">500</span>):<br>    optimizer.zero_grad()<br>    <span class="hljs-attr">y</span> = f(x)<br>    y.backward()<br>    optimizer.step()<br>    writer.add_scalar(<span class="hljs-string">&quot;x&quot;</span>,x.item(),i) <span class="hljs-comment">#æ—¥å¿—ä¸­è®°å½•xåœ¨ç¬¬step i çš„å€¼</span><br>    writer.add_scalar(<span class="hljs-string">&quot;y&quot;</span>,y.item(),i) <span class="hljs-comment">#æ—¥å¿—ä¸­è®°å½•yåœ¨ç¬¬step i çš„å€¼</span><br><br>writer.close()<br>    <br>print(<span class="hljs-string">&quot;y=&quot;</span>,f(x).data,<span class="hljs-string">&quot;;&quot;</span>,<span class="hljs-string">&quot;x=&quot;</span>,x.data)<br></code></pre></td></tr></table></figure><h4 id="å¯è§†åŒ–å‚æ•°åˆ†å¸ƒ"><a href="#å¯è§†åŒ–å‚æ•°åˆ†å¸ƒ" class="headerlink" title="å¯è§†åŒ–å‚æ•°åˆ†å¸ƒ"></a>å¯è§†åŒ–å‚æ•°åˆ†å¸ƒ</h4><p>å¦‚æœéœ€è¦å¯¹æ¨¡å‹çš„å‚æ•°(ä¸€èˆ¬éæ ‡é‡)åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­çš„å˜åŒ–è¿›è¡Œå¯è§†åŒ–ï¼Œå¯ä»¥ä½¿ç”¨ writer.add_histogramã€‚</p><p>å®ƒèƒ½å¤Ÿè§‚æµ‹å¼ é‡å€¼åˆ†å¸ƒçš„ç›´æ–¹å›¾éšè®­ç»ƒæ­¥éª¤çš„å˜åŒ–è¶‹åŠ¿ã€‚</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs maxima">import numpy as <span class="hljs-built_in">np</span> <br>import torch <br>from torch.utils.tensorboard import SummaryWriter<br><br># åˆ›å»ºæ­£æ€åˆ†å¸ƒçš„å¼ é‡æ¨¡æ‹Ÿå‚æ•°çŸ©é˜µ<br>def norm(<span class="hljs-built_in">mean</span>,<span class="hljs-built_in">std</span>):<br>    t = <span class="hljs-built_in">std</span>*torch.randn((<span class="hljs-number">100</span>,<span class="hljs-number">20</span>))+<span class="hljs-built_in">mean</span><br>    <span class="hljs-built_in">return</span> t<br><br>writer = SummaryWriter(&#x27;./data/tensorboard&#x27;)<br><span class="hljs-keyword">for</span> <span class="hljs-keyword">step</span>,<span class="hljs-built_in">mean</span> <span class="hljs-keyword">in</span> enumerate(<span class="hljs-built_in">range</span>(-<span class="hljs-number">10</span>,<span class="hljs-number">10</span>,<span class="hljs-number">1</span>)):<br>    w = norm(<span class="hljs-built_in">mean</span>,<span class="hljs-number">1</span>)<br>    writer.add_histogram(<span class="hljs-string">&quot;w&quot;</span>,w, <span class="hljs-keyword">step</span>)<br>    writer.<span class="hljs-built_in">flush</span>()<br>writer.<span class="hljs-built_in">close</span>()<br></code></pre></td></tr></table></figure><h4 id="å¯è§†åŒ–åŸå§‹å›¾åƒ"><a href="#å¯è§†åŒ–åŸå§‹å›¾åƒ" class="headerlink" title="å¯è§†åŒ–åŸå§‹å›¾åƒ"></a>å¯è§†åŒ–åŸå§‹å›¾åƒ</h4><p>å¦‚æœæˆ‘ä»¬åšå›¾åƒç›¸å…³çš„ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥å°†åŸå§‹çš„å›¾ç‰‡åœ¨tensorboardä¸­è¿›è¡Œå¯è§†åŒ–å±•ç¤ºã€‚</p><p>å¦‚æœåªå†™å…¥ä¸€å¼ å›¾ç‰‡ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨writer.add_imageã€‚</p><p>å¦‚æœè¦å†™å…¥å¤šå¼ å›¾ç‰‡ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨writer.add_imagesã€‚</p><p>ä¹Ÿå¯ä»¥ç”¨ torchvision.utils.make_gridå°†å¤šå¼ å›¾ç‰‡æ‹¼æˆä¸€å¼ å›¾ç‰‡ï¼Œç„¶åç”¨writer.add_imageå†™å…¥ã€‚</p><p>æ³¨æ„ï¼Œä¼ å…¥çš„æ˜¯ä»£è¡¨å›¾ç‰‡ä¿¡æ¯çš„Pytorchä¸­çš„å¼ é‡æ•°æ®ã€‚</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torchvision<br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn<br><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> Dataset,DataLoader<br><span class="hljs-keyword">from</span> torchvision <span class="hljs-keyword">import</span> transforms,datasets <br><br><br>transform_train = transforms.Compose(<br><span class="hljs-string">    [transforms.ToTensor()]</span>)<br>transform_valid = transforms.Compose(<br><span class="hljs-string">    [transforms.ToTensor()]</span>)<br></code></pre></td></tr></table></figure><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-attr">ds_train</span> = datasets.ImageFolder(<span class="hljs-string">&quot;/home/kesci/input/data6936/data/cifar2/train/&quot;</span>,<br>            <span class="hljs-attr">transform</span> = transform_train,<span class="hljs-attr">target_transform=</span> lambda t:torch.tensor([t]).float())<br><span class="hljs-attr">ds_valid</span> = datasets.ImageFolder(<span class="hljs-string">&quot;/home/kesci/input/data6936/data/cifar2/test/&quot;</span>,<br>            <span class="hljs-attr">transform</span> = transform_train,<span class="hljs-attr">target_transform=</span> lambda t:torch.tensor([t]).float())<br><br>print(ds_train.class_to_idx)<br><br><span class="hljs-attr">dl_train</span> = DataLoader(ds_train,<span class="hljs-attr">batch_size</span> = <span class="hljs-number">50</span>,<span class="hljs-attr">shuffle</span> = True,<span class="hljs-attr">num_workers=3)</span><br><span class="hljs-attr">dl_valid</span> = DataLoader(ds_valid,<span class="hljs-attr">batch_size</span> = <span class="hljs-number">50</span>,<span class="hljs-attr">shuffle</span> = True,<span class="hljs-attr">num_workers=3)</span><br><br><span class="hljs-attr">dl_train_iter</span> = iter(dl_train)<br>images, <span class="hljs-attr">labels</span> = dl_train_iter.next()<br><br><span class="hljs-comment"># ä»…æŸ¥çœ‹ä¸€å¼ å›¾ç‰‡</span><br><span class="hljs-attr">writer</span> = SummaryWriter(&#x27;/home/kesci/input/data6936/data/tensorboard&#x27;)<br>writer.add_image(&#x27;images[<span class="hljs-number">0</span>]&#x27;, images[<span class="hljs-number">0</span>])<br>writer.close()<br><br><span class="hljs-comment"># å°†å¤šå¼ å›¾ç‰‡æ‹¼æ¥æˆä¸€å¼ å›¾ç‰‡ï¼Œä¸­é—´ç”¨é»‘è‰²ç½‘æ ¼åˆ†å‰²</span><br><span class="hljs-attr">writer</span> = SummaryWriter(&#x27;/home/kesci/input/data6936/data/tensorboard&#x27;)<br><span class="hljs-comment"># create grid of images</span><br><span class="hljs-attr">img_grid</span> = torchvision.utils.make_grid(images)<br>writer.add_image(&#x27;image_grid&#x27;, img_grid)<br>writer.close()<br><br><span class="hljs-comment"># å°†å¤šå¼ å›¾ç‰‡ç›´æ¥å†™å…¥</span><br><span class="hljs-attr">writer</span> = SummaryWriter(&#x27;/home/kesci/input/data6936/data/tensorboard&#x27;)<br>writer.add_images(<span class="hljs-string">&quot;images&quot;</span>,images,<span class="hljs-attr">global_step</span> = <span class="hljs-number">0</span>)<br>writer.close()<br></code></pre></td></tr></table></figure><h4 id="å¯è§†åŒ–äººå·¥ç»˜å›¾"><a href="#å¯è§†åŒ–äººå·¥ç»˜å›¾" class="headerlink" title="å¯è§†åŒ–äººå·¥ç»˜å›¾"></a>å¯è§†åŒ–äººå·¥ç»˜å›¾</h4><p>å¦‚æœæˆ‘ä»¬å°†matplotlibç»˜å›¾çš„ç»“æœå† tensorboardä¸­å±•ç¤ºï¼Œå¯ä»¥ä½¿ç”¨ add_figure.</p><p>æ³¨æ„ï¼Œå’Œwriter.add_imageä¸åŒçš„æ˜¯ï¼Œwriter.add_figureéœ€è¦ä¼ å…¥matplotlibçš„figureå¯¹è±¡ã€‚</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-built_in">import</span> torch<br><span class="hljs-built_in">import</span> torchvision<br>from torch <span class="hljs-built_in">import</span> nn<br>from torch.utils.data <span class="hljs-built_in">import</span> Dataset,DataLoader<br>from torchvision <span class="hljs-built_in">import</span> transforms,datasets <br><br><br><span class="hljs-attr">transform_train</span> = transforms.Compose(<br>    [transforms.ToTensor()])<br><span class="hljs-attr">transform_valid</span> = transforms.Compose(<br>    [transforms.ToTensor()])<br><br><span class="hljs-attr">ds_train</span> = datasets.ImageFolder(<span class="hljs-string">&quot;/home/kesci/input/data6936/data/cifar2/train/&quot;</span>,<br>            <span class="hljs-attr">transform</span> = transform_train,<span class="hljs-attr">target_transform=</span> lambda t:torch.tensor([t]).float())<br><span class="hljs-attr">ds_valid</span> = datasets.ImageFolder(<span class="hljs-string">&quot;/home/kesci/input/data6936/data/cifar2/test/&quot;</span>,<br>            <span class="hljs-attr">transform</span> = transform_train,<span class="hljs-attr">target_transform=</span> lambda t:torch.tensor([t]).float())<br><br>print(ds_train.class_to_idx)<br></code></pre></td></tr></table></figure><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">%matplotlib inline<br>%config <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">InlineBackend</span>.</span></span>figure_format = &#x27;svg&#x27;<br>from matplotlib import pyplot <span class="hljs-keyword">as</span> plt <br><br>figure = plt.figure(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">8</span>)) <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">9</span>):<br>    img,label = ds_train<span class="hljs-literal">[<span class="hljs-identifier">i</span>]</span><br>    img = img.permute(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>)<br>    ax=plt.subplot(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,i+<span class="hljs-number">1</span>)<br>    ax.imshow(img.numpy<span class="hljs-literal">()</span>)<br>    ax.set<span class="hljs-constructor">_title(<span class="hljs-string">&quot;label = %d&quot;</span>%<span class="hljs-params">label</span>.<span class="hljs-params">item</span>()</span>)<br>    ax.set<span class="hljs-constructor">_xticks([])</span><br>    ax.set<span class="hljs-constructor">_yticks([])</span> <br>plt.show<span class="hljs-literal">()</span><br><br>writer = <span class="hljs-constructor">SummaryWriter(&#x27;.<span class="hljs-operator">/</span><span class="hljs-params">data</span><span class="hljs-operator">/</span><span class="hljs-params">tensorboard</span>&#x27;)</span><br>writer.add<span class="hljs-constructor">_figure(&#x27;<span class="hljs-params">figure</span>&#x27;,<span class="hljs-params">figure</span>,<span class="hljs-params">global_step</span>=0)</span><br>writer.close<span class="hljs-literal">()</span><br></code></pre></td></tr></table></figure><p>æ¬è¿è‡ªï¼š</p><ul><li><a href="https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1">https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorchå­¦ä¹ ç¬”è®°9-æŸå¤±å‡½æ•°</title>
    <link href="/2022/01/27/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B09-%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/"/>
    <url>/2022/01/27/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B09-%E6%8D%9F%E5%A4%B1%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h2 id="å„ç§æŸå¤±å‡½æ•°"><a href="#å„ç§æŸå¤±å‡½æ•°" class="headerlink" title="å„ç§æŸå¤±å‡½æ•°"></a>å„ç§æŸå¤±å‡½æ•°</h2><span id="more"></span><p>ä¸€èˆ¬æ¥è¯´ï¼Œç›‘ç£å­¦ä¹ çš„ç›®æ ‡å‡½æ•°ç”±æŸå¤±å‡½æ•°å’Œæ­£åˆ™åŒ–é¡¹ç»„æˆã€‚(Objective = Loss + Regularization)</p><p>Pytorchä¸­çš„æŸå¤±å‡½æ•°ä¸€èˆ¬åœ¨è®­ç»ƒæ¨¡å‹æ—¶å€™æŒ‡å®šã€‚</p><p>æ³¨æ„Pytorchä¸­å†…ç½®çš„æŸå¤±å‡½æ•°çš„å‚æ•°å’Œtensorflowä¸åŒï¼Œæ˜¯y_predåœ¨å‰ï¼Œy_trueåœ¨åï¼Œè€ŒTensorflowæ˜¯y_trueåœ¨å‰ï¼Œy_predåœ¨åã€‚</p><ul><li><p>å¯¹äºå›å½’æ¨¡å‹ï¼Œé€šå¸¸ä½¿ç”¨çš„å†…ç½®æŸå¤±å‡½æ•°æ˜¯å‡æ–¹æŸå¤±å‡½æ•°nn.MSELoss ã€‚</p></li><li><p>å¯¹äºäºŒåˆ†ç±»æ¨¡å‹ï¼Œé€šå¸¸ä½¿ç”¨çš„æ˜¯äºŒå…ƒäº¤å‰ç†µæŸå¤±å‡½æ•°nn.BCELoss (è¾“å…¥å·²ç»æ˜¯sigmoidæ¿€æ´»å‡½æ•°ä¹‹åçš„ç»“æœ)æˆ–è€… nn.BCEWithLogitsLoss (è¾“å…¥å°šæœªç»è¿‡nn.Sigmoidæ¿€æ´»å‡½æ•°) ã€‚</p></li><li><p>å¯¹äºå¤šåˆ†ç±»æ¨¡å‹ï¼Œä¸€èˆ¬æ¨èä½¿ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•° nn.CrossEntropyLossã€‚(y_trueéœ€è¦æ˜¯ä¸€ç»´çš„ï¼Œæ˜¯ç±»åˆ«ç¼–ç ã€‚y_predæœªç»è¿‡nn.Softmaxæ¿€æ´»ã€‚)</p></li></ul><p>æ­¤å¤–ï¼Œå¦‚æœå¤šåˆ†ç±»çš„y_predç»è¿‡äº†nn.LogSoftmaxæ¿€æ´»ï¼Œå¯ä»¥ä½¿ç”¨nn.NLLLossæŸå¤±å‡½æ•°(The negative log likelihood loss)ã€‚<br>è¿™ç§æ–¹æ³•å’Œç›´æ¥ä½¿ç”¨nn.CrossEntropyLossç­‰ä»·ã€‚</p><p>å¦‚æœæœ‰éœ€è¦ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰æŸå¤±å‡½æ•°ï¼Œè‡ªå®šä¹‰æŸå¤±å‡½æ•°éœ€è¦æ¥æ”¶ä¸¤ä¸ªå¼ é‡y_predï¼Œy_trueä½œä¸ºè¾“å…¥å‚æ•°ï¼Œå¹¶è¾“å‡ºä¸€ä¸ªæ ‡é‡ä½œä¸ºæŸå¤±å‡½æ•°å€¼ã€‚</p><p>Pytorchä¸­çš„æ­£åˆ™åŒ–é¡¹ä¸€èˆ¬é€šè¿‡è‡ªå®šä¹‰çš„æ–¹å¼å’ŒæŸå¤±å‡½æ•°ä¸€èµ·æ·»åŠ ä½œä¸ºç›®æ ‡å‡½æ•°ã€‚</p><p>å¦‚æœä»…ä»…ä½¿ç”¨L2æ­£åˆ™åŒ–ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ä¼˜åŒ–å™¨çš„weight_decayå‚æ•°æ¥å®ç°ç›¸åŒçš„æ•ˆæœã€‚</p><h4 id="å†…ç½®æŸå¤±å‡½æ•°"><a href="#å†…ç½®æŸå¤±å‡½æ•°" class="headerlink" title="å†…ç½®æŸå¤±å‡½æ•°"></a>å†…ç½®æŸå¤±å‡½æ•°</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">import</span> numpy as np<br><span class="hljs-attribute">import</span> pandas as pd<br><span class="hljs-attribute">import</span> torch <br><span class="hljs-attribute">from</span> torch import nn <br><span class="hljs-attribute">import</span> torch.nn.functional as F <br><br><br><span class="hljs-attribute">y_pred</span> = torch.tensor([[<span class="hljs-number">10</span>.<span class="hljs-number">0</span>,<span class="hljs-number">0</span>.<span class="hljs-number">0</span>,-<span class="hljs-number">10</span>.<span class="hljs-number">0</span>],[<span class="hljs-number">8</span>.<span class="hljs-number">0</span>,<span class="hljs-number">8</span>.<span class="hljs-number">0</span>,<span class="hljs-number">8</span>.<span class="hljs-number">0</span>]])<br><span class="hljs-attribute">y_true</span> = torch.tensor([<span class="hljs-number">0</span>,<span class="hljs-number">2</span>])<br><br><span class="hljs-comment"># ç›´æ¥è°ƒç”¨äº¤å‰ç†µæŸå¤±</span><br><span class="hljs-attribute">ce</span> = nn.CrossEntropyLoss()(y_pred,y_true)<br><span class="hljs-attribute">print</span>(ce)<br><br><span class="hljs-comment"># ç­‰ä»·äºå…ˆè®¡ç®—nn.LogSoftmaxæ¿€æ´»ï¼Œå†è°ƒç”¨NLLLoss</span><br><span class="hljs-attribute">y_pred_logsoftmax</span> = nn.LogSoftmax(dim = <span class="hljs-number">1</span>)(y_pred)<br><span class="hljs-attribute">nll</span> = nn.NLLLoss()(y_pred_logsoftmax,y_true)<br><span class="hljs-attribute">print</span>(nll)<br></code></pre></td></tr></table></figure><p>å†…ç½®çš„æŸå¤±å‡½æ•°ä¸€èˆ¬æœ‰ç±»çš„å®ç°å’Œå‡½æ•°çš„å®ç°ä¸¤ç§å½¢å¼ã€‚</p><p>å¦‚ï¼šnn.BCE å’Œ F.binary_cross_entropy éƒ½æ˜¯äºŒå…ƒäº¤å‰ç†µæŸå¤±å‡½æ•°ï¼Œå‰è€…æ˜¯ç±»çš„å®ç°å½¢å¼ï¼Œåè€…æ˜¯å‡½æ•°çš„å®ç°å½¢å¼ã€‚</p><p>å®é™…ä¸Šç±»çš„å®ç°å½¢å¼é€šå¸¸æ˜¯è°ƒç”¨å‡½æ•°çš„å®ç°å½¢å¼å¹¶ç”¨nn.Moduleå°è£…åå¾—åˆ°çš„ã€‚</p><p>ä¸€èˆ¬æˆ‘ä»¬å¸¸ç”¨çš„æ˜¯ç±»çš„å®ç°å½¢å¼ã€‚å®ƒä»¬å°è£…åœ¨torch.nnæ¨¡å—ä¸‹ï¼Œå¹¶ä¸”ç±»åä»¥Lossç»“å°¾ã€‚</p><p>å¸¸ç”¨çš„ä¸€äº›å†…ç½®æŸå¤±å‡½æ•°è¯´æ˜å¦‚ä¸‹ã€‚</p><ul><li><p>nn.MSELossï¼ˆå‡æ–¹è¯¯å·®æŸå¤±ï¼Œä¹Ÿå«åšL2æŸå¤±ï¼Œç”¨äºå›å½’ï¼‰</p></li><li><p>nn.L1Loss ï¼ˆL1æŸå¤±ï¼Œä¹Ÿå«åšç»å¯¹å€¼è¯¯å·®æŸå¤±ï¼Œç”¨äºå›å½’ï¼‰</p></li><li><p>nn.SmoothL1Loss (å¹³æ»‘L1æŸå¤±ï¼Œå½“è¾“å…¥åœ¨-1åˆ°1ä¹‹é—´æ—¶ï¼Œå¹³æ»‘ä¸ºL2æŸå¤±ï¼Œç”¨äºå›å½’)</p></li><li><p>nn.BCELoss (äºŒå…ƒäº¤å‰ç†µï¼Œç”¨äºäºŒåˆ†ç±»ï¼Œè¾“å…¥å·²ç»è¿‡nn.Sigmoidæ¿€æ´»ï¼Œå¯¹ä¸å¹³è¡¡æ•°æ®é›†å¯ä»¥ç”¨weigthså‚æ•°è°ƒæ•´ç±»åˆ«æƒé‡)</p></li><li><p>nn.BCEWithLogitsLoss (äºŒå…ƒäº¤å‰ç†µï¼Œç”¨äºäºŒåˆ†ç±»ï¼Œè¾“å…¥æœªç»è¿‡nn.Sigmoidæ¿€æ´»)</p></li><li><p>nn.CrossEntropyLoss (äº¤å‰ç†µï¼Œç”¨äºå¤šåˆ†ç±»ï¼Œè¦æ±‚labelä¸ºç¨€ç–ç¼–ç ï¼Œè¾“å…¥æœªç»è¿‡nn.Softmaxæ¿€æ´»ï¼Œå¯¹ä¸å¹³è¡¡æ•°æ®é›†å¯ä»¥ç”¨weigthså‚æ•°è°ƒæ•´ç±»åˆ«æƒé‡)</p></li><li><p>nn.NLLLoss (è´Ÿå¯¹æ•°ä¼¼ç„¶æŸå¤±ï¼Œç”¨äºå¤šåˆ†ç±»ï¼Œè¦æ±‚labelä¸ºç¨€ç–ç¼–ç ï¼Œè¾“å…¥ç»è¿‡nn.LogSoftmaxæ¿€æ´»)</p></li><li><p>nn.CosineSimilarity(ä½™å¼¦ç›¸ä¼¼åº¦ï¼Œå¯ç”¨äºå¤šåˆ†ç±»)</p></li><li><p>nn.AdaptiveLogSoftmaxWithLoss (ä¸€ç§é€‚åˆéå¸¸å¤šç±»åˆ«ä¸”ç±»åˆ«åˆ†å¸ƒå¾ˆä¸å‡è¡¡çš„æŸå¤±å‡½æ•°ï¼Œä¼šè‡ªé€‚åº”åœ°å°†å¤šä¸ªå°ç±»åˆ«åˆæˆä¸€ä¸ªcluster)</p></li></ul><p>æ›´å¤šæŸå¤±å‡½æ•°çš„ä»‹ç»å‚è€ƒå¦‚ä¸‹çŸ¥ä¹æ–‡ç« ï¼š</p><p>ã€ŠPyTorchçš„åå…«ä¸ªæŸå¤±å‡½æ•°ã€‹</p><ul><li><a href="https://zhuanlan.zhihu.com/p/61379965">https://zhuanlan.zhihu.com/p/61379965</a></li></ul><h4 id="è‡ªå®šä¹‰æŸå¤±å‡½æ•°"><a href="#è‡ªå®šä¹‰æŸå¤±å‡½æ•°" class="headerlink" title="è‡ªå®šä¹‰æŸå¤±å‡½æ•°"></a>è‡ªå®šä¹‰æŸå¤±å‡½æ•°</h4><p>è‡ªå®šä¹‰æŸå¤±å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå¼ é‡y_pred,y_trueä½œä¸ºè¾“å…¥å‚æ•°ï¼Œå¹¶è¾“å‡ºä¸€ä¸ªæ ‡é‡ä½œä¸ºæŸå¤±å‡½æ•°å€¼ã€‚</p><p>ä¹Ÿå¯ä»¥å¯¹nn.Moduleè¿›è¡Œå­ç±»åŒ–ï¼Œé‡å†™forwardæ–¹æ³•å®ç°æŸå¤±çš„è®¡ç®—é€»è¾‘ï¼Œä»è€Œå¾—åˆ°æŸå¤±å‡½æ•°çš„ç±»çš„å®ç°ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªFocal Lossçš„è‡ªå®šä¹‰å®ç°ç¤ºèŒƒã€‚Focal Lossæ˜¯ä¸€ç§å¯¹binary_crossentropyçš„æ”¹è¿›æŸå¤±å‡½æ•°å½¢å¼ã€‚</p><p>å®ƒåœ¨æ ·æœ¬ä¸å‡è¡¡å’Œå­˜åœ¨è¾ƒå¤šæ˜“åˆ†ç±»çš„æ ·æœ¬æ—¶ç›¸æ¯”binary_crossentropyå…·æœ‰æ˜æ˜¾çš„ä¼˜åŠ¿ã€‚</p><p>å®ƒæœ‰ä¸¤ä¸ªå¯è°ƒå‚æ•°ï¼Œalphaå‚æ•°å’Œgammaå‚æ•°ã€‚å…¶ä¸­alphaå‚æ•°ä¸»è¦ç”¨äºè¡°å‡è´Ÿæ ·æœ¬çš„æƒé‡ï¼Œgammaå‚æ•°ä¸»è¦ç”¨äºè¡°å‡å®¹æ˜“è®­ç»ƒæ ·æœ¬çš„æƒé‡ã€‚</p><p>ä»è€Œè®©æ¨¡å‹æ›´åŠ èšç„¦åœ¨æ­£æ ·æœ¬å’Œå›°éš¾æ ·æœ¬ä¸Šã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™ä¸ªæŸå¤±å‡½æ•°å«åšFocal Lossã€‚</p><p>è¯¦è§ã€Š5åˆ†é’Ÿç†è§£Focal Lossä¸GHMâ€”â€”è§£å†³æ ·æœ¬ä¸å¹³è¡¡åˆ©å™¨ã€‹</p><ul><li><a href="https://zhuanlan.zhihu.com/p/80594704">https://zhuanlan.zhihu.com/p/80594704</a></li></ul><h4 id="è‡ªå®šä¹‰L1å’ŒL2æ­£åˆ™åŒ–é¡¹"><a href="#è‡ªå®šä¹‰L1å’ŒL2æ­£åˆ™åŒ–é¡¹" class="headerlink" title="è‡ªå®šä¹‰L1å’ŒL2æ­£åˆ™åŒ–é¡¹"></a>è‡ªå®šä¹‰L1å’ŒL2æ­£åˆ™åŒ–é¡¹</h4><p>é€šå¸¸è®¤ä¸ºL1 æ­£åˆ™åŒ–å¯ä»¥äº§ç”Ÿç¨€ç–æƒå€¼çŸ©é˜µï¼Œå³äº§ç”Ÿä¸€ä¸ªç¨€ç–æ¨¡å‹ï¼Œå¯ä»¥ç”¨äºç‰¹å¾é€‰æ‹©ã€‚</p><p>è€ŒL2 æ­£åˆ™åŒ–å¯ä»¥é˜²æ­¢æ¨¡å‹è¿‡æ‹Ÿåˆï¼ˆoverfittingï¼‰ã€‚ä¸€å®šç¨‹åº¦ä¸Šï¼ŒL1ä¹Ÿå¯ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆã€‚</p><p>ä¸‹é¢ä»¥ä¸€ä¸ªäºŒåˆ†ç±»é—®é¢˜ä¸ºä¾‹ï¼Œæ¼”ç¤ºç»™æ¨¡å‹çš„ç›®æ ‡å‡½æ•°æ·»åŠ è‡ªå®šä¹‰L1å’ŒL2æ­£åˆ™åŒ–é¡¹çš„æ–¹æ³•ã€‚</p><p>è¿™ä¸ªèŒƒä¾‹åŒæ—¶æ¼”ç¤ºäº†ä¸Šä¸€ä¸ªéƒ¨åˆ†çš„FocalLossçš„ä½¿ç”¨</p><p>ç¤ºä¾‹å‚è€ƒ <a href="https://www.heywhale.com/mw/project/5f33d61caf3980002cb83d18">https://www.heywhale.com/mw/project/5f33d61caf3980002cb83d18</a></p><h4 id="é€šè¿‡ä¼˜åŒ–å™¨å®ç°L2æ­£åˆ™åŒ–"><a href="#é€šè¿‡ä¼˜åŒ–å™¨å®ç°L2æ­£åˆ™åŒ–" class="headerlink" title="é€šè¿‡ä¼˜åŒ–å™¨å®ç°L2æ­£åˆ™åŒ–"></a>é€šè¿‡ä¼˜åŒ–å™¨å®ç°L2æ­£åˆ™åŒ–</h4><p>å¦‚æœä»…ä»…éœ€è¦ä½¿ç”¨L2æ­£åˆ™åŒ–ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥åˆ©ç”¨ä¼˜åŒ–å™¨çš„weight_decayå‚æ•°æ¥å®ç°ã€‚</p><p>weight_decayå‚æ•°å¯ä»¥è®¾ç½®å‚æ•°åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­çš„è¡°å‡ï¼Œè¿™å’ŒL2æ­£åˆ™åŒ–çš„ä½œç”¨æ•ˆæœç­‰ä»·ã€‚</p><p>Pytorchçš„ä¼˜åŒ–å™¨æ”¯æŒä¸€ç§ç§°ä¹‹ä¸ºPer-parameter optionsçš„æ“ä½œï¼Œå°±æ˜¯å¯¹æ¯ä¸€ä¸ªå‚æ•°è¿›è¡Œç‰¹å®šçš„å­¦ä¹ ç‡ï¼Œæƒé‡è¡°å‡ç‡æŒ‡å®šï¼Œä»¥æ»¡è¶³æ›´ä¸ºç»†è‡´çš„è¦æ±‚ã€‚</p><p>æ¬è¿è‡ªï¼š</p><ul><li><a href="https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1">https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorchå­¦ä¹ ç¬”è®°8-æ¨¡å‹å±‚layers</title>
    <link href="/2022/01/24/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B08-%E6%A8%A1%E5%9E%8B%E5%B1%82layers/"/>
    <url>/2022/01/24/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B08-%E6%A8%A1%E5%9E%8B%E5%B1%82layers/</url>
    
    <content type="html"><![CDATA[<h2 id="æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸€èˆ¬ç”±å„ç§æ¨¡å‹å±‚ç»„åˆè€Œæˆ"><a href="#æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸€èˆ¬ç”±å„ç§æ¨¡å‹å±‚ç»„åˆè€Œæˆ" class="headerlink" title="æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸€èˆ¬ç”±å„ç§æ¨¡å‹å±‚ç»„åˆè€Œæˆ"></a>æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸€èˆ¬ç”±å„ç§æ¨¡å‹å±‚ç»„åˆè€Œæˆ</h2><span id="more"></span><p>torch.nnä¸­å†…ç½®äº†éå¸¸ä¸°å¯Œçš„å„ç§æ¨¡å‹å±‚ã€‚å®ƒä»¬éƒ½å±äºnn.Moduleçš„å­ç±»ï¼Œå…·å¤‡å‚æ•°ç®¡ç†åŠŸèƒ½ã€‚<br>ä¾‹å¦‚ï¼š</p><ul><li>nn.Linear, nn.Flatten, nn.Dropout, nn.BatchNorm2d</li><li>nn.Conv2d,nn.AvgPool2d,nn.Conv1d,nn.ConvTranspose2d</li><li>nn.Embedding,nn.GRU,nn.LSTM</li><li>nn.Transformer</li></ul><p>å¦‚æœè¿™äº›å†…ç½®æ¨¡å‹å±‚ä¸èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç»§æ‰¿nn.ModuleåŸºç±»æ„å»ºè‡ªå®šä¹‰çš„æ¨¡å‹å±‚ã€‚<br>å®é™…ä¸Šï¼Œpytorchä¸åŒºåˆ†æ¨¡å‹å’Œæ¨¡å‹å±‚ï¼Œéƒ½æ˜¯é€šè¿‡ç»§æ‰¿nn.Moduleè¿›è¡Œæ„å»ºã€‚<br>å› æ­¤ï¼Œæˆ‘ä»¬åªè¦ç»§æ‰¿nn.ModuleåŸºç±»å¹¶å®ç°forwardæ–¹æ³•å³å¯è‡ªå®šä¹‰æ¨¡å‹å±‚ã€‚</p><h4 id="å†…ç½®æ¨¡å‹å±‚"><a href="#å†…ç½®æ¨¡å‹å±‚" class="headerlink" title="å†…ç½®æ¨¡å‹å±‚"></a>å†…ç½®æ¨¡å‹å±‚</h4><p>ä¸€äº›å¸¸ç”¨çš„å†…ç½®æ¨¡å‹å±‚ç®€å•ä»‹ç»å¦‚ä¸‹ã€‚</p><p>åŸºç¡€å±‚</p><ul><li>nn.Linearï¼šå…¨è¿æ¥å±‚ã€‚å‚æ•°ä¸ªæ•° = è¾“å…¥å±‚ç‰¹å¾æ•°Ã— è¾“å‡ºå±‚ç‰¹å¾æ•°(weight)ï¼‹ è¾“å‡ºå±‚ç‰¹å¾æ•°(bias)</li><li>nn.Flattenï¼šå‹å¹³å±‚ï¼Œç”¨äºå°†å¤šç»´å¼ é‡æ ·æœ¬å‹æˆä¸€ç»´å¼ é‡æ ·æœ¬ã€‚</li><li>nn.BatchNorm1dï¼šä¸€ç»´æ‰¹æ ‡å‡†åŒ–å±‚ã€‚é€šè¿‡çº¿æ€§å˜æ¢å°†è¾“å…¥æ‰¹æ¬¡ç¼©æ”¾å¹³ç§»åˆ°ç¨³å®šçš„å‡å€¼å’Œæ ‡å‡†å·®ã€‚å¯ä»¥å¢å¼ºæ¨¡å‹å¯¹è¾“å…¥ä¸åŒåˆ†å¸ƒçš„é€‚åº”æ€§ï¼ŒåŠ å¿«æ¨¡å‹è®­ç»ƒé€Ÿåº¦ï¼Œæœ‰è½»å¾®æ­£åˆ™åŒ–æ•ˆæœã€‚ä¸€èˆ¬åœ¨æ¿€æ´»å‡½æ•°ä¹‹å‰ä½¿ç”¨ã€‚å¯ä»¥ç”¨afineå‚æ•°è®¾ç½®è¯¥å±‚æ˜¯å¦å«æœ‰å¯ä»¥è®­ç»ƒçš„å‚æ•°ã€‚</li><li>nn.BatchNorm2dï¼šäºŒç»´æ‰¹æ ‡å‡†åŒ–å±‚ã€‚</li><li>nn.BatchNorm3dï¼šä¸‰ç»´æ‰¹æ ‡å‡†åŒ–å±‚ã€‚</li><li>nn.Dropoutï¼šä¸€ç»´éšæœºä¸¢å¼ƒå±‚ã€‚ä¸€ç§æ­£åˆ™åŒ–æ‰‹æ®µã€‚</li><li>nn.Dropout2dï¼šäºŒç»´éšæœºä¸¢å¼ƒå±‚ã€‚</li><li>nn.Dropout3dï¼šä¸‰ç»´éšæœºä¸¢å¼ƒå±‚ã€‚</li><li>nn.Thresholdï¼šé™å¹…å±‚ã€‚å½“è¾“å…¥å¤§äºæˆ–å°äºé˜ˆå€¼èŒƒå›´æ—¶ï¼Œæˆªæ–­ä¹‹ã€‚</li><li>nn.ConstantPad2dï¼š äºŒç»´å¸¸æ•°å¡«å……å±‚ã€‚å¯¹äºŒç»´å¼ é‡æ ·æœ¬å¡«å……å¸¸æ•°æ‰©å±•é•¿åº¦ã€‚</li><li>nn.ReplicationPad1dï¼š ä¸€ç»´å¤åˆ¶å¡«å……å±‚ã€‚å¯¹ä¸€ç»´å¼ é‡æ ·æœ¬é€šè¿‡å¤åˆ¶è¾¹ç¼˜å€¼å¡«å……æ‰©å±•é•¿åº¦ã€‚</li><li>nn.ZeroPad2dï¼šäºŒç»´é›¶å€¼å¡«å……å±‚ã€‚å¯¹äºŒç»´å¼ é‡æ ·æœ¬åœ¨è¾¹ç¼˜å¡«å……0å€¼.</li><li>nn.GroupNormï¼šç»„å½’ä¸€åŒ–ã€‚ä¸€ç§æ›¿ä»£æ‰¹å½’ä¸€åŒ–çš„æ–¹æ³•ï¼Œå°†é€šé“åˆ†æˆè‹¥å¹²ç»„è¿›è¡Œå½’ä¸€ã€‚ä¸å—batchå¤§å°é™åˆ¶ï¼Œæ®ç§°æ€§èƒ½å’Œæ•ˆæœéƒ½ä¼˜äºBatchNormã€‚</li><li>nn.LayerNormï¼šå±‚å½’ä¸€åŒ–ã€‚è¾ƒå°‘ä½¿ç”¨ã€‚</li><li>nn.InstanceNorm2d: æ ·æœ¬å½’ä¸€åŒ–ã€‚è¾ƒå°‘ä½¿ç”¨ã€‚</li></ul><p>å„ç§å½’ä¸€åŒ–æŠ€æœ¯å‚è€ƒå¦‚ä¸‹çŸ¥ä¹æ–‡ç« ã€ŠFAIRä½•æºæ˜ç­‰äººæå‡ºç»„å½’ä¸€åŒ–ï¼šæ›¿ä»£æ‰¹å½’ä¸€åŒ–ï¼Œä¸å—æ‰¹é‡å¤§å°é™åˆ¶ã€‹</p><ul><li><a href="https://zhuanlan.zhihu.com/p/34858971">https://zhuanlan.zhihu.com/p/34858971</a></li></ul><p>å·ç§¯ç½‘ç»œç›¸å…³å±‚</p><ul><li><p>nn.Conv1dï¼šæ™®é€šä¸€ç»´å·ç§¯ï¼Œå¸¸ç”¨äºæ–‡æœ¬ã€‚å‚æ•°ä¸ªæ•° = è¾“å…¥é€šé“æ•°Ã—å·ç§¯æ ¸å°ºå¯¸(å¦‚3)Ã—å·ç§¯æ ¸ä¸ªæ•° + å·ç§¯æ ¸å°ºå¯¸(å¦‚3ï¼‰</p></li><li><p>nn.Conv2dï¼šæ™®é€šäºŒç»´å·ç§¯ï¼Œå¸¸ç”¨äºå›¾åƒã€‚å‚æ•°ä¸ªæ•° = è¾“å…¥é€šé“æ•°Ã—å·ç§¯æ ¸å°ºå¯¸(å¦‚3ä¹˜3)Ã—å·ç§¯æ ¸ä¸ªæ•° + å·ç§¯æ ¸å°ºå¯¸(å¦‚3ä¹˜3)<br>é€šè¿‡è°ƒæ•´dilationå‚æ•°å¤§äº1ï¼Œå¯ä»¥å˜æˆç©ºæ´å·ç§¯ï¼Œå¢å¤§å·ç§¯æ ¸æ„Ÿå—é‡ã€‚<br>é€šè¿‡è°ƒæ•´groupså‚æ•°ä¸ä¸º1ï¼Œå¯ä»¥å˜æˆåˆ†ç»„å·ç§¯ã€‚åˆ†ç»„å·ç§¯ä¸­ä¸åŒåˆ†ç»„ä½¿ç”¨ç›¸åŒçš„å·ç§¯æ ¸ï¼Œæ˜¾è‘—å‡å°‘å‚æ•°æ•°é‡ã€‚<br>å½“groupså‚æ•°ç­‰äºé€šé“æ•°æ—¶ï¼Œç›¸å½“äºtensorflowä¸­çš„äºŒç»´æ·±åº¦å·ç§¯å±‚tf.keras.layers.DepthwiseConv2Dã€‚<br>åˆ©ç”¨åˆ†ç»„å·ç§¯å’Œ1ä¹˜1å·ç§¯çš„ç»„åˆæ“ä½œï¼Œå¯ä»¥æ„é€ ç›¸å½“äºKerasä¸­çš„äºŒç»´æ·±åº¦å¯åˆ†ç¦»å·ç§¯å±‚tf.keras.layers.SeparableConv2Dã€‚</p></li><li><p>nn.Conv3dï¼šæ™®é€šä¸‰ç»´å·ç§¯ï¼Œå¸¸ç”¨äºè§†é¢‘ã€‚å‚æ•°ä¸ªæ•° = è¾“å…¥é€šé“æ•°Ã—å·ç§¯æ ¸å°ºå¯¸(å¦‚3ä¹˜3ä¹˜3)Ã—å·ç§¯æ ¸ä¸ªæ•° + å·ç§¯æ ¸å°ºå¯¸(å¦‚3ä¹˜3ä¹˜3) ã€‚</p></li><li><p>nn.MaxPool1d: ä¸€ç»´æœ€å¤§æ± åŒ–ã€‚</p></li><li><p>nn.MaxPool2dï¼šäºŒç»´æœ€å¤§æ± åŒ–ã€‚ä¸€ç§ä¸‹é‡‡æ ·æ–¹å¼ã€‚æ²¡æœ‰éœ€è¦è®­ç»ƒçš„å‚æ•°ã€‚</p></li><li><p>nn.MaxPool3dï¼šä¸‰ç»´æœ€å¤§æ± åŒ–ã€‚</p></li><li><p>nn.AdaptiveMaxPool2dï¼šäºŒç»´è‡ªé€‚åº”æœ€å¤§æ± åŒ–ã€‚æ— è®ºè¾“å…¥å›¾åƒçš„å°ºå¯¸å¦‚ä½•å˜åŒ–ï¼Œè¾“å‡ºçš„å›¾åƒå°ºå¯¸æ˜¯å›ºå®šçš„ã€‚</p></li><li><p>è¯¥å‡½æ•°çš„å®ç°åŸç†ï¼Œå¤§æ¦‚æ˜¯é€šè¿‡è¾“å…¥å›¾åƒçš„å°ºå¯¸å’Œè¦å¾—åˆ°çš„è¾“å‡ºå›¾åƒçš„å°ºå¯¸æ¥åå‘æ¨ç®—æ± åŒ–ç®—å­çš„padding,strideç­‰å‚æ•°ã€‚</p></li><li><p>nn.FractionalMaxPool2dï¼šäºŒç»´åˆ†æ•°æœ€å¤§æ± åŒ–ã€‚æ™®é€šæœ€å¤§æ± åŒ–é€šå¸¸è¾“å…¥å°ºå¯¸æ˜¯è¾“å‡ºçš„æ•´æ•°å€ã€‚è€Œåˆ†æ•°æœ€å¤§æ± åŒ–åˆ™å¯ä»¥ä¸å¿…æ˜¯æ•´æ•°ã€‚åˆ†æ•°æœ€å¤§æ± åŒ–ä½¿ç”¨äº†ä¸€äº›éšæœºé‡‡æ ·ç­–ç•¥ï¼Œæœ‰ä¸€å®šçš„æ­£åˆ™æ•ˆæœï¼Œå¯ä»¥ç”¨å®ƒæ¥ä»£æ›¿æ™®é€šæœ€å¤§æ± åŒ–å’ŒDropoutå±‚ã€‚</p></li><li><p>nn.AvgPool2dï¼šäºŒç»´å¹³å‡æ± åŒ–ã€‚</p></li><li><p>nn.AdaptiveAvgPool2dï¼šäºŒç»´è‡ªé€‚åº”å¹³å‡æ± åŒ–ã€‚æ— è®ºè¾“å…¥çš„ç»´åº¦å¦‚ä½•å˜åŒ–ï¼Œè¾“å‡ºçš„ç»´åº¦æ˜¯å›ºå®šçš„ã€‚</p></li><li><p>nn.ConvTranspose2dï¼šäºŒç»´å·ç§¯è½¬ç½®å±‚ï¼Œä¿—ç§°åå·ç§¯å±‚ã€‚å¹¶éå·ç§¯çš„é€†æ“ä½œï¼Œä½†åœ¨å·ç§¯æ ¸ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œå½“å…¶è¾“å…¥å°ºå¯¸æ˜¯å·ç§¯æ“ä½œè¾“å‡ºå°ºå¯¸çš„æƒ…å†µä¸‹ï¼Œå·ç§¯è½¬ç½®çš„è¾“å‡ºå°ºå¯¸æ°å¥½æ˜¯å·ç§¯æ“ä½œçš„è¾“å…¥å°ºå¯¸ã€‚åœ¨è¯­ä¹‰åˆ†å‰²ä¸­å¯ç”¨äºä¸Šé‡‡æ ·ã€‚</p></li><li><p>nn.Upsampleï¼šä¸Šé‡‡æ ·å±‚ï¼Œæ“ä½œæ•ˆæœå’Œæ± åŒ–ç›¸åã€‚å¯ä»¥é€šè¿‡modeå‚æ•°æ§åˆ¶ä¸Šé‡‡æ ·ç­–ç•¥ä¸ºâ€nearestâ€æœ€é‚»è¿‘ç­–ç•¥æˆ–â€linearâ€çº¿æ€§æ’å€¼ç­–ç•¥ã€‚</p></li><li><p>nn.Unfoldï¼šæ»‘åŠ¨çª—å£æå–å±‚ã€‚å…¶å‚æ•°å’Œå·ç§¯æ“ä½œnn.Conv2dç›¸åŒã€‚å®é™…ä¸Šï¼Œå·ç§¯æ“ä½œå¯ä»¥ç­‰ä»·äºnn.Unfoldå’Œnn.Linearä»¥åŠnn.Foldçš„ä¸€ä¸ªç»„åˆã€‚<br>å…¶ä¸­nn.Unfoldæ“ä½œå¯ä»¥ä»è¾“å…¥ä¸­æå–å„ä¸ªæ»‘åŠ¨çª—å£çš„æ•°å€¼çŸ©é˜µï¼Œå¹¶å°†å…¶å‹å¹³æˆä¸€ç»´ã€‚åˆ©ç”¨nn.Linearå°†nn.Unfoldçš„è¾“å‡ºå’Œå·ç§¯æ ¸åšä¹˜æ³•åï¼Œå†ä½¿ç”¨</p></li><li><p>nn.Foldæ“ä½œå°†ç»“æœè½¬æ¢æˆè¾“å‡ºå›¾ç‰‡å½¢çŠ¶ã€‚</p></li><li><p>nn.Foldï¼šé€†æ»‘åŠ¨çª—å£æå–å±‚ã€‚</p></li></ul><p>å¾ªç¯ç½‘ç»œç›¸å…³å±‚</p><ul><li>nn.Embeddingï¼šåµŒå…¥å±‚ã€‚ä¸€ç§æ¯”Onehotæ›´åŠ æœ‰æ•ˆçš„å¯¹ç¦»æ•£ç‰¹å¾è¿›è¡Œç¼–ç çš„æ–¹æ³•ã€‚ä¸€èˆ¬ç”¨äºå°†è¾“å…¥ä¸­çš„å•è¯æ˜ å°„ä¸ºç¨ å¯†å‘é‡ã€‚åµŒå…¥å±‚çš„å‚æ•°éœ€è¦å­¦ä¹ ã€‚</li><li>nn.LSTMï¼šé•¿çŸ­è®°å¿†å¾ªç¯ç½‘ç»œå±‚ã€æ”¯æŒå¤šå±‚ã€‘ã€‚æœ€æ™®éä½¿ç”¨çš„å¾ªç¯ç½‘ç»œå±‚ã€‚å…·æœ‰æºå¸¦è½¨é“ï¼Œé—å¿˜é—¨ï¼Œæ›´æ–°é—¨ï¼Œè¾“å‡ºé—¨ã€‚å¯ä»¥è¾ƒä¸ºæœ‰æ•ˆåœ°ç¼“è§£æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œä»è€Œèƒ½å¤Ÿé€‚ç”¨é•¿æœŸä¾èµ–é—®é¢˜ã€‚è®¾ç½®bidirectional = Trueæ—¶å¯ä»¥å¾—åˆ°åŒå‘LSTMã€‚éœ€è¦æ³¨æ„çš„æ—¶ï¼Œé»˜è®¤çš„è¾“å…¥å’Œè¾“å‡ºå½¢çŠ¶æ˜¯(seq,batch,feature), å¦‚æœéœ€è¦å°†batchç»´åº¦æ”¾åœ¨ç¬¬0ç»´ï¼Œåˆ™è¦è®¾ç½®batch_firstå‚æ•°è®¾ç½®ä¸ºTrueã€‚</li><li>nn.GRUï¼šé—¨æ§å¾ªç¯ç½‘ç»œå±‚ã€æ”¯æŒå¤šå±‚ã€‘ã€‚LSTMçš„ä½é…ç‰ˆï¼Œä¸å…·æœ‰æºå¸¦è½¨é“ï¼Œå‚æ•°æ•°é‡å°‘äºLSTMï¼Œè®­ç»ƒé€Ÿåº¦æ›´å¿«ã€‚</li><li>nn.RNNï¼šç®€å•å¾ªç¯ç½‘ç»œå±‚ã€æ”¯æŒå¤šå±‚ã€‘ã€‚å®¹æ˜“å­˜åœ¨æ¢¯åº¦æ¶ˆå¤±ï¼Œä¸èƒ½å¤Ÿé€‚ç”¨é•¿æœŸä¾èµ–é—®é¢˜ã€‚ä¸€èˆ¬è¾ƒå°‘ä½¿ç”¨ã€‚</li><li>nn.LSTMCellï¼šé•¿çŸ­è®°å¿†å¾ªç¯ç½‘ç»œå•å…ƒã€‚å’Œnn.LSTMåœ¨æ•´ä¸ªåºåˆ—ä¸Šè¿­ä»£ç›¸æ¯”ï¼Œå®ƒä»…åœ¨åºåˆ—ä¸Šè¿­ä»£ä¸€æ­¥ã€‚ä¸€èˆ¬è¾ƒå°‘ä½¿ç”¨ã€‚</li><li>nn.GRUCellï¼šé—¨æ§å¾ªç¯ç½‘ç»œå•å…ƒã€‚å’Œnn.GRUåœ¨æ•´ä¸ªåºåˆ—ä¸Šè¿­ä»£ç›¸æ¯”ï¼Œå®ƒä»…åœ¨åºåˆ—ä¸Šè¿­ä»£ä¸€æ­¥ã€‚ä¸€èˆ¬è¾ƒå°‘ä½¿ç”¨ã€‚</li><li>nn.RNNCellï¼šç®€å•å¾ªç¯ç½‘ç»œå•å…ƒã€‚å’Œnn.RNNåœ¨æ•´ä¸ªåºåˆ—ä¸Šè¿­ä»£ç›¸æ¯”ï¼Œå®ƒä»…åœ¨åºåˆ—ä¸Šè¿­ä»£ä¸€æ­¥ã€‚ä¸€èˆ¬è¾ƒå°‘ä½¿ç”¨ã€‚</li></ul><p>Transformerç›¸å…³å±‚</p><ul><li>nn.Transformerï¼šTransformerç½‘ç»œç»“æ„ã€‚Transformerç½‘ç»œç»“æ„æ˜¯æ›¿ä»£å¾ªç¯ç½‘ç»œçš„ä¸€ç§ç»“æ„ï¼Œè§£å†³äº†å¾ªç¯ç½‘ç»œéš¾ä»¥å¹¶è¡Œï¼Œéš¾ä»¥æ•æ‰é•¿æœŸä¾èµ–çš„ç¼ºé™·ã€‚å®ƒæ˜¯ç›®å‰NLPä»»åŠ¡çš„ä¸»æµæ¨¡å‹çš„ä¸»è¦æ„æˆéƒ¨åˆ†ã€‚Transformerç½‘ç»œç»“æ„ç”±TransformerEncoderç¼–ç å™¨å’ŒTransformerDecoderè§£ç å™¨ç»„æˆã€‚ç¼–ç å™¨å’Œè§£ç å™¨çš„æ ¸å¿ƒæ˜¯MultiheadAttentionå¤šå¤´æ³¨æ„åŠ›å±‚ã€‚</li><li>nn.TransformerEncoderï¼šTransformerç¼–ç å™¨ç»“æ„ã€‚ç”±å¤šä¸ª nn.TransformerEncoderLayerç¼–ç å™¨å±‚ç»„æˆã€‚</li><li>nn.TransformerDecoderï¼šTransformerè§£ç å™¨ç»“æ„ã€‚ç”±å¤šä¸ª nn.TransformerDecoderLayerè§£ç å™¨å±‚ç»„æˆã€‚</li><li>nn.TransformerEncoderLayerï¼šTransformerçš„ç¼–ç å™¨å±‚ã€‚</li><li>nn.TransformerDecoderLayerï¼šTransformerçš„è§£ç å™¨å±‚ã€‚</li><li>nn.MultiheadAttentionï¼šå¤šå¤´æ³¨æ„åŠ›å±‚ã€‚</li></ul><p>TransformeråŸç†ä»‹ç»å¯ä»¥å‚è€ƒå¦‚ä¸‹çŸ¥ä¹æ–‡ç« ã€Šè¯¦è§£Transformer(Attention Is All You Need)ã€‹</p><ul><li><a href="https://zhuanlan.zhihu.com/p/48508221">https://zhuanlan.zhihu.com/p/48508221</a></li></ul><h4 id="è‡ªå®šä¹‰æ¨¡å‹å±‚"><a href="#è‡ªå®šä¹‰æ¨¡å‹å±‚" class="headerlink" title="è‡ªå®šä¹‰æ¨¡å‹å±‚"></a>è‡ªå®šä¹‰æ¨¡å‹å±‚</h4><p>ä¸‹é¢æ˜¯Pytorchçš„nn.Linearå±‚çš„æºç ï¼Œå¯ä»¥ä»¿ç…§å®ƒæ¥è‡ªå®šä¹‰æ¨¡å‹å±‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn<br><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Linear</span>(<span class="hljs-params">nn.Module</span>):</span><br>    __constants__ = [<span class="hljs-string">&#x27;in_features&#x27;</span>, <span class="hljs-string">&#x27;out_features&#x27;</span>]<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, in_features, out_features, bias=<span class="hljs-literal">True</span></span>):</span><br>        <span class="hljs-built_in">super</span>(Linear, self).__init__()<br>        self.in_features = in_features<br>        self.out_features = out_features<br>        self.weight = nn.Parameter(torch.Tensor(out_features, in_features))<br>        <span class="hljs-keyword">if</span> bias:<br>            self.bias = nn.Parameter(torch.Tensor(out_features))<br>        <span class="hljs-keyword">else</span>:<br>            self.register_parameter(<span class="hljs-string">&#x27;bias&#x27;</span>, <span class="hljs-literal">None</span>)<br>        self.reset_parameters()<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">reset_parameters</span>(<span class="hljs-params">self</span>):</span><br>        nn.init.kaiming_uniform_(self.weight, a=math.sqrt(<span class="hljs-number">5</span>))<br>        <span class="hljs-keyword">if</span> self.bias <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            fan_in, _ = nn.init._calculate_fan_in_and_fan_out(self.weight)<br>            bound = <span class="hljs-number">1</span> / math.sqrt(fan_in)<br>            nn.init.uniform_(self.bias, -bound, bound)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">self, <span class="hljs-built_in">input</span></span>):</span><br>        <span class="hljs-keyword">return</span> F.linear(<span class="hljs-built_in">input</span>, self.weight, self.bias)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">extra_repr</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;in_features=&#123;&#125;, out_features=&#123;&#125;, bias=&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<br>            self.in_features, self.out_features, self.bias <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span><br>        )<br><br><br>linear = nn.Linear(<span class="hljs-number">20</span>, <span class="hljs-number">30</span>)<br>inputs = torch.randn(<span class="hljs-number">128</span>, <span class="hljs-number">20</span>)<br>output = linear(inputs)<br><span class="hljs-built_in">print</span>(output.size())<br></code></pre></td></tr></table></figure><p>æ¬è¿è‡ªï¼š</p><ul><li><a href="https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1">https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorchå­¦ä¹ ç¬”è®°7-Datasetå’ŒDataLoader</title>
    <link href="/2022/01/21/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B07-Dataset%E5%92%8CDataLoader/"/>
    <url>/2022/01/21/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B07-Dataset%E5%92%8CDataLoader/</url>
    
    <content type="html"><![CDATA[<h2 id="Pytorché€šå¸¸ä½¿ç”¨Datasetå’ŒDataLoaderè¿™ä¸¤ä¸ªå·¥å…·ç±»æ¥æ„å»ºæ•°æ®ç®¡é“"><a href="#Pytorché€šå¸¸ä½¿ç”¨Datasetå’ŒDataLoaderè¿™ä¸¤ä¸ªå·¥å…·ç±»æ¥æ„å»ºæ•°æ®ç®¡é“" class="headerlink" title="Pytorché€šå¸¸ä½¿ç”¨Datasetå’ŒDataLoaderè¿™ä¸¤ä¸ªå·¥å…·ç±»æ¥æ„å»ºæ•°æ®ç®¡é“"></a>Pytorché€šå¸¸ä½¿ç”¨Datasetå’ŒDataLoaderè¿™ä¸¤ä¸ªå·¥å…·ç±»æ¥æ„å»ºæ•°æ®ç®¡é“</h2><span id="more"></span><p>Datasetå®šä¹‰äº†æ•°æ®é›†çš„å†…å®¹ï¼Œå®ƒç›¸å½“äºä¸€ä¸ªç±»ä¼¼åˆ—è¡¨çš„æ•°æ®ç»“æ„ï¼Œå…·æœ‰ç¡®å®šçš„é•¿åº¦ï¼Œèƒ½å¤Ÿç”¨ç´¢å¼•è·å–æ•°æ®é›†ä¸­çš„å…ƒç´ ã€‚<br>è€ŒDataLoaderå®šä¹‰äº†æŒ‰batchåŠ è½½æ•°æ®é›†çš„æ–¹æ³•ï¼Œå®ƒæ˜¯ä¸€ä¸ªå®ç°äº†__iter_æ–¹æ³•çš„å¯è¿­ä»£å¯¹è±¡ï¼Œæ¯æ¬¡è¿­ä»£è¾“å‡ºä¸€ä¸ªbatchçš„æ•°æ®ã€‚<br>DataLoaderèƒ½å¤Ÿæ§åˆ¶batchçš„å¤§å°ï¼Œbatchä¸­å…ƒç´ çš„é‡‡æ ·æ–¹æ³•ï¼Œä»¥åŠå°†batchç»“æœæ•´ç†æˆæ¨¡å‹æ‰€éœ€è¾“å…¥å½¢å¼çš„æ–¹æ³•ï¼Œå¹¶ä¸”èƒ½å¤Ÿä½¿ç”¨å¤šè¿›ç¨‹è¯»å–æ•°æ®ã€‚<br>åœ¨ç»å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œç”¨æˆ·åªéœ€å®ç°Datasetçš„__len__æ–¹æ³•å’Œ__getitem__æ–¹æ³•ï¼Œå°±å¯ä»¥è½»æ¾æ„å»ºè‡ªå·±çš„æ•°æ®é›†ï¼Œå¹¶ç”¨é»˜è®¤æ•°æ®ç®¡é“è¿›è¡ŒåŠ è½½ã€‚</p><h5 id="Datasetå’ŒDataLoaderæ¦‚è¿°"><a href="#Datasetå’ŒDataLoaderæ¦‚è¿°" class="headerlink" title="Datasetå’ŒDataLoaderæ¦‚è¿°"></a>Datasetå’ŒDataLoaderæ¦‚è¿°</h5><h6 id="1ï¼Œè·å–ä¸€ä¸ªbatchæ•°æ®çš„æ­¥éª¤"><a href="#1ï¼Œè·å–ä¸€ä¸ªbatchæ•°æ®çš„æ­¥éª¤" class="headerlink" title="1ï¼Œè·å–ä¸€ä¸ªbatchæ•°æ®çš„æ­¥éª¤"></a>1ï¼Œè·å–ä¸€ä¸ªbatchæ•°æ®çš„æ­¥éª¤</h6><p>(å‡å®šæ•°æ®é›†çš„ç‰¹å¾å’Œæ ‡ç­¾åˆ†åˆ«è¡¨ç¤ºä¸ºå¼ é‡Xå’ŒYï¼Œæ•°æ®é›†å¯ä»¥è¡¨ç¤ºä¸º(X,Y), å‡å®šbatchå¤§å°ä¸ºm)</p><p>1ï¼Œé¦–å…ˆæˆ‘ä»¬è¦ç¡®å®šæ•°æ®é›†çš„é•¿åº¦nã€‚</p><p>ç»“æœç±»ä¼¼ï¼šn = 1000ã€‚</p><p>2ï¼Œç„¶åæˆ‘ä»¬ä»0åˆ°n-1çš„èŒƒå›´ä¸­æŠ½æ ·å‡ºmä¸ªæ•°(batchå¤§å°)ã€‚</p><p>å‡å®šm=4, æ‹¿åˆ°çš„ç»“æœæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œç±»ä¼¼ï¼šindices = [1,4,8,9]</p><p>3ï¼Œæ¥ç€æˆ‘ä»¬ä»æ•°æ®é›†ä¸­å»å–è¿™mä¸ªæ•°å¯¹åº”ä¸‹æ ‡çš„å…ƒç´ ã€‚</p><p>æ‹¿åˆ°çš„ç»“æœæ˜¯ä¸€ä¸ªå…ƒç»„åˆ—è¡¨ï¼Œç±»ä¼¼ï¼šsamples = [(X[1],Y[1]),(X[4],Y[4]),(X[8],Y[8]),(X[9],Y[9])]</p><p>4ï¼Œæœ€åæˆ‘ä»¬å°†ç»“æœæ•´ç†æˆä¸¤ä¸ªå¼ é‡ä½œä¸ºè¾“å‡ºã€‚</p><p>æ‹¿åˆ°çš„ç»“æœæ˜¯ä¸¤ä¸ªå¼ é‡ï¼Œç±»ä¼¼batch = (features,labels)ï¼Œ</p><p>å…¶ä¸­ features = torch.stack([X[1],X[4],X[8],X[9]])</p><p>labels = torch.stack([Y[1],Y[4],Y[8],Y[9]])</p><h6 id="2ï¼ŒDatasetå’ŒDataLoaderçš„åŠŸèƒ½åˆ†å·¥"><a href="#2ï¼ŒDatasetå’ŒDataLoaderçš„åŠŸèƒ½åˆ†å·¥" class="headerlink" title="2ï¼ŒDatasetå’ŒDataLoaderçš„åŠŸèƒ½åˆ†å·¥"></a>2ï¼ŒDatasetå’ŒDataLoaderçš„åŠŸèƒ½åˆ†å·¥</h6><p>ä¸Šè¿°ç¬¬1ä¸ªæ­¥éª¤ç¡®å®šæ•°æ®é›†çš„é•¿åº¦æ˜¯ç”± Datasetçš„__len__ æ–¹æ³•å®ç°çš„ã€‚</p><p>ç¬¬2ä¸ªæ­¥éª¤ä»0åˆ°n-1çš„èŒƒå›´ä¸­æŠ½æ ·å‡ºmä¸ªæ•°çš„æ–¹æ³•æ˜¯ç”± DataLoaderçš„ samplerå’Œ batch_samplerå‚æ•°æŒ‡å®šçš„ã€‚</p><p>samplerå‚æ•°æŒ‡å®šå•ä¸ªå…ƒç´ æŠ½æ ·æ–¹æ³•ï¼Œä¸€èˆ¬æ— éœ€ç”¨æˆ·è®¾ç½®ï¼Œç¨‹åºé»˜è®¤åœ¨DataLoaderçš„å‚æ•°shuffle=Trueæ—¶é‡‡ç”¨éšæœºæŠ½æ ·ï¼Œshuffle=Falseæ—¶é‡‡ç”¨é¡ºåºæŠ½æ ·ã€‚</p><p>batch_samplerå‚æ•°å°†å¤šä¸ªæŠ½æ ·çš„å…ƒç´ æ•´ç†æˆä¸€ä¸ªåˆ—è¡¨ï¼Œä¸€èˆ¬æ— éœ€ç”¨æˆ·è®¾ç½®ï¼Œé»˜è®¤æ–¹æ³•åœ¨DataLoaderçš„å‚æ•°drop_last=Trueæ—¶ä¼šä¸¢å¼ƒæ•°æ®é›†æœ€åä¸€ä¸ªé•¿åº¦ä¸èƒ½è¢«batchå¤§å°æ•´é™¤çš„æ‰¹æ¬¡ï¼Œåœ¨drop_last=Falseæ—¶ä¿ç•™æœ€åä¸€ä¸ªæ‰¹æ¬¡ã€‚</p><p>ç¬¬3ä¸ªæ­¥éª¤çš„æ ¸å¿ƒé€»è¾‘æ ¹æ®ä¸‹æ ‡å–æ•°æ®é›†ä¸­çš„å…ƒç´  æ˜¯ç”± Datasetçš„ __getitem__æ–¹æ³•å®ç°çš„ã€‚</p><p>ç¬¬4ä¸ªæ­¥éª¤çš„é€»è¾‘ç”±DataLoaderçš„å‚æ•°collate_fnæŒ‡å®šã€‚ä¸€èˆ¬æƒ…å†µä¸‹ä¹Ÿæ— éœ€ç”¨æˆ·è®¾ç½®ã€‚</p><h6 id="3ï¼ŒDatasetå’ŒDataLoaderçš„ä¸»è¦æ¥å£"><a href="#3ï¼ŒDatasetå’ŒDataLoaderçš„ä¸»è¦æ¥å£" class="headerlink" title="3ï¼ŒDatasetå’ŒDataLoaderçš„ä¸»è¦æ¥å£"></a>3ï¼ŒDatasetå’ŒDataLoaderçš„ä¸»è¦æ¥å£</h6><p>ä»¥ä¸‹æ˜¯ Datasetå’Œ DataLoaderçš„æ ¸å¿ƒæ¥å£é€»è¾‘ä¼ªä»£ç ï¼Œä¸å®Œå…¨å’Œæºç ä¸€è‡´ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Dataset</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">pass</span><br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__len__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">raise</span> NotImplementedError<br>        <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__getitem__</span>(<span class="hljs-params">self,index</span>):</span><br>        <span class="hljs-keyword">raise</span> NotImplementedError<br>        <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataLoader</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self,dataset,batch_size,collate_fn,shuffle = <span class="hljs-literal">True</span>,drop_last = <span class="hljs-literal">False</span></span>):</span><br>        self.dataset = dataset<br>        self.sampler =torch.utils.data.RandomSampler <span class="hljs-keyword">if</span> shuffle <span class="hljs-keyword">else</span> \<br>           torch.utils.data.SequentialSampler<br>        self.batch_sampler = torch.utils.data.BatchSampler<br>        self.sample_iter = self.batch_sampler(<br>            self.sampler(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(dataset))),<br>            batch_size = batch_size,drop_last = drop_last)<br>        <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__next__</span>(<span class="hljs-params">self</span>):</span><br>        indices = <span class="hljs-built_in">next</span>(self.sample_iter)<br>        batch = self.collate_fn([self.dataset[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> indices])<br>        <span class="hljs-keyword">return</span> batch<br></code></pre></td></tr></table></figure><h5 id="ä½¿ç”¨Datasetåˆ›å»ºæ•°æ®é›†"><a href="#ä½¿ç”¨Datasetåˆ›å»ºæ•°æ®é›†" class="headerlink" title="ä½¿ç”¨Datasetåˆ›å»ºæ•°æ®é›†"></a>ä½¿ç”¨Datasetåˆ›å»ºæ•°æ®é›†</h5><p>Datasetåˆ›å»ºæ•°æ®é›†å¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼š</p><ul><li><p>ä½¿ç”¨ torch.utils.data.TensorDataset æ ¹æ®Tensoråˆ›å»ºæ•°æ®é›†(numpyçš„arrayï¼ŒPandasçš„DataFrameéœ€è¦å…ˆè½¬æ¢æˆTensor)ã€‚</p></li><li><p>ä½¿ç”¨ torchvision.datasets.ImageFolder æ ¹æ®å›¾ç‰‡ç›®å½•åˆ›å»ºå›¾ç‰‡æ•°æ®é›†ã€‚</p></li><li><p>ç»§æ‰¿ torch.utils.data.Dataset åˆ›å»ºè‡ªå®šä¹‰æ•°æ®é›†ã€‚</p></li></ul><p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡</p><ul><li><p>torch.utils.data.random_split å°†ä¸€ä¸ªæ•°æ®é›†åˆ†å‰²æˆå¤šä»½ï¼Œå¸¸ç”¨äºåˆ†å‰²è®­ç»ƒé›†ï¼ŒéªŒè¯é›†å’Œæµ‹è¯•é›†ã€‚</p></li><li><p>è°ƒç”¨Datasetçš„åŠ æ³•è¿ç®—ç¬¦(+)å°†å¤šä¸ªæ•°æ®é›†åˆå¹¶æˆä¸€ä¸ªæ•°æ®é›†ã€‚</p></li></ul><h6 id="1ï¼Œæ ¹æ®Tensoråˆ›å»ºæ•°æ®é›†"><a href="#1ï¼Œæ ¹æ®Tensoråˆ›å»ºæ•°æ®é›†" class="headerlink" title="1ï¼Œæ ¹æ®Tensoråˆ›å»ºæ•°æ®é›†"></a>1ï¼Œæ ¹æ®Tensoråˆ›å»ºæ•°æ®é›†</h6><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np <br><span class="hljs-keyword">import</span> torch <br><span class="hljs-title">from</span> torch.utils.data <span class="hljs-keyword">import</span> TensorDataset,Dataset,DataLoader,random_split <br></code></pre></td></tr></table></figure><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-meta"># æ ¹æ®Tensoråˆ›å»ºæ•°æ®é›†</span><br><br><span class="hljs-title">from</span> sklearn <span class="hljs-keyword">import</span> datasets <br><span class="hljs-title">iris</span> = datasets.load_iris()<br><span class="hljs-title">ds_iris</span> = <span class="hljs-type">TensorDataset</span>(torch.tensor(iris.<span class="hljs-class"><span class="hljs-keyword">data</span>),torch.tensor(<span class="hljs-title">iris</span>.<span class="hljs-title">target</span>))</span><br><br><span class="hljs-meta"># åˆ†å‰²æˆè®­ç»ƒé›†å’Œé¢„æµ‹é›†</span><br><span class="hljs-title">n_train</span> = int(len(ds_iris)*<span class="hljs-number">0.8</span>)<br><span class="hljs-title">n_valid</span> = len(ds_iris) - n_train<br><span class="hljs-title">ds_train</span>,ds_valid = random_split(ds_iris,[n_train,n_valid])<br><br><span class="hljs-title">print</span>(<span class="hljs-class"><span class="hljs-keyword">type</span>(<span class="hljs-title">ds_iris</span>))</span><br><span class="hljs-title">print</span>(<span class="hljs-class"><span class="hljs-keyword">type</span>(<span class="hljs-title">ds_train</span>))</span><br></code></pre></td></tr></table></figure><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs maxima"># ä½¿ç”¨DataLoaderåŠ è½½æ•°æ®é›†<br>dl_train,dl_valid = DataLoader(ds_train,batch_size = <span class="hljs-number">8</span>),DataLoader(ds_valid,batch_size = <span class="hljs-number">8</span>)<br><br><span class="hljs-keyword">for</span> <span class="hljs-built_in">features</span>,<span class="hljs-built_in">labels</span> <span class="hljs-keyword">in</span> dl_train:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">features</span>,<span class="hljs-built_in">labels</span>)<br>    <span class="hljs-built_in">break</span><br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"># æ¼”ç¤ºåŠ æ³•è¿ç®—ç¬¦ï¼ˆ<span class="hljs-string">`+`</span>ï¼‰çš„åˆå¹¶ä½œç”¨<br>ds_data = ds_train + ds_valid<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;len(ds_train) = &#x27;</span>,<span class="hljs-built_in">len</span>(ds_train))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;len(ds_valid) = &#x27;</span>,<span class="hljs-built_in">len</span>(ds_valid))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;len(ds_train+ds_valid) = &#x27;</span>,<span class="hljs-built_in">len</span>(ds_data))<br></code></pre></td></tr></table></figure><h6 id="2ï¼Œæ ¹æ®å›¾ç‰‡ç›®å½•åˆ›å»ºå›¾ç‰‡æ•°æ®é›†"><a href="#2ï¼Œæ ¹æ®å›¾ç‰‡ç›®å½•åˆ›å»ºå›¾ç‰‡æ•°æ®é›†" class="headerlink" title="2ï¼Œæ ¹æ®å›¾ç‰‡ç›®å½•åˆ›å»ºå›¾ç‰‡æ•°æ®é›†"></a>2ï¼Œæ ¹æ®å›¾ç‰‡ç›®å½•åˆ›å»ºå›¾ç‰‡æ•°æ®é›†</h6><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np <br><span class="hljs-keyword">import</span> torch <br><span class="hljs-title">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader<br><span class="hljs-title">from</span> torchvision <span class="hljs-keyword">import</span> transforms,datasets<br></code></pre></td></tr></table></figure><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-comment">#ä¸€äº›å¸¸ç”¨çš„å›¾ç‰‡å¢å¼ºæ“ä½œ</span><br>from PIL <span class="hljs-built_in">import</span> Image<br><span class="hljs-attr">img</span> = Image.open(&#x27;/home/kesci/input/data6936/data/cat.jpeg&#x27;)<br><br><span class="hljs-comment"># éšæœºæ•°å€¼ç¿»è½¬</span><br>transforms.RandomVerticalFlip()(img)<br><br><span class="hljs-comment">#éšæœºæ—‹è½¬</span><br>transforms.RandomRotation(<span class="hljs-number">45</span>)(img)<br><br><span class="hljs-comment"># å®šä¹‰å›¾ç‰‡å¢å¼ºæ“ä½œ</span><br><span class="hljs-attr">transform_train</span> = transforms.Compose([<br>   transforms.RandomHorizontalFlip(), <span class="hljs-comment">#éšæœºæ°´å¹³ç¿»è½¬</span><br>   transforms.RandomVerticalFlip(), <span class="hljs-comment">#éšæœºå‚ç›´ç¿»è½¬</span><br>   transforms.RandomRotation(<span class="hljs-number">45</span>),  <span class="hljs-comment">#éšæœºåœ¨45åº¦è§’åº¦å†…æ—‹è½¬</span><br>   transforms.ToTensor() <span class="hljs-comment">#è½¬æ¢æˆå¼ é‡</span><br>  ]<br>) <br><br><span class="hljs-attr">transform_valid</span> = transforms.Compose([<br>    transforms.ToTensor()<br>  ]<br>)<br><br></code></pre></td></tr></table></figure><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs maxima"># æ ¹æ®å›¾ç‰‡ç›®å½•åˆ›å»ºæ•°æ®é›†<br>ds_train = datasets.ImageFolder(<span class="hljs-string">&quot;/home/kesci/input/data6936/data/cifar2/train/&quot;</span>,<br>            <span class="hljs-built_in">transform</span> = transform_train,target_transform= <span class="hljs-built_in">lambda</span> t:torch.tensor([t]).<span class="hljs-built_in">float</span>())<br>ds_valid = datasets.ImageFolder(<span class="hljs-string">&quot;/home/kesci/input/data6936/data/cifar2/test/&quot;</span>,<br>            <span class="hljs-built_in">transform</span> = transform_train,target_transform= <span class="hljs-built_in">lambda</span> t:torch.tensor([t]).<span class="hljs-built_in">float</span>())<br><br><span class="hljs-built_in">print</span>(ds_train.class_to_idx)<br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># ä½¿ç”¨DataLoaderåŠ è½½æ•°æ®é›†</span><br>dl_train = DataLoader(ds_train,batch_size = 50,shuffle = <span class="hljs-literal">True</span>,<span class="hljs-attribute">num_workers</span>=3)<br>dl_valid = DataLoader(ds_valid,batch_size = 50,shuffle = <span class="hljs-literal">True</span>,<span class="hljs-attribute">num_workers</span>=3)<br><br><span class="hljs-keyword">for</span> features,labels <span class="hljs-keyword">in</span> dl_train:<br>    <span class="hljs-builtin-name">print</span>(features.shape)<br>    <span class="hljs-builtin-name">print</span>(labels.shape)<br>    break<br><br></code></pre></td></tr></table></figure><h6 id="åˆ›å»ºè‡ªå®šä¹‰æ•°æ®é›†"><a href="#åˆ›å»ºè‡ªå®šä¹‰æ•°æ®é›†" class="headerlink" title="åˆ›å»ºè‡ªå®šä¹‰æ•°æ®é›†"></a>åˆ›å»ºè‡ªå®šä¹‰æ•°æ®é›†</h6><p>ä¸‹é¢é€šè¿‡ç»§æ‰¿Datasetç±»åˆ›å»ºimdbæ–‡æœ¬åˆ†ç±»ä»»åŠ¡çš„è‡ªå®šä¹‰æ•°æ®é›†ã€‚</p><p>å¤§æ¦‚æ€è·¯å¦‚ä¸‹ï¼šé¦–å…ˆï¼Œå¯¹è®­ç»ƒé›†æ–‡æœ¬åˆ†è¯æ„å»ºè¯å…¸ã€‚ç„¶åå°†è®­ç»ƒé›†æ–‡æœ¬å’Œæµ‹è¯•é›†æ–‡æœ¬æ•°æ®è½¬æ¢æˆtokenå•è¯ç¼–ç ã€‚</p><p>æ¥ç€å°†è½¬æ¢æˆå•è¯ç¼–ç çš„è®­ç»ƒé›†æ•°æ®å’Œæµ‹è¯•é›†æ•°æ®æŒ‰æ ·æœ¬åˆ†å‰²æˆå¤šä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ–‡ä»¶ä»£è¡¨ä¸€ä¸ªæ ·æœ¬ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æ–‡ä»¶ååˆ—è¡¨è·å–å¯¹åº”åºå·çš„æ ·æœ¬å†…å®¹ï¼Œä»è€Œæ„å»ºDatasetæ•°æ®é›†ã€‚</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np <br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd <br><span class="hljs-title">from</span> collections <span class="hljs-keyword">import</span> OrderedDict<br><span class="hljs-keyword">import</span> re,string<br><br><span class="hljs-type">MAX_WORDS</span> = <span class="hljs-number">10000</span>  # ä»…è€ƒè™‘æœ€é«˜é¢‘çš„<span class="hljs-number">10000</span>ä¸ªè¯<br><span class="hljs-type">MAX_LEN</span> = <span class="hljs-number">200</span>  # æ¯ä¸ªæ ·æœ¬ä¿ç•™<span class="hljs-number">200</span>ä¸ªè¯çš„é•¿åº¦<br><span class="hljs-type">BATCH_SIZE</span> = <span class="hljs-number">20</span> <br><br><span class="hljs-title">train_data_path</span> = &#x27;/home/kesci/input/data6936/<span class="hljs-class"><span class="hljs-keyword">data</span>/imdb/train.tsv&#x27;</span><br><span class="hljs-title">test_data_path</span> = &#x27;/home/kesci/input/data6936/<span class="hljs-class"><span class="hljs-keyword">data</span>/imdb/test.tsv&#x27;</span><br><span class="hljs-title">train_token_path</span> = &#x27;/home/kesci/input/data6936/<span class="hljs-class"><span class="hljs-keyword">data</span>/imdb/train_token.tsv&#x27;</span><br><span class="hljs-title">test_token_path</span> =  &#x27;/home/kesci/input/data6936/<span class="hljs-class"><span class="hljs-keyword">data</span>/imdb/test_token.tsv&#x27;</span><br><span class="hljs-title">train_samples_path</span> = &#x27;/home/kesci/input/data6936/<span class="hljs-class"><span class="hljs-keyword">data</span>/imdb/train_samples/&#x27;</span><br><span class="hljs-title">test_samples_path</span> =  &#x27;/home/kesci/input/data6936/<span class="hljs-class"><span class="hljs-keyword">data</span>/imdb/test_samples/&#x27;</span><br></code></pre></td></tr></table></figure><p>é¦–å…ˆæˆ‘ä»¬æ„å»ºè¯å…¸ï¼Œå¹¶ä¿ç•™æœ€é«˜é¢‘çš„MAX_WORDSä¸ªè¯ã€‚</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment">##æ„å»ºè¯å…¸</span><br><br>word_count_dict = &#123;&#125;<br><br><span class="hljs-comment">#æ¸…æ´—æ–‡æœ¬</span><br>def clean_text(<span class="hljs-built_in">text</span>):<br>    lowercase = <span class="hljs-built_in">text</span>.lower().replace(<span class="hljs-string">&quot;\n&quot;</span>,<span class="hljs-string">&quot; &quot;</span>)<br>    stripped_html = re.sub(&#x27;&lt;br /&gt;&#x27;, &#x27; &#x27;,lowercase)<br>    cleaned_punctuation = re.sub(&#x27;[%s]&#x27;%re.escape(<span class="hljs-built_in">string</span>.punctuation),&#x27;&#x27;,stripped_html)<br><span class="hljs-built_in">    return</span> cleaned_punctuation<br><br><span class="hljs-keyword">with</span> open(train_data_path,<span class="hljs-string">&quot;r&quot;</span>,encoding = &#x27;utf<span class="hljs-number">-8</span>&#x27;) <span class="hljs-keyword">as</span> f:<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:<br>        label,<span class="hljs-built_in">text</span> = line.split(<span class="hljs-string">&quot;\t&quot;</span>)<br>        cleaned_text = clean_text(<span class="hljs-built_in">text</span>)<br>        <span class="hljs-keyword">for</span> <span class="hljs-built_in">word</span> <span class="hljs-keyword">in</span> cleaned_text.split(<span class="hljs-string">&quot; &quot;</span>):<br>            word_count_dict[<span class="hljs-built_in">word</span>] = word_count_dict.<span class="hljs-keyword">get</span>(<span class="hljs-built_in">word</span>,<span class="hljs-number">0</span>)+<span class="hljs-number">1</span> <br><br>df_word_dict = pd.DataFrame(pd.Series(word_count_dict,<span class="hljs-built_in">name</span> = <span class="hljs-string">&quot;count&quot;</span>))<br>df_word_dict = df_word_dict.sort_values(<span class="hljs-keyword">by</span> = <span class="hljs-string">&quot;count&quot;</span>,ascending =False)<br><br>df_word_dict = df_word_dict[<span class="hljs-number">0</span>:MAX_WORDS<span class="hljs-number">-2</span>] <span class="hljs-comment">#  </span><br>df_word_dict[<span class="hljs-string">&quot;word_id&quot;</span>] = range(<span class="hljs-number">2</span>,MAX_WORDS) <span class="hljs-comment">#ç¼–å·0å’Œ1åˆ†åˆ«ç•™ç»™æœªçŸ¥è¯&lt;unkown&gt;å’Œå¡«å……&lt;padding&gt;</span><br><br>word_id_dict = df_word_dict[<span class="hljs-string">&quot;word_id&quot;</span>].to_dict()<br><br>df_word_dict.head(<span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬åˆ©ç”¨æ„å»ºå¥½çš„è¯å…¸ï¼Œå°†æ–‡æœ¬è½¬æ¢æˆtokenåºå·ã€‚</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-comment">#è½¬æ¢token</span><br><br><span class="hljs-comment"># å¡«å……æ–‡æœ¬</span><br>def pad(data_list,pad_length):<br>    padded_list = data_list.copy()<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data_list)&gt; pad_length:<br>         padded_list = data_list[-pad_length:]<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data_list)&lt; pad_length:<br>         padded_list = [<span class="hljs-number">1</span>]*(pad_length-<span class="hljs-built_in">len</span>(data_list))+data_list<br>    <span class="hljs-literal">return</span> padded_list<br><br>def text_to_token(text_file,token_file):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(text_file,<span class="hljs-string">&quot;r&quot;</span>,encoding = <span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> fin,\<br>      <span class="hljs-built_in">open</span>(token_file,<span class="hljs-string">&quot;w&quot;</span>,encoding = <span class="hljs-string">&#x27;utf-8&#x27;</span>) <span class="hljs-keyword">as</span> fout:<br>        <span class="hljs-keyword">for</span> <span class="hljs-built_in">line</span> <span class="hljs-keyword">in</span> fin:<br>            label,<span class="hljs-keyword">text</span> = <span class="hljs-built_in">line</span>.<span class="hljs-built_in">split</span>(<span class="hljs-string">&quot;\t&quot;</span>)<br>            cleaned_text = clean_text(<span class="hljs-keyword">text</span>)<br>            word_token_list = [word_id_dict.<span class="hljs-built_in">get</span>(<span class="hljs-built_in">word</span>, <span class="hljs-number">0</span>) <span class="hljs-keyword">for</span> <span class="hljs-built_in">word</span> <span class="hljs-keyword">in</span> cleaned_text.<span class="hljs-built_in">split</span>(<span class="hljs-string">&quot; &quot;</span>)]<br>            pad_list = pad(word_token_list,MAX_LEN)<br>            out_line = label+<span class="hljs-string">&quot;\t&quot;</span>+<span class="hljs-string">&quot; &quot;</span>.join([str(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> pad_list])<br>            fout.<span class="hljs-built_in">write</span>(out_line+<span class="hljs-string">&quot;\n&quot;</span>)<br>        <br>text_to_token(train_data_path,train_token_path)<br>text_to_token(test_data_path,test_token_path)<br></code></pre></td></tr></table></figure><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"># åˆ†å‰²æ ·æœ¬<br>import os<br><br><span class="hljs-keyword">if</span> not os.path.exists(train_samples_path):<br>    os.mkdir(train_samples_path)<br>    <br><span class="hljs-keyword">if</span> not os.path.exists(test_samples_path):<br>    os.mkdir(test_samples_path)<br>    <br>    <br>def split<span class="hljs-constructor">_samples(<span class="hljs-params">token_path</span>,<span class="hljs-params">samples_dir</span>)</span>:<br>    <span class="hljs-keyword">with</span> <span class="hljs-keyword">open</span>(token_path,<span class="hljs-string">&quot;r&quot;</span>,encoding = &#x27;utf-<span class="hljs-number">8</span>&#x27;) <span class="hljs-keyword">as</span> fin:<br>        i = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> fin:<br>            <span class="hljs-keyword">with</span> <span class="hljs-keyword">open</span>(samples_dir+<span class="hljs-string">&quot;%d.txt&quot;</span>%i,<span class="hljs-string">&quot;w&quot;</span>,encoding = <span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> fout:<br>                fout.write(line)<br>            i = i+<span class="hljs-number">1</span><br><br>split<span class="hljs-constructor">_samples(<span class="hljs-params">train_token_path</span>,<span class="hljs-params">train_samples_path</span>)</span><br>split<span class="hljs-constructor">_samples(<span class="hljs-params">test_token_path</span>,<span class="hljs-params">test_samples_path</span>)</span><br></code></pre></td></tr></table></figure><p>ä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºæ•°æ®é›†Dataset, ä»æ–‡ä»¶åç§°åˆ—è¡¨ä¸­è¯»å–æ–‡ä»¶å†…å®¹äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">imdbDataset</span>(<span class="hljs-params">Dataset</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self,samples_dir</span>):</span><br>        self.samples_dir = samples_dir<br>        self.samples_paths = os.listdir(samples_dir)<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__len__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.samples_paths)<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__getitem__</span>(<span class="hljs-params">self,index</span>):</span><br>        path = self.samples_dir + self.samples_paths[index]<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path,<span class="hljs-string">&quot;r&quot;</span>,encoding = <span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>            line = f.readline()<br>            label,tokens = line.split(<span class="hljs-string">&quot;\t&quot;</span>)<br>            label = torch.tensor([<span class="hljs-built_in">float</span>(label)],dtype = torch.<span class="hljs-built_in">float</span>)<br>            feature = torch.tensor([<span class="hljs-built_in">int</span>(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> tokens.split(<span class="hljs-string">&quot; &quot;</span>)],dtype = torch.long)<br>            <span class="hljs-keyword">return</span>  (feature,label)<br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">ds_train</span> = imdbDataset(train_samples_path)<br><span class="hljs-attr">ds_test</span> = imdbDataset(test_samples_path)<br></code></pre></td></tr></table></figure><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">dl_train = <span class="hljs-constructor">DataLoader(<span class="hljs-params">ds_train</span>,<span class="hljs-params">batch_size</span> = BATCH_SIZE,<span class="hljs-params">shuffle</span> = True,<span class="hljs-params">num_workers</span>=4)</span><br>dl_test = <span class="hljs-constructor">DataLoader(<span class="hljs-params">ds_test</span>,<span class="hljs-params">batch_size</span> = BATCH_SIZE,<span class="hljs-params">num_workers</span>=4)</span><br><br><span class="hljs-keyword">for</span> features,labels <span class="hljs-keyword">in</span> dl_train:<br>    print(features)<br>    print(labels)<br>    break<br></code></pre></td></tr></table></figure><p>æœ€åæ„å»ºæ¨¡å‹æµ‹è¯•ä¸€ä¸‹æ•°æ®é›†ç®¡é“æ˜¯å¦å¯ç”¨ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">import torch<br>from torch import nn <br>import importlib <br>from torchkeras import Model,summary<br><br><span class="hljs-keyword">class</span> <span class="hljs-constructor">Net(Model)</span>:<br>    <br>    def <span class="hljs-constructor">__init__(<span class="hljs-params">self</span>)</span>:<br>        super(Net, self).<span class="hljs-constructor">__init__()</span><br>        <br>        #è®¾ç½®padding_idxå‚æ•°åå°†åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å°†å¡«å……çš„tokenå§‹ç»ˆèµ‹å€¼ä¸º<span class="hljs-number">0</span>å‘é‡<br>        self.embedding = nn.<span class="hljs-constructor">Embedding(<span class="hljs-params">num_embeddings</span> = MAX_WORDS,<span class="hljs-params">embedding_dim</span> = 3,<span class="hljs-params">padding_idx</span> = 1)</span><br>        self.conv = nn.<span class="hljs-constructor">Sequential()</span><br>        self.conv.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;conv_1&quot;</span>,<span class="hljs-params">nn</span>.Conv1d(<span class="hljs-params">in_channels</span> = 3,<span class="hljs-params">out_channels</span> = 16,<span class="hljs-params">kernel_size</span> = 5)</span>)<br>        self.conv.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;pool_1&quot;</span>,<span class="hljs-params">nn</span>.MaxPool1d(<span class="hljs-params">kernel_size</span> = 2)</span>)<br>        self.conv.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;relu_1&quot;</span>,<span class="hljs-params">nn</span>.ReLU()</span>)<br>        self.conv.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;conv_2&quot;</span>,<span class="hljs-params">nn</span>.Conv1d(<span class="hljs-params">in_channels</span> = 16,<span class="hljs-params">out_channels</span> = 128,<span class="hljs-params">kernel_size</span> = 2)</span>)<br>        self.conv.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;pool_2&quot;</span>,<span class="hljs-params">nn</span>.MaxPool1d(<span class="hljs-params">kernel_size</span> = 2)</span>)<br>        self.conv.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;relu_2&quot;</span>,<span class="hljs-params">nn</span>.ReLU()</span>)<br>        <br>        self.dense = nn.<span class="hljs-constructor">Sequential()</span><br>        self.dense.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;flatten&quot;</span>,<span class="hljs-params">nn</span>.Flatten()</span>)<br>        self.dense.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;linear&quot;</span>,<span class="hljs-params">nn</span>.Linear(6144,1)</span>)<br>        self.dense.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;sigmoid&quot;</span>,<span class="hljs-params">nn</span>.Sigmoid()</span>)<br>        <br>    def forward(self,x):<br>        x = self.embedding(x).transpose(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)<br>        x = self.conv(x)<br>        y = self.dense(x)<br>        return y<br>        <br>model = <span class="hljs-constructor">Net()</span><br>print(model)<br><br>model.summary(input_shape = (<span class="hljs-number">200</span>,),input_dtype = torch.LongTensor)<br></code></pre></td></tr></table></figure><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"># ç¼–è¯‘æ¨¡å‹<br>def accuracy(y_pred,y_true):<br>    y_pred = torch.where(y_pred&gt;<span class="hljs-number">0.5</span>,torch.ones<span class="hljs-constructor">_like(<span class="hljs-params">y_pred</span>,<span class="hljs-params">dtype</span> = <span class="hljs-params">torch</span>.<span class="hljs-params">float32</span>)</span>,<br>                      torch.zeros<span class="hljs-constructor">_like(<span class="hljs-params">y_pred</span>,<span class="hljs-params">dtype</span> = <span class="hljs-params">torch</span>.<span class="hljs-params">float32</span>)</span>)<br>    acc = torch.mean(<span class="hljs-number">1</span>-torch.abs(y_true-y_pred))<br>    return acc<br><br>model.compile(loss_func = nn.<span class="hljs-constructor">BCELoss()</span>,optimizer= torch.optim.<span class="hljs-constructor">Adagrad(<span class="hljs-params">model</span>.<span class="hljs-params">parameters</span>()</span>,lr = <span class="hljs-number">0.02</span>),<br>             metrics_dict=&#123;<span class="hljs-string">&quot;accuracy&quot;</span>:accuracy&#125;)<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># è®­ç»ƒæ¨¡å‹</span><br><span class="hljs-attribute">dfhistory</span> = model.fit(<span class="hljs-number">10</span>,dl_train,dl_val=dl_test,log_step_freq= <span class="hljs-number">200</span>)<br></code></pre></td></tr></table></figure><h5 id="ä½¿ç”¨DataLoaderåŠ è½½æ•°æ®é›†"><a href="#ä½¿ç”¨DataLoaderåŠ è½½æ•°æ®é›†" class="headerlink" title="ä½¿ç”¨DataLoaderåŠ è½½æ•°æ®é›†"></a>ä½¿ç”¨DataLoaderåŠ è½½æ•°æ®é›†</h5><p>DataLoaderèƒ½å¤Ÿæ§åˆ¶batchçš„å¤§å°ï¼Œbatchä¸­å…ƒç´ çš„é‡‡æ ·æ–¹æ³•ï¼Œä»¥åŠå°†batchç»“æœæ•´ç†æˆæ¨¡å‹æ‰€éœ€è¾“å…¥å½¢å¼çš„æ–¹æ³•ï¼Œå¹¶ä¸”èƒ½å¤Ÿä½¿ç”¨å¤šè¿›ç¨‹è¯»å–æ•°æ®ã€‚</p><p>DataLoaderçš„å‡½æ•°ç­¾åå¦‚ä¸‹ã€‚</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs routeros">DataLoader(  <br>    dataset,  <br>    <span class="hljs-attribute">batch_size</span>=1,  <br>    <span class="hljs-attribute">shuffle</span>=<span class="hljs-literal">False</span>,  <br>    <span class="hljs-attribute">sampler</span>=None,  <br>    <span class="hljs-attribute">batch_sampler</span>=None,  <br>    <span class="hljs-attribute">num_workers</span>=0,  <br>    <span class="hljs-attribute">collate_fn</span>=None,  <br>    <span class="hljs-attribute">pin_memory</span>=<span class="hljs-literal">False</span>,  <br>    <span class="hljs-attribute">drop_last</span>=<span class="hljs-literal">False</span>,  <br>    <span class="hljs-attribute">timeout</span>=0,  <br>    <span class="hljs-attribute">worker_init_fn</span>=None,  <br>    <span class="hljs-attribute">multiprocessing_context</span>=None,  <br>)<br></code></pre></td></tr></table></figure><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä»…ä»…ä¼šé…ç½® dataset, batch_size, shuffle, num_workers, drop_lastè¿™äº”ä¸ªå‚æ•°ï¼Œå…¶ä»–å‚æ•°ä½¿ç”¨é»˜è®¤å€¼å³å¯ã€‚</p><p>DataLoaderé™¤äº†å¯ä»¥åŠ è½½æˆ‘ä»¬å‰é¢è®²çš„ torch.utils.data.Dataset å¤–ï¼Œè¿˜èƒ½å¤ŸåŠ è½½å¦å¤–ä¸€ç§æ•°æ®é›† torch.utils.data.IterableDatasetã€‚</p><p>å’ŒDatasetæ•°æ®é›†ç›¸å½“äºä¸€ç§åˆ—è¡¨ç»“æ„ä¸åŒï¼ŒIterableDatasetç›¸å½“äºä¸€ç§è¿­ä»£å™¨ç»“æ„ã€‚ å®ƒæ›´åŠ å¤æ‚ï¼Œä¸€èˆ¬è¾ƒå°‘ä½¿ç”¨ã€‚</p><ul><li>dataset : æ•°æ®é›†</li><li>batch_size: æ‰¹æ¬¡å¤§å°</li><li>shuffle: æ˜¯å¦ä¹±åº</li><li>sampler: æ ·æœ¬é‡‡æ ·å‡½æ•°ï¼Œä¸€èˆ¬æ— éœ€è®¾ç½®ã€‚</li><li>batch_sampler: æ‰¹æ¬¡é‡‡æ ·å‡½æ•°ï¼Œä¸€èˆ¬æ— éœ€è®¾ç½®ã€‚</li><li>num_workers: ä½¿ç”¨å¤šè¿›ç¨‹è¯»å–æ•°æ®ï¼Œè®¾ç½®çš„è¿›ç¨‹æ•°ã€‚</li><li>collate_fn: æ•´ç†ä¸€ä¸ªæ‰¹æ¬¡æ•°æ®çš„å‡½æ•°ã€‚</li><li>pin_memory: æ˜¯å¦è®¾ç½®ä¸ºé”ä¸šå†…å­˜ã€‚é»˜è®¤ä¸ºFalseï¼Œé”ä¸šå†…å­˜ä¸ä¼šä½¿ç”¨è™šæ‹Ÿå†…å­˜(ç¡¬ç›˜)ï¼Œä»é”ä¸šå†…å­˜æ‹·è´åˆ°GPUä¸Šé€Ÿåº¦ä¼šæ›´å¿«ã€‚</li><li>drop_last: æ˜¯å¦ä¸¢å¼ƒæœ€åä¸€ä¸ªæ ·æœ¬æ•°é‡ä¸è¶³batch_sizeæ‰¹æ¬¡æ•°æ®ã€‚</li><li>timeout: åŠ è½½ä¸€ä¸ªæ•°æ®æ‰¹æ¬¡çš„æœ€é•¿ç­‰å¾…æ—¶é—´ï¼Œä¸€èˆ¬æ— éœ€è®¾ç½®ã€‚</li><li>worker_init_fn: æ¯ä¸ªworkerä¸­datasetçš„åˆå§‹åŒ–å‡½æ•°ï¼Œå¸¸ç”¨äº IterableDatasetã€‚ä¸€èˆ¬ä¸ä½¿ç”¨ã€‚</li></ul><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-comment">#æ„å»ºè¾“å…¥æ•°æ®ç®¡é“</span><br><span class="hljs-attr">ds</span> = TensorDataset(torch.arange(<span class="hljs-number">1</span>,<span class="hljs-number">50</span>))<br><span class="hljs-attr">dl</span> = DataLoader(ds,<br>                <span class="hljs-attr">batch_size</span> = <span class="hljs-number">10</span>,<br>                <span class="hljs-attr">shuffle=</span> True,<br>                <span class="hljs-attr">num_workers=2,</span><br>                <span class="hljs-attr">drop_last</span> = True)<br><span class="hljs-comment">#è¿­ä»£æ•°æ®</span><br>for batch, <span class="hljs-keyword">in</span> dl:<br>    print(batch)<br></code></pre></td></tr></table></figure><p>æ¬è¿è‡ªï¼š</p><ul><li><a href="https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1">https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorchå­¦ä¹ ç¬”è®°6-nn.functionalå’Œnn.Module</title>
    <link href="/2022/01/20/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B06-nn-functional%E5%92%8Cnn-Module/"/>
    <url>/2022/01/20/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B06-nn-functional%E5%92%8Cnn-Module/</url>
    
    <content type="html"><![CDATA[<h2 id="ç¥ç»ç½‘ç»œç›¸å…³çš„ç»„ä»¶-å¦‚æ¿€æ´»å‡½æ•°ï¼Œæ¨¡å‹å±‚ï¼ŒæŸå¤±å‡½æ•°"><a href="#ç¥ç»ç½‘ç»œç›¸å…³çš„ç»„ä»¶-å¦‚æ¿€æ´»å‡½æ•°ï¼Œæ¨¡å‹å±‚ï¼ŒæŸå¤±å‡½æ•°" class="headerlink" title="ç¥ç»ç½‘ç»œç›¸å…³çš„ç»„ä»¶(å¦‚æ¿€æ´»å‡½æ•°ï¼Œæ¨¡å‹å±‚ï¼ŒæŸå¤±å‡½æ•°)"></a>ç¥ç»ç½‘ç»œç›¸å…³çš„ç»„ä»¶(å¦‚æ¿€æ´»å‡½æ•°ï¼Œæ¨¡å‹å±‚ï¼ŒæŸå¤±å‡½æ•°)</h2><span id="more"></span><h5 id="nn-functional-å’Œ-nn-Module"><a href="#nn-functional-å’Œ-nn-Module" class="headerlink" title="nn.functional å’Œ nn.Module"></a>nn.functional å’Œ nn.Module</h5><p>Pytorchå’Œç¥ç»ç½‘ç»œç›¸å…³çš„åŠŸèƒ½ç»„ä»¶å¤§å¤šéƒ½å°è£…åœ¨ torch.nnæ¨¡å—ä¸‹ã€‚<br>è¿™äº›åŠŸèƒ½ç»„ä»¶çš„ç»å¤§éƒ¨åˆ†æ—¢æœ‰å‡½æ•°å½¢å¼å®ç°ï¼Œä¹Ÿæœ‰ç±»å½¢å¼å®ç°ã€‚<br>å…¶ä¸­nn.functional(ä¸€èˆ¬å¼•å…¥åæ”¹åä¸ºF)æœ‰å„ç§åŠŸèƒ½ç»„ä»¶çš„å‡½æ•°å®ç°ã€‚ä¾‹å¦‚ï¼š</p><h6 id="æ¿€æ´»å‡½æ•°"><a href="#æ¿€æ´»å‡½æ•°" class="headerlink" title="(æ¿€æ´»å‡½æ•°)"></a>(æ¿€æ´»å‡½æ•°)</h6><ul><li>F.relu</li><li>F.sigmoid</li><li>F.tanh</li><li>F.softmax</li></ul><h6 id="æ¨¡å‹å±‚"><a href="#æ¨¡å‹å±‚" class="headerlink" title="(æ¨¡å‹å±‚)"></a>(æ¨¡å‹å±‚)</h6><ul><li>F.linear</li><li>F.conv2d</li><li>F.max_pool2d</li><li>F.dropout2d</li><li>F.embedding</li></ul><h6 id="æŸå¤±å‡½æ•°"><a href="#æŸå¤±å‡½æ•°" class="headerlink" title="(æŸå¤±å‡½æ•°)"></a>(æŸå¤±å‡½æ•°)</h6><ul><li>F.binary_cross_entropy</li><li>F.mse_loss</li><li>F.cross_entropy</li></ul><p>ä¸ºäº†ä¾¿äºå¯¹å‚æ•°è¿›è¡Œç®¡ç†ï¼Œä¸€èˆ¬é€šè¿‡ç»§æ‰¿ nn.Module è½¬æ¢æˆä¸ºç±»çš„å®ç°å½¢å¼ï¼Œå¹¶ç›´æ¥å°è£…åœ¨ nn æ¨¡å—ä¸‹ã€‚ä¾‹å¦‚ï¼š</p><h6 id="æ¿€æ´»å‡½æ•°-1"><a href="#æ¿€æ´»å‡½æ•°-1" class="headerlink" title="(æ¿€æ´»å‡½æ•°)"></a>(æ¿€æ´»å‡½æ•°)</h6><ul><li>nn.ReLU</li><li>nn.Sigmoid</li><li>nn.Tanh</li><li>nn.Softmax</li></ul><h6 id="æ¨¡å‹å±‚-1"><a href="#æ¨¡å‹å±‚-1" class="headerlink" title="(æ¨¡å‹å±‚)"></a>(æ¨¡å‹å±‚)</h6><ul><li>nn.Linear</li><li>nn.Conv2d</li><li>nn.MaxPool2d</li><li>nn.Dropout2d</li><li>nn.Embedding</li></ul><h6 id="æŸå¤±å‡½æ•°-1"><a href="#æŸå¤±å‡½æ•°-1" class="headerlink" title="(æŸå¤±å‡½æ•°)"></a>(æŸå¤±å‡½æ•°)</h6><ul><li>nn.BCELoss</li><li>nn.MSELoss</li><li>nn.CrossEntropyLoss</li></ul><p>å®é™…ä¸Šnn.Moduleé™¤äº†å¯ä»¥ç®¡ç†å…¶å¼•ç”¨çš„å„ç§å‚æ•°ï¼Œè¿˜å¯ä»¥ç®¡ç†å…¶å¼•ç”¨çš„å­æ¨¡å—ï¼ŒåŠŸèƒ½ååˆ†å¼ºå¤§ã€‚</p><h5 id="ä½¿ç”¨nn-Moduleæ¥ç®¡ç†å‚æ•°"><a href="#ä½¿ç”¨nn-Moduleæ¥ç®¡ç†å‚æ•°" class="headerlink" title="ä½¿ç”¨nn.Moduleæ¥ç®¡ç†å‚æ•°"></a>ä½¿ç”¨nn.Moduleæ¥ç®¡ç†å‚æ•°</h5><p>åœ¨Pytorchä¸­ï¼Œæ¨¡å‹çš„å‚æ•°æ˜¯éœ€è¦è¢«ä¼˜åŒ–å™¨è®­ç»ƒçš„ï¼Œå› æ­¤ï¼Œé€šå¸¸è¦è®¾ç½®å‚æ•°ä¸º requires_grad = True çš„å¼ é‡ã€‚<br>åŒæ—¶ï¼Œåœ¨ä¸€ä¸ªæ¨¡å‹ä¸­ï¼Œå¾€å¾€æœ‰è®¸å¤šçš„å‚æ•°ï¼Œè¦æ‰‹åŠ¨ç®¡ç†è¿™äº›å‚æ•°å¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ã€‚<br>Pytorchä¸€èˆ¬å°†å‚æ•°ç”¨nn.Parameteræ¥è¡¨ç¤ºï¼Œå¹¶ä¸”ç”¨nn.Moduleæ¥ç®¡ç†å…¶ç»“æ„ä¸‹çš„æ‰€æœ‰å‚æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch <br><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn <br><span class="hljs-keyword">import</span> torch.nn.functional  <span class="hljs-keyword">as</span> F<br><span class="hljs-keyword">from</span> matplotlib <span class="hljs-keyword">import</span> pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-comment"># nn.Parameter å…·æœ‰ requires_grad = True å±æ€§</span><br>w = nn.Parameter(torch.randn(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>))<br><span class="hljs-built_in">print</span>(w)<br><span class="hljs-built_in">print</span>(w.requires_grad)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">arameter containing:</span><br><span class="hljs-string">tensor([[ 1.2790,  0.6851],</span><br><span class="hljs-string">        [-1.9961,  0.4121]], requires_grad=True)</span><br><span class="hljs-string">True</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-comment"># nn.ParameterList å¯ä»¥å°†å¤šä¸ªnn.Parameterç»„æˆä¸€ä¸ªåˆ—è¡¨</span><br>params_list = nn.ParameterList([nn.Parameter(torch.rand(<span class="hljs-number">8</span>,i)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">3</span>)])<br><span class="hljs-built_in">print</span>(params_list)<br><span class="hljs-built_in">print</span>(params_list[<span class="hljs-number">0</span>].requires_grad)<br><br><span class="hljs-comment"># nn.ParameterDict å¯ä»¥å°†å¤šä¸ªnn.Parameterç»„æˆä¸€ä¸ªå­—å…¸</span><br>params_dict = nn.ParameterDict(&#123;<span class="hljs-string">&quot;a&quot;</span>:nn.Parameter(torch.rand(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)),<br>                               <span class="hljs-string">&quot;b&quot;</span>:nn.Parameter(torch.zeros(<span class="hljs-number">2</span>))&#125;)<br><span class="hljs-built_in">print</span>(params_dict)<br><span class="hljs-built_in">print</span>(params_dict[<span class="hljs-string">&quot;a&quot;</span>].requires_grad)<br></code></pre></td></tr></table></figure><figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs monkey"><span class="hljs-meta"># å¯ä»¥ç”¨Moduleå°†å®ƒä»¬ç®¡ç†èµ·æ¥</span><span class="hljs-meta"></span><br><span class="hljs-meta"># module.parameters()è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨ï¼ŒåŒ…æ‹¬å…¶ç»“æ„ä¸‹çš„æ‰€æœ‰parameters</span><br><br><span class="hljs-keyword">module</span> = nn.<span class="hljs-keyword">Module</span>()<br><span class="hljs-keyword">module</span>.w = w<br><span class="hljs-keyword">module</span>.params_list = params_list<br><span class="hljs-keyword">module</span>.params_dict = params_dict<br><br>num_param = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> param in <span class="hljs-keyword">module</span>.parameters():<br>    <span class="hljs-built_in">print</span>(param,<span class="hljs-string">&quot;\n&quot;</span>)<br>    num_param = num_param + <span class="hljs-number">1</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;number of Parameters =&quot;</span>,num_param)<br></code></pre></td></tr></table></figure><p>å®è·µå½“ä¸­ï¼Œä¸€èˆ¬é€šè¿‡ç»§æ‰¿nn.Moduleæ¥æ„å»ºæ¨¡å—ç±»ï¼Œå¹¶å°†æ‰€æœ‰å«æœ‰éœ€è¦å­¦ä¹ çš„å‚æ•°çš„éƒ¨åˆ†æ”¾åœ¨æ„é€ å‡½æ•°ä¸­ã€‚<br>ä»¥ä¸‹èŒƒä¾‹ä¸ºPytorchä¸­nn.Linearçš„æºç çš„ç®€åŒ–ç‰ˆæœ¬<br>å¯ä»¥çœ‹åˆ°å®ƒå°†éœ€è¦å­¦ä¹ çš„å‚æ•°æ”¾åœ¨äº†__init__æ„é€ å‡½æ•°ä¸­ï¼Œå¹¶åœ¨forwardä¸­è°ƒç”¨F.linearå‡½æ•°æ¥å®ç°è®¡ç®—é€»è¾‘ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Linear</span>(<span class="hljs-params">nn.Module</span>):</span><br>    __constants__ = [<span class="hljs-string">&#x27;in_features&#x27;</span>, <span class="hljs-string">&#x27;out_features&#x27;</span>]<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, in_features, out_features, bias=<span class="hljs-literal">True</span></span>):</span><br>        <span class="hljs-built_in">super</span>(Linear, self).__init__()<br>        self.in_features = in_features<br>        self.out_features = out_features<br>        self.weight = nn.Parameter(torch.Tensor(out_features, in_features))<br>        <span class="hljs-keyword">if</span> bias:<br>            self.bias = nn.Parameter(torch.Tensor(out_features))<br>        <span class="hljs-keyword">else</span>:<br>            self.register_parameter(<span class="hljs-string">&#x27;bias&#x27;</span>, <span class="hljs-literal">None</span>)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">self, <span class="hljs-built_in">input</span></span>):</span><br>        <span class="hljs-keyword">return</span> F.linear(<span class="hljs-built_in">input</span>, self.weight, self.bias)<br></code></pre></td></tr></table></figure><h5 id="ä½¿ç”¨nn-Moduleæ¥ç®¡ç†å­æ¨¡å—"><a href="#ä½¿ç”¨nn-Moduleæ¥ç®¡ç†å­æ¨¡å—" class="headerlink" title="ä½¿ç”¨nn.Moduleæ¥ç®¡ç†å­æ¨¡å—"></a>ä½¿ç”¨nn.Moduleæ¥ç®¡ç†å­æ¨¡å—</h5><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½å¾ˆå°‘ç›´æ¥ä½¿ç”¨ nn.Parameteræ¥å®šä¹‰å‚æ•°æ„å»ºæ¨¡å‹ï¼Œè€Œæ˜¯é€šè¿‡ä¸€äº›æ‹¼è£…ä¸€äº›å¸¸ç”¨çš„æ¨¡å‹å±‚æ¥æ„é€ æ¨¡å‹ã€‚<br>è¿™äº›æ¨¡å‹å±‚ä¹Ÿæ˜¯ç»§æ‰¿è‡ªnn.Moduleçš„å¯¹è±¡,æœ¬èº«ä¹ŸåŒ…æ‹¬å‚æ•°ï¼Œå±äºæˆ‘ä»¬è¦å®šä¹‰çš„æ¨¡å—çš„å­æ¨¡å—ã€‚</p><p>nn.Moduleæä¾›äº†ä¸€äº›æ–¹æ³•å¯ä»¥ç®¡ç†è¿™äº›å­æ¨¡å—ã€‚</p><ul><li>children() æ–¹æ³•: è¿”å›ç”Ÿæˆå™¨ï¼ŒåŒ…æ‹¬æ¨¡å—ä¸‹çš„æ‰€æœ‰å­æ¨¡å—ã€‚</li><li>named_children()æ–¹æ³•ï¼šè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨ï¼ŒåŒ…æ‹¬æ¨¡å—ä¸‹çš„æ‰€æœ‰å­æ¨¡å—ï¼Œä»¥åŠå®ƒä»¬çš„åå­—ã€‚</li><li>modules()æ–¹æ³•ï¼šè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨ï¼ŒåŒ…æ‹¬æ¨¡å—ä¸‹çš„æ‰€æœ‰å„ä¸ªå±‚çº§çš„æ¨¡å—ï¼ŒåŒ…æ‹¬æ¨¡å—æœ¬èº«ã€‚</li><li>named_modules()æ–¹æ³•ï¼šè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨ï¼ŒåŒ…æ‹¬æ¨¡å—ä¸‹çš„æ‰€æœ‰å„ä¸ªå±‚çº§çš„æ¨¡å—ä»¥åŠå®ƒä»¬çš„åå­—ï¼ŒåŒ…æ‹¬æ¨¡å—æœ¬èº«ã€‚</li></ul><p>å…¶ä¸­chidren()æ–¹æ³•å’Œnamed_children()æ–¹æ³•è¾ƒå¤šä½¿ç”¨ã€‚<br>modules()æ–¹æ³•å’Œnamed_modules()æ–¹æ³•è¾ƒå°‘ä½¿ç”¨ï¼Œå…¶åŠŸèƒ½å¯ä»¥é€šè¿‡å¤šä¸ªnamed_children()çš„åµŒå¥—ä½¿ç”¨å®ç°ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">class</span> <span class="hljs-constructor">Net(<span class="hljs-params">nn</span>.Module)</span>:<br>    <br>    def <span class="hljs-constructor">__init__(<span class="hljs-params">self</span>)</span>:<br>        super(Net, self).<span class="hljs-constructor">__init__()</span><br>        <br>        self.embedding = nn.<span class="hljs-constructor">Embedding(<span class="hljs-params">num_embeddings</span> = 10000,<span class="hljs-params">embedding_dim</span> = 3,<span class="hljs-params">padding_idx</span> = 1)</span><br>        self.conv = nn.<span class="hljs-constructor">Sequential()</span><br>        self.conv.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;conv_1&quot;</span>,<span class="hljs-params">nn</span>.Conv1d(<span class="hljs-params">in_channels</span> = 3,<span class="hljs-params">out_channels</span> = 16,<span class="hljs-params">kernel_size</span> = 5)</span>)<br>        self.conv.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;pool_1&quot;</span>,<span class="hljs-params">nn</span>.MaxPool1d(<span class="hljs-params">kernel_size</span> = 2)</span>)<br>        self.conv.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;relu_1&quot;</span>,<span class="hljs-params">nn</span>.ReLU()</span>)<br>        self.conv.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;conv_2&quot;</span>,<span class="hljs-params">nn</span>.Conv1d(<span class="hljs-params">in_channels</span> = 16,<span class="hljs-params">out_channels</span> = 128,<span class="hljs-params">kernel_size</span> = 2)</span>)<br>        self.conv.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;pool_2&quot;</span>,<span class="hljs-params">nn</span>.MaxPool1d(<span class="hljs-params">kernel_size</span> = 2)</span>)<br>        self.conv.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;relu_2&quot;</span>,<span class="hljs-params">nn</span>.ReLU()</span>)<br>        <br>        self.dense = nn.<span class="hljs-constructor">Sequential()</span><br>        self.dense.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;flatten&quot;</span>,<span class="hljs-params">nn</span>.Flatten()</span>)<br>        self.dense.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;linear&quot;</span>,<span class="hljs-params">nn</span>.Linear(6144,1)</span>)<br>        self.dense.add<span class="hljs-constructor">_module(<span class="hljs-string">&quot;sigmoid&quot;</span>,<span class="hljs-params">nn</span>.Sigmoid()</span>)<br>        <br>    def forward(self,x):<br>        x = self.embedding(x).transpose(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)<br>        x = self.conv(x)<br>        y = self.dense(x)<br>        return y<br>    <br>net = <span class="hljs-constructor">Net()</span><br></code></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-tag">i</span> = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> child <span class="hljs-keyword">in</span> net<span class="hljs-selector-class">.children</span>():<br>    i+=<span class="hljs-number">1</span><br>    print(child,<span class="hljs-string">&quot;\n&quot;</span>)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(<span class="hljs-string">&quot;child number&quot;</span>,i)</span></span><br><br><br><span class="hljs-selector-tag">i</span> = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> name,child <span class="hljs-keyword">in</span> net<span class="hljs-selector-class">.named_children</span>():<br>    i+=<span class="hljs-number">1</span><br>    print(name,<span class="hljs-string">&quot;:&quot;</span>,child,<span class="hljs-string">&quot;\n&quot;</span>)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(<span class="hljs-string">&quot;child number&quot;</span>,i)</span></span><br><br><br><span class="hljs-selector-tag">i</span> = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> module <span class="hljs-keyword">in</span> net<span class="hljs-selector-class">.modules</span>():<br>    i+=<span class="hljs-number">1</span><br>    print(module)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(<span class="hljs-string">&quot;module number:&quot;</span>,i)</span></span><br><br></code></pre></td></tr></table></figure><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡named_childrenæ–¹æ³•æ‰¾åˆ°embeddingå±‚ï¼Œå¹¶å°†å…¶å‚æ•°è®¾ç½®ä¸ºä¸å¯è®­ç»ƒ(ç›¸å½“äºå†»ç»“embeddingå±‚)ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">children_dict = &#123;name:module <span class="hljs-keyword">for</span> name,module <span class="hljs-keyword">in</span> net<span class="hljs-selector-class">.named_children</span>()&#125;<br><br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(children_dict)</span></span><br>embedding = children_dict<span class="hljs-selector-attr">[<span class="hljs-string">&quot;embedding&quot;</span>]</span><br>embedding<span class="hljs-selector-class">.requires_grad_</span>(False) #å†»ç»“å…¶å‚æ•°<br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">#å¯ä»¥çœ‹åˆ°å…¶ç¬¬ä¸€å±‚çš„å‚æ•°å·²ç»ä¸å¯ä»¥è¢«è®­ç»ƒäº†ã€‚<br>for param in embedding.parameters():<br><span class="hljs-code">    print(param.requires_grad)</span><br><span class="hljs-code">    print(param.numel())</span><br><br>&#x27;&#x27;&#x27;<br><span class="hljs-code">False</span><br><span class="hljs-code">30000</span><br>&#x27;&#x27;&#x27;<br></code></pre></td></tr></table></figure><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-title">from</span> torchkeras <span class="hljs-keyword">import</span> summary<br><span class="hljs-title">summary</span>(net,input_shape = (<span class="hljs-number">200</span>,),input_d<span class="hljs-keyword">type</span> = torch.<span class="hljs-type">LongTensor</span>)<br># ä¸å¯è®­ç»ƒå‚æ•°æ•°é‡å¢åŠ <br></code></pre></td></tr></table></figure><p>æ¬è¿è‡ªï¼š</p><ul><li><a href="https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1">https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorchå­¦ä¹ ç¬”è®°5-å¼ é‡çš„æ•°å­¦è¿ç®—</title>
    <link href="/2022/01/20/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B05-%E5%BC%A0%E9%87%8F%E7%9A%84%E6%95%B0%E5%AD%A6%E8%BF%90%E7%AE%97/"/>
    <url>/2022/01/20/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B05-%E5%BC%A0%E9%87%8F%E7%9A%84%E6%95%B0%E5%AD%A6%E8%BF%90%E7%AE%97/</url>
    
    <content type="html"><![CDATA[<h2 id="å¼ é‡æ•°å­¦è¿ç®—ä¸»è¦æœ‰ï¼šæ ‡é‡è¿ç®—ï¼Œå‘é‡è¿ç®—ï¼ŒçŸ©é˜µè¿ç®—ï¼Œä»¥åŠå¼ é‡è¿ç®—çš„å¹¿æ’­æœºåˆ¶"><a href="#å¼ é‡æ•°å­¦è¿ç®—ä¸»è¦æœ‰ï¼šæ ‡é‡è¿ç®—ï¼Œå‘é‡è¿ç®—ï¼ŒçŸ©é˜µè¿ç®—ï¼Œä»¥åŠå¼ é‡è¿ç®—çš„å¹¿æ’­æœºåˆ¶" class="headerlink" title="å¼ é‡æ•°å­¦è¿ç®—ä¸»è¦æœ‰ï¼šæ ‡é‡è¿ç®—ï¼Œå‘é‡è¿ç®—ï¼ŒçŸ©é˜µè¿ç®—ï¼Œä»¥åŠå¼ é‡è¿ç®—çš„å¹¿æ’­æœºåˆ¶"></a>å¼ é‡æ•°å­¦è¿ç®—ä¸»è¦æœ‰ï¼šæ ‡é‡è¿ç®—ï¼Œå‘é‡è¿ç®—ï¼ŒçŸ©é˜µè¿ç®—ï¼Œä»¥åŠå¼ é‡è¿ç®—çš„å¹¿æ’­æœºåˆ¶</h2><span id="more"></span><h5 id="æ ‡é‡è¿ç®—"><a href="#æ ‡é‡è¿ç®—" class="headerlink" title="æ ‡é‡è¿ç®—"></a>æ ‡é‡è¿ç®—</h5><p>å¼ é‡çš„æ•°å­¦è¿ç®—ç¬¦å¯ä»¥åˆ†ä¸ºæ ‡é‡è¿ç®—ç¬¦ã€å‘é‡è¿ç®—ç¬¦ã€ä»¥åŠçŸ©é˜µè¿ç®—ç¬¦ã€‚<br>åŠ å‡ä¹˜é™¤ä¹˜æ–¹ï¼Œä»¥åŠä¸‰è§’å‡½æ•°ï¼ŒæŒ‡æ•°ï¼Œå¯¹æ•°ç­‰å¸¸è§å‡½æ•°ï¼Œé€»è¾‘æ¯”è¾ƒè¿ç®—ç¬¦ç­‰éƒ½æ˜¯æ ‡é‡è¿ç®—ç¬¦ã€‚<br>æ ‡é‡è¿ç®—ç¬¦çš„ç‰¹ç‚¹æ˜¯å¯¹å¼ é‡å®æ–½é€å…ƒç´ è¿ç®—ã€‚<br>æœ‰äº›æ ‡é‡è¿ç®—ç¬¦å¯¹å¸¸ç”¨çš„æ•°å­¦è¿ç®—ç¬¦è¿›è¡Œäº†é‡è½½ã€‚å¹¶ä¸”æ”¯æŒç±»ä¼¼numpyçš„å¹¿æ’­ç‰¹æ€§ã€‚</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"># å¹…å€¼è£å‰ª<br>x = torch.tensor([0.9,-0.8,100.0,-20.0,0.7])<br>y = torch.clamp(x,min=-1,max = 1)<br>z = torch.clamp(x,max = 1)<br>print(y)<br>print(z)<br>&#x27;&#x27;&#x27;<br><span class="hljs-code">tensor([ 0.9000, -0.8000,  1.0000, -1.0000,  0.7000])</span><br><span class="hljs-code">tensor([  0.9000,  -0.8000,   1.0000, -20.0000,   0.7000])</span><br>&#x27;&#x27;&#x27;<br></code></pre></td></tr></table></figure><h5 id="å‘é‡è¿ç®—"><a href="#å‘é‡è¿ç®—" class="headerlink" title="å‘é‡è¿ç®—"></a>å‘é‡è¿ç®—</h5><p>å‘é‡è¿ç®—ç¬¦åªåœ¨ä¸€ä¸ªç‰¹å®šè½´ä¸Šè¿ç®—ï¼Œå°†ä¸€ä¸ªå‘é‡æ˜ å°„åˆ°ä¸€ä¸ªæ ‡é‡æˆ–è€…å¦å¤–ä¸€ä¸ªå‘é‡</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-tag">a</span> = torch<span class="hljs-selector-class">.arange</span>(<span class="hljs-number">1</span>,<span class="hljs-number">10</span>)<span class="hljs-selector-class">.float</span>()<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(torch.sum(a)</span></span>)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(torch.mean(a)</span></span>)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(torch.max(a)</span></span>)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(torch.min(a)</span></span>)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(torch.prod(a)</span></span>) #ç´¯ä¹˜<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(torch.std(a)</span></span>)  #æ ‡å‡†å·®<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(torch.var(a)</span></span>)  #æ–¹å·®<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(torch.median(a)</span></span>) #ä¸­ä½æ•°<br></code></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">#æŒ‡å®šç»´åº¦è®¡ç®—ç»Ÿè®¡å€¼<br><span class="hljs-selector-tag">b</span> = <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.view</span>(<span class="hljs-number">3</span>,<span class="hljs-number">3</span>)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(b)</span></span><br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(torch.max(b,dim = <span class="hljs-number">0</span>)</span></span>)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(torch.max(b,dim = <span class="hljs-number">1</span>)</span></span>)<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#torch.sortå’Œtorch.topkå¯ä»¥å¯¹å¼ é‡æ’åº</span><br><span class="hljs-attribute">a</span> = torch.tensor([[<span class="hljs-number">9</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">4</span>]]).float()<br><span class="hljs-attribute">print</span>(torch.topk(a,<span class="hljs-number">2</span>,dim = <span class="hljs-number">0</span>),<span class="hljs-string">&quot;\n&quot;</span>)<br><span class="hljs-attribute">print</span>(torch.topk(a,<span class="hljs-number">2</span>,dim = <span class="hljs-number">1</span>),<span class="hljs-string">&quot;\n&quot;</span>)<br><span class="hljs-attribute">print</span>(torch.sort(a,dim = <span class="hljs-number">1</span>),<span class="hljs-string">&quot;\n&quot;</span>)<br><br><span class="hljs-comment">#åˆ©ç”¨torch.topkå¯ä»¥åœ¨Pytorchä¸­å®ç°KNNç®—æ³•</span><br></code></pre></td></tr></table></figure><h5 id="çŸ©é˜µè¿ç®—"><a href="#çŸ©é˜µè¿ç®—" class="headerlink" title="çŸ©é˜µè¿ç®—"></a>çŸ©é˜µè¿ç®—</h5><p>çŸ©é˜µå¿…é¡»æ˜¯äºŒç»´çš„ã€‚ç±»ä¼¼torch.tensor([1,2,3])è¿™æ ·çš„ä¸æ˜¯çŸ©é˜µã€‚<br>çŸ©é˜µè¿ç®—åŒ…æ‹¬ï¼šçŸ©é˜µä¹˜æ³•ï¼ŒçŸ©é˜µè½¬ç½®ï¼ŒçŸ©é˜µé€†ï¼ŒçŸ©é˜µæ±‚è¿¹ï¼ŒçŸ©é˜µèŒƒæ•°ï¼ŒçŸ©é˜µè¡Œåˆ—å¼ï¼ŒçŸ©é˜µæ±‚ç‰¹å¾å€¼ï¼ŒçŸ©é˜µåˆ†è§£ç­‰è¿ç®—ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs stylus">#çŸ©é˜µä¹˜æ³•<br><span class="hljs-selector-tag">a</span> = torch<span class="hljs-selector-class">.tensor</span>(<span class="hljs-selector-attr">[[1,2]</span>,<span class="hljs-selector-attr">[3,4]</span>])<br><span class="hljs-selector-tag">b</span> = torch<span class="hljs-selector-class">.tensor</span>(<span class="hljs-selector-attr">[[2,0]</span>,<span class="hljs-selector-attr">[0,2]</span>])<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(a@b)</span></span>  #ç­‰ä»·äºtorch<span class="hljs-selector-class">.matmul</span>(<span class="hljs-selector-tag">a</span>,b) æˆ– torch<span class="hljs-selector-class">.mm</span>(<span class="hljs-selector-tag">a</span>,b)<br><br>#çŸ©é˜µè½¬ç½®<br><span class="hljs-selector-tag">a</span> = torch<span class="hljs-selector-class">.tensor</span>(<span class="hljs-selector-attr">[[1.0,2]</span>,<span class="hljs-selector-attr">[3,4]</span>])<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(a.t()</span></span>)<br><br>#çŸ©é˜µé€†ï¼Œå¿…é¡»ä¸ºæµ®ç‚¹ç±»å‹<br><span class="hljs-selector-tag">a</span> = torch<span class="hljs-selector-class">.tensor</span>(<span class="hljs-selector-attr">[[1.0,2]</span>,<span class="hljs-selector-attr">[3,4]</span>])<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(torch.inverse(a)</span></span>)<br><br>#çŸ©é˜µæ±‚trace<br><span class="hljs-selector-tag">a</span> = torch<span class="hljs-selector-class">.tensor</span>(<span class="hljs-selector-attr">[[1.0,2]</span>,<span class="hljs-selector-attr">[3,4]</span>])<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(torch.trace(a)</span></span>)<br><br>#çŸ©é˜µæ±‚èŒƒæ•°<br><span class="hljs-selector-tag">a</span> = torch<span class="hljs-selector-class">.tensor</span>(<span class="hljs-selector-attr">[[1.0,2]</span>,<span class="hljs-selector-attr">[3,4]</span>])<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(torch.norm(a)</span></span>)<br><br>#çŸ©é˜µè¡Œåˆ—å¼<br><span class="hljs-selector-tag">a</span> = torch<span class="hljs-selector-class">.tensor</span>(<span class="hljs-selector-attr">[[1.0,2]</span>,<span class="hljs-selector-attr">[3,4]</span>])<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(torch.det(a)</span></span>)<br><br>#çŸ©é˜µç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡<br><span class="hljs-selector-tag">a</span> = torch<span class="hljs-selector-class">.tensor</span>(<span class="hljs-selector-attr">[[1.0,2]</span>,<span class="hljs-selector-attr">[-5,4]</span>],dtype = torch.<span class="hljs-attribute">float</span>)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(torch.eig(a,eigenvectors=True)</span></span>)<br><br>#ä¸¤ä¸ªç‰¹å¾å€¼åˆ†åˆ«æ˜¯ -<span class="hljs-number">2.5</span>+<span class="hljs-number">2.7839</span>j, <span class="hljs-number">2.5</span>-<span class="hljs-number">2.7839</span>j <br><br><br>#çŸ©é˜µQRåˆ†è§£, å°†ä¸€ä¸ªæ–¹é˜µåˆ†è§£ä¸ºä¸€ä¸ªæ­£äº¤çŸ©é˜µqå’Œä¸Šä¸‰è§’çŸ©é˜µr<br>#QRåˆ†è§£å®é™…ä¸Šæ˜¯å¯¹çŸ©é˜µaå®æ–½Schmidtæ­£äº¤åŒ–å¾—åˆ°<span class="hljs-selector-tag">q</span><br><span class="hljs-selector-tag">a</span>  = torch<span class="hljs-selector-class">.tensor</span>(<span class="hljs-selector-attr">[[1.0,2.0]</span>,<span class="hljs-selector-attr">[3.0,4.0]</span>])<br><span class="hljs-selector-tag">q</span>,r = torch<span class="hljs-selector-class">.qr</span>(a)<br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(q,<span class="hljs-string">&quot;\n&quot;</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(r,<span class="hljs-string">&quot;\n&quot;</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(q@r)</span></span><br><br><br>#çŸ©é˜µsvdåˆ†è§£<br>#svdåˆ†è§£å¯ä»¥å°†ä»»æ„ä¸€ä¸ªçŸ©é˜µåˆ†è§£ä¸ºä¸€ä¸ªæ­£äº¤çŸ©é˜µu,ä¸€ä¸ªå¯¹è§’é˜µså’Œä¸€ä¸ªæ­£äº¤çŸ©é˜µv<span class="hljs-selector-class">.t</span>()çš„ä¹˜ç§¯<br>#svdå¸¸ç”¨äºçŸ©é˜µå‹ç¼©å’Œé™ç»´<br>a=torch<span class="hljs-selector-class">.tensor</span>(<span class="hljs-selector-attr">[[1.0,2.0]</span>,<span class="hljs-selector-attr">[3.0,4.0]</span>,<span class="hljs-selector-attr">[5.0,6.0]</span>])<br><br>u,s,v = torch<span class="hljs-selector-class">.svd</span>(a)<br><br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(u,<span class="hljs-string">&quot;\n&quot;</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(s,<span class="hljs-string">&quot;\n&quot;</span>)</span></span><br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(v,<span class="hljs-string">&quot;\n&quot;</span>)</span></span><br><br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(u@torch.diag(s)</span></span>@v<span class="hljs-selector-class">.t</span>())<br><br>#åˆ©ç”¨svdåˆ†è§£å¯ä»¥åœ¨Pytorchä¸­å®ç°ä¸»æˆåˆ†åˆ†æé™ç»´<br></code></pre></td></tr></table></figure><h5 id="å¹¿æ’­æœºåˆ¶"><a href="#å¹¿æ’­æœºåˆ¶" class="headerlink" title="å¹¿æ’­æœºåˆ¶"></a>å¹¿æ’­æœºåˆ¶</h5><p>Pytorchçš„å¹¿æ’­è§„åˆ™å’Œnumpyæ˜¯ä¸€æ ·çš„:</p><ul><li>1ã€å¦‚æœå¼ é‡çš„ç»´åº¦ä¸åŒï¼Œå°†ç»´åº¦è¾ƒå°çš„å¼ é‡è¿›è¡Œæ‰©å±•ï¼Œç›´åˆ°ä¸¤ä¸ªå¼ é‡çš„ç»´åº¦éƒ½ä¸€æ ·ã€‚</li><li>2ã€å¦‚æœä¸¤ä¸ªå¼ é‡åœ¨æŸä¸ªç»´åº¦ä¸Šçš„é•¿åº¦æ˜¯ç›¸åŒçš„ï¼Œæˆ–è€…å…¶ä¸­ä¸€ä¸ªå¼ é‡åœ¨è¯¥ç»´åº¦ä¸Šçš„é•¿åº¦ä¸º1ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¯´è¿™ä¸¤ä¸ªå¼ é‡åœ¨è¯¥ç»´åº¦ä¸Šæ˜¯ç›¸å®¹çš„ã€‚</li><li>3ã€å¦‚æœä¸¤ä¸ªå¼ é‡åœ¨æ‰€æœ‰ç»´åº¦ä¸Šéƒ½æ˜¯ç›¸å®¹çš„ï¼Œå®ƒä»¬å°±èƒ½ä½¿ç”¨å¹¿æ’­ã€‚</li><li>4ã€å¹¿æ’­ä¹‹åï¼Œæ¯ä¸ªç»´åº¦çš„é•¿åº¦å°†å–ä¸¤ä¸ªå¼ é‡åœ¨è¯¥ç»´åº¦é•¿åº¦çš„è¾ƒå¤§å€¼ã€‚</li><li>5ã€åœ¨ä»»ä½•ä¸€ä¸ªç»´åº¦ä¸Šï¼Œå¦‚æœä¸€ä¸ªå¼ é‡çš„é•¿åº¦ä¸º1ï¼Œå¦ä¸€ä¸ªå¼ é‡é•¿åº¦å¤§äº1ï¼Œé‚£ä¹ˆåœ¨è¯¥ç»´åº¦ä¸Šï¼Œå°±å¥½åƒæ˜¯å¯¹ç¬¬ä¸€ä¸ªå¼ é‡è¿›è¡Œäº†å¤åˆ¶ã€‚</li></ul><p>torch.broadcast_tensorså¯ä»¥å°†å¤šä¸ªå¼ é‡æ ¹æ®å¹¿æ’­è§„åˆ™è½¬æ¢æˆç›¸åŒçš„ç»´åº¦ã€‚</p><p>æ¬è¿è‡ªï¼š</p><ul><li><a href="https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1">https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorchå­¦ä¹ ç¬”è®°4-å¼ é‡çš„ç»“æ„æ“ä½œ</title>
    <link href="/2022/01/19/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B04-%E5%BC%A0%E9%87%8F%E7%9A%84%E7%BB%93%E6%9E%84%E6%93%8D%E4%BD%9C/"/>
    <url>/2022/01/19/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B04-%E5%BC%A0%E9%87%8F%E7%9A%84%E7%BB%93%E6%9E%84%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<h2 id="å¼ é‡çš„æ“ä½œä¸»è¦åŒ…æ‹¬å¼ é‡çš„ç»“æ„æ“ä½œå’Œå¼ é‡çš„æ•°å­¦è¿ç®—"><a href="#å¼ é‡çš„æ“ä½œä¸»è¦åŒ…æ‹¬å¼ é‡çš„ç»“æ„æ“ä½œå’Œå¼ é‡çš„æ•°å­¦è¿ç®—" class="headerlink" title="å¼ é‡çš„æ“ä½œä¸»è¦åŒ…æ‹¬å¼ é‡çš„ç»“æ„æ“ä½œå’Œå¼ é‡çš„æ•°å­¦è¿ç®—"></a>å¼ é‡çš„æ“ä½œä¸»è¦åŒ…æ‹¬å¼ é‡çš„ç»“æ„æ“ä½œå’Œå¼ é‡çš„æ•°å­¦è¿ç®—</h2><span id="more"></span><p>å¼ é‡ç»“æ„æ“ä½œè¯¸å¦‚ï¼šå¼ é‡åˆ›å»ºï¼Œç´¢å¼•åˆ‡ç‰‡ï¼Œç»´åº¦å˜æ¢ï¼Œåˆå¹¶åˆ†å‰²ã€‚<br>å¼ é‡æ•°å­¦è¿ç®—ä¸»è¦æœ‰ï¼šæ ‡é‡è¿ç®—ï¼Œå‘é‡è¿ç®—ï¼ŒçŸ©é˜µè¿ç®—ã€‚å¦å¤–æˆ‘ä»¬ä¼šä»‹ç»å¼ é‡è¿ç®—çš„å¹¿æ’­æœºåˆ¶ã€‚</p><h5 id="åˆ›å»ºå¼ é‡"><a href="#åˆ›å»ºå¼ é‡" class="headerlink" title="åˆ›å»ºå¼ é‡"></a>åˆ›å»ºå¼ é‡</h5><p>å¼ é‡åˆ›å»ºçš„è®¸å¤šæ–¹æ³•å’Œnumpyä¸­åˆ›å»ºarrayçš„æ–¹æ³•å¾ˆåƒ</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">import numpy as np<br>import torch <br><br>a = torch.tensor([1,2,3],dtype = torch.float)<br>print(a)<br>&#x27;&#x27;&#x27;<br><span class="hljs-code">tensor([1., 2., 3.])</span><br>&#x27;&#x27;&#x27;<br><br>b = torch.arange(1,10,step = 2)<br>print(b)<br>&#x27;&#x27;&#x27;<br><span class="hljs-code">tensor([1, 3, 5, 7, 9])</span><br>&#x27;&#x27;&#x27;<br><br>c = torch.linspace(0.0, 2*3.14, 10)<br>print(c)<br>&#x27;&#x27;&#x27;<br><span class="hljs-code">tensor([0.0000, 0.6978, 1.3956, 2.0933, 2.7911, 3.4889, 4.1867, 4.8844, 5.5822,</span><br><span class="hljs-code">        6.2800])</span><br>&#x27;&#x27;&#x27;<br></code></pre></td></tr></table></figure><p>å¦å¤–è¿˜æœ‰ torch.ones()ã€torch.zero_like()ã€torch.zeros() ç­‰æ–¹æ³•åˆ›å»º</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"># å‡åŒ€éšæœºåˆ†å¸ƒ<br>torch.manual_seed(0)<br>minval, maxval = 0, 10<br>a = minval + (maxval - minval) * torch.rand([5])<br>print(a)<br>&#x27;&#x27;&#x27;<br><span class="hljs-code">tensor([4.9626, 7.6822, 0.8848, 1.3203, 3.0742])</span><br>&#x27;&#x27;&#x27;<br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"># æ­£å¤ªåˆ†å¸ƒéšæœº<br>b = torch.normal(mean = torch.zeros(3,3), std = torch.ones(3,3))<br>print(b)<br>&#x27;&#x27;&#x27;<br><span class="hljs-code">tensor([[ 0.5507,  0.2704,  0.6472],</span><br><span class="hljs-code">        [ 0.2490, -0.3354,  0.4564],</span><br><span class="hljs-code">        [-0.6255,  0.4539, -1.3740]])</span><br>&#x27;&#x27;&#x27;<br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"># æ•´æ•°éšæœºæ’åˆ—<br>d = torch.randperm(20)<br>print(d)<br>&#x27;&#x27;&#x27;<br><span class="hljs-code">tensor([ 3, 17,  9, 19,  1, 18,  4, 13, 15, 12,  0, 16,  7, 11,  2,  5,  8, 10,</span><br><span class="hljs-code">         6, 14])</span><br>&#x27;&#x27;&#x27;<br></code></pre></td></tr></table></figure><p>æ­¤å¤–è¿˜æœ‰ torch.eye() (å•ä½çŸ©é˜µ) ã€ torch.diag() (å¯¹è§’çŸ©é˜µ) ç­‰</p><h5 id="ç´¢å¼•åˆ‡ç‰‡"><a href="#ç´¢å¼•åˆ‡ç‰‡" class="headerlink" title="ç´¢å¼•åˆ‡ç‰‡"></a>ç´¢å¼•åˆ‡ç‰‡</h5><p>å¼ é‡çš„ç´¢å¼•åˆ‡ç‰‡æ–¹å¼å’Œnumpyå‡ ä¹æ˜¯ä¸€æ ·çš„ã€‚åˆ‡ç‰‡æ—¶æ”¯æŒç¼ºçœå‚æ•°å’Œçœç•¥å·ã€‚å¯ä»¥é€šè¿‡ç´¢å¼•å’Œåˆ‡ç‰‡å¯¹éƒ¨åˆ†å…ƒç´ è¿›è¡Œä¿®æ”¹ã€‚<br>æ­¤å¤–ï¼Œå¯¹äºä¸è§„åˆ™çš„åˆ‡ç‰‡æå–,å¯ä»¥ä½¿ç”¨ torch.index_select, torch.masked_select, torch.take<br>å¦‚æœè¦é€šè¿‡ä¿®æ”¹å¼ é‡çš„æŸäº›å…ƒç´ å¾—åˆ°æ–°çš„å¼ é‡ï¼Œå¯ä»¥ä½¿ç”¨ torch.where,torch.masked_fill,torch.index_fill</p><ul><li>torch.whereå¯ä»¥ç†è§£ä¸ºifçš„å¼ é‡ç‰ˆæœ¬ã€‚</li><li>torch.index_fillçš„é€‰å–å…ƒç´ é€»è¾‘å’Œtorch.index_selectç›¸åŒã€‚</li><li>torch.masked_fillçš„é€‰å–å…ƒç´ é€»è¾‘å’Œtorch.masked_selectç›¸åŒã€‚</li></ul><h5 id="ç»´åº¦å˜æ¢"><a href="#ç»´åº¦å˜æ¢" class="headerlink" title="ç»´åº¦å˜æ¢"></a>ç»´åº¦å˜æ¢</h5><p>ç»´åº¦å˜æ¢ç›¸å…³å‡½æ•°ä¸»è¦æœ‰ torch.reshape(æˆ–è€…è°ƒç”¨å¼ é‡çš„viewæ–¹æ³•), torch.squeeze, torch.unsqueeze, torch.transpose</p><ul><li>torch.reshape å¯ä»¥æ”¹å˜å¼ é‡çš„å½¢çŠ¶ã€‚</li><li>torch.squeeze å¯ä»¥å‡å°‘ç»´åº¦ã€‚</li><li>torch.unsqueeze å¯ä»¥å¢åŠ ç»´åº¦ã€‚</li><li>torch.transpose å¯ä»¥äº¤æ¢ç»´åº¦ã€‚</li></ul><p>å¦‚æœå¼ é‡åœ¨æŸä¸ªç»´åº¦ä¸Šåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œåˆ©ç”¨torch.squeezeå¯ä»¥æ¶ˆé™¤è¿™ä¸ªç»´åº¦ã€‚<br>torch.unsqueezeçš„ä½œç”¨å’Œtorch.squeezeçš„ä½œç”¨ç›¸åã€‚</p><p>torch.transposeå¯ä»¥äº¤æ¢å¼ é‡çš„ç»´åº¦ï¼Œtorch.transposeå¸¸ç”¨äºå›¾ç‰‡å­˜å‚¨æ ¼å¼çš„å˜æ¢ä¸Šã€‚<br>å¦‚æœæ˜¯äºŒç»´çš„çŸ©é˜µï¼Œé€šå¸¸ä¼šè°ƒç”¨çŸ©é˜µçš„è½¬ç½®æ–¹æ³• matrix.t()ï¼Œç­‰ä»·äº torch.transpose(matrix,0,1)ã€‚</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">minval=0<br>maxval=255<br># Batch,Height,Width,Channel<br>data = torch.floor(minval + (maxval-minval)*torch.rand([100,256,256,4])).int()<br>print(data.shape)<br><br># è½¬æ¢æˆ Pytorché»˜è®¤çš„å›¾ç‰‡æ ¼å¼ Batch,Channel,Height,Width <br># éœ€è¦äº¤æ¢ä¸¤æ¬¡<br>data<span class="hljs-emphasis">_t = torch.transpose(torch.transpose(data,1,2),1,3)</span><br><span class="hljs-emphasis">print(data_</span>t.shape)<br>&#x27;&#x27;&#x27;<br><span class="hljs-code">torch.Size([100, 256, 256, 4])</span><br><span class="hljs-code">torch.Size([100, 4, 256, 256])</span><br>&#x27;&#x27;&#x27;<br></code></pre></td></tr></table></figure><h5 id="åˆå¹¶åˆ†å‰²"><a href="#åˆå¹¶åˆ†å‰²" class="headerlink" title="åˆå¹¶åˆ†å‰²"></a>åˆå¹¶åˆ†å‰²</h5><p>å¯ä»¥ç”¨torch.catæ–¹æ³•å’Œtorch.stackæ–¹æ³•å°†å¤šä¸ªå¼ é‡åˆå¹¶ï¼Œå¯ä»¥ç”¨torch.splitæ–¹æ³•æŠŠä¸€ä¸ªå¼ é‡åˆ†å‰²æˆå¤šä¸ªå¼ é‡ã€‚<br>torch.catå’Œtorch.stackæœ‰ç•¥å¾®çš„åŒºåˆ«ï¼Œtorch.catæ˜¯è¿æ¥ï¼Œä¸ä¼šå¢åŠ ç»´åº¦ï¼Œè€Œtorch.stackæ˜¯å †å ï¼Œä¼šå¢åŠ ç»´åº¦ã€‚<br>torch.splitæ˜¯torch.catçš„é€†è¿ç®—ï¼Œå¯ä»¥æŒ‡å®šåˆ†å‰²ä»½æ•°å¹³å‡åˆ†å‰²ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®šæ¯ä»½çš„è®°å½•æ•°é‡è¿›è¡Œåˆ†å‰²</p><p>æ¬è¿è‡ªï¼š</p><ul><li><a href="https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1">https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorchå­¦ä¹ ç¬”è®°3-åŠ¨æ€è®¡ç®—å›¾</title>
    <link href="/2022/01/18/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03-%E5%8A%A8%E6%80%81%E8%AE%A1%E7%AE%97%E5%9B%BE/"/>
    <url>/2022/01/18/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03-%E5%8A%A8%E6%80%81%E8%AE%A1%E7%AE%97%E5%9B%BE/</url>
    
    <content type="html"><![CDATA[<h2 id="åŠ¨æ€è®¡ç®—å›¾"><a href="#åŠ¨æ€è®¡ç®—å›¾" class="headerlink" title="åŠ¨æ€è®¡ç®—å›¾"></a>åŠ¨æ€è®¡ç®—å›¾</h2><span id="more"></span><h5 id="Pytorchçš„åŠ¨æ€è®¡ç®—å›¾"><a href="#Pytorchçš„åŠ¨æ€è®¡ç®—å›¾" class="headerlink" title="Pytorchçš„åŠ¨æ€è®¡ç®—å›¾"></a>Pytorchçš„åŠ¨æ€è®¡ç®—å›¾</h5><p>åŒ…æ‹¬ï¼š</p><ul><li>åŠ¨æ€è®¡ç®—å›¾ç®€ä»‹</li><li>è®¡ç®—å›¾ä¸­çš„Function</li><li>è®¡ç®—å›¾å’Œåå‘ä¼ æ’­</li><li>å¶å­èŠ‚ç‚¹å’Œéå¶å­èŠ‚ç‚¹</li><li>è®¡ç®—å›¾åœ¨TensorBoardä¸­çš„å¯è§†åŒ–</li></ul><h5 id="åŠ¨æ€è®¡ç®—å›¾ç®€ä»‹"><a href="#åŠ¨æ€è®¡ç®—å›¾ç®€ä»‹" class="headerlink" title="åŠ¨æ€è®¡ç®—å›¾ç®€ä»‹"></a>åŠ¨æ€è®¡ç®—å›¾ç®€ä»‹</h5><p>Pytorchçš„è®¡ç®—å›¾ç”±èŠ‚ç‚¹å’Œè¾¹ç»„æˆï¼ŒèŠ‚ç‚¹è¡¨ç¤ºå¼ é‡æˆ–è€…Functionï¼Œè¾¹è¡¨ç¤ºå¼ é‡å’ŒFunctionä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚<br>Pytorchä¸­çš„è®¡ç®—å›¾æ˜¯åŠ¨æ€å›¾ã€‚è¿™é‡Œçš„åŠ¨æ€ä¸»è¦æœ‰ä¸¤é‡å«ä¹‰ã€‚<br>ç¬¬ä¸€å±‚å«ä¹‰æ˜¯ï¼šè®¡ç®—å›¾çš„æ­£å‘ä¼ æ’­æ˜¯ç«‹å³æ‰§è¡Œçš„ã€‚æ— éœ€ç­‰å¾…å®Œæ•´çš„è®¡ç®—å›¾åˆ›å»ºå®Œæ¯•ï¼Œæ¯æ¡è¯­å¥éƒ½ä¼šåœ¨è®¡ç®—å›¾ä¸­åŠ¨æ€æ·»åŠ èŠ‚ç‚¹å’Œè¾¹ï¼Œå¹¶ç«‹å³æ‰§è¡Œæ­£å‘ä¼ æ’­å¾—åˆ°è®¡ç®—ç»“æœã€‚<br>ç¬¬äºŒå±‚å«ä¹‰æ˜¯ï¼šè®¡ç®—å›¾åœ¨åå‘ä¼ æ’­åç«‹å³é”€æ¯ã€‚ä¸‹æ¬¡è°ƒç”¨éœ€è¦é‡æ–°æ„å»ºè®¡ç®—å›¾ã€‚å¦‚æœåœ¨ç¨‹åºä¸­ä½¿ç”¨äº†backwardæ–¹æ³•æ‰§è¡Œäº†åå‘ä¼ æ’­ï¼Œæˆ–è€…åˆ©ç”¨torch.autograd.gradæ–¹æ³•è®¡ç®—äº†æ¢¯åº¦ï¼Œé‚£ä¹ˆåˆ›å»ºçš„è®¡ç®—å›¾ä¼šè¢«ç«‹å³é”€æ¯ï¼Œé‡Šæ”¾å­˜å‚¨ç©ºé—´ï¼Œä¸‹æ¬¡è°ƒç”¨éœ€è¦é‡æ–°åˆ›å»ºã€‚</p><h6 id="è®¡ç®—å›¾çš„æ­£å‘ä¼ æ’­æ˜¯ç«‹å³æ‰§è¡Œçš„ã€‚"><a href="#è®¡ç®—å›¾çš„æ­£å‘ä¼ æ’­æ˜¯ç«‹å³æ‰§è¡Œçš„ã€‚" class="headerlink" title="è®¡ç®—å›¾çš„æ­£å‘ä¼ æ’­æ˜¯ç«‹å³æ‰§è¡Œçš„ã€‚"></a>è®¡ç®—å›¾çš„æ­£å‘ä¼ æ’­æ˜¯ç«‹å³æ‰§è¡Œçš„ã€‚</h6><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">import torch <br>w = torch.tensor([[3.0,1.0]],requires<span class="hljs-emphasis">_grad=True)</span><br><span class="hljs-emphasis">b = torch.tensor([[3.0]],requires_grad=True)</span><br><span class="hljs-emphasis">X = torch.randn(10,2)</span><br><span class="hljs-emphasis">Y = torch.randn(10,1)</span><br><span class="hljs-emphasis">Y_hat = X@w.t() + b  # Y_hatå®šä¹‰åå…¶æ­£å‘ä¼ æ’­è¢«ç«‹å³æ‰§è¡Œï¼Œä¸å…¶åé¢çš„lossåˆ›å»ºè¯­å¥æ— å…³</span><br><span class="hljs-emphasis">loss = torch.mean(torch.pow(Y_</span>hat-Y,2))<br><br>print(loss.data)<br>print(Y_hat.data)<br><br>&#x27;&#x27;&#x27;<br><span class="hljs-code">tensor(16.8885)</span><br><span class="hljs-code">tensor([[ 3.3509],</span><br><span class="hljs-code">        [-2.5233],</span><br><span class="hljs-code">        [ 5.1586],</span><br><span class="hljs-code">        [ 4.9135],</span><br><span class="hljs-code">        [ 1.0449],</span><br><span class="hljs-code">        [ 8.0712],</span><br><span class="hljs-code">        [ 5.0686],</span><br><span class="hljs-code">        [ 0.5840],</span><br><span class="hljs-code">        [-0.0614],</span><br><span class="hljs-code">        [ 2.7492]])</span><br>&#x27;&#x27;&#x27;<br></code></pre></td></tr></table></figure><h6 id="è®¡ç®—å›¾åœ¨åå‘ä¼ æ’­åç«‹å³é”€æ¯ã€‚"><a href="#è®¡ç®—å›¾åœ¨åå‘ä¼ æ’­åç«‹å³é”€æ¯ã€‚" class="headerlink" title="è®¡ç®—å›¾åœ¨åå‘ä¼ æ’­åç«‹å³é”€æ¯ã€‚"></a>è®¡ç®—å›¾åœ¨åå‘ä¼ æ’­åç«‹å³é”€æ¯ã€‚</h6><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">import</span> torch <br><span class="hljs-attribute">w</span> = torch.tensor([[<span class="hljs-number">3</span>.<span class="hljs-number">0</span>,<span class="hljs-number">1</span>.<span class="hljs-number">0</span>]],requires_grad=True)<br><span class="hljs-attribute">b</span> = torch.tensor([[<span class="hljs-number">3</span>.<span class="hljs-number">0</span>]],requires_grad=True)<br><span class="hljs-attribute">X</span> = torch.randn(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>)<br><span class="hljs-attribute">Y</span> = torch.randn(<span class="hljs-number">10</span>,<span class="hljs-number">1</span>)<br><span class="hljs-attribute">Y_hat</span> = X@w.t() + b  # Y_hatå®šä¹‰åå…¶æ­£å‘ä¼ æ’­è¢«ç«‹å³æ‰§è¡Œï¼Œä¸å…¶åé¢çš„lossåˆ›å»ºè¯­å¥æ— å…³<br><span class="hljs-attribute">loss</span> = torch.mean(torch.pow(Y_hat-Y,<span class="hljs-number">2</span>))<br><br><span class="hljs-comment">#è®¡ç®—å›¾åœ¨åå‘ä¼ æ’­åç«‹å³é”€æ¯ï¼Œå¦‚æœéœ€è¦ä¿ç•™è®¡ç®—å›¾, éœ€è¦è®¾ç½®retain_graph = True</span><br><span class="hljs-attribute">loss</span>.backward()  #loss.backward(retain_graph = True) <br><br><span class="hljs-comment">#loss.backward() #å¦‚æœå†æ¬¡æ‰§è¡Œåå‘ä¼ æ’­å°†æŠ¥é”™</span><br></code></pre></td></tr></table></figure><h5 id="è®¡ç®—å›¾ä¸­çš„Function"><a href="#è®¡ç®—å›¾ä¸­çš„Function" class="headerlink" title="è®¡ç®—å›¾ä¸­çš„Function"></a>è®¡ç®—å›¾ä¸­çš„Function</h5><p>è®¡ç®—å›¾ä¸­çš„ å¼ é‡æˆ‘ä»¬å·²ç»æ¯”è¾ƒç†Ÿæ‚‰äº†, è®¡ç®—å›¾ä¸­çš„å¦å¤–ä¸€ç§èŠ‚ç‚¹æ˜¯Function, å®é™…ä¸Šå°±æ˜¯ Pytorchä¸­å„ç§å¯¹å¼ é‡æ“ä½œçš„å‡½æ•°ã€‚<br>è¿™äº›Functionå’Œæˆ‘ä»¬Pythonä¸­çš„å‡½æ•°æœ‰ä¸€ä¸ªè¾ƒå¤§çš„åŒºåˆ«ï¼Œé‚£å°±æ˜¯å®ƒåŒæ—¶åŒ…æ‹¬æ­£å‘è®¡ç®—é€»è¾‘å’Œåå‘ä¼ æ’­çš„é€»è¾‘ã€‚<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»§æ‰¿torch.autograd.Functionæ¥åˆ›å»ºè¿™ç§æ”¯æŒåå‘ä¼ æ’­çš„Function</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyReLU</span>(<span class="hljs-params">torch.autograd.Function</span>):</span><br>   <br>    <span class="hljs-comment">#æ­£å‘ä¼ æ’­é€»è¾‘ï¼Œå¯ä»¥ç”¨ctxå­˜å‚¨ä¸€äº›å€¼ï¼Œä¾›åå‘ä¼ æ’­ä½¿ç”¨ã€‚</span><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">ctx, <span class="hljs-built_in">input</span></span>):</span><br>        ctx.save_for_backward(<span class="hljs-built_in">input</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">input</span>.clamp(<span class="hljs-built_in">min</span>=<span class="hljs-number">0</span>)<br><br>    <span class="hljs-comment">#åå‘ä¼ æ’­é€»è¾‘</span><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">backward</span>(<span class="hljs-params">ctx, grad_output</span>):</span><br>        <span class="hljs-built_in">input</span>, = ctx.saved_tensors<br>        grad_input = grad_output.clone()<br>        grad_input[<span class="hljs-built_in">input</span> &lt; <span class="hljs-number">0</span>] = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">return</span> grad_input<br><br><br>w = torch.tensor([[<span class="hljs-number">3.0</span>,<span class="hljs-number">1.0</span>]],requires_grad=<span class="hljs-literal">True</span>)<br>b = torch.tensor([[<span class="hljs-number">3.0</span>]],requires_grad=<span class="hljs-literal">True</span>)<br>X = torch.tensor([[-<span class="hljs-number">1.0</span>,-<span class="hljs-number">1.0</span>],[<span class="hljs-number">1.0</span>,<span class="hljs-number">1.0</span>]])<br>Y = torch.tensor([[<span class="hljs-number">2.0</span>,<span class="hljs-number">3.0</span>]])<br><br>relu = MyReLU.apply <span class="hljs-comment"># reluç°åœ¨ä¹Ÿå¯ä»¥å…·æœ‰æ­£å‘ä¼ æ’­å’Œåå‘ä¼ æ’­åŠŸèƒ½</span><br>Y_hat = relu(X@w.t() + b)<br>loss = torch.mean(torch.<span class="hljs-built_in">pow</span>(Y_hat-Y,<span class="hljs-number">2</span>))<br><br>loss.backward()<br><br><span class="hljs-built_in">print</span>(w.grad)<br><span class="hljs-built_in">print</span>(b.grad)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">tensor([[4.5000, 4.5000]])</span><br><span class="hljs-string">tensor([[4.5000]])</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"># Y<span class="hljs-emphasis">_hatçš„æ¢¯åº¦å‡½æ•°å³æ˜¯æˆ‘ä»¬è‡ªå·±æ‰€å®šä¹‰çš„ MyReLU.backward</span><br><span class="hljs-emphasis">print(Y_hat.grad_</span>fn)<br>&#x27;&#x27;&#x27;<br><span class="hljs-code">&lt;torch.autograd.function.MyReLUBackward object at 0x7efe582c7ba8&gt;</span><br>&#x27;&#x27;&#x27;<br></code></pre></td></tr></table></figure><h5 id="è®¡ç®—å›¾ä¸åå‘ä¼ æ’­"><a href="#è®¡ç®—å›¾ä¸åå‘ä¼ æ’­" class="headerlink" title="è®¡ç®—å›¾ä¸åå‘ä¼ æ’­"></a>è®¡ç®—å›¾ä¸åå‘ä¼ æ’­</h5><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">import</span> torch <br><br><span class="hljs-attribute">x</span> = torch.tensor(<span class="hljs-number">3</span>.<span class="hljs-number">0</span>,requires_grad=True)<br><span class="hljs-attribute">y1</span> = x + <span class="hljs-number">1</span><br><span class="hljs-attribute">y2</span> = <span class="hljs-number">2</span>*x<br><span class="hljs-attribute">loss</span> = (y<span class="hljs-number">1</span>-y<span class="hljs-number">2</span>)**<span class="hljs-number">2</span><br><br><span class="hljs-attribute">loss</span>.backward()<br></code></pre></td></tr></table></figure><p>loss.backward()è¯­å¥è°ƒç”¨åï¼Œä¾æ¬¡å‘ç”Ÿä»¥ä¸‹è®¡ç®—è¿‡ç¨‹ã€‚</p><ul><li>1ï¼Œlossè‡ªå·±çš„gradæ¢¯åº¦èµ‹å€¼ä¸º1ï¼Œå³å¯¹è‡ªèº«çš„æ¢¯åº¦ä¸º1ã€‚</li><li>2ï¼Œlossæ ¹æ®å…¶è‡ªèº«æ¢¯åº¦ä»¥åŠå…³è”çš„backwardæ–¹æ³•ï¼Œè®¡ç®—å‡ºå…¶å¯¹åº”çš„è‡ªå˜é‡å³y1å’Œy2çš„æ¢¯åº¦ï¼Œå°†è¯¥å€¼èµ‹å€¼åˆ°y1.gradå’Œy2.gradã€‚</li><li>3ï¼Œy2å’Œy1æ ¹æ®å…¶è‡ªèº«æ¢¯åº¦ä»¥åŠå…³è”çš„backwardæ–¹æ³•, åˆ†åˆ«è®¡ç®—å‡ºå…¶å¯¹åº”çš„è‡ªå˜é‡xçš„æ¢¯åº¦ï¼Œx.gradå°†å…¶æ”¶åˆ°çš„å¤šä¸ªæ¢¯åº¦å€¼ç´¯åŠ ã€‚</li></ul><p>ï¼ˆæ³¨æ„ï¼Œ1,2,3æ­¥éª¤çš„æ±‚æ¢¯åº¦é¡ºåºå’Œå¯¹å¤šä¸ªæ¢¯åº¦å€¼çš„ç´¯åŠ è§„åˆ™æ°å¥½æ˜¯æ±‚å¯¼é“¾å¼æ³•åˆ™çš„ç¨‹åºè¡¨è¿°ï¼‰<br>æ­£å› ä¸ºæ±‚å¯¼é“¾å¼æ³•åˆ™è¡ç”Ÿçš„æ¢¯åº¦ç´¯åŠ è§„åˆ™ï¼Œå¼ é‡çš„gradæ¢¯åº¦ä¸ä¼šè‡ªåŠ¨æ¸…é›¶ï¼Œåœ¨éœ€è¦çš„æ—¶å€™éœ€è¦æ‰‹åŠ¨ç½®é›¶ã€‚</p><h5 id="å¶å­èŠ‚ç‚¹å’Œéå¶å­èŠ‚ç‚¹"><a href="#å¶å­èŠ‚ç‚¹å’Œéå¶å­èŠ‚ç‚¹" class="headerlink" title="å¶å­èŠ‚ç‚¹å’Œéå¶å­èŠ‚ç‚¹"></a>å¶å­èŠ‚ç‚¹å’Œéå¶å­èŠ‚ç‚¹</h5><p>æ‰§è¡Œä¸‹é¢ä»£ç ï¼Œæˆ‘ä»¬ä¼šå‘ç° loss.gradå¹¶ä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„1,è€Œæ˜¯ Noneã€‚ç±»ä¼¼åœ° y1.grad ä»¥åŠ y2.gradä¹Ÿæ˜¯ None.<br>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™æ˜¯ç”±äºå®ƒä»¬ä¸æ˜¯å¶å­èŠ‚ç‚¹å¼ é‡ã€‚<br>åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­ï¼Œåªæœ‰ is_leaf=True çš„å¶å­èŠ‚ç‚¹ï¼Œéœ€è¦æ±‚å¯¼çš„å¼ é‡çš„å¯¼æ•°ç»“æœæ‰ä¼šè¢«æœ€åä¿ç•™ä¸‹æ¥ã€‚<br>é‚£ä¹ˆä»€ä¹ˆæ˜¯å¶å­èŠ‚ç‚¹å¼ é‡å‘¢ï¼Ÿå¶å­èŠ‚ç‚¹å¼ é‡éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ã€‚</p><ul><li>1ï¼Œå¶å­èŠ‚ç‚¹å¼ é‡æ˜¯ç”±ç”¨æˆ·ç›´æ¥åˆ›å»ºçš„å¼ é‡ï¼Œè€Œéç”±æŸä¸ªFunctioné€šè¿‡è®¡ç®—å¾—åˆ°çš„å¼ é‡ã€‚</li><li>2ï¼Œå¶å­èŠ‚ç‚¹å¼ é‡çš„ requires_gradå±æ€§å¿…é¡»ä¸ºTrue.</li></ul><p>Pytorchè®¾è®¡è¿™æ ·çš„è§„åˆ™ä¸»è¦æ˜¯ä¸ºäº†èŠ‚çº¦å†…å­˜æˆ–è€…æ˜¾å­˜ç©ºé—´ï¼Œå› ä¸ºå‡ ä¹æ‰€æœ‰çš„æ—¶å€™ï¼Œç”¨æˆ·åªä¼šå…³å¿ƒä»–è‡ªå·±ç›´æ¥åˆ›å»ºçš„å¼ é‡çš„æ¢¯åº¦ã€‚<br>æ‰€æœ‰ä¾èµ–äºå¶å­èŠ‚ç‚¹å¼ é‡çš„å¼ é‡, å…¶requires_grad å±æ€§å¿…å®šæ˜¯Trueçš„ï¼Œä½†å…¶æ¢¯åº¦å€¼åªåœ¨è®¡ç®—è¿‡ç¨‹ä¸­è¢«ç”¨åˆ°ï¼Œä¸ä¼šæœ€ç»ˆå­˜å‚¨åˆ°gradå±æ€§ä¸­ã€‚<br>å¦‚æœéœ€è¦ä¿ç•™ä¸­é—´è®¡ç®—ç»“æœçš„æ¢¯åº¦åˆ°gradå±æ€§ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ retain_gradæ–¹æ³•ã€‚<br>å¦‚æœä»…ä»…æ˜¯ä¸ºäº†è°ƒè¯•ä»£ç æŸ¥çœ‹æ¢¯åº¦å€¼ï¼Œå¯ä»¥åˆ©ç”¨register_hookæ‰“å°æ—¥å¿—ã€‚</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">import torch <br><br>x = torch.tensor(3.0,requires_grad=True)<br>y1 = x + 1<br>y2 = 2*x<br>loss = (y1-y2)**2<br><br>loss.backward()<br>print(&quot;loss.grad:&quot;, loss.grad)<br>print(&quot;y1.grad:&quot;, y1.grad)<br>print(&quot;y2.grad:&quot;, y2.grad)<br>print(x.grad)<br><br>&#x27;&#x27;&#x27;<br><span class="hljs-code">loss.grad: None</span><br><span class="hljs-code">y1.grad: None</span><br><span class="hljs-code">y2.grad: None</span><br><span class="hljs-code">tensor(4.)</span><br>&#x27;&#x27;&#x27;<br><br>print(x.is<span class="hljs-emphasis">_leaf)</span><br><span class="hljs-emphasis">print(y1.is_leaf)</span><br><span class="hljs-emphasis">print(y2.is_leaf)</span><br><span class="hljs-emphasis">print(loss.is_</span>leaf)<br><br>&#x27;&#x27;&#x27;<br><span class="hljs-code">True</span><br><span class="hljs-code">False</span><br><span class="hljs-code">False</span><br><span class="hljs-code">False</span><br>&#x27;&#x27;&#x27;<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨retain_gradå¯ä»¥ä¿ç•™éå¶å­èŠ‚ç‚¹çš„æ¢¯åº¦å€¼ï¼Œåˆ©ç”¨register_hookå¯ä»¥æŸ¥çœ‹éå¶å­èŠ‚ç‚¹çš„æ¢¯åº¦å€¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch <br><br><span class="hljs-comment">#æ­£å‘ä¼ æ’­</span><br>x = torch.tensor(<span class="hljs-number">3.0</span>,requires_grad=<span class="hljs-literal">True</span>)<br>y1 = x + <span class="hljs-number">1</span><br>y2 = <span class="hljs-number">2</span>*x<br>loss = (y1-y2)**<span class="hljs-number">2</span><br><br><span class="hljs-comment">#éå¶å­èŠ‚ç‚¹æ¢¯åº¦æ˜¾ç¤ºæ§åˆ¶</span><br>y1.register_hook(<span class="hljs-keyword">lambda</span> grad: <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;y1 grad: &#x27;</span>, grad))<br>y2.register_hook(<span class="hljs-keyword">lambda</span> grad: <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;y2 grad: &#x27;</span>, grad))<br>loss.retain_grad()<br><br><span class="hljs-comment">#åå‘ä¼ æ’­</span><br>loss.backward()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;loss.grad:&quot;</span>, loss.grad)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;x.grad:&quot;</span>, x.grad)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">y2 grad:  tensor(4.)</span><br><span class="hljs-string">y1 grad:  tensor(-4.)</span><br><span class="hljs-string">loss.grad: tensor(1.)</span><br><span class="hljs-string">x.grad: tensor(4.)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><h5 id="è®¡ç®—å›¾åœ¨TensorBoardä¸­çš„å¯è§†åŒ–"><a href="#è®¡ç®—å›¾åœ¨TensorBoardä¸­çš„å¯è§†åŒ–" class="headerlink" title="è®¡ç®—å›¾åœ¨TensorBoardä¸­çš„å¯è§†åŒ–"></a>è®¡ç®—å›¾åœ¨TensorBoardä¸­çš„å¯è§†åŒ–</h5><p>å¯ä»¥åˆ©ç”¨ torch.utils.tensorboard å°†è®¡ç®—å›¾å¯¼å‡ºåˆ° TensorBoardè¿›è¡Œå¯è§†åŒ–</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Net</span>(<span class="hljs-params">nn.Module</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-built_in">super</span>(Net, self).__init__()<br>        self.w = nn.Parameter(torch.randn(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>))<br>        self.b = nn.Parameter(torch.zeros(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">self, x</span>):</span><br>        y = x@self.w + self.b<br>        <span class="hljs-keyword">return</span> y<br><br>net = Net()<br><br><span class="hljs-keyword">from</span> torch.utils.tensorboard <span class="hljs-keyword">import</span> SummaryWriter<br>writer = SummaryWriter(<span class="hljs-string">&#x27;./data/tensorboard&#x27;</span>)<br>writer.add_graph(net,input_to_model = torch.rand(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>))<br>writer.close()<br><br>%load_ext tensorboard<br><span class="hljs-comment">#%tensorboard --logdir ./data/tensorboard</span><br><br><span class="hljs-keyword">from</span> tensorboard <span class="hljs-keyword">import</span> notebook<br>notebook.<span class="hljs-built_in">list</span>()<br><br><span class="hljs-comment">#åœ¨tensorboardä¸­æŸ¥çœ‹æ¨¡å‹</span><br>notebook.start(<span class="hljs-string">&quot;--logdir ./data/tensorboard&quot;</span>)<br></code></pre></td></tr></table></figure><p>æ¬è¿è‡ªï¼š</p><ul><li><a href="https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1">https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorchå­¦ä¹ ç¬”è®°2-è‡ªåŠ¨å¾®åˆ†æœºåˆ¶</title>
    <link href="/2022/01/18/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02-%E8%87%AA%E5%8A%A8%E5%BE%AE%E5%88%86%E6%9C%BA%E5%88%B6/"/>
    <url>/2022/01/18/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02-%E8%87%AA%E5%8A%A8%E5%BE%AE%E5%88%86%E6%9C%BA%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<h2 id="è‡ªåŠ¨å¾®åˆ†æœºåˆ¶"><a href="#è‡ªåŠ¨å¾®åˆ†æœºåˆ¶" class="headerlink" title="è‡ªåŠ¨å¾®åˆ†æœºåˆ¶"></a>è‡ªåŠ¨å¾®åˆ†æœºåˆ¶</h2><span id="more"></span><p>ç¥ç»ç½‘ç»œé€šå¸¸ä¾èµ–åå‘ä¼ æ’­æ±‚æ¢¯åº¦æ¥æ›´æ–°ç½‘ç»œå‚æ•°ï¼Œæ±‚æ¢¯åº¦è¿‡ç¨‹é€šå¸¸æ˜¯ä¸€ä»¶éå¸¸å¤æ‚è€Œå®¹æ˜“å‡ºé”™çš„äº‹æƒ…ã€‚è€Œæ·±åº¦å­¦ä¹ æ¡†æ¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨åœ°å®Œæˆè¿™ç§æ±‚æ¢¯åº¦è¿ç®—ã€‚<br>Pytorchä¸€èˆ¬é€šè¿‡åå‘ä¼ æ’­ backward æ–¹æ³• å®ç°è¿™ç§æ±‚æ¢¯åº¦è®¡ç®—ã€‚è¯¥æ–¹æ³•æ±‚å¾—çš„æ¢¯åº¦å°†å­˜åœ¨å¯¹åº”è‡ªå˜é‡å¼ é‡çš„gradå±æ€§ä¸‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿèƒ½å¤Ÿè°ƒç”¨torch.autograd.grad å‡½æ•°æ¥å®ç°æ±‚æ¢¯åº¦è®¡ç®—ã€‚è¿™å°±æ˜¯Pytorchçš„è‡ªåŠ¨å¾®åˆ†æœºåˆ¶ã€‚</p><h5 id="åˆ©ç”¨backwardæ–¹æ³•æ±‚å¯¼æ•°"><a href="#åˆ©ç”¨backwardæ–¹æ³•æ±‚å¯¼æ•°" class="headerlink" title="åˆ©ç”¨backwardæ–¹æ³•æ±‚å¯¼æ•°"></a>åˆ©ç”¨backwardæ–¹æ³•æ±‚å¯¼æ•°</h5><p>backward æ–¹æ³•é€šå¸¸åœ¨ä¸€ä¸ªæ ‡é‡å¼ é‡ä¸Šè°ƒç”¨ï¼Œè¯¥æ–¹æ³•æ±‚å¾—çš„æ¢¯åº¦å°†å­˜åœ¨å¯¹åº”è‡ªå˜é‡å¼ é‡çš„gradå±æ€§ä¸‹ã€‚å¦‚æœè°ƒç”¨çš„å¼ é‡éæ ‡é‡ï¼Œåˆ™è¦ä¼ å…¥ä¸€ä¸ªå’Œå®ƒåŒå½¢çŠ¶ çš„gradientå‚æ•°å¼ é‡ã€‚ç›¸å½“äºç”¨è¯¥gradientå‚æ•°å¼ é‡ä¸è°ƒç”¨å¼ é‡ä½œå‘é‡ç‚¹ä¹˜ï¼Œå¾—åˆ°çš„æ ‡é‡ç»“æœå†åå‘ä¼ æ’­ã€‚</p><h6 id="æ ‡é‡çš„åå‘ä¼ æ’­"><a href="#æ ‡é‡çš„åå‘ä¼ æ’­" class="headerlink" title="æ ‡é‡çš„åå‘ä¼ æ’­"></a>æ ‡é‡çš„åå‘ä¼ æ’­</h6><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">import numpy as np <br>import torch <br><br># f(x) = a*x**2 <span class="hljs-code">+ b*x +</span> cçš„å¯¼æ•°<br><br>x = torch.tensor(0.0,requires_grad = True) # xéœ€è¦è¢«æ±‚å¯¼<br>a = torch.tensor(1.0)<br>b = torch.tensor(-2.0)<br>c = torch.tensor(1.0)<br>y = a*torch.pow(x,2) <span class="hljs-code">+ b*x +</span> c <br><br>y.backward()<br>dy<span class="hljs-emphasis">_dx = x.grad</span><br><span class="hljs-emphasis">print(dy_</span>dx)<br><br>&#x27;&#x27;&#x27;<br><span class="hljs-code">tensor(-2.)</span><br>&#x27;&#x27;&#x27;<br></code></pre></td></tr></table></figure><h6 id="éæ ‡é‡çš„åå‘ä¼ æ’­"><a href="#éæ ‡é‡çš„åå‘ä¼ æ’­" class="headerlink" title="éæ ‡é‡çš„åå‘ä¼ æ’­"></a>éæ ‡é‡çš„åå‘ä¼ æ’­</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np <br><span class="hljs-keyword">import</span> torch <br><br><span class="hljs-comment"># f(x) = a*x**2 + b*x + c</span><br><br>x = torch.tensor([[<span class="hljs-number">0.0</span>,<span class="hljs-number">0.0</span>],[<span class="hljs-number">1.0</span>,<span class="hljs-number">2.0</span>]],requires_grad = <span class="hljs-literal">True</span>) <span class="hljs-comment"># xéœ€è¦è¢«æ±‚å¯¼</span><br>a = torch.tensor(<span class="hljs-number">1.0</span>)<br>b = torch.tensor(-<span class="hljs-number">2.0</span>)<br>c = torch.tensor(<span class="hljs-number">1.0</span>)<br>y = a*torch.<span class="hljs-built_in">pow</span>(x,<span class="hljs-number">2</span>) + b*x + c <br><br>gradient = torch.tensor([[<span class="hljs-number">1.0</span>,<span class="hljs-number">1.0</span>],[<span class="hljs-number">1.0</span>,<span class="hljs-number">1.0</span>]])<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;x:\n&quot;</span>,x)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;y:\n&quot;</span>,y)<br>y.backward(gradient = gradient)<br>x_grad = x.grad<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;x_grad:\n&quot;</span>,x_grad)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">x:</span><br><span class="hljs-string"> tensor([[0., 0.],</span><br><span class="hljs-string">        [1., 2.]], requires_grad=True)</span><br><span class="hljs-string">y:</span><br><span class="hljs-string"> tensor([[1., 1.],</span><br><span class="hljs-string">        [0., 1.]], grad_fn=&lt;AddBackward0&gt;)</span><br><span class="hljs-string">x_grad:</span><br><span class="hljs-string"> tensor([[-2., -2.],</span><br><span class="hljs-string">        [ 0.,  2.]])</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><h6 id="éæ ‡é‡çš„åå‘ä¼ æ’­å¯ä»¥ç”¨æ ‡é‡çš„åå‘ä¼ æ’­å®ç°"><a href="#éæ ‡é‡çš„åå‘ä¼ æ’­å¯ä»¥ç”¨æ ‡é‡çš„åå‘ä¼ æ’­å®ç°" class="headerlink" title="éæ ‡é‡çš„åå‘ä¼ æ’­å¯ä»¥ç”¨æ ‡é‡çš„åå‘ä¼ æ’­å®ç°"></a>éæ ‡é‡çš„åå‘ä¼ æ’­å¯ä»¥ç”¨æ ‡é‡çš„åå‘ä¼ æ’­å®ç°</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np <br><span class="hljs-keyword">import</span> torch <br><br><span class="hljs-comment"># f(x) = a*x**2 + b*x + c</span><br><br>x = torch.tensor([[<span class="hljs-number">0.0</span>,<span class="hljs-number">0.0</span>],[<span class="hljs-number">1.0</span>,<span class="hljs-number">2.0</span>]],requires_grad = <span class="hljs-literal">True</span>) <span class="hljs-comment"># xéœ€è¦è¢«æ±‚å¯¼</span><br>a = torch.tensor(<span class="hljs-number">1.0</span>)<br>b = torch.tensor(-<span class="hljs-number">2.0</span>)<br>c = torch.tensor(<span class="hljs-number">1.0</span>)<br>y = a*torch.<span class="hljs-built_in">pow</span>(x,<span class="hljs-number">2</span>) + b*x + c <br><br>gradient = torch.tensor([[<span class="hljs-number">1.0</span>,<span class="hljs-number">1.0</span>],[<span class="hljs-number">1.0</span>,<span class="hljs-number">1.0</span>]])<br>z = torch.<span class="hljs-built_in">sum</span>(y*gradient)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;x:&quot;</span>,x)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;y:&quot;</span>,y)<br>z.backward()<br>x_grad = x.grad<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;x_grad:\n&quot;</span>,x_grad)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">x: tensor([[0., 0.],</span><br><span class="hljs-string">        [1., 2.]], requires_grad=True)</span><br><span class="hljs-string">y: tensor([[1., 1.],</span><br><span class="hljs-string">        [0., 1.]], grad_fn=&lt;AddBackward0&gt;)</span><br><span class="hljs-string">x_grad:</span><br><span class="hljs-string"> tensor([[-2., -2.],</span><br><span class="hljs-string">        [ 0.,  2.]])</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><h5 id="åˆ©ç”¨autograd-gradæ–¹æ³•æ±‚å¯¼æ•°"><a href="#åˆ©ç”¨autograd-gradæ–¹æ³•æ±‚å¯¼æ•°" class="headerlink" title="åˆ©ç”¨autograd.gradæ–¹æ³•æ±‚å¯¼æ•°"></a>åˆ©ç”¨autograd.gradæ–¹æ³•æ±‚å¯¼æ•°</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np <br><span class="hljs-keyword">import</span> torch <br><br><span class="hljs-comment"># f(x) = a*x**2 + b*x + cçš„å¯¼æ•°</span><br><br>x = torch.tensor(<span class="hljs-number">0.0</span>,requires_grad = <span class="hljs-literal">True</span>) <span class="hljs-comment"># xéœ€è¦è¢«æ±‚å¯¼</span><br>a = torch.tensor(<span class="hljs-number">1.0</span>)<br>b = torch.tensor(-<span class="hljs-number">2.0</span>)<br>c = torch.tensor(<span class="hljs-number">1.0</span>)<br>y = a*torch.<span class="hljs-built_in">pow</span>(x,<span class="hljs-number">2</span>) + b*x + c<br><br><br><span class="hljs-comment"># create_graph è®¾ç½®ä¸º True å°†å…è®¸åˆ›å»ºæ›´é«˜é˜¶çš„å¯¼æ•° </span><br>dy_dx = torch.autograd.grad(y,x,create_graph=<span class="hljs-literal">True</span>)[<span class="hljs-number">0</span>]<br><span class="hljs-built_in">print</span>(dy_dx.data)<br><br><span class="hljs-comment"># æ±‚äºŒé˜¶å¯¼æ•°</span><br>dy2_dx2 = torch.autograd.grad(dy_dx,x)[<span class="hljs-number">0</span>] <br><br><span class="hljs-built_in">print</span>(dy2_dx2.data)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">tensor(-2.)</span><br><span class="hljs-string">tensor(2.)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">import numpy as np <br>import torch <br><br>x1 = torch.tensor(1.0,requires<span class="hljs-emphasis">_grad = True) # xéœ€è¦è¢«æ±‚å¯¼</span><br><span class="hljs-emphasis">x2 = torch.tensor(2.0,requires_</span>grad = True)<br><br>y1 = x1*x2<br>y2 = x1+x2<br><br><br># å…è®¸åŒæ—¶å¯¹å¤šä¸ªè‡ªå˜é‡æ±‚å¯¼æ•°<br>(dy1<span class="hljs-emphasis">_dx1,dy1_dx2) = torch.autograd.grad(outputs=y1,inputs = [x1,x2],retain_graph = True)</span><br><span class="hljs-emphasis">print(dy1_dx1,dy1_</span>dx2)<br><br># å¦‚æœæœ‰å¤šä¸ªå› å˜é‡ï¼Œç›¸å½“äºæŠŠå¤šä¸ªå› å˜é‡çš„æ¢¯åº¦ç»“æœæ±‚å’Œ<br>(dy12<span class="hljs-emphasis">_dx1,dy12_dx2) = torch.autograd.grad(outputs=[y1,y2],inputs = [x1,x2])</span><br><span class="hljs-emphasis">print(dy12_dx1,dy12_</span>dx2)<br><br>&#x27;&#x27;&#x27;<br><span class="hljs-code">tensor(2.) tensor(1.)</span><br><span class="hljs-code">tensor(3.) tensor(2.)</span><br>&#x27;&#x27;&#x27;<br></code></pre></td></tr></table></figure><h5 id="åˆ©ç”¨è‡ªåŠ¨å¾®åˆ†å’Œä¼˜åŒ–å™¨æ±‚æœ€å°å€¼"><a href="#åˆ©ç”¨è‡ªåŠ¨å¾®åˆ†å’Œä¼˜åŒ–å™¨æ±‚æœ€å°å€¼" class="headerlink" title="åˆ©ç”¨è‡ªåŠ¨å¾®åˆ†å’Œä¼˜åŒ–å™¨æ±‚æœ€å°å€¼"></a>åˆ©ç”¨è‡ªåŠ¨å¾®åˆ†å’Œä¼˜åŒ–å™¨æ±‚æœ€å°å€¼</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np <br><span class="hljs-keyword">import</span> torch <br><br><span class="hljs-comment"># f(x) = a*x**2 + b*x + cçš„æœ€å°å€¼</span><br><br>x = torch.tensor(<span class="hljs-number">0.0</span>,requires_grad = <span class="hljs-literal">True</span>) <span class="hljs-comment"># xéœ€è¦è¢«æ±‚å¯¼</span><br>a = torch.tensor(<span class="hljs-number">1.0</span>)<br>b = torch.tensor(-<span class="hljs-number">2.0</span>)<br>c = torch.tensor(<span class="hljs-number">1.0</span>)<br><br>optimizer = torch.optim.SGD(params=[x],lr = <span class="hljs-number">0.01</span>)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>(<span class="hljs-params">x</span>):</span><br>    result = a*torch.<span class="hljs-built_in">pow</span>(x,<span class="hljs-number">2</span>) + b*x + c <br>    <span class="hljs-keyword">return</span>(result)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">500</span>):<br>    optimizer.zero_grad()<br>    y = f(x)<br>    y.backward()<br>    optimizer.step()<br>   <br>    <br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;y=&quot;</span>,f(x).data,<span class="hljs-string">&quot;;&quot;</span>,<span class="hljs-string">&quot;x=&quot;</span>,x.data)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">y= tensor(0.) ; x= tensor(1.0000)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><p>æ¬è¿è‡ªï¼š</p><ul><li><a href="https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1">https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorchå­¦ä¹ ç¬”è®°1-å¼ é‡æ•°æ®ç»“æ„</title>
    <link href="/2022/01/18/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E5%BC%A0%E9%87%8F%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    <url>/2022/01/18/Pytorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01-%E5%BC%A0%E9%87%8F%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
    
    <content type="html"><![CDATA[<h2 id="å¼ é‡çš„æ•°æ®ç±»å‹ã€å¼ é‡çš„ç»´åº¦ã€å¼ é‡çš„å°ºå¯¸ã€å¼ é‡å’Œnumpyæ•°ç»„ç­‰"><a href="#å¼ é‡çš„æ•°æ®ç±»å‹ã€å¼ é‡çš„ç»´åº¦ã€å¼ é‡çš„å°ºå¯¸ã€å¼ é‡å’Œnumpyæ•°ç»„ç­‰" class="headerlink" title="å¼ é‡çš„æ•°æ®ç±»å‹ã€å¼ é‡çš„ç»´åº¦ã€å¼ é‡çš„å°ºå¯¸ã€å¼ é‡å’Œnumpyæ•°ç»„ç­‰"></a>å¼ é‡çš„æ•°æ®ç±»å‹ã€å¼ é‡çš„ç»´åº¦ã€å¼ é‡çš„å°ºå¯¸ã€å¼ é‡å’Œnumpyæ•°ç»„ç­‰</h2><span id="more"></span><p>Pytorchçš„åŸºæœ¬æ•°æ®ç»“æ„æ˜¯å¼ é‡Tensorã€‚å¼ é‡å³å¤šç»´æ•°ç»„ã€‚Pytorchçš„å¼ é‡å’Œnumpyä¸­çš„arrayå¾ˆç±»ä¼¼ã€‚</p><h5 id="å¼ é‡çš„æ•°æ®ç±»å‹"><a href="#å¼ é‡çš„æ•°æ®ç±»å‹" class="headerlink" title="å¼ é‡çš„æ•°æ®ç±»å‹"></a>å¼ é‡çš„æ•°æ®ç±»å‹</h5><p>å¼ é‡çš„æ•°æ®ç±»å‹å’Œnumpy.arrayåŸºæœ¬ä¸€ä¸€å¯¹åº”ï¼Œä½†æ˜¯ä¸æ”¯æŒstrç±»å‹ã€‚åŒ…æ‹¬:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">torch.<span class="hljs-built_in">float</span>64(torch.<span class="hljs-built_in">double</span>),<br><br>torch.<span class="hljs-built_in">float</span>32(torch.<span class="hljs-built_in">float</span>),<br><br>torch.<span class="hljs-built_in">float</span>16,<br><br>torch.<span class="hljs-built_in">int</span>64(torch.long),<br><br>torch.<span class="hljs-built_in">int</span>32(torch.<span class="hljs-built_in">int</span>),<br><br>torch.<span class="hljs-built_in">int</span>16,<br><br>torch.<span class="hljs-built_in">int</span>8,<br><br>torch.<span class="hljs-built_in">uint</span>8,<br><br>torch.<span class="hljs-built_in">bool</span><br></code></pre></td></tr></table></figure><p>ä¸€èˆ¬ç¥ç»ç½‘ç»œå»ºæ¨¡ä½¿ç”¨çš„éƒ½æ˜¯torch.float32ç±»å‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> torch <br><br><span class="hljs-comment"># è‡ªåŠ¨æ¨æ–­æ•°æ®ç±»å‹</span><br>i = torch.tensor(<span class="hljs-number">1</span>);<span class="hljs-built_in">print</span>(i,i.dtype)<br>x = torch.tensor(<span class="hljs-number">2.0</span>);<span class="hljs-built_in">print</span>(x,x.dtype)<br>b = torch.tensor(<span class="hljs-literal">True</span>);<span class="hljs-built_in">print</span>(b,b.dtype)<br><span class="hljs-string">&#x27;&#x27;&#x27; # è¾“å‡º</span><br><span class="hljs-string">tensor(1) torch.int64</span><br><span class="hljs-string">tensor(2.) torch.float32</span><br><span class="hljs-string">tensor(True) torch.bool</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-comment"># æŒ‡å®šæ•°æ®ç±»å‹</span><br>i = torch.tensor(<span class="hljs-number">1</span>,dtype = torch.int32);<span class="hljs-built_in">print</span>(i,i.dtype)<br>x = torch.tensor(<span class="hljs-number">2.0</span>,dtype = torch.double);<span class="hljs-built_in">print</span>(x,x.dtype)<br>â€˜â€™â€˜<br>tensor(<span class="hljs-number">1</span>, dtype=torch.int32) torch.int32<br>tensor(<span class="hljs-number">2.</span>, dtype=torch.float64) torch.float64<br>â€™â€˜â€™<br><br><span class="hljs-comment"># ä½¿ç”¨ç‰¹å®šç±»å‹æ„é€ å‡½æ•°</span><br>i = torch.IntTensor(<span class="hljs-number">1</span>);<span class="hljs-built_in">print</span>(i,i.dtype)<br>x = torch.Tensor(np.array(<span class="hljs-number">2.0</span>));<span class="hljs-built_in">print</span>(x,x.dtype) <span class="hljs-comment">#ç­‰ä»·äºtorch.FloatTensor</span><br>b = torch.BoolTensor(np.array([<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>])); <span class="hljs-built_in">print</span>(b,b.dtype)<br>â€˜â€™â€˜<br>tensor([<span class="hljs-number">1266789664</span>], dtype=torch.int32) torch.int32<br>tensor(<span class="hljs-number">2.</span>) torch.float32<br>tensor([ <span class="hljs-literal">True</span>, <span class="hljs-literal">False</span>,  <span class="hljs-literal">True</span>, <span class="hljs-literal">False</span>]) torch.<span class="hljs-built_in">bool</span><br>â€™â€˜â€™<br><br><span class="hljs-comment"># ä¸åŒç±»å‹è¿›è¡Œè½¬æ¢</span><br>i = torch.tensor(<span class="hljs-number">1</span>); <span class="hljs-built_in">print</span>(i,i.dtype)<br>x = i.<span class="hljs-built_in">float</span>(); <span class="hljs-built_in">print</span>(x,x.dtype) <span class="hljs-comment">#è°ƒç”¨ floatæ–¹æ³•è½¬æ¢æˆæµ®ç‚¹ç±»å‹</span><br>y = i.<span class="hljs-built_in">type</span>(torch.<span class="hljs-built_in">float</span>); <span class="hljs-built_in">print</span>(y,y.dtype) <span class="hljs-comment">#ä½¿ç”¨typeå‡½æ•°è½¬æ¢æˆæµ®ç‚¹ç±»å‹</span><br>z = i.type_as(x);<span class="hljs-built_in">print</span>(z,z.dtype) <span class="hljs-comment">#ä½¿ç”¨type_asæ–¹æ³•è½¬æ¢æˆæŸä¸ªTensorç›¸åŒç±»å‹</span><br>â€˜â€™â€˜<br>tensor(<span class="hljs-number">1</span>) torch.int64<br>tensor(<span class="hljs-number">1.</span>) torch.float32<br>tensor(<span class="hljs-number">1.</span>) torch.float32<br>tensor(<span class="hljs-number">1.</span>) torch.float32<br>â€™â€˜â€™<br></code></pre></td></tr></table></figure><h5 id="å¼ é‡çš„ç»´åº¦"><a href="#å¼ é‡çš„ç»´åº¦" class="headerlink" title="å¼ é‡çš„ç»´åº¦"></a>å¼ é‡çš„ç»´åº¦</h5><p>ä¸åŒç±»å‹çš„æ•°æ®å¯ä»¥ç”¨ä¸åŒç»´åº¦(dimension)çš„å¼ é‡æ¥è¡¨ç¤ºã€‚æ ‡é‡ä¸º0ç»´å¼ é‡ï¼Œå‘é‡ä¸º1ç»´å¼ é‡ï¼ŒçŸ©é˜µä¸º2ç»´å¼ é‡ã€‚å½©è‰²å›¾åƒæœ‰rgbä¸‰ä¸ªé€šé“ï¼Œå¯ä»¥è¡¨ç¤ºä¸º3ç»´å¼ é‡ã€‚è§†é¢‘è¿˜æœ‰æ—¶é—´ç»´ï¼Œå¯ä»¥è¡¨ç¤ºä¸º4ç»´å¼ é‡ã€‚<br>å¯ä»¥ç®€å•åœ°æ€»ç»“ä¸ºï¼šæœ‰å‡ å±‚ä¸­æ‹¬å·ï¼Œå°±æ˜¯å¤šå°‘ç»´çš„å¼ é‡ã€‚</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">scalar = torch.tensor(True)<br>print(scalar)<br>print(scalar.dim())  # æ ‡é‡ï¼Œ0ç»´å¼ é‡<br>&#x27;&#x27;&#x27;<br><span class="hljs-code">tensor(True)</span><br><span class="hljs-code">0</span><br>&#x27;&#x27;&#x27;<br><br>vector = torch.tensor([1.0,2.0,3.0,4.0]) #å‘é‡ï¼Œ1ç»´å¼ é‡<br>print(vector)<br>print(vector.dim())<br>&#x27;&#x27;&#x27;<br><span class="hljs-code">tensor([1., 2., 3., 4.])</span><br><span class="hljs-code">1</span><br>&#x27;&#x27;&#x27;<br><br>matrix = torch.tensor([[1.0,2.0],[3.0,4.0]]) #çŸ©é˜µ, 2ç»´å¼ é‡<br>print(matrix)<br>print(matrix.dim())<br>&#x27;&#x27;&#x27;<br><span class="hljs-code">tensor([[1., 2.],</span><br><span class="hljs-code">        [3., 4.]])</span><br><span class="hljs-code">2</span><br>&#x27;&#x27;&#x27;<br></code></pre></td></tr></table></figure><h5 id="å¼ é‡çš„å°ºå¯¸"><a href="#å¼ é‡çš„å°ºå¯¸" class="headerlink" title="å¼ é‡çš„å°ºå¯¸"></a>å¼ é‡çš„å°ºå¯¸</h5><p>å¯ä»¥ä½¿ç”¨ shapeå±æ€§æˆ–è€… size()æ–¹æ³•æŸ¥çœ‹å¼ é‡åœ¨æ¯ä¸€ç»´çš„é•¿åº¦.å¯ä»¥ä½¿ç”¨ view æ–¹æ³•æ”¹å˜å¼ é‡çš„å°ºå¯¸ã€‚<br>å¦‚æœviewæ–¹æ³•æ”¹å˜å°ºå¯¸å¤±è´¥ï¼Œå¯ä»¥ä½¿ç”¨reshapeæ–¹æ³•.</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"># ä½¿ç”¨viewå¯ä»¥æ”¹å˜å¼ é‡å°ºå¯¸<br>vector = torch.arange(0,12)<br>print(vector)<br>print(vector.shape)<br><br>matrix34 = vector.view(3,4)<br>print(matrix34)<br>print(matrix34.shape)<br><br>matrix43 = vector.view(4,-1) #-1è¡¨ç¤ºè¯¥ä½ç½®é•¿åº¦ç”±ç¨‹åºè‡ªåŠ¨æ¨æ–­<br>print(matrix43)<br>print(matrix43.shape)<br><br>&#x27;&#x27;&#x27;<br><span class="hljs-code">tensor([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11])</span><br><span class="hljs-code">torch.Size([12])</span><br><span class="hljs-code">tensor([[ 0,  1,  2,  3],</span><br><span class="hljs-code">        [ 4,  5,  6,  7],</span><br><span class="hljs-code">        [ 8,  9, 10, 11]])</span><br><span class="hljs-code">torch.Size([3, 4])</span><br><span class="hljs-code">tensor([[ 0,  1,  2],</span><br><span class="hljs-code">        [ 3,  4,  5],</span><br><span class="hljs-code">        [ 6,  7,  8],</span><br><span class="hljs-code">        [ 9, 10, 11]])</span><br><span class="hljs-code">torch.Size([4, 3])</span><br>&#x27;&#x27;&#x27;<br><br># æœ‰äº›æ“ä½œä¼šè®©å¼ é‡å­˜å‚¨ç»“æ„æ‰­æ›²ï¼Œç›´æ¥ä½¿ç”¨viewä¼šå¤±è´¥ï¼Œå¯ä»¥ç”¨reshapeæ–¹æ³•<br>matrix26 = torch.arange(0,12).view(2,6)<br>print(matrix26)<br>print(matrix26.shape)<br><br># è½¬ç½®æ“ä½œè®©å¼ é‡å­˜å‚¨ç»“æ„æ‰­æ›²<br>matrix62 = matrix26.t()<br>print(matrix62.is_contiguous())<br><br># ç›´æ¥ä½¿ç”¨viewæ–¹æ³•ä¼šå¤±è´¥ï¼Œå¯ä»¥ä½¿ç”¨reshapeæ–¹æ³•<br>#matrix34 = matrix62.view(3,4) #error!<br>matrix34 = matrix62.reshape(3,4) #ç­‰ä»·äºmatrix34 = matrix62.contiguous().view(3,4)<br>print(matrix34)<br><br>&#x27;&#x27;&#x27;<br><span class="hljs-code">tensor([[ 0,  1,  2,  3,  4,  5],</span><br><span class="hljs-code">        [ 6,  7,  8,  9, 10, 11]])</span><br><span class="hljs-code">torch.Size([2, 6])</span><br><span class="hljs-code">False</span><br><span class="hljs-code">tensor([[ 0,  6,  1,  7],</span><br><span class="hljs-code">        [ 2,  8,  3,  9],</span><br><span class="hljs-code">        [ 4, 10,  5, 11]])</span><br>&#x27;&#x27;&#x27;<br></code></pre></td></tr></table></figure><h5 id="å¼ é‡å’Œnumpyæ•°ç»„"><a href="#å¼ é‡å’Œnumpyæ•°ç»„" class="headerlink" title="å¼ é‡å’Œnumpyæ•°ç»„"></a>å¼ é‡å’Œnumpyæ•°ç»„</h5><p>å¯ä»¥ç”¨numpyæ–¹æ³•ä»Tensorå¾—åˆ°numpyæ•°ç»„ï¼Œä¹Ÿå¯ä»¥ç”¨torch.from_numpyä»numpyæ•°ç»„å¾—åˆ°Tensorã€‚è¿™ä¸¤ç§æ–¹æ³•å…³è”çš„Tensorå’Œnumpyæ•°ç»„æ˜¯å…±äº«æ•°æ®å†…å­˜çš„ã€‚å¦‚æœæ”¹å˜å…¶ä¸­ä¸€ä¸ªï¼Œå¦å¤–ä¸€ä¸ªçš„å€¼ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜ã€‚å¦‚æœæœ‰éœ€è¦ï¼Œå¯ä»¥ç”¨å¼ é‡çš„cloneæ–¹æ³•æ‹·è´å¼ é‡ï¼Œä¸­æ–­è¿™ç§å…³è”ã€‚<br>æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨itemæ–¹æ³•ä»æ ‡é‡å¼ é‡å¾—åˆ°å¯¹åº”çš„Pythonæ•°å€¼ã€‚ä½¿ç”¨tolistæ–¹æ³•ä»å¼ é‡å¾—åˆ°å¯¹åº”çš„Pythonæ•°å€¼åˆ—è¡¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#torch.from_numpyå‡½æ•°ä»numpyæ•°ç»„å¾—åˆ°Tensor</span><br>arr = np.zeros(<span class="hljs-number">3</span>)<br>tensor = torch.from_numpy(arr)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;before add 1:&quot;</span>)<br><span class="hljs-built_in">print</span>(arr)<br><span class="hljs-built_in">print</span>(tensor)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nafter add 1:&quot;</span>)<br>np.add(arr,<span class="hljs-number">1</span>, out = arr) <span class="hljs-comment">#ç»™ arrå¢åŠ 1ï¼Œtensorä¹Ÿéšä¹‹æ”¹å˜</span><br><span class="hljs-built_in">print</span>(arr)<br><span class="hljs-built_in">print</span>(tensor)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">before add 1:</span><br><span class="hljs-string">[0. 0. 0.]</span><br><span class="hljs-string">tensor([0., 0., 0.], dtype=torch.float64)</span><br><span class="hljs-string"></span><br><span class="hljs-string">after add 1:</span><br><span class="hljs-string">[1. 1. 1.]</span><br><span class="hljs-string">tensor([1., 1., 1.], dtype=torch.float64)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-comment"># numpyæ–¹æ³•ä»Tensorå¾—åˆ°numpyæ•°ç»„</span><br>tensor = torch.zeros(<span class="hljs-number">3</span>)<br>arr = tensor.numpy()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;before add 1:&quot;</span>)<br><span class="hljs-built_in">print</span>(tensor)<br><span class="hljs-built_in">print</span>(arr)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nafter add 1:&quot;</span>)<br><span class="hljs-comment">#ä½¿ç”¨å¸¦ä¸‹åˆ’çº¿çš„æ–¹æ³•è¡¨ç¤ºè®¡ç®—ç»“æœä¼šè¿”å›ç»™è°ƒç”¨ å¼ é‡</span><br>tensor.add_(<span class="hljs-number">1</span>) <span class="hljs-comment">#ç»™ tensorå¢åŠ 1ï¼Œarrä¹Ÿéšä¹‹æ”¹å˜ </span><br><span class="hljs-comment">#æˆ–ï¼š torch.add(tensor,1,out = tensor)</span><br><span class="hljs-built_in">print</span>(tensor)<br><span class="hljs-built_in">print</span>(arr)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">before add 1:</span><br><span class="hljs-string">tensor([0., 0., 0.])</span><br><span class="hljs-string">[0. 0. 0.]</span><br><span class="hljs-string"></span><br><span class="hljs-string">after add 1:</span><br><span class="hljs-string">tensor([1., 1., 1.])</span><br><span class="hljs-string">[1. 1. 1.]</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-comment"># å¯ä»¥ç”¨clone() æ–¹æ³•æ‹·è´å¼ é‡ï¼Œä¸­æ–­è¿™ç§å…³è”</span><br>tensor = torch.zeros(<span class="hljs-number">3</span>)<br><br><span class="hljs-comment">#ä½¿ç”¨cloneæ–¹æ³•æ‹·è´å¼ é‡, æ‹·è´åçš„å¼ é‡å’ŒåŸå§‹å¼ é‡å†…å­˜ç‹¬ç«‹</span><br>arr = tensor.clone().numpy() <span class="hljs-comment"># ä¹Ÿå¯ä»¥ä½¿ç”¨tensor.data.numpy()</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;before add 1:&quot;</span>)<br><span class="hljs-built_in">print</span>(tensor)<br><span class="hljs-built_in">print</span>(arr)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nafter add 1:&quot;</span>)<br><span class="hljs-comment">#ä½¿ç”¨ å¸¦ä¸‹åˆ’çº¿çš„æ–¹æ³•è¡¨ç¤ºè®¡ç®—ç»“æœä¼šè¿”å›ç»™è°ƒç”¨ å¼ é‡</span><br>tensor.add_(<span class="hljs-number">1</span>) <span class="hljs-comment">#ç»™ tensorå¢åŠ 1ï¼Œarrä¸å†éšä¹‹æ”¹å˜</span><br><span class="hljs-built_in">print</span>(tensor)<br><span class="hljs-built_in">print</span>(arr)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">before add 1:</span><br><span class="hljs-string">tensor([0., 0., 0.])</span><br><span class="hljs-string">[0. 0. 0.]</span><br><span class="hljs-string"></span><br><span class="hljs-string">after add 1:</span><br><span class="hljs-string">tensor([1., 1., 1.])</span><br><span class="hljs-string">[0. 0. 0.]</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-comment"># itemæ–¹æ³•å’Œtolistæ–¹æ³•å¯ä»¥å°†å¼ é‡è½¬æ¢æˆPythonæ•°å€¼å’Œæ•°å€¼åˆ—è¡¨</span><br>scalar = torch.tensor(<span class="hljs-number">1.0</span>)<br>s = scalar.item()<br><span class="hljs-built_in">print</span>(s)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(s))<br><br>tensor = torch.rand(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)<br>t = tensor.tolist()<br><span class="hljs-built_in">print</span>(t)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(t))<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">1.0</span><br><span class="hljs-string">&lt;class &#x27;float&#x27;&gt;</span><br><span class="hljs-string">[[0.5526873469352722, 0.46957558393478394], [0.6724914312362671, 0.26923561096191406]]</span><br><span class="hljs-string">&lt;class &#x27;list&#x27;&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><p>æ¬è¿è‡ªï¼š</p><ul><li><a href="https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1">https://www.heywhale.com/home/competition/61bff9a84b63a700179b7f8d/content/1</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Pytorch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¬¬ä¸€ä¸ªpythonåŒ…</title>
    <link href="/2021/12/29/%E7%AC%AC%E4%B8%80%E4%B8%AApython%E5%8C%85/"/>
    <url>/2021/12/29/%E7%AC%AC%E4%B8%80%E4%B8%AApython%E5%8C%85/</url>
    
    <content type="html"><![CDATA[<h2 id="Senior-Data-Structure-Toolsâ€“SDStools"><a href="#Senior-Data-Structure-Toolsâ€“SDStools" class="headerlink" title="Senior Data Structure Toolsâ€“SDStools"></a>Senior Data Structure Toolsâ€“SDStools</h2><span id="more"></span><p>pythonæ ‡å‡†åº“ä¸­æ²¡æœ‰é“¾è¡¨ã€æ ‘ã€å›¾ç­‰é«˜çº§æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥æ•´ç†äº†ä¸€äº›ç½‘ä¸Šçš„ä»£ç åˆ°è¿™ä¸ªåº“ä¸­ã€‚</p><h5 id="é“¾è¡¨ï¼š"><a href="#é“¾è¡¨ï¼š" class="headerlink" title="é“¾è¡¨ï¼š"></a>é“¾è¡¨ï¼š</h5><ul><li><a href="https://zhuanlan.zhihu.com/p/60057180">https://zhuanlan.zhihu.com/p/60057180</a></li><li><a href="https://jackkuo666.github.io/Data_Structure_with_Python_book/chapter3/section1.html">https://jackkuo666.github.io/Data_Structure_with_Python_book/chapter3/section1.html</a></li></ul><h5 id="å¦‚ä½•å‘å¸ƒåŒ…åˆ°pypi"><a href="#å¦‚ä½•å‘å¸ƒåŒ…åˆ°pypi" class="headerlink" title="å¦‚ä½•å‘å¸ƒåŒ…åˆ°pypi"></a>å¦‚ä½•å‘å¸ƒåŒ…åˆ°pypi</h5><p>æˆ‘çš„é¡¹ç›®ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š<br><img src="/img/article/py.jpg"></p><p>æ‰“åŒ…ä¸»è¦å°±æ˜¯setupçš„ç¼–å†™</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs clean">setup(<br>    name=NAME,<br>    version=about[<span class="hljs-string">&#x27;__version__&#x27;</span>],<br>    description=DESCRIPTION,<br>    long_description=long_description,<br>    long_description_content_type=<span class="hljs-string">&#x27;text/markdown&#x27;</span>,<br>    author=AUTHOR,<br>    author_email=EMAIL,<br>    python_requires=REQUIRES_PYTHON,<br>    url=URL,<br>    packages=find_packages(),                ## å¿…é¡»ï¼Œå¦‚æœéœ€è¦æ‰“åŒ…testæ–‡ä»¶å¤¹æˆ–å…¶ä»–å¯å‚è€ƒä¸‹é¢æ ¼å¼è¿›è¡Œæ·»åŠ <br>    # packages=find_packages(exclude=[<span class="hljs-string">&quot;tests&quot;</span>, <span class="hljs-string">&quot;*.tests&quot;</span>, <span class="hljs-string">&quot;*.tests.*&quot;</span>, <span class="hljs-string">&quot;tests.*&quot;</span>]),<br>    # If your package is a single <span class="hljs-keyword">module</span>, use this instead <span class="hljs-keyword">of</span> <span class="hljs-string">&#x27;packages&#x27;</span>:<br>    # py_modules=[<span class="hljs-string">&#x27;SDStools&#x27;</span>],<br><br>    # entry_points=&#123;<br>    #     <span class="hljs-string">&#x27;console_scripts&#x27;</span>: [<span class="hljs-string">&#x27;mycli=mymodule:cli&#x27;</span>],<br>    # &#125;,<br>    install_requires=REQUIRED,<br>    extras_require=EXTRAS,<br>    # package_data=&#123;<br>    #     # include json and pkl files<br>    #     <span class="hljs-string">&#x27;&#x27;</span>: [<span class="hljs-string">&#x27;*.json&#x27;</span>, <span class="hljs-string">&#x27;models/*.pkl&#x27;</span>, <span class="hljs-string">&#x27;models/*.json&#x27;</span>],<br>    # &#125;,<br>    include_package_data=<span class="hljs-literal">True</span>,<br>    license=<span class="hljs-string">&#x27;MIT&#x27;</span>,<br>    classifiers=[<br>        # Trove classifiers<br>        # Full list: https:<span class="hljs-comment">//pypi.python.org/pypi?%3Aaction=list_classifiers</span><br>        <span class="hljs-string">&#x27;License :: OSI Approved :: MIT License&#x27;</span>,<br>        <span class="hljs-string">&#x27;Programming Language :: Python&#x27;</span>,<br>        <span class="hljs-string">&#x27;Programming Language :: Python :: 3&#x27;</span>,<br>        <span class="hljs-string">&#x27;Programming Language :: Python :: 3.6&#x27;</span>,<br>        <span class="hljs-string">&#x27;Programming Language :: Python :: Implementation :: CPython&#x27;</span>,<br>        <span class="hljs-string">&#x27;Programming Language :: Python :: Implementation :: PyPy&#x27;</span><br>    ],<br>    # $ setup.py publish support.<br>    cmdclass=&#123;<br>        <span class="hljs-string">&#x27;upload&#x27;</span>: UploadCommand,<br>    &#125;,<br>)<br></code></pre></td></tr></table></figure><p>ç¼–å†™å®Œå¯ä»¥è¿›è¡Œæœ¬åœ°æ‰“åŒ…å®‰è£…æµ‹è¯•ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">python setup.py <span class="hljs-keyword">build </span>    <span class="hljs-comment"># æ‰§è¡Œæ„å»º, ä¼šå°†åŒ…çš„å†…å®¹æ„å»ºåˆ° build æ–‡ä»¶å¤¹ä¸‹ã€‚</span><br></code></pre></td></tr></table></figure><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">python setup.py <span class="hljs-keyword">install</span>  <span class="hljs-comment"># ä¼šå°†åŒ…ç›´æ¥å®‰è£…åˆ°å½“å‰è§£é‡Šå™¨çš„ site-packages ä¸‹ï¼Œå®‰è£…å®Œæˆåå³å¯ä»¥ä½¿ç”¨ pip list å‘½ä»¤æŸ¥çœ‹åˆ°ã€‚</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæ²¡ä»€ä¹ˆé—®é¢˜çš„è¯å°±å¯ä»¥æäº¤åˆ°pypiäº†ã€‚</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> setup.<span class="hljs-keyword">py</span> sdist  ## æ‰“åŒ…<br>twine upload dist/*    ## å‘å¸ƒ<br># <span class="hljs-keyword">python</span> setup.<span class="hljs-keyword">py</span> upload   ## å¦‚æœsetup.<span class="hljs-keyword">py</span>é‡Œæœ‰uploadå‘½ä»¤ä¹Ÿå¯ä¸€é”®æ‰§è¡Œæ‰“åŒ…å‘å¸ƒ<br></code></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><ul><li><a href="https://www.jiqizhixin.com/articles/19060901">https://www.jiqizhixin.com/articles/19060901</a></li><li><a href="https://zhuanlan.zhihu.com/p/66603015">https://zhuanlan.zhihu.com/p/66603015</a></li><li><a href="https://zhuanlan.zhihu.com/p/66603015">https://zhuanlan.zhihu.com/p/66603015</a></li></ul><h5 id="æºç åœ°å€"><a href="#æºç åœ°å€" class="headerlink" title="æºç åœ°å€"></a>æºç åœ°å€</h5><ul><li><a href="https://github.com/shubihu/SDSTools">https://github.com/shubihu/SDSTools</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>LeetCode</title>
    <link href="/2021/12/28/leetcode/"/>
    <url>/2021/12/28/leetcode/</url>
    
    <content type="html"><![CDATA[<h2 id="åŠ›æ‰£ç¬”è®°"><a href="#åŠ›æ‰£ç¬”è®°" class="headerlink" title="åŠ›æ‰£ç¬”è®°"></a>åŠ›æ‰£ç¬”è®°</h2><span id="more"></span><h5 id="é¢˜ç›®æè¿°ï¼š"><a href="#é¢˜ç›®æè¿°ï¼š" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h5><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² s ï¼Œå…¶ä¸­åŒ…å«å­—æ¯é¡ºåºæ‰“ä¹±çš„ç”¨è‹±æ–‡å•è¯è¡¨ç¤ºçš„è‹¥å¹²æ•°å­—ï¼ˆ0-9ï¼‰ã€‚æŒ‰ å‡åº è¿”å›åŸå§‹çš„æ•°å­—ã€‚ä¾‹å¦‚ï¼šè¾“å…¥ï¼šs = â€œowoztneoerâ€ï¼Œè¾“å‡ºï¼šâ€012â€ã€‚<br>åŸé¢˜åœ°å€ï¼š<a href="https://leetcode-cn.com/problems/reconstruct-original-digits-from-english/">https://leetcode-cn.com/problems/reconstruct-original-digits-from-english/</a></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs vim">### æˆ‘çš„æ–¹æ¡ˆï¼Œä½¿ç”¨äº†é€’å½’ï¼Œï¼Œä½†ä¾ç„¶å¾ˆæƒ¨ï¼Œæ²¡é€šè¿‡åŠ›æ‰£çš„æ£€éªŒï¼ˆè¶…å‡ºæ—¶é—´é™åˆ¶ï¼‰<br><br>def originalDigits(s):<br>    en_num = &#123;<span class="hljs-string">&#x27;zero&#x27;</span>:<span class="hljs-number">0</span>, <span class="hljs-string">&#x27;one&#x27;</span>:<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;two&#x27;</span>:<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;three&#x27;</span>:<span class="hljs-number">3</span>,<span class="hljs-string">&#x27;four&#x27;</span>:<span class="hljs-number">4</span>,<span class="hljs-string">&#x27;five&#x27;</span>:<span class="hljs-number">5</span>,<span class="hljs-string">&#x27;six&#x27;</span>:<span class="hljs-number">6</span>,<span class="hljs-string">&#x27;seven&#x27;</span>:<span class="hljs-number">7</span>,<br>    <span class="hljs-string">&#x27;eight&#x27;</span>:<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;nine&#x27;</span>:<span class="hljs-number">9</span>&#125;<br><br>    ss = []<br>    <span class="hljs-keyword">for</span> <span class="hljs-keyword">k</span>, v in en_num.<span class="hljs-built_in">items</span>():<br>        <span class="hljs-keyword">l</span> = <span class="hljs-built_in">len</span>(<span class="hljs-keyword">k</span>)<br>        <span class="hljs-keyword">c</span> = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> i in <span class="hljs-keyword">k</span>:<br>            <span class="hljs-keyword">if</span> i in <span class="hljs-variable">s:</span><br>                <span class="hljs-keyword">c</span> += <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">c</span> == <span class="hljs-variable">l:</span><br>            ss.<span class="hljs-keyword">append</span>(str(v))<br>            <span class="hljs-keyword">for</span> <span class="hljs-keyword">j</span> in <span class="hljs-keyword">k</span>:<br>                s = s.replace(<span class="hljs-keyword">j</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-variable">s:</span><br>        ss.<span class="hljs-keyword">append</span>(originalDigits(s))<br>        ss.<span class="hljs-keyword">sort</span>()<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-keyword">join</span>(ss)<br>    <span class="hljs-keyword">else</span>:<br>        ss.<span class="hljs-keyword">sort</span>()<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.<span class="hljs-keyword">join</span>(ss)<br></code></pre></td></tr></table></figure><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs prolog">## åŠ›æ‰£æ–¹æ¡ˆ<br><br>class <span class="hljs-symbol">Solution</span>:<br>    def originalDigits(self, s: str) -&gt; str:<br>        c = <span class="hljs-symbol">Counter</span>(s)<br><br>        cnt = [<span class="hljs-number">0</span>] * <span class="hljs-number">10</span><br>        cnt[<span class="hljs-number">0</span>] = c[<span class="hljs-string">&quot;z&quot;</span>]<br>        cnt[<span class="hljs-number">2</span>] = c[<span class="hljs-string">&quot;w&quot;</span>]<br>        cnt[<span class="hljs-number">4</span>] = c[<span class="hljs-string">&quot;u&quot;</span>]<br>        cnt[<span class="hljs-number">6</span>] = c[<span class="hljs-string">&quot;x&quot;</span>]<br>        cnt[<span class="hljs-number">8</span>] = c[<span class="hljs-string">&quot;g&quot;</span>]<br><br>        cnt[<span class="hljs-number">3</span>] = c[<span class="hljs-string">&quot;h&quot;</span>] - cnt[<span class="hljs-number">8</span>]<br>        cnt[<span class="hljs-number">5</span>] = c[<span class="hljs-string">&quot;f&quot;</span>] - cnt[<span class="hljs-number">4</span>]<br>        cnt[<span class="hljs-number">7</span>] = c[<span class="hljs-string">&quot;s&quot;</span>] - cnt[<span class="hljs-number">6</span>]<br>        <br>        cnt[<span class="hljs-number">1</span>] = c[<span class="hljs-string">&quot;o&quot;</span>] - cnt[<span class="hljs-number">0</span>] - cnt[<span class="hljs-number">2</span>] - cnt[<span class="hljs-number">4</span>]<br><br>        cnt[<span class="hljs-number">9</span>] = c[<span class="hljs-string">&quot;i&quot;</span>] - cnt[<span class="hljs-number">5</span>] - cnt[<span class="hljs-number">6</span>] - cnt[<span class="hljs-number">8</span>]<br><br>        return <span class="hljs-string">&quot;&quot;</span>.join(str(x) * cnt[x] for x in range(<span class="hljs-number">10</span>))<br></code></pre></td></tr></table></figure><p>å¦‚æœå•çœ‹è¿™ä¸ªä»£ç çš„è¯æˆ‘ä¾ç„¶çœ‹ä¸æ‡‚ï¼Œè¿˜æ˜¯è¦çœ‹è§£é‡Šï¼Œè§£é‡Šåœ¨ä¸Šé¢çš„ç½‘å€é‡Œéƒ½æœ‰ã€‚åæ­£è¿™ä¸ªé¢˜ç¡®å®æŒºè€ƒéªŒæ™ºå•†çš„å§ï¼Œæˆ‘è¿™æ™ºå•†è¿˜æ˜¯æ´—æ´—ç¡äº†ã€‚</p><h5 id="é¢˜ç›®æè¿°ï¼š-1"><a href="#é¢˜ç›®æè¿°ï¼š-1" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h5><p>æ— é‡å¤å­—ç¬¦ä¸²çš„æ’åˆ—ç»„åˆã€‚ç¼–å†™ä¸€ç§æ–¹æ³•ï¼Œè®¡ç®—æŸå­—ç¬¦ä¸²çš„æ‰€æœ‰æ’åˆ—ç»„åˆï¼Œå­—ç¬¦ä¸²æ¯ä¸ªå­—ç¬¦å‡ä¸ç›¸åŒã€‚<br>ä¾‹å¦‚è¾“å…¥å­—ç¬¦ä¸²abc,åˆ™æ‰“å°å‡ºç”±å­—ç¬¦a,b,cæ‰€èƒ½æ’åˆ—å‡ºæ¥çš„æ‰€æœ‰å­—ç¬¦ä¸²abc,acb,bac,bca,cabå’Œcbaã€‚<br>åŸé¢˜åœ°å€ï¼š<a href="https://leetcode-cn.com/problems/permutation-i-lcci/">https://leetcode-cn.com/problems/permutation-i-lcci/</a><br>pythonçš„itertoolsåŒ…ä¸­çš„permutationså‡½æ•°å¯ä»¥å®ç°ã€‚</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs maxima">### itertools.<span class="hljs-built_in">permutations</span>å‡½æ•°æºç å¦‚ä¸‹<br><br>def <span class="hljs-built_in">permutation</span>(iterable, r=None):<br>    #  r:<span class="hljs-built_in">length</span> <span class="hljs-built_in">permutations</span> of elements <span class="hljs-keyword">in</span> the iterable<br>    # <span class="hljs-built_in">permutations</span>(&#x27;ABCD&#x27;, <span class="hljs-number">2</span>) --&gt; AB AC AD BA BC BD CA CB CD DA DB DC<br>    # <span class="hljs-built_in">permutations</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>)) --&gt; <span class="hljs-number">012</span> <span class="hljs-number">021</span> <span class="hljs-number">102</span> <span class="hljs-number">120</span> <span class="hljs-number">201</span> <span class="hljs-number">210</span><br>    pool = tuple(iterable)<br>    n = len(pool)<br>    r = n <span class="hljs-keyword">if</span> r <span class="hljs-built_in">is</span> None <span class="hljs-keyword">else</span> r<br>    <span class="hljs-keyword">if</span> r &gt; n:<br>        <span class="hljs-built_in">return</span><br>    <span class="hljs-built_in">indices</span> = list(<span class="hljs-built_in">range</span>(n))<br>    cycles = list(<span class="hljs-built_in">range</span>(n, n-r, -<span class="hljs-number">1</span>))<br>    yield tuple(pool[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">indices</span>[:r])<br>    <span class="hljs-keyword">while</span> n:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> reversed(<span class="hljs-built_in">range</span>(r)):<br>            cycles[i] -= <span class="hljs-number">1</span><br>            <span class="hljs-keyword">if</span> cycles[i] == <span class="hljs-number">0</span>:<br>                <span class="hljs-built_in">indices</span>[i:] = <span class="hljs-built_in">indices</span>[i+<span class="hljs-number">1</span>:] + <span class="hljs-built_in">indices</span>[i:i+<span class="hljs-number">1</span>]<br>                cycles[i] = n - i<br>            <span class="hljs-keyword">else</span>:<br>                j = cycles[i]<br>                <span class="hljs-built_in">indices</span>[i], <span class="hljs-built_in">indices</span>[-j] = <span class="hljs-built_in">indices</span>[-j], <span class="hljs-built_in">indices</span>[i]<br>                yield tuple(pool[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">indices</span>[:r])<br>                <span class="hljs-built_in">break</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">return</span><br></code></pre></td></tr></table></figure><p>æºç è¿˜æ˜¯æŒºå¤æ‚çš„ï¼Œï¼Œï¼Œï¼Œï¼Œ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go">### åŠ›æ‰£æ–¹æ³•ï¼Œä¹Ÿæ˜¯é€’å½’<br><br>def permutation(S):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(S)==<span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">return</span> [S]<br>        ans=[]<br>        <span class="hljs-keyword">for</span> i in <span class="hljs-keyword">range</span>(<span class="hljs-built_in">len</span>(S)):<br>            s=S[:i]+S[i+<span class="hljs-number">1</span>:]              <br>            <span class="hljs-keyword">for</span> <span class="hljs-keyword">string</span> in permutation(s):<br>                ans.<span class="hljs-built_in">append</span>(S[i]+<span class="hljs-keyword">string</span>)<br>        <span class="hljs-keyword">return</span> ans<br></code></pre></td></tr></table></figure><h5 id="é¢˜ç›®æè¿°ï¼š-2"><a href="#é¢˜ç›®æè¿°ï¼š-2" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h5><p>ç»™å®šä¸¤ä¸ªå•è¯ word1 å’Œ word2ï¼Œè¯·è®¡ç®—å‡º word1 ä¸ word2 çš„æœ€é•¿å…¬å…±å­—ä¸²é•¿åº¦ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">word1</span> = &#x27;abcfdg&#x27;<br><span class="hljs-attribute">word2</span> = &#x27;bcfdkhi&#x27;<br><br><span class="hljs-attribute">def</span> comm_len(word<span class="hljs-number">1</span>, word<span class="hljs-number">2</span>):<br>    <span class="hljs-attribute">c</span> = <span class="hljs-number">0</span><br>    <span class="hljs-attribute">for</span> i in range(len(word<span class="hljs-number">1</span>)):<br>        <span class="hljs-attribute">if</span> word[i-c:i+<span class="hljs-number">1</span>] in word<span class="hljs-number">2</span>:<br>            <span class="hljs-attribute">c</span> += <span class="hljs-number">1</span><br><br>    <span class="hljs-attribute">return</span> c<br><br></code></pre></td></tr></table></figure><h5 id="é¢˜ç›®æè¿°ï¼š-3"><a href="#é¢˜ç›®æè¿°ï¼š-3" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h5><p>å¿«é€Ÿæ’åº</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">arr = <span class="hljs-literal">[<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">12</span>, <span class="hljs-number">32</span>, <span class="hljs-number">198</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">15</span>, <span class="hljs-number">112</span>, <span class="hljs-number">132</span>]</span><br><br>def quick<span class="hljs-constructor">_sort(<span class="hljs-params">arr</span>)</span>:<br>    <span class="hljs-keyword">if</span> len(arr) &lt;= <span class="hljs-number">1</span>:<br>        return arr<br>    tmp = arr<span class="hljs-literal">[<span class="hljs-number">0</span>]</span><br>    left = <span class="hljs-literal">[<span class="hljs-identifier">i</span> <span class="hljs-identifier">for</span> <span class="hljs-identifier">i</span> <span class="hljs-identifier">in</span> <span class="hljs-identifier">arr</span>[<span class="hljs-number">1</span>:]</span> <span class="hljs-keyword">if</span> i &lt; tmp]<br>    right = <span class="hljs-literal">[<span class="hljs-identifier">i</span> <span class="hljs-identifier">for</span> <span class="hljs-identifier">i</span> <span class="hljs-identifier">in</span> <span class="hljs-identifier">arr</span>[<span class="hljs-number">1</span>:]</span> <span class="hljs-keyword">if</span> i &gt; tmp]<br>    return quick<span class="hljs-constructor">_sort(<span class="hljs-params">left</span>)</span> + <span class="hljs-literal">[<span class="hljs-identifier">tmp</span>]</span> + quick<span class="hljs-constructor">_sort(<span class="hljs-params">right</span>)</span><br><br>print(quick<span class="hljs-constructor">_sort(<span class="hljs-params">arr</span>)</span>)<br></code></pre></td></tr></table></figure><h5 id="é¢˜ç›®æè¿°ï¼š-4"><a href="#é¢˜ç›®æè¿°ï¼š-4" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h5><p>å½’å¹¶æ’åºåº”ç”¨</p><ul><li><p>1ã€å°†ä¸¤ä¸ªæœ‰åºæ•°ç»„åˆå¹¶æˆä¸€ä¸ªæœ‰åºæ•°ç»„</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-keyword">a</span> = [<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">7</span>]<br>b = [<span class="hljs-number">2</span>,<span class="hljs-number">6</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>]<br><br>def <span class="hljs-built_in">merge</span>(left, <span class="hljs-literal">right</span>):<br>    <span class="hljs-string">&#x27;&#x27;</span><span class="hljs-string">&#x27;åˆå¹¶æ“ä½œï¼Œå°†ä¸¤ä¸ªæœ‰åºæ•°ç»„left[]å’Œright[]åˆå¹¶æˆä¸€ä¸ªå¤§çš„æœ‰åºæ•°ç»„&#x27;</span><span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-comment">#leftä¸rightçš„ä¸‹æ ‡æŒ‡é’ˆ</span><br>    l, r = <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br>    <span class="hljs-built_in">result</span> = []<br>    <span class="hljs-keyword">while</span> l&lt;<span class="hljs-built_in">len</span>(left) <span class="hljs-keyword">and</span> r&lt;<span class="hljs-built_in">len</span>(<span class="hljs-literal">right</span>):<br>        <span class="hljs-keyword">if</span> left[l] &lt; <span class="hljs-literal">right</span>[r]:<br>            <span class="hljs-built_in">result</span>.append(left[l])<br>            l += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">result</span>.append(<span class="hljs-literal">right</span>[r])<br>            r += <span class="hljs-number">1</span><br>    <span class="hljs-built_in">result</span> += left[l:]<br>    <span class="hljs-built_in">result</span> += <span class="hljs-literal">right</span>[r:]<br>    <span class="hljs-literal">return</span> <span class="hljs-built_in">result</span><br><br>print(<span class="hljs-built_in">merge</span>(<span class="hljs-keyword">a</span>, b))<br></code></pre></td></tr></table></figure></li><li><ol start="2"><li>æ¯ä¸ª SNP ä½ç‚¹ç”¨ä¸€ä¸ªé•¿åº¦ä¸º 2 çš„ list è¡¨ç¤ºï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºæŸ“è‰²ä½“ç¼–å·ï¼ˆchrï¼ŒèŒƒå›´ä¸º<br>1~22ï¼‰ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸ºæŸ“è‰²ä½“ä¸Šçš„ä½ç½®ï¼ˆposï¼‰ã€‚å†™ä¸€ä¸ª python å‡½æ•°ï¼Œè¾“å…¥ä¸¤ä¸ªæ­£åºï¼ˆæŒ‰<br>chr å’Œ pos æ’åºï¼‰çš„ SNP ä½ç‚¹ listï¼Œè¾“å‡ºä¸€ä¸ªåˆå¹¶ä¸”å»é‡çš„æ­£åº SNP ä½ç‚¹ listã€‚ä¸èƒ½ä½¿ç”¨<br>sorted å‡½æ•°ã€pandas åº“ï¼Œè¦æ±‚æ—¶é—´å¤æ‚åº¦å°½å¯èƒ½ä½ã€‚<br>ä¾‹å¦‚ï¼š<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lua">Input: list1 = <span class="hljs-string">[[1,230], [1,4000], [2,500]]</span>, list2 = <span class="hljs-string">[[2,320], [6,70]]</span><br>Output: <span class="hljs-string">[[1,230], [1,4000], [2,320], [2,500], [6,70]]</span><br></code></pre></td></tr></table></figure></li></ol></li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">list1</span> =<span class="hljs-meta"> [[1,230], [1,4000], [2,500]]</span><br><span class="hljs-attribute">list2</span> =<span class="hljs-meta"> [[2,320], [6,70]]</span><br><br><span class="hljs-attribute">def</span> merge(list<span class="hljs-number">1</span>, list<span class="hljs-number">2</span>):<br>    <span class="hljs-attribute">l</span>, r = <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br>    <span class="hljs-attribute">result</span> =<span class="hljs-meta"> []</span><br>    <span class="hljs-attribute">while</span> l&lt;len(list<span class="hljs-number">1</span>) and r&lt;len(list<span class="hljs-number">2</span>):<br>        <span class="hljs-attribute">if</span> list<span class="hljs-number">1</span>[l][<span class="hljs-number">0</span>] &lt; list<span class="hljs-number">2</span>[r][<span class="hljs-number">0</span>]:<br>            <span class="hljs-attribute">if</span> list<span class="hljs-number">1</span>[l] not in result:<br>                <span class="hljs-attribute">result</span>.append(list<span class="hljs-number">1</span>[l])<br>            <span class="hljs-attribute">l</span> += <span class="hljs-number">1</span><br>        <span class="hljs-attribute">else</span>:<br>            <span class="hljs-attribute">if</span> list<span class="hljs-number">2</span>[r] not in result:<br>                <span class="hljs-attribute">result</span>.append(list<span class="hljs-number">2</span>[r])<br>            <span class="hljs-attribute">r</span> += <span class="hljs-number">1</span><br><br>    <span class="hljs-attribute">result</span> += list<span class="hljs-number">1</span>[l:]<br>    <span class="hljs-attribute">result</span> += list<span class="hljs-number">2</span>[r:]<br>    <span class="hljs-attribute">return</span> result<br><br><span class="hljs-attribute">print</span>(merge(list<span class="hljs-number">1</span>, list<span class="hljs-number">2</span>))<br></code></pre></td></tr></table></figure><h5 id="é¢˜ç›®æè¿°ï¼š-5"><a href="#é¢˜ç›®æè¿°ï¼š-5" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h5><p>è¾“å‡ºå•å‘é“¾è¡¨ä¸­å€’æ•°ç¬¬kä¸ªç»“ç‚¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Node</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, val=<span class="hljs-number">0</span></span>):</span><br>        self.val = val<br>        self.<span class="hljs-built_in">next</span> = <span class="hljs-literal">None</span><br><br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">try</span>:<br>        l, s, k, head = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>()), <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, <span class="hljs-built_in">input</span>().split())), <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>()), Node()<br>        <span class="hljs-keyword">while</span> k:<br>            head.<span class="hljs-built_in">next</span> = Node(s.pop())<br>            head = head.<span class="hljs-built_in">next</span><br>            k -= <span class="hljs-number">1</span><br>        <span class="hljs-built_in">print</span>(head.val)<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><h5 id="é¢˜ç›®æè¿°ï¼š-6"><a href="#é¢˜ç›®æè¿°ï¼š-6" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h5><p>ç»™å®šä¸¤ä¸ªå•è¯ word1 å’Œ word2ï¼Œè¯·è®¡ç®—å‡ºå°† word1 è½¬æ¢æˆ word2 æ‰€ä½¿ç”¨çš„æœ€å°‘æ“ä½œæ•°ã€‚<br>å‚è€ƒï¼š<a href="https://www.jianshu.com/p/9a53f32cf62b">https://www.jianshu.com/p/9a53f32cf62b</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">editDistance</span>(<span class="hljs-params">str1, str2</span>):</span><br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    è®¡ç®—å­—ç¬¦ä¸²str1å’Œstr2çš„ç¼–è¾‘è·ç¦»</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    edit = [[i+j <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(str2)+<span class="hljs-number">1</span>)] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(str1)+<span class="hljs-number">1</span>)]<br>    <span class="hljs-built_in">print</span>(edit)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-built_in">len</span>(str1)+<span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-built_in">len</span>(str2)+<span class="hljs-number">1</span>):<br>            <span class="hljs-keyword">if</span> str1[i-<span class="hljs-number">1</span>] == str2[j-<span class="hljs-number">1</span>]:<br>                d = <span class="hljs-number">0</span><br>            <span class="hljs-keyword">else</span>:<br>                d = <span class="hljs-number">1</span><br>            edit[i][j] = <span class="hljs-built_in">min</span>(edit[i-<span class="hljs-number">1</span>][j]+<span class="hljs-number">1</span>,edit[i][j-<span class="hljs-number">1</span>]+<span class="hljs-number">1</span>,edit[i-<span class="hljs-number">1</span>][j-<span class="hljs-number">1</span>]+d)<br>    <span class="hljs-keyword">return</span> edit[<span class="hljs-built_in">len</span>(str1)][<span class="hljs-built_in">len</span>(str2)]<br><br>editDistance(<span class="hljs-string">&#x27;python&#x27;</span>, <span class="hljs-string">&#x27;pyton&#x27;</span>)<br></code></pre></td></tr></table></figure><h5 id="é¢˜ç›®æè¿°ï¼š-7"><a href="#é¢˜ç›®æè¿°ï¼š-7" class="headerlink" title="é¢˜ç›®æè¿°ï¼š"></a>é¢˜ç›®æè¿°ï¼š</h5><ul><li><p>æœ€é•¿å›æ–‡å­—ä¸²</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs stylus">s = <span class="hljs-selector-tag">input</span>()<br>win_len = <span class="hljs-number">2</span><br>s_list = <span class="hljs-selector-attr">[]</span><br><span class="hljs-keyword">for</span> <span class="hljs-selector-tag">i</span> <span class="hljs-keyword">in</span> range(len(s)):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(i+<span class="hljs-number">1</span>, len(s) + <span class="hljs-number">1</span>):<br>        ss = s<span class="hljs-selector-attr">[i:j]</span><br>        <span class="hljs-keyword">if</span> ss == ss<span class="hljs-selector-attr">[::-1]</span>:<br>            s_list<span class="hljs-selector-class">.append</span>(len(ss))<br>            <br><span class="hljs-function"><span class="hljs-title">print</span><span class="hljs-params">(max(s_list)</span></span>)<br></code></pre></td></tr></table></figure></li><li><p>è¾“å…¥ä¸¤ä¸ª DNA åºåˆ—ï¼Œè¾“å‡ºå®ƒä»¬çš„æœ€é•¿å…¬å…±åºåˆ—ã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Input</span>: seq<span class="hljs-number">1</span> = â€œAGGCTâ€, seq<span class="hljs-number">2</span> = â€œGGCAâ€<br><span class="hljs-attribute">Output</span>: â€œGGCâ€<br></code></pre></td></tr></table></figure></li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">seq1</span> = &#x27;AGGCT&#x27;<br><span class="hljs-attribute">seq2</span> = &#x27;GGCA&#x27;<br><br><span class="hljs-attribute">def</span> comm_len(seq<span class="hljs-number">1</span>, seq<span class="hljs-number">2</span>):<br>    <span class="hljs-attribute">c</span> = <span class="hljs-number">0</span><br>    <span class="hljs-attribute">seq_list</span> =<span class="hljs-meta"> []</span><br>    <span class="hljs-attribute">for</span> i in range(len(seq<span class="hljs-number">1</span>)):<br>        <span class="hljs-attribute">tmp</span> = seq<span class="hljs-number">1</span>[i-c:i+<span class="hljs-number">1</span>]<br>        <span class="hljs-attribute">if</span> tmp in seq<span class="hljs-number">2</span>:<br>            <span class="hljs-attribute">c</span> += <span class="hljs-number">1</span><br>            <span class="hljs-attribute">seq_list</span>.append(tmp)<br><br>          <br>    <span class="hljs-attribute">return</span> seq_list[-<span class="hljs-number">1</span>]<br><br><span class="hljs-attribute">print</span>(comm_len(seq<span class="hljs-number">1</span>, seq<span class="hljs-number">2</span>))<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VIPè§†é¢‘è§£ææ‰‹æœºç«¯</title>
    <link href="/2021/12/24/VIP%E8%A7%86%E9%A2%91%E8%A7%A3%E6%9E%90%E6%89%8B%E6%9C%BA%E7%AB%AF/"/>
    <url>/2021/12/24/VIP%E8%A7%86%E9%A2%91%E8%A7%A3%E6%9E%90%E6%89%8B%E6%9C%BA%E7%AB%AF/</url>
    
    <content type="html"><![CDATA[<h2 id="è–…å„å¤§å‚è§†é¢‘ç¾Šæ¯›â€”â€”æ‰‹æœºç«¯"><a href="#è–…å„å¤§å‚è§†é¢‘ç¾Šæ¯›â€”â€”æ‰‹æœºç«¯" class="headerlink" title="è–…å„å¤§å‚è§†é¢‘ç¾Šæ¯›â€”â€”æ‰‹æœºç«¯"></a>è–…å„å¤§å‚è§†é¢‘ç¾Šæ¯›â€”â€”æ‰‹æœºç«¯</h2><span id="more"></span><p>ä»¥å‰éƒ½æ˜¯ç”¨ç”µè„‘ç«¯Chromeæµè§ˆå™¨å®‰è£…æ²¹çŒ´æ’ä»¶åŠå…¶ç›¸åº”çš„è„šæœ¬çœ‹è§†é¢‘ï¼Œä½†æ˜¯å¦‚æœæƒ³ç”¨ç”µè§†çœ‹è§†é¢‘ï¼Œç”¨ç”µè„‘æŠ•å±ç»ˆç©¶æ˜¯æœ‰ç‚¹éº»çƒ¦ã€‚æ‰¾äº†è®¸ä¹…è¿˜æ˜¯è®©æˆ‘æ‰¾åˆ°äº†æ‰‹æœºç«¯å¯ä»¥ä½¿ç”¨è„šæœ¬çš„æµè§ˆå™¨ã€‚<br>ä½¿ç”¨æ–¹æ³•ä¹Ÿå¯ä»¥ç›´æ¥è·³è½¬è¯¥åœ°å€ï¼š<br><a href="https://blog.csdn.net/qq_37759464/article/details/121903038?utm_source=app&amp;app_version=4.20.0&amp;code=app_1562916241&amp;uLinkId=usr1mkqgl919blen">https://blog.csdn.net/qq_37759464/article/details/121903038?utm_source=app&amp;app_version=4.20.0&amp;code=app_1562916241&amp;uLinkId=usr1mkqgl919blen</a></p><p>ä¸ªäººæ¨èçš„è¯ï¼šå®‰å“å¯ä»¥ä½¿ç”¨Viaæµè§ˆå™¨ï¼ŒçœŸçš„å¾ˆç®€çº¦ï¼Œå®˜ç½‘ä¹Ÿä¸€æ ·çš„ç®€çº¦ï¼ˆ<a href="https://viayoo.com/zh-cn/%EF%BC%89%EF%BC%8C%E8%80%8C%E4%B8%94%E4%BA%B2%E6%B5%8B%E5%8F%AF%E4%BB%A5%E5%AE%9E%E7%8E%B0VIP%E8%A7%86%E9%A2%91%E8%A7%A3%E6%9E%90%E3%80%82%E8%8B%B9%E6%9E%9CIOS%E7%AB%AF%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8Alook%EF%BC%8C%E4%B8%8D%E8%BF%87%E8%BF%99%E4%B8%AA%E8%BD%AF%E4%BB%B6%E4%B8%8D%E6%98%AF%E5%85%8D%E8%B4%B9%E7%9A%84%EF%BC%88%E7%8E%B0%E5%9C%A8%E7%96%AB%E6%83%85%E6%90%9E%E5%8D%8A%E4%BB%B7%E6%B4%BB%E5%8A%A86%E5%85%83%EF%BC%8C%E4%B8%8D%E8%BF%87%E6%94%AF%E4%BB%98%E5%AE%9D%E6%9C%89%E6%97%B6%E5%80%99%E4%BC%9A%E6%9C%89%E8%8B%B9%E6%9E%9CAppstore%E6%B6%88%E8%B4%B9%E5%88%B8%EF%BC%8C%E6%AF%94%E5%A6%82%E4%BF%BA%E4%BB%8A%E5%A4%A9%E9%A2%86%E4%BA%869%E5%85%83%EF%BC%8C%E6%9E%9C%E6%96%AD%E5%85%A5%E6%89%8B%E7%99%BD%E6%8D%A1%E4%BA%86%E8%BF%99%E4%B8%AA%E6%B5%8F%E8%A7%88%E5%99%A8%EF%BC%89%E3%80%82">https://viayoo.com/zh-cn/ï¼‰ï¼Œè€Œä¸”äº²æµ‹å¯ä»¥å®ç°VIPè§†é¢‘è§£æã€‚è‹¹æœIOSç«¯å¯ä»¥ä½¿ç”¨Alookï¼Œä¸è¿‡è¿™ä¸ªè½¯ä»¶ä¸æ˜¯å…è´¹çš„ï¼ˆç°åœ¨ç–«æƒ…æåŠä»·æ´»åŠ¨6å…ƒï¼Œä¸è¿‡æ”¯ä»˜å®æœ‰æ—¶å€™ä¼šæœ‰è‹¹æœAppstoreæ¶ˆè´¹åˆ¸ï¼Œæ¯”å¦‚ä¿ºä»Šå¤©é¢†äº†9å…ƒï¼Œæœæ–­å…¥æ‰‹ç™½æ¡äº†è¿™ä¸ªæµè§ˆå™¨ï¼‰ã€‚</a></p><p>å®‰è£…å¥½æµè§ˆå™¨åå°±æ˜¯å®‰è£…è„šæœ¬äº†ï¼Œä¸Šé¢çš„åœ°å€é‡Œæœ‰è¯¦ç»†çš„æ–¹æ³•ï¼Œè„šæœ¬çš„åœ°å€åœ¨æ­¤ï¼š<br><a href="https://greasyfork.org/zh-CN/scripts/435698-%E5%85%A8%E7%BD%91vip%E8%A7%86%E9%A2%91%E8%87%AA%E5%8A%A8%E8%A7%A3%E6%9E%90%E6%92%AD%E6%94%BE%E5%99%A8-%E5%B7%B2%E9%80%82%E9%85%8D%E6%89%8B%E6%9C%BA%E3%80%82">https://greasyfork.org/zh-CN/scripts/435698-%E5%85%A8%E7%BD%91vip%E8%A7%86%E9%A2%91%E8%87%AA%E5%8A%A8%E8%A7%A3%E6%9E%90%E6%92%AD%E6%94%BE%E5%99%A8-%E5%B7%B2%E9%80%82%E9%85%8D%E6%89%8B%E6%9C%BAã€‚</a></p><p>è¯´ä¸‹æˆ‘å®‰è£…è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å§ï¼Œå°±æ˜¯å…¨é€‰å¤åˆ¶é‚£å—ï¼Œä¸çŸ¥é“ä¸ºå•¥å°±æ˜¯ä¸èƒ½å…¨é€‰ï¼Œæ²¡åŠæ³•åªèƒ½æ…¢æ…¢æ‹–æ‹½å…‰æ ‡è¿›è¡Œå…¨é€‰ç„¶åå¤åˆ¶ï¼ˆè„šæœ¬æ˜¯çœŸé•¿ï¼‰ã€‚</p><p>æ‰‹æœºæŠ•å±çš„è¯ï¼Œå®‰å“å¯ä»¥ç”¨ä¹æ’­æŠ•å±ï¼Œè‹¹æœçš„è¯ç›´æ¥ç”¨è‡ªå¸¦çš„å±å¹•é•œåƒè¿›è¡ŒæŠ•å±å°±OKäº†ã€‚</p><p>å½“ç„¶äº†å¦‚æœæœ‰é’±å¼€VIPå°±å¯ä»¥ç›´æ¥å¿½ç•¥æœ¬æ–‡å•¦ï¼Œä¸è¿‡çˆ±å¥‡è‰ºåˆè¦æ¶¨ä»·äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>TroubleShoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è–…ç¾Šæ¯›</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JupyterNotebookè¿œç¨‹äº‘æœåŠ¡å™¨</title>
    <link href="/2021/11/30/jupyter/"/>
    <url>/2021/11/30/jupyter/</url>
    
    <content type="html"><![CDATA[<h2 id="æ­å»ºJupyter-Notebookè¿œç¨‹äº‘æœåŠ¡å™¨"><a href="#æ­å»ºJupyter-Notebookè¿œç¨‹äº‘æœåŠ¡å™¨" class="headerlink" title="æ­å»ºJupyter Notebookè¿œç¨‹äº‘æœåŠ¡å™¨"></a>æ­å»ºJupyter Notebookè¿œç¨‹äº‘æœåŠ¡å™¨</h2><span id="more"></span><h5 id="å®‰è£…Jupyter"><a href="#å®‰è£…Jupyter" class="headerlink" title="å®‰è£…Jupyter"></a>å®‰è£…Jupyter</h5><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs verilog">pip install Jupyter<br>jupyter notebook --<span class="hljs-keyword">generate</span>-<span class="hljs-keyword">config</span><br></code></pre></td></tr></table></figure><h5 id="è®¾ç½®å¯†ç ç”¨äºè®¾ç½®æœåŠ¡å™¨é…ç½®ï¼Œä»¥åŠç™»å½•Jupyterã€‚æ‰“å¼€Pythonç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹ï¼š"><a href="#è®¾ç½®å¯†ç ç”¨äºè®¾ç½®æœåŠ¡å™¨é…ç½®ï¼Œä»¥åŠç™»å½•Jupyterã€‚æ‰“å¼€Pythonç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹ï¼š" class="headerlink" title="è®¾ç½®å¯†ç ç”¨äºè®¾ç½®æœåŠ¡å™¨é…ç½®ï¼Œä»¥åŠç™»å½•Jupyterã€‚æ‰“å¼€Pythonç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹ï¼š"></a>è®¾ç½®å¯†ç ç”¨äºè®¾ç½®æœåŠ¡å™¨é…ç½®ï¼Œä»¥åŠç™»å½•Jupyterã€‚æ‰“å¼€Pythonç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹ï¼š</h5><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">jupyter notebook password</span><br></code></pre></td></tr></table></figure><h5 id="è®¾ç½®æœåŠ¡å™¨é…ç½®æ–‡ä»¶"><a href="#è®¾ç½®æœåŠ¡å™¨é…ç½®æ–‡ä»¶" class="headerlink" title="è®¾ç½®æœåŠ¡å™¨é…ç½®æ–‡ä»¶"></a>è®¾ç½®æœåŠ¡å™¨é…ç½®æ–‡ä»¶</h5><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">vim ~<span class="hljs-regexp">/.jupyter/</span>jupyter_notebook_config.py<br></code></pre></td></tr></table></figure><p>åœ¨æœ«å°¾å¢åŠ ä»¥ä¸‹å‡ è¡Œé…ç½®ä¿¡æ¯</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">c.NotebookApp.ip</span> = <span class="hljs-string">&#x27;*&#x27;</span> <span class="hljs-comment">#æ‰€æœ‰ç»‘å®šæœåŠ¡å™¨çš„IPéƒ½èƒ½è®¿é—®ï¼Œè‹¥æƒ³åªåœ¨ç‰¹å®šipè®¿é—®ï¼Œè¾“å…¥ipåœ°å€å³å¯</span><br><span class="hljs-attr">c.NotebookApp.port</span> = <span class="hljs-number">8888</span> <span class="hljs-comment">#å°†ç«¯å£è®¾ç½®ä¸ºè‡ªå·±å–œæ¬¢çš„å§ï¼Œé»˜è®¤æ˜¯8888</span><br><span class="hljs-attr">c.NotebookApp.open_browser</span> = <span class="hljs-literal">False</span> <span class="hljs-comment">#æˆ‘ä»¬å¹¶ä¸æƒ³åœ¨æœåŠ¡å™¨ä¸Šç›´æ¥æ‰“å¼€Jupyter Notebookï¼Œæ‰€ä»¥è®¾ç½®æˆFalse</span><br><span class="hljs-attr">c.NotebookApp.notebook_dir</span> = <span class="hljs-string">&#x27;/root/jupyter_projects&#x27;</span> <span class="hljs-comment">#è¿™é‡Œæ˜¯è®¾ç½®Jupyterçš„æ ¹ç›®å½•ï¼Œè‹¥ä¸è®¾ç½®å°†é»˜è®¤rootçš„æ ¹ç›®å½•ï¼Œä¸å®‰å…¨</span><br><span class="hljs-attr">c.NotebookApp.allow_root</span> = <span class="hljs-literal">True</span> <span class="hljs-comment"># ä¸ºäº†å®‰å…¨ï¼ŒJupyteré»˜è®¤ä¸å…è®¸ä»¥rootæƒé™å¯åŠ¨jupyter </span><br></code></pre></td></tr></table></figure><h5 id="å¯åŠ¨Jupyter-è¿œç¨‹æœåŠ¡å™¨"><a href="#å¯åŠ¨Jupyter-è¿œç¨‹æœåŠ¡å™¨" class="headerlink" title="å¯åŠ¨Jupyter è¿œç¨‹æœåŠ¡å™¨"></a>å¯åŠ¨Jupyter è¿œç¨‹æœåŠ¡å™¨</h5><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">jupyter notebook</span><br></code></pre></td></tr></table></figure><p>è‡³æ­¤ï¼ŒJupyterè¿œç¨‹æœåŠ¡å™¨ä»¥æ­å»ºå®Œæ¯•ã€‚åœ¨æœ¬åœ°æµè§ˆå™¨ä¸Šï¼Œè¾“å…¥ ipåœ°å€:8888ï¼Œå°†ä¼šæ‰“å¼€è¿œç¨‹Jupyterã€‚æ¥ä¸‹æ¥å°±å¯ä»¥åƒåœ¨æœ¬åœ°ä¸€æ ·ä½¿ç”¨æœåŠ¡å™¨ä¸Šçš„Jupyterã€‚</p><p>å¦‚æœå‡ºç°ä¸èƒ½è¿æ¥çš„æƒ…å†µï¼Œå¤šåŠæ˜¯é˜²ç«å¢™çš„é—®é¢˜ã€‚<br>ç®€å•ç²—æš´ä¸€åŠ³æ°¸é€¸çš„å°±æ˜¯å…³é—­é˜²ç«å¢™ï¼Œå½“ç„¶ä¹Ÿå¯è¿›è¡Œè®¾ç½®ã€‚å‚è€ƒ <a href="https://www.codeleading.com/article/10462087431/">https://www.codeleading.com/article/10462087431/</a></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">systemctl stop firewalld.service<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>jupyter</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pytorchæ¨¡å‹è½¬paddleæ¨¡å‹è¸©å‘è®°å½•</title>
    <link href="/2021/11/29/pytorch2paddle/"/>
    <url>/2021/11/29/pytorch2paddle/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><h5 id="è¸©å‘1"><a href="#è¸©å‘1" class="headerlink" title="è¸©å‘1"></a>è¸©å‘1</h5><p>ç½‘ä¸Šæœ‰å¾ˆå¤šä½¿ç”¨x2paddleæŠŠpytorchè½¬paddleçš„æ–‡ç« ï¼Œä¸è¿‡å¤§ä¸éƒ¨åˆ†ä¹Ÿéƒ½æ˜¯é‡‡ç”¨çš„è¿‚å›è·¯çº¿ï¼Œå°±æ˜¯å…ˆè½¬ONNXï¼Œå†è½¬paddleï¼Œè¯•äº†ä¸‹æ°´ï¼Œæœç„¶æ²¡æœ‰é‚£ä¹ˆç®€å•çš„äº‹æƒ…ï¼Œä¸€ç›´æŠ¥é”™ï¼Œæœ€åå¥½åƒæŠ¥äº†ä¸ª model not supportï¼Œï¼Œï¼Œï¼Œé‚æ”¾å¼ƒã€‚</p><h5 id="è¸©å‘2"><a href="#è¸©å‘2" class="headerlink" title="è¸©å‘2"></a>è¸©å‘2</h5><p>ä½¿ç”¨å·¥å…·ä¸è¡Œåªæœ‰ä¸€æ­¥ä¸€æ­¥æ…¢æ…¢è½¬ï¼Œè¿™ä¹Ÿæ˜¯æœ€å¼€å§‹ä½¿ç”¨çš„æ–¹æ³•ï¼Œèµ·åˆæŠ¥é”™æ²¡è§£å†³æ‰æ‰¾åˆ°x2paddleçš„ï¼Œæ²¡æƒ³åˆ°åˆå›å½’åˆ°æœ€åŸå§‹çš„æ–¹æ³•äº†ã€‚<br>è½¬æ¢çš„è¿‡ç¨‹ä¸€ç›´å¡åœ¨ç½‘ç»œè¿™å—ï¼Œæ‰€ä»¥å°±å…ˆæŠŠç½‘ç»œè¿™å—æ‹¿å‡ºæ¥è®°å½•ä¸‹ã€‚</p><h6 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h6><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs clean">######################### torch ç‰ˆ  ############################<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<br><br><span class="hljs-keyword">class</span> SeqNet(nn.Module):<br>    def __init__(self):<br>        super(SeqNet, self).__init__()<br>        # input <br>        self.conv1 = nn.Conv1d(<span class="hljs-number">12</span>, <span class="hljs-number">10</span>, <span class="hljs-number">50</span>)<br>        self.conv2 = nn.Conv1d(<span class="hljs-number">12</span>, <span class="hljs-number">10</span>, <span class="hljs-number">200</span>)<br>        self.conv3 = nn.Conv1d(<span class="hljs-number">12</span>, <span class="hljs-number">10</span>, <span class="hljs-number">500</span>)<br>        self.conv4 = nn.Conv1d(<span class="hljs-number">12</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1000</span>)<br>        self.pooling = nn.MaxPool2d((<span class="hljs-number">1</span>, <span class="hljs-number">200</span>))<br>        self.fc1 = nn.Linear(<span class="hljs-number">900</span>, <span class="hljs-number">64</span>)<br>        self.fc2 = nn.Linear(<span class="hljs-number">64</span>, <span class="hljs-number">1</span>)<br><br>    def forward(self, x):<br>        batch_size = x.size(<span class="hljs-number">0</span>)<br>        <br>        out1 = self.pooling(F.relu(self.conv1(x)))<br>        out2 = self.pooling(F.relu(self.conv2(x)))<br>        out3 = self.pooling(F.relu(self.conv3(x)))<br>        out4 = self.pooling(F.relu(self.conv4(x)))<br><br>        out = torch.cat([out1, out2, out3, out4], <span class="hljs-number">2</span>)<br>        out = out.view(batch_size, <span class="hljs-number">-1</span>)<br>        out = self.fc1(out)<br>        out = F.relu(out)<br>        # out = F.dropout(out, p=<span class="hljs-number">0.2</span>)<br>        out = self.fc2(out)<br>        return out<br></code></pre></td></tr></table></figure><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs clean">######################### paddle ç‰ˆ  ############################<br><span class="hljs-keyword">import</span> paddle<br><span class="hljs-keyword">import</span> paddle.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">import</span> paddle.nn.functional <span class="hljs-keyword">as</span> F<br><br><span class="hljs-keyword">class</span> SeqNet(nn.Layer):<br>    def __init__(self):<br>        super(SeqNet, self).__init__()<br>        # input <br>        self.conv1 = nn.Conv1D(<span class="hljs-number">12</span>, <span class="hljs-number">10</span>, <span class="hljs-number">50</span>)<br>        self.conv2 = nn.Conv1D(<span class="hljs-number">12</span>, <span class="hljs-number">10</span>, <span class="hljs-number">200</span>)<br>        self.conv3 = nn.Conv1D(<span class="hljs-number">12</span>, <span class="hljs-number">10</span>, <span class="hljs-number">500</span>)<br>        self.conv4 = nn.Conv1D(<span class="hljs-number">12</span>, <span class="hljs-number">10</span>, <span class="hljs-number">1000</span>)<br>        # self.pooling = nn.MaxPool2D((<span class="hljs-number">1</span>, <span class="hljs-number">200</span>))   <br>        ### torchç‰ˆçš„ nn.MaxPool2D è¾“å…¥æ•°å‰§æ ¼å¼ä¸ºï¼ˆNCHW æˆ– CHWï¼‰,paddleç‰ˆçš„ nn.MaxPool2D è¾“å…¥æ•°æ®æ ¼å¼åªæœ‰ NCHW<br>        ### Nä»£è¡¨batch_sizeï¼Œ Cä»£è¡¨channelï¼ŒHä»£è¡¨é«˜åº¦ï¼ŒWä»£è¡¨å®½åº¦<br>        ### æ‰€ä»¥è¿™é‡Œç”¨ paddle çš„ nn.MaxPool1D æ›¿æ¢äº† torch çš„ nn.MaxPool2D<br>        self.pooling = nn.MaxPool1D(<span class="hljs-number">200</span>)<br>        self.fc1 = nn.Linear(<span class="hljs-number">900</span>, <span class="hljs-number">64</span>)<br>        self.fc2 = nn.Linear(<span class="hljs-number">64</span>, <span class="hljs-number">1</span>)<br><br>    def forward(self, x):<br>        ### torch.tensor.size å¯¹åº” paddle.tensor.shape<br>        batch_size = x.shape[<span class="hljs-number">0</span>]   <br>        <br>        out1 = self.pooling(F.relu(self.conv1(x)))<br>        out2 = self.pooling(F.relu(self.conv2(x)))<br>        out3 = self.pooling(F.relu(self.conv3(x)))<br>        out4 = self.pooling(F.relu(self.conv4(x)))<br>        <br>        ### torch.cat å¯¹åº” paddle.concat<br>        # out = torch.cat([out1, out2, out3, out4], <span class="hljs-number">2</span>)  <br>        out = paddle.concat([out1, out2, out3, out4], <span class="hljs-number">2</span>)<br>        ### torch.tensor.view å¯¹åº” paddle.tensor.reshape<br>        # out = out.view(batch_size, <span class="hljs-number">-1</span>)<br>        out = paddle.reshape(out, [batch_size, <span class="hljs-number">-1</span>])<br>        out = self.fc1(out)<br>        out = F.relu(out)<br>        # out = F.dropout(out, p=<span class="hljs-number">0.2</span>)<br>        out = self.fc2(out)<br><br>        return out<br></code></pre></td></tr></table></figure><h6 id="å¯¹äºè‡ªå®šä¹‰æ•°æ®é›†-paddleå’Œpytorchå®ç°çš„æ–¹æ³•ç±»ä¼¼"><a href="#å¯¹äºè‡ªå®šä¹‰æ•°æ®é›†-paddleå’Œpytorchå®ç°çš„æ–¹æ³•ç±»ä¼¼" class="headerlink" title="å¯¹äºè‡ªå®šä¹‰æ•°æ®é›† paddleå’Œpytorchå®ç°çš„æ–¹æ³•ç±»ä¼¼"></a>å¯¹äºè‡ªå®šä¹‰æ•°æ®é›† paddleå’Œpytorchå®ç°çš„æ–¹æ³•ç±»ä¼¼</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> paddle.io <span class="hljs-keyword">import</span> Dataset<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyDataset</span>(<span class="hljs-params">Dataset</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    æ­¥éª¤ä¸€ï¼šç»§æ‰¿paddle.io.Datasetç±»</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, mode=<span class="hljs-string">&#x27;train&#x27;</span></span>):</span><br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ­¥éª¤äºŒï¼šå®ç°æ„é€ å‡½æ•°ï¼Œå®šä¹‰æ•°æ®è¯»å–æ–¹å¼ï¼Œåˆ’åˆ†è®­ç»ƒå’Œæµ‹è¯•æ•°æ®é›†</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">super</span>(MyDataset, self).__init__()<br><br>        <span class="hljs-keyword">if</span> mode == <span class="hljs-string">&#x27;train&#x27;</span>:<br>            self.data = [<br>                [<span class="hljs-string">&#x27;traindata1&#x27;</span>, <span class="hljs-string">&#x27;label1&#x27;</span>],<br>                [<span class="hljs-string">&#x27;traindata2&#x27;</span>, <span class="hljs-string">&#x27;label2&#x27;</span>],<br>                [<span class="hljs-string">&#x27;traindata3&#x27;</span>, <span class="hljs-string">&#x27;label3&#x27;</span>],<br>                [<span class="hljs-string">&#x27;traindata4&#x27;</span>, <span class="hljs-string">&#x27;label4&#x27;</span>],<br>            ]<br>        <span class="hljs-keyword">else</span>:<br>            self.data = [<br>                [<span class="hljs-string">&#x27;testdata1&#x27;</span>, <span class="hljs-string">&#x27;label1&#x27;</span>],<br>                [<span class="hljs-string">&#x27;testdata2&#x27;</span>, <span class="hljs-string">&#x27;label2&#x27;</span>],<br>                [<span class="hljs-string">&#x27;testdata3&#x27;</span>, <span class="hljs-string">&#x27;label3&#x27;</span>],<br>                [<span class="hljs-string">&#x27;testdata4&#x27;</span>, <span class="hljs-string">&#x27;label4&#x27;</span>],<br>            ]<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__getitem__</span>(<span class="hljs-params">self, index</span>):</span><br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ­¥éª¤ä¸‰ï¼šå®ç°__getitem__æ–¹æ³•ï¼Œå®šä¹‰æŒ‡å®šindexæ—¶å¦‚ä½•è·å–æ•°æ®ï¼Œå¹¶è¿”å›å•æ¡æ•°æ®ï¼ˆè®­ç»ƒæ•°æ®ï¼Œå¯¹åº”çš„æ ‡ç­¾ï¼‰</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        data = self.data[index][<span class="hljs-number">0</span>]<br>        label = self.data[index][<span class="hljs-number">1</span>]<br><br>        <span class="hljs-keyword">return</span> data, label<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__len__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        æ­¥éª¤å››ï¼šå®ç°__len__æ–¹æ³•ï¼Œè¿”å›æ•°æ®é›†æ€»æ•°ç›®</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.data)<br></code></pre></td></tr></table></figure><h6 id="è¿˜æœ‰å°±æ˜¯è®­ç»ƒè¿™å—"><a href="#è¿˜æœ‰å°±æ˜¯è®­ç»ƒè¿™å—" class="headerlink" title="è¿˜æœ‰å°±æ˜¯è®­ç»ƒè¿™å—"></a>è¿˜æœ‰å°±æ˜¯è®­ç»ƒè¿™å—</h6><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs clean">######################### torch ç‰ˆ  ############################<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br>model = SeqNet()<br>model.to(device)<br>optimizer = torch.optim.AdamW(model.parameters(), lr=<span class="hljs-number">1e-4</span> ,weight_decay=<span class="hljs-number">5e-4</span>)<br>scheduler = torch.optim.lr_scheduler.CosineAnnealingLR(optimizer, T_max=max_epoch)<br>criterion = nn.BCEWithLogitsLoss()<br><br>for i, (inputs, labels) <span class="hljs-keyword">in</span> (enumerate(trainloader)):<br>    inputs = inputs.to(device)<br>    labels = labels.float().to(device)<br><br>    out_linear = model(inputs).to(device)<br>    loss = criterion(out_linear, labels.unsqueeze(<span class="hljs-number">1</span>))<br><br>    optimizer.zero_grad()<br>    loss.backward()<br>    optimizer.step()<br></code></pre></td></tr></table></figure><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs clean">######################### paddle ç‰ˆ  ############################<br><span class="hljs-keyword">import</span> paddle<br><span class="hljs-keyword">import</span> paddle.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">import</span> paddle.optimizer <span class="hljs-keyword">as</span> optim<br><br>model = SeqNet()<br>model.to(device)<br>optimizer = optim.AdamW(learning_rate=<span class="hljs-number">1e-4</span>, parameters=model.parameters(),weight_decay=<span class="hljs-number">5e-4</span>)<br>### optimizer = optim.Adam(parameters=model.parameters(), learning_rate=<span class="hljs-number">1e-4</span>)<br>### paddle ç‰ˆCosineAnnealingDecayæ¥åçš„æ˜¯ learning_rateå‚æ•°<br>scheduler = optim.lr.CosineAnnealingDecay(<span class="hljs-number">1e-4</span>, T_max=max_epoch)<br>criterion = nn.BCEWithLogitsLoss()<br><br>for i, (inputs, labels) <span class="hljs-keyword">in</span> (enumerate(trainloader)):<br>    # inputs = inputs.to(device)<br>    inputs = inputs.cuda()<br>    # labels = labels.float().to(device)<br>    labels = labels.cuda()<br>    # labels = paddle.reshape(labels, (<span class="hljs-number">30</span>, <span class="hljs-number">1</span>))<br>    labels = paddle.cast(labels, dtype=<span class="hljs-string">&#x27;float32&#x27;</span>)  ## è½¬æ¢æ•°æ®ç±»å‹<br><br>    out_linear = model(inputs)<br>    out_linear = paddle.reshape(out_linear, (batch_size,))<br>    loss = criterion(out_linear, labels)<br>    # loss = criterion(out_linear, labels.unsqueeze(<span class="hljs-number">1</span>))<br><br>    # optimizer.zero_grad()<br>    loss.backward()<br>    optimizer.step()<br>    optimizer.clear_grad()<br></code></pre></td></tr></table></figure><p>å…¶ä½™å‰©ä¸‹å°±æ˜¯ä¸€äº›å°é—®é¢˜äº†ï¼Œç›´æ¥è¿è¡Œdebugæ”¹å°±å¥½äº†ã€‚<br>pytorch å®Œæ•´ç‰ˆåœ°å€ï¼š<a href="https://github.com/shubihu/coggle_learn/blob/main/baseline/pytorch.ipynb">https://github.com/shubihu/coggle_learn/blob/main/baseline/pytorch.ipynb</a><br>paddle å®Œæ•´ç‰ˆåœ°å€ï¼š<a href="https://github.com/shubihu/coggle_learn/blob/main/baseline/paddle.ipynb">https://github.com/shubihu/coggle_learn/blob/main/baseline/paddle.ipynb</a><br>aistudioä¸Šé¡¹ç›®çš„åœ°å€ä¸ºï¼š<a href="https://aistudio.baidu.com/aistudio/projectdetail/2724787?contributionType=1">https://aistudio.baidu.com/aistudio/projectdetail/2724787?contributionType=1</a></p>]]></content>
    
    
    <categories>
      
      <category>TroubleShoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>TroubleShoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mac-iTerm2</title>
    <link href="/2021/11/15/mac-iTerm2/"/>
    <url>/2021/11/15/mac-iTerm2/</url>
    
    <content type="html"><![CDATA[<h2 id="mac-air-m1-ç»ˆç«¯é…ç½®è®°å½•"><a href="#mac-air-m1-ç»ˆç«¯é…ç½®è®°å½•" class="headerlink" title="mac air m1 ç»ˆç«¯é…ç½®è®°å½•"></a>mac air m1 ç»ˆç«¯é…ç½®è®°å½•</h2><span id="more"></span><h3 id="å®‰è£…Homebrew"><a href="#å®‰è£…Homebrew" class="headerlink" title="å®‰è£…Homebrew"></a>å®‰è£…Homebrew</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/bin/</span>bash -c <span class="hljs-string">&quot;$(curl -fsSL https://cdn.jsdelivr.net/gh/ineo6/homebrew-install/install.sh)&quot;</span><br></code></pre></td></tr></table></figure><p>å°†ä»¥ä¸Šå‘½ä»¤ç²˜è´´è‡³ç»ˆç«¯ã€‚è„šæœ¬å†…ç½® ä¸­ç§‘å¤§é•œåƒï¼Œæ‰€ä»¥èƒ½è®©Homebrewå®‰è£…çš„æ›´å¿«ã€‚</p><h3 id="å®‰è£…-oh-my-zsh"><a href="#å®‰è£…-oh-my-zsh" class="headerlink" title="å®‰è£… oh-my-zsh"></a>å®‰è£… oh-my-zsh</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sh -c <span class="hljs-string">&quot;<span class="hljs-subst">$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)</span>&quot;</span><br></code></pre></td></tr></table></figure><h3 id="é…ç½®-oh-my-zsh"><a href="#é…ç½®-oh-my-zsh" class="headerlink" title="é…ç½® oh-my-zsh"></a>é…ç½® oh-my-zsh</h3><p>å‚è€ƒ <a href="https://www.dazhuanlan.com/lyuuawa0508/topics/1599354">https://www.dazhuanlan.com/lyuuawa0508/topics/1599354</a><br>æ³¨ï¼šå…¶ä¸­æœ‰äº›å‘½ä»¤å¯èƒ½å› ä¸ºç‰ˆæœ¬é—®é¢˜ä¸ä¸€è‡´ï¼Œä¸»è¦æ˜¯caskç›¸å…³ï¼ŒæŒ‰ç…§æç¤ºä¿®æ”¹å³å¯<br>æ¯”å¦‚ å®‰è£… iTerm2 çš„å‘½ä»¤æ˜¯ç°åœ¨è¿™æ ·</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">brew</span> tap homebrew/cask<br><span class="hljs-attribute">brew</span> install iterm<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><h3 id="brew-å®‰è£…-nvm"><a href="#brew-å®‰è£…-nvm" class="headerlink" title="brew å®‰è£… nvm"></a>brew å®‰è£… nvm</h3><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs clean">brew install nvm<br>mkdir ~/.nvm<br>vi ~/.zshrc<br>#################### å°†ä¸‹é¢å†…å®¹æ·»åŠ åˆ° ~/.zshrc ä¸­ #############################<br><span class="hljs-keyword">export</span> NVM_DIR=<span class="hljs-string">&quot;$HOME/.nvm&quot;</span><br>[ -s <span class="hljs-string">&quot;/opt/homebrew/opt/nvm/nvm.sh&quot;</span> ] &amp;&amp; . <span class="hljs-string">&quot;/opt/homebrew/opt/nvm/nvm.sh&quot;</span> # This loads nvm<br>[ -s <span class="hljs-string">&quot;/opt/homebrew/opt/nvm/etc/bash_completion.d/nvm&quot;</span> ] &amp;&amp; . <span class="hljs-string">&quot;/opt/homebrew/opt/nvm/etc/bash_completion.d/nvm&quot;</span> # This loads nvm bash_completion<br>###############################################################################<br>source ~/.zshrc<br></code></pre></td></tr></table></figure><h3 id="github-åŠ é€Ÿ"><a href="#github-åŠ é€Ÿ" class="headerlink" title="github åŠ é€Ÿ"></a>github åŠ é€Ÿ</h3><p>å‚è€ƒ <a href="https://brew.idayer.com/guide/github">https://brew.idayer.com/guide/github</a></p>]]></content>
    
    
    <categories>
      
      <category>Mac</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç©</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç§‘å­¦ä¸Šç½‘</title>
    <link href="/2021/11/07/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"/>
    <url>/2021/11/07/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><h3 id="Markä¸€ä¸‹ä»¥é˜²ä¸æ—¶ä¹‹éœ€-https-lncn-org"><a href="#Markä¸€ä¸‹ä»¥é˜²ä¸æ—¶ä¹‹éœ€-https-lncn-org" class="headerlink" title="Markä¸€ä¸‹ä»¥é˜²ä¸æ—¶ä¹‹éœ€ https://lncn.org/"></a>Markä¸€ä¸‹ä»¥é˜²ä¸æ—¶ä¹‹éœ€ <a href="https://lncn.org/">https://lncn.org/</a></h3><p>è¿æ¥è¯¥ç½‘ç«™æ–¹æ³•å¦‚ä¸‹å›¾æ‰€ç¤º<br><img src="/img/article/ssr.jpg"></p><h3 id="Window-å®¢æˆ·ç«¯åœ°å€"><a href="#Window-å®¢æˆ·ç«¯åœ°å€" class="headerlink" title="Window å®¢æˆ·ç«¯åœ°å€"></a>Window å®¢æˆ·ç«¯åœ°å€</h3><p><a href="https://github.com/shadowsocksrr/shadowsocksr-csharp/releases">https://github.com/shadowsocksrr/shadowsocksr-csharp/releases</a></p><h3 id="Mac-OS-å®¢æˆ·ç«¯åœ°å€"><a href="#Mac-OS-å®¢æˆ·ç«¯åœ°å€" class="headerlink" title="Mac OS å®¢æˆ·ç«¯åœ°å€"></a>Mac OS å®¢æˆ·ç«¯åœ°å€</h3><p><a href="https://github.com/wzdnzd/ShadowsocksX-NG-R/releases">https://github.com/wzdnzd/ShadowsocksX-NG-R/releases</a></p>]]></content>
    
    
    <categories>
      
      <category>TroubleShoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç§‘å­¦ä¸Šç½‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ ¸é…¸æ£€æµ‹æœºæ„åœ°å›¾å¾®ä¿¡å°ç¨‹åºå¼€å‘</title>
    <link href="/2021/10/20/%E6%A0%B8%E9%85%B8%E6%A3%80%E6%B5%8B%E6%9C%BA%E6%9E%84%E5%9C%B0%E5%9B%BE%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/"/>
    <url>/2021/10/20/%E6%A0%B8%E9%85%B8%E6%A3%80%E6%B5%8B%E6%9C%BA%E6%9E%84%E5%9C%B0%E5%9B%BE%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/</url>
    
    <content type="html"><![CDATA[<h2 id="å°ç¨‹åºå¼€å‘å­¦ä¹ "><a href="#å°ç¨‹åºå¼€å‘å­¦ä¹ " class="headerlink" title="å°ç¨‹åºå¼€å‘å­¦ä¹ "></a>å°ç¨‹åºå¼€å‘å­¦ä¹ </h2><span id="more"></span><h5 id="å¼€å‘ï¼ˆç©ï¼‰èƒŒæ™¯"><a href="#å¼€å‘ï¼ˆç©ï¼‰èƒŒæ™¯" class="headerlink" title="å¼€å‘ï¼ˆç©ï¼‰èƒŒæ™¯"></a>å¼€å‘ï¼ˆç©ï¼‰èƒŒæ™¯</h5><p>æœ€è¿‘éœ€è¦åšæ ¸é…¸æ£€æµ‹ï¼Œäºæ˜¯æƒ³æ‰¾ä¸‹é™„ä»¶çš„æœºæ„ï¼Œä½†æ˜¯æ‰¾äº†å¥½å¤šéƒ½æ˜¯åˆ—è¡¨å½¢å¼çš„ï¼ˆå¿ƒé‡Œå˜€å’•äº†å¥æ€ä¹ˆè¿é™„è¿‘éƒ½çœ‹ä¸äº†ï¼Œå°±æƒ³ç€è‡ªå·±åšä¸‹ï¼‰ï¼Œä¸è¿‡æœ€åè¿˜æ˜¯æ‰¾åˆ°äº†å¸¦é™„è¿‘åŠŸèƒ½çš„å°ç¨‹åºï¼Œç«Ÿç„¶è¿˜æ˜¯å›½åŠ¡é™¢å®¢æˆ·ç«¯ã€‚æœç„¶è¿˜æ˜¯å›½å®¶æƒ³çš„å‘¨åˆ°ã€‚è™½ç„¶æ‰¾åˆ°äº†è¿™æ ·çš„å°ç¨‹åºè‡ªå·±å·²ç»æ²¡å¿…è¦å†é€ è½®å­äº†ï¼Œä½†æ˜¯æœ¬ç€å­¦ä¹ ï¼ˆç©ï¼‰çš„å¿ƒæ€è¿˜æ˜¯æƒ³ç€å¦‚ä½•é‡ç°ä¸€ä¸‹ã€‚</p><h5 id="è¿™é‡Œä¹Ÿæ¨å¹¿ä¸‹å›½åŠ¡é™¢å®¢æˆ·ç«¯å°ç¨‹åº"><a href="#è¿™é‡Œä¹Ÿæ¨å¹¿ä¸‹å›½åŠ¡é™¢å®¢æˆ·ç«¯å°ç¨‹åº" class="headerlink" title="è¿™é‡Œä¹Ÿæ¨å¹¿ä¸‹å›½åŠ¡é™¢å®¢æˆ·ç«¯å°ç¨‹åº"></a>è¿™é‡Œä¹Ÿæ¨å¹¿ä¸‹å›½åŠ¡é™¢å®¢æˆ·ç«¯å°ç¨‹åº</h5><p><img src="/img/article/wechat/%E5%9B%BD%E5%8A%A1%E9%99%A2.jpg"></p><h5 id="æœ€åä¹Ÿç®—åŸºæœ¬å®ç°äº†è¿™æ ·çš„åŠŸèƒ½ï¼Œè´´ä¸¤å¼ å›¾åšä¸ªå¯¹æ¯”å§ã€‚"><a href="#æœ€åä¹Ÿç®—åŸºæœ¬å®ç°äº†è¿™æ ·çš„åŠŸèƒ½ï¼Œè´´ä¸¤å¼ å›¾åšä¸ªå¯¹æ¯”å§ã€‚" class="headerlink" title="æœ€åä¹Ÿç®—åŸºæœ¬å®ç°äº†è¿™æ ·çš„åŠŸèƒ½ï¼Œè´´ä¸¤å¼ å›¾åšä¸ªå¯¹æ¯”å§ã€‚"></a>æœ€åä¹Ÿç®—åŸºæœ¬å®ç°äº†è¿™æ ·çš„åŠŸèƒ½ï¼Œè´´ä¸¤å¼ å›¾åšä¸ªå¯¹æ¯”å§ã€‚</h5><p>å·¦è¾¹çš„æ˜¯å›½åŠ¡é™¢å®¢æˆ·ç«¯ï¼Œå³è¾¹æ˜¯è‡ªå·±åšçš„<br><img src="/img/article/wechat/%E6%A0%B8%E9%85%B8%E6%A3%80%E6%B5%8B.jpg"></p><h5 id="æœ€åå†è¯´ä¸‹å¼€å‘è¿‡ç¨‹è¸©è¿‡çš„å‘å§"><a href="#æœ€åå†è¯´ä¸‹å¼€å‘è¿‡ç¨‹è¸©è¿‡çš„å‘å§" class="headerlink" title="æœ€åå†è¯´ä¸‹å¼€å‘è¿‡ç¨‹è¸©è¿‡çš„å‘å§"></a>æœ€åå†è¯´ä¸‹å¼€å‘è¿‡ç¨‹è¸©è¿‡çš„å‘å§</h5><p>æœ€ä¸»è¦çš„å‘å°±æ˜¯æ ‡è®°åœ¨åœ°å›¾ä¸Šçš„markerï¼ˆæ ¸é…¸æœºæ„ï¼‰ä¸æ˜¾ç¤ºçš„é—®é¢˜ï¼Œé¦–å…ˆæ˜¯ç»çº¬åº¦ï¼Œç»åº¦ï¼ˆlongitudeï¼‰ï¼Œç»´åº¦ï¼ˆlatitudeï¼‰ï¼Œæœ€å¼€å§‹æ ‡è®°ç‚¹ä¸€ç›´æ²¡æ˜¾ç¤ºå°±æ˜¯å› ä¸ºè‡ªå·±æŠŠç»çº¬åº¦å†™åäº†ï¼ˆå…³é”®æ˜¯åå°éƒ½ä¸æŠ¥é”™ï¼‰å¯¼è‡´ä¸€ç›´ä¸æ˜¾ç¤ºã€‚å…¶æ¬¡æ˜¯ç»çº¬åº¦çš„èµ‹å€¼éœ€æ˜¯æ•°å­—ç±»å‹ï¼Œå­—ç¬¦ä¸²ç±»å‹ä¹Ÿæ˜¯ä¸è¡Œçš„ã€‚æœ€åå°±æ˜¯æœåŠ¡å™¨åŸŸåçš„é…ç½®é—®é¢˜ï¼Œæœ‰äº›åŸŸåæ¯”å¦‚ <a href="https://apis.map.qq.com/">https://apis.map.qq.com</a> ä»¥åŠ wx.request çš„åœ°å€éƒ½éœ€è¦è¿›è¡Œé…ç½®ã€‚å½“ç„¶äº†è¿˜æœ‰å°±æ˜¯æ–‡ä»¶è·¯å¾„ä»€ä¹ˆçš„å°½é‡ä¸è¦ç”¨ä¸­æ–‡å‘½åï¼Œåæ­£å¥‡å¥‡æ€ªæ€ªçš„bugå°±æ˜¯è¿™æ ·äº§ç”Ÿçš„ã€‚<br>ä½œä¸ºä¸€ä¸ªå‰ç«¯å°ç™½åšè¿™ä¸ªèŠ±äº†ä¸€ä¸ªå¤šæ˜ŸæœŸæ—¶é—´ï¼Œæ‰å‹‰å¼ºåšå‡ºè¿™æ ·çš„åŠŸèƒ½ï¼ŒçœŸæ˜¯ä»¤äººå¤´ç§ƒå•Šã€‚</p><h5 id="å®Œæ•´ä»£ç åœ°å€-https-github-com-shubihu-Korok-Mask"><a href="#å®Œæ•´ä»£ç åœ°å€-https-github-com-shubihu-Korok-Mask" class="headerlink" title="å®Œæ•´ä»£ç åœ°å€ https://github.com/shubihu/Korok-Mask"></a>å®Œæ•´ä»£ç åœ°å€ <a href="https://github.com/shubihu/Korok-Mask">https://github.com/shubihu/Korok-Mask</a></h5><p>æ‰«æä¸‹æ–¹äºŒç»´ç ç›´è¾¾ï¼Œç¬¬ä¸€æ¬¡åŠ è½½æœ‰ç‚¹æ…¢ï¼Œï¼Œï¼Œï¼Œæ²¡åŠæ³•ï¼Œç”¨çš„å…è´¹çš„æœåŠ¡å™¨ï¼Œæ…¢åº”è¯¥æ˜¯æ­£å¸¸çš„ã€‚<br><img src="/img/article/wechat/%E5%85%8B%E6%B4%9B%E6%A0%BC.jpg"><br>å‚è€ƒ</p><ul><li><a href="https://www.ruanyifeng.com/blog/2020/10/wechat-miniprogram-tutorial-part-one.html">https://www.ruanyifeng.com/blog/2020/10/wechat-miniprogram-tutorial-part-one.html</a></li><li><a href="https://github.com/zwz888mm/zhang">https://github.com/zwz888mm/zhang</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>å¾®ä¿¡å°ç¨‹åº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ ¸é…¸æ£€æµ‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MongoDBåŸºç¡€</title>
    <link href="/2021/10/18/MongoDB%E5%9F%BA%E7%A1%80/"/>
    <url>/2021/10/18/MongoDB%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h2 id="MongoDB-åŸºç¡€å‘½ä»¤"><a href="#MongoDB-åŸºç¡€å‘½ä»¤" class="headerlink" title="MongoDB åŸºç¡€å‘½ä»¤"></a>MongoDB åŸºç¡€å‘½ä»¤</h2><span id="more"></span><h5 id="å¯åŠ¨æœ¬åœ°æœåŠ¡ç«¯"><a href="#å¯åŠ¨æœ¬åœ°æœåŠ¡ç«¯" class="headerlink" title="å¯åŠ¨æœ¬åœ°æœåŠ¡ç«¯"></a>å¯åŠ¨æœ¬åœ°æœåŠ¡ç«¯</h5><p>è¿›å…¥mongodb binç›®å½•ä¸‹æ‰“å¼€å‘½ä»¤è¡Œæ‰§è¡Œ mongod å¯åŠ¨æœåŠ¡ç«¯(å­˜å‚¨å¼•æ“å‚æ•° â€“storageEngine=mmapv1)</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">.<span class="hljs-symbol">\m</span>ongod.exe --storageEngine=mmapv1 --dbpath E:<span class="hljs-symbol">\D</span>esktop<span class="hljs-symbol">\J</span>ava<span class="hljs-symbol">\J</span>avaSoftware<span class="hljs-symbol">\m</span>ongoDB<span class="hljs-symbol">\d</span>ata\<br></code></pre></td></tr></table></figure><h5 id="å¯åŠ¨æœ¬åœ°å®¢æˆ·ç«¯"><a href="#å¯åŠ¨æœ¬åœ°å®¢æˆ·ç«¯" class="headerlink" title="å¯åŠ¨æœ¬åœ°å®¢æˆ·ç«¯"></a>å¯åŠ¨æœ¬åœ°å®¢æˆ·ç«¯</h5><p>è¿›å…¥mongodb binç›®å½•ä¸‹æ‰“å¼€å‘½ä»¤è¡Œæ‰§è¡Œ mongo å¯åŠ¨å®¢æˆ·ç«¯</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livescript">.<span class="hljs-string">\mongo.exe</span><br></code></pre></td></tr></table></figure><h5 id="æŸ¥çœ‹æ•°æ®åº“"><a href="#æŸ¥çœ‹æ•°æ®åº“" class="headerlink" title="æŸ¥çœ‹æ•°æ®åº“"></a>æŸ¥çœ‹æ•°æ®åº“</h5><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">show</span> dbs<br></code></pre></td></tr></table></figure><h5 id="åˆ‡æ¢æ•°æ®åº“ï¼ˆæ— éœ€æ–°å»ºï¼Œç›´æ¥å¼•ç”¨ï¼‰"><a href="#åˆ‡æ¢æ•°æ®åº“ï¼ˆæ— éœ€æ–°å»ºï¼Œç›´æ¥å¼•ç”¨ï¼‰" class="headerlink" title="åˆ‡æ¢æ•°æ®åº“ï¼ˆæ— éœ€æ–°å»ºï¼Œç›´æ¥å¼•ç”¨ï¼‰"></a>åˆ‡æ¢æ•°æ®åº“ï¼ˆæ— éœ€æ–°å»ºï¼Œç›´æ¥å¼•ç”¨ï¼‰</h5><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">use</span> demo<br></code></pre></td></tr></table></figure><h5 id="æ’å…¥æ•°æ®-ä»¥åˆ›å»ºä¸€ä¸ªé›‡å‘˜ä¿¡æ¯è¡¨ä¸ºä¾‹"><a href="#æ’å…¥æ•°æ®-ä»¥åˆ›å»ºä¸€ä¸ªé›‡å‘˜ä¿¡æ¯è¡¨ä¸ºä¾‹" class="headerlink" title="æ’å…¥æ•°æ®(ä»¥åˆ›å»ºä¸€ä¸ªé›‡å‘˜ä¿¡æ¯è¡¨ä¸ºä¾‹)"></a>æ’å…¥æ•°æ®(ä»¥åˆ›å»ºä¸€ä¸ªé›‡å‘˜ä¿¡æ¯è¡¨ä¸ºä¾‹)</h5><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">db<span class="hljs-selector-class">.Employee</span><span class="hljs-selector-class">.save</span>(&#123;<span class="hljs-selector-tag">code</span>:<span class="hljs-string">&#x27;E01&#x27;</span>, name:<span class="hljs-string">&#x27;Jacky&#x27;</span>&#125;)<br></code></pre></td></tr></table></figure><h5 id="æŸ¥çœ‹æ•°æ®"><a href="#æŸ¥çœ‹æ•°æ®" class="headerlink" title="æŸ¥çœ‹æ•°æ®"></a>æŸ¥çœ‹æ•°æ®</h5><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">show</span> collections<br></code></pre></td></tr></table></figure><h5 id="æŸ¥æ‰¾æ•°æ®"><a href="#æŸ¥æ‰¾æ•°æ®" class="headerlink" title="æŸ¥æ‰¾æ•°æ®"></a>æŸ¥æ‰¾æ•°æ®</h5><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">db.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Employee</span>.</span></span>find<span class="hljs-literal">()</span><br></code></pre></td></tr></table></figure><h5 id="æ ¼å¼åŒ–è¾“å‡ºæŸ¥æ‰¾æ•°æ®"><a href="#æ ¼å¼åŒ–è¾“å‡ºæŸ¥æ‰¾æ•°æ®" class="headerlink" title="æ ¼å¼åŒ–è¾“å‡ºæŸ¥æ‰¾æ•°æ®"></a>æ ¼å¼åŒ–è¾“å‡ºæŸ¥æ‰¾æ•°æ®</h5><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">db<span class="hljs-selector-class">.Employee</span><span class="hljs-selector-class">.find</span>()<span class="hljs-selector-class">.pretty</span>()<br></code></pre></td></tr></table></figure><h5 id="æ·»åŠ ä¸åŒæ ¼å¼æ•°æ®"><a href="#æ·»åŠ ä¸åŒæ ¼å¼æ•°æ®" class="headerlink" title="æ·»åŠ ä¸åŒæ ¼å¼æ•°æ®"></a>æ·»åŠ ä¸åŒæ ¼å¼æ•°æ®</h5><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">db<span class="hljs-selector-class">.Employee</span><span class="hljs-selector-class">.save</span>(&#123;<span class="hljs-selector-tag">code</span>:<span class="hljs-string">&#x27;E02&#x27;</span>, name:<span class="hljs-string">&#x27;Jim&#x27;</span>, email:<span class="hljs-string">&#x27;test@email.com&#x27;</span>&#125;)<br></code></pre></td></tr></table></figure><p>å¯åŠ¨mongodbæ—¶ï¼Œæç¤ºUnclean shutdown detected mongodbï¼Œè§£å†³æ–¹æ³•:</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">.<span class="hljs-symbol">\m</span>ongod.exe --repair --dbpath E:<span class="hljs-symbol">\D</span>esktop<span class="hljs-symbol">\J</span>ava<span class="hljs-symbol">\J</span>avaSoftware<span class="hljs-symbol">\m</span>ongoDB<span class="hljs-symbol">\d</span>ata\<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æ•°æ®åº“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MongoDB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iPhone å¿«æ·æŒ‡ä»¤è‡ªåŠ¨æ‰“å¼€ä½ç”µé‡æ¨¡å¼</title>
    <link href="/2021/09/27/iPhone%E5%BF%AB%E6%8D%B7%E6%8C%87%E4%BB%A4%E8%87%AA%E5%8A%A8%E6%89%93%E5%BC%80%E4%BD%8E%E7%94%B5%E9%87%8F%E6%A8%A1%E5%BC%8F/"/>
    <url>/2021/09/27/iPhone%E5%BF%AB%E6%8D%B7%E6%8C%87%E4%BB%A4%E8%87%AA%E5%8A%A8%E6%89%93%E5%BC%80%E4%BD%8E%E7%94%B5%E9%87%8F%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><p>iPhoneçš„ç”µé‡ä¸€ç›´æ˜¯ä¸ªè½¯è‚‹ï¼Œä½†æ˜¯å…¶ä½ç”µé‡æ¨¡å¼ç»­èˆªè¿˜çœŸæ˜¯å¾ˆå¯è§‚çš„ã€‚å½“ç„¶ä¸€èˆ¬æƒ³èµ·æ¥ç”¨ä½ç”µé‡æ¨¡å¼çš„æ—¶å€™éƒ½æ˜¯ç”µé‡å‰©ä½™ä¸å¤šäº†çš„æ—¶å€™ï¼Œå°¤å…¶æ˜¯åœ¨å¤–é¢ç©è€çš„æ—¶å€™ï¼Œéƒ½ä¸èƒ½å¥½å¥½åœ°æ‰£æ‰‹æœºäº†ã€‚</p><h5 id="å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š"><a href="#å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š" class="headerlink" title="å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š"></a>å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</h5><p>æ‰“å¼€å¿«æ·æŒ‡ä»¤ï¼Œæ·»åŠ è‡ªåŠ¨åŒ–ï¼Œé€‰æ‹© ç”µæ± ç”µé‡ ï¼Œç„¶åé€‰æ‹© ä½äº50%ï¼ˆè¿™é‡Œå¯ä»¥ä¿®æ”¹ï¼Œåæ­£æˆ‘ä¿®æ”¹æˆäº†100%ï¼Œè®©æ‰‹æœºåœ¨99%ä»¥ä¸‹éƒ½å¤„äºä½ç”µé‡æ¨¡å¼ä»¥æ­¤æ¥å»¶é•¿ç»­èˆªï¼‰ï¼Œç„¶å ä¸‹ä¸€æ­¥ ï¼Œç‚¹å‡» æ·»åŠ æ“ä½œï¼Œåœ¨æœç´ æ¡†æœç´¢ä½ç”µé‡ï¼Œé€‰æ‹©è®¾å®šä½ç”µé‡æ¨¡å¼è„šæœ¬ ï¼Œç„¶åå†ä¸‹ä¸€æ­¥ï¼Œå…³æ‰è¿è¡Œå‰è¯¢é—®å°±å®Œæˆäº†ã€‚</p><h5 id="1"><a href="#1" class="headerlink" title="1"></a>1</h5><p><img src="/img/article/iphone1/1.jpg"></p><h5 id="2"><a href="#2" class="headerlink" title="2"></a>2</h5><p><img src="/img/article/iphone1/2.jpg"></p><h5 id="3"><a href="#3" class="headerlink" title="3"></a>3</h5><p><img src="/img/article/iphone1/3.jpg"></p>]]></content>
    
    
    <categories>
      
      <category>iPhone</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç©</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pyecharts ä¸åŒé¢œè‰²ç»˜åˆ¶æ­£è´ŸæŸ±çŠ¶å›¾</title>
    <link href="/2021/09/27/Pyecharts%E4%B8%8D%E5%90%8C%E9%A2%9C%E8%89%B2%E7%BB%98%E5%88%B6%E6%AD%A3%E8%B4%9F%E6%9F%B1%E7%8A%B6%E5%9B%BE/"/>
    <url>/2021/09/27/Pyecharts%E4%B8%8D%E5%90%8C%E9%A2%9C%E8%89%B2%E7%BB%98%E5%88%B6%E6%AD%A3%E8%B4%9F%E6%9F%B1%E7%8A%B6%E5%9B%BE/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs routeros">import akshare as ak<br>import pyecharts.options as opts<br><span class="hljs-keyword">from</span> pyecharts.charts import Bar, Line<br><span class="hljs-keyword">from</span> pyecharts.commons.utils import JsCode<br><br>fund_em_info_df = ak.fund_em_open_fund_info(<span class="hljs-attribute">fund</span>=<span class="hljs-string">&quot;006008&quot;</span>, <span class="hljs-attribute">indicator</span>=<span class="hljs-string">&quot;å•ä½å‡€å€¼èµ°åŠ¿&quot;</span>)<br><br>fund_name = <span class="hljs-string">&#x27;è¯ºå®‰ç§¯æé…ç½®æ··åˆC&#x27;</span><br>x_data = fund_em_info_df[<span class="hljs-string">&#x27;å‡€å€¼æ—¥æœŸ&#x27;</span>].tolist()<br>y_data = fund_em_info_df[<span class="hljs-string">&#x27;å•ä½å‡€å€¼&#x27;</span>].tolist()<br>z_data = fund_em_info_df[<span class="hljs-string">&#x27;æ—¥å¢é•¿ç‡&#x27;</span>].tolist()<br><br>background_color_js = (<br>    <span class="hljs-string">&quot;new echarts.graphic.LinearGradient(0, 0, 0, 1, &quot;</span><br>    <span class="hljs-string">&quot;[&#123;offset: 0, color: &#x27;#c86589&#x27;&#125;, &#123;offset: 1, color: &#x27;#06a7ff&#x27;&#125;], false)&quot;</span><br>)<br>area_color_js = (<br>    <span class="hljs-string">&quot;new echarts.graphic.LinearGradient(0, 0, 0, 1, &quot;</span><br>    <span class="hljs-string">&quot;[&#123;offset: 0, color: &#x27;#eb64fb&#x27;&#125;, &#123;offset: 1, color: &#x27;#3fbbff0d&#x27;&#125;], false)&quot;</span><br>)<br><br><br>bar = (<br>    Bar(<span class="hljs-attribute">init_opts</span>=opts.InitOpts(bg_color=JsCode(background_color_js), <span class="hljs-attribute">width</span>=<span class="hljs-string">&#x27;700px&#x27;</span>, <span class="hljs-attribute">height</span>=<span class="hljs-string">&#x27;450px&#x27;</span>))     ## width, heightä¿®æ”¹ç”»å¸ƒå¤§å°<br>    .add_xaxis(<span class="hljs-attribute">xaxis_data</span>=x_data)<br>    .add_yaxis(<br>        <span class="hljs-attribute">series_name</span>=<span class="hljs-string">&quot;&quot;</span>,<br>        <span class="hljs-attribute">y_axis</span>=z_data,<br>        <span class="hljs-attribute">label_opts</span>=opts.LabelOpts(is_show=False),<br>        <span class="hljs-attribute">itemstyle_opts</span>=opts.ItemStyleOpts(<br>            ### è°ƒç”¨jsä»£ç ç»˜åˆ¶ä¸åŒé¢œè‰²<br>            <span class="hljs-attribute">color</span>=JsCode(<br>                <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">                    function(params) &#123;</span><br><span class="hljs-string">                        var colorList;</span><br><span class="hljs-string">                        if (params.data &gt;= 0) &#123;</span><br><span class="hljs-string">                          colorList = &#x27;#FF4500&#x27;;</span><br><span class="hljs-string">                        &#125; else &#123;</span><br><span class="hljs-string">                          colorList = &#x27;#14b143&#x27;;</span><br><span class="hljs-string">                        &#125;</span><br><span class="hljs-string">                        return colorList;</span><br><span class="hljs-string">                    &#125;</span><br><span class="hljs-string">                    &quot;</span><span class="hljs-string">&quot;&quot;</span><br>                )<br>            )<br>        )<br>    .set_global_opts(<br>        <span class="hljs-attribute">title_opts</span>=opts.TitleOpts(<br>            <span class="hljs-attribute">title</span>=fund_name,<br>            <span class="hljs-attribute">pos_bottom</span>=<span class="hljs-string">&quot;90%&quot;</span>,<br>            <span class="hljs-attribute">pos_left</span>=<span class="hljs-string">&quot;center&quot;</span>,<br>            <span class="hljs-attribute">title_textstyle_opts</span>=opts.TextStyleOpts(color=&quot;#fff&quot;, <span class="hljs-attribute">font_size</span>=16),<br>        ),<br>        <span class="hljs-attribute">xaxis_opts</span>=opts.AxisOpts(<br>            <span class="hljs-attribute">type_</span>=<span class="hljs-string">&quot;category&quot;</span>,<br>            <span class="hljs-attribute">boundary_gap</span>=<span class="hljs-literal">False</span>,<br>            <span class="hljs-attribute">axislabel_opts</span>=opts.LabelOpts(margin=30, <span class="hljs-attribute">color</span>=<span class="hljs-string">&quot;#ffffff63&quot;</span>),<br>            <span class="hljs-attribute">axisline_opts</span>=opts.AxisLineOpts(is_show=False),<br>            <span class="hljs-attribute">axistick_opts</span>=opts.AxisTickOpts(<br>                <span class="hljs-attribute">is_show</span>=<span class="hljs-literal">True</span>,<br>                <span class="hljs-attribute">length</span>=25,<br>                <span class="hljs-attribute">linestyle_opts</span>=opts.LineStyleOpts(color=&quot;#ffffff1f&quot;),<br>            ),<br>            <span class="hljs-attribute">splitline_opts</span>=opts.SplitLineOpts(<br>                <span class="hljs-attribute">is_show</span>=<span class="hljs-literal">True</span>, <span class="hljs-attribute">linestyle_opts</span>=opts.LineStyleOpts(color=&quot;#ffffff1f&quot;)<br>            ),<br>        ),<br>        <span class="hljs-attribute">yaxis_opts</span>=opts.AxisOpts(<br>            <span class="hljs-attribute">type_</span>=<span class="hljs-string">&quot;value&quot;</span>,<br>            <span class="hljs-attribute">position</span>=<span class="hljs-string">&quot;left&quot;</span>,<br>            <span class="hljs-attribute">axislabel_opts</span>=opts.LabelOpts(margin=20, <span class="hljs-attribute">color</span>=<span class="hljs-string">&quot;#ffffff63&quot;</span>),<br>            <span class="hljs-attribute">axisline_opts</span>=opts.AxisLineOpts(<br>                <span class="hljs-attribute">linestyle_opts</span>=opts.LineStyleOpts(width=2, <span class="hljs-attribute">color</span>=<span class="hljs-string">&quot;#fff&quot;</span>)<br>            ),<br>            <span class="hljs-attribute">axistick_opts</span>=opts.AxisTickOpts(<br>                <span class="hljs-attribute">is_show</span>=<span class="hljs-literal">True</span>,<br>                <span class="hljs-attribute">length</span>=15,<br>                <span class="hljs-attribute">linestyle_opts</span>=opts.LineStyleOpts(color=&quot;#ffffff1f&quot;),<br>            ),<br>            <span class="hljs-attribute">splitline_opts</span>=opts.SplitLineOpts(<br>                <span class="hljs-attribute">is_show</span>=<span class="hljs-literal">True</span>, <span class="hljs-attribute">linestyle_opts</span>=opts.LineStyleOpts(color=&quot;#ffffff1f&quot;)<br>            ),<br>        ),<br><span class="hljs-comment">#         legend_opts=opts.LegendOpts(is_show=True),</span><br>        datazoom_opts=[opts.DataZoomOpts(), opts.DataZoomOpts(<span class="hljs-attribute">type_</span>=<span class="hljs-string">&quot;inside&quot;</span>)]    ## æ—¶é—´è½´æ˜¾ç¤ºå¹¶å¯åŒé€šè¿‡é¼ æ ‡æ»‘åŠ¨<br>    )<br>)<br><br><br>line = (<br>    Line(<span class="hljs-attribute">init_opts</span>=opts.InitOpts(bg_color=JsCode(background_color_js)))<br>    .add_xaxis(<span class="hljs-attribute">xaxis_data</span>=x_data)<br>    .add_yaxis(<br>        <span class="hljs-attribute">series_name</span>=<span class="hljs-string">&quot;&quot;</span>,<br>        y_axis=[round(i * 10, 2) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> y_data],<br>        <span class="hljs-attribute">is_smooth</span>=<span class="hljs-literal">True</span>,<br>        <span class="hljs-attribute">is_symbol_show</span>=<span class="hljs-literal">True</span>,<br>        <span class="hljs-attribute">symbol</span>=<span class="hljs-string">&quot;circle&quot;</span>,<br>        <span class="hljs-attribute">symbol_size</span>=6,<br>        <span class="hljs-attribute">linestyle_opts</span>=opts.LineStyleOpts(color=&quot;#fff&quot;),<br>        <span class="hljs-attribute">label_opts</span>=opts.LabelOpts(is_show=True, <span class="hljs-attribute">position</span>=<span class="hljs-string">&quot;top&quot;</span>, <span class="hljs-attribute">color</span>=<span class="hljs-string">&quot;white&quot;</span>),<br>        <span class="hljs-attribute">itemstyle_opts</span>=opts.ItemStyleOpts(<br>            <span class="hljs-attribute">color</span>=<span class="hljs-string">&quot;red&quot;</span>, <span class="hljs-attribute">border_color</span>=<span class="hljs-string">&quot;#fff&quot;</span>, <span class="hljs-attribute">border_width</span>=3<br>        ),<br>        <span class="hljs-attribute">tooltip_opts</span>=opts.TooltipOpts(is_show=False),<br>        <span class="hljs-attribute">areastyle_opts</span>=opts.AreaStyleOpts(color=JsCode(area_color_js), <span class="hljs-attribute">opacity</span>=1),<br>    )<br>)<br><br>bar.overlap(line)        ## æ··åˆæŸ±çŠ¶å›¾å’Œçº¿å›¾<br>bar.render_notebook()<br><br></code></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹</p><iframe src="/img/bar_line.html" width="100%" height="500" name="topFrame" scrolling="yes"  noresize="noresize" frameborder="0" id="topFrame"></iframe><p>å‚è€ƒ</p><ul><li><a href="https://gallery.pyecharts.org/#/Candlestick/professional_kline_chart">https://gallery.pyecharts.org/#/Candlestick/professional_kline_chart</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pyecharts</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pytorch å­¦ä¹ å…¥é—¨</title>
    <link href="/2021/09/16/Pytorch-learning/"/>
    <url>/2021/09/16/Pytorch-learning/</url>
    
    <content type="html"><![CDATA[<h2 id="Pytorch-Learning-Note"><a href="#Pytorch-Learning-Note" class="headerlink" title="Pytorch Learning Note"></a>Pytorch Learning Note</h2><span id="more"></span><h5 id="torch-nn"><a href="#torch-nn" class="headerlink" title="torch.nn"></a>torch.nn</h5><p>Moduleï¼šåˆ›å»ºä¸€ä¸ªè¡Œä¸ºç±»ä¼¼äºå‡½æ•°çš„å¯è°ƒç”¨å¯¹è±¡ï¼Œä½†ä¹Ÿå¯ä»¥åŒ…å«çŠ¶æ€ï¼ˆä¾‹å¦‚ç¥ç»ç½‘ç»œå±‚æƒé‡ï¼‰ã€‚ å®ƒçŸ¥é“å…¶ä¸­åŒ…å«çš„ Parameter ï¼Œå¹¶ä¸”å¯ä»¥å°†å…¶æ‰€æœ‰å¡åº¦å½’é›¶ï¼Œéå†å®ƒä»¬ä»¥è¿›è¡Œæƒé‡æ›´æ–°ç­‰ã€‚<br>Parameterï¼šå¼ é‡çš„åŒ…è£…å™¨ï¼Œç”¨äºå‘ŠçŸ¥ Module å…·æœ‰åœ¨åå‘ä¼ æ’­æœŸé—´éœ€è¦æ›´æ–°çš„æƒé‡ã€‚ ä»…æ›´æ–°å…·æœ‰require_gradå±æ€§é›†çš„å¼ é‡<br>functionalï¼šä¸€ä¸ªæ¨¡å—ï¼ˆé€šå¸¸æŒ‰ç…§æƒ¯ä¾‹å¯¼å…¥åˆ° F åç§°ç©ºé—´ä¸­ï¼‰ï¼Œå…¶ä¸­åŒ…å«æ¿€æ´»å‡½æ•°ï¼ŒæŸå¤±å‡½æ•°ç­‰ã€‚ ä»¥åŠå·ç§¯å’Œçº¿æ€§å±‚ç­‰å±‚çš„æ— çŠ¶æ€ç‰ˆæœ¬ã€‚</p><h5 id="torch-optim"><a href="#torch-optim" class="headerlink" title="torch.optim"></a>torch.optim</h5><p>åŒ…å«è¯¸å¦‚ SGD çš„ä¼˜åŒ–ç¨‹åºï¼Œè¿™äº›ä¼˜åŒ–ç¨‹åºåœ¨åé€€æ­¥éª¤</p><h5 id="Dataset"><a href="#Dataset" class="headerlink" title="Dataset"></a>Dataset</h5><p>æ›´æ–° Parameter çš„æƒé‡ã€‚ å…·æœ‰__len__å’Œ__getitem__çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬ Pytorch æä¾›çš„ç±»ï¼Œä¾‹å¦‚ TensorDataset</p><h5 id="DataLoader"><a href="#DataLoader" class="headerlink" title="DataLoader"></a>DataLoader</h5><p>è·å–ä»»ä½• Dataset å¹¶åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œè¯¥è¿­ä»£å™¨è¿”å›æ‰¹é‡æ•°æ®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<br><span class="hljs-keyword">import</span> requests<br><br>DATA_PATH = Path(<span class="hljs-string">&quot;data&quot;</span>)<br>PATH = DATA_PATH / <span class="hljs-string">&quot;mnist&quot;</span><br><br>PATH.mkdir(parents=<span class="hljs-literal">True</span>, exist_ok=<span class="hljs-literal">True</span>)<br><br>URL = <span class="hljs-string">&quot;https://github.com/pytorch/tutorials/raw/master/_static/&quot;</span><br>FILENAME = <span class="hljs-string">&quot;mnist.pkl.gz&quot;</span><br><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (PATH / FILENAME).exists():<br>        content = requests.get(URL + FILENAME).content<br>        (PATH / FILENAME).<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;wb&quot;</span>).write(content)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> gzip<br><br><span class="hljs-keyword">with</span> gzip.<span class="hljs-built_in">open</span>((PATH / FILENAME).as_posix(), <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        ((x_train, y_train), (x_valid, y_valid), _) = pickle.load(f, encoding=<span class="hljs-string">&quot;latin-1&quot;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> matplotlib <span class="hljs-keyword">import</span> pyplot<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br>pyplot.imshow(x_train[<span class="hljs-number">0</span>].reshape((<span class="hljs-number">28</span>, <span class="hljs-number">28</span>)), cmap=<span class="hljs-string">&quot;gray&quot;</span>)<br><span class="hljs-built_in">print</span>(x_train.shape)<br></code></pre></td></tr></table></figure><pre><code>(50000, 784)</code></pre><!-- ![png](output_2_1.png) --><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><br>x_train, y_train, x_valid, y_valid = <span class="hljs-built_in">map</span>(<br>    torch.tensor, (x_train, y_train, x_valid, y_valid)<br>)<br>n, c = x_train.shape<br>x_train, x_train.shape, y_train.<span class="hljs-built_in">min</span>(), y_train.<span class="hljs-built_in">max</span>()<br><span class="hljs-built_in">print</span>(x_train, y_train)<br><span class="hljs-built_in">print</span>(x_train.shape)<br><span class="hljs-built_in">print</span>(y_train.<span class="hljs-built_in">min</span>(), y_train.<span class="hljs-built_in">max</span>())<br></code></pre></td></tr></table></figure><pre><code>tensor([[0., 0., 0.,  ..., 0., 0., 0.],        [0., 0., 0.,  ..., 0., 0., 0.],        [0., 0., 0.,  ..., 0., 0., 0.],        ...,        [0., 0., 0.,  ..., 0., 0., 0.],        [0., 0., 0.,  ..., 0., 0., 0.],        [0., 0., 0.,  ..., 0., 0., 0.]]) tensor([5, 0, 4,  ..., 8, 4, 8])torch.Size([50000, 784])tensor(0) tensor(9)</code></pre><h5 id="ä»0æ„å»ºç¥ç»ç½‘ç»œçº¿æ€§æ¨¡å‹"><a href="#ä»0æ„å»ºç¥ç»ç½‘ç»œçº¿æ€§æ¨¡å‹" class="headerlink" title="ä»0æ„å»ºç¥ç»ç½‘ç»œçº¿æ€§æ¨¡å‹"></a>ä»0æ„å»ºç¥ç»ç½‘ç»œçº¿æ€§æ¨¡å‹</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> math<br><br>weights = torch.randn(<span class="hljs-number">784</span>, <span class="hljs-number">10</span>) / math.sqrt(<span class="hljs-number">784</span>)<br>weights.requires_grad_()<br>bias = torch.zeros(<span class="hljs-number">10</span>, requires_grad=<span class="hljs-literal">True</span>)<br><br><span class="hljs-comment">## softmaxæ¿€æ´»å‡½æ•°</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">log_softmax</span>(<span class="hljs-params">x</span>):</span><br>    <span class="hljs-keyword">return</span> x - x.exp().<span class="hljs-built_in">sum</span>(-<span class="hljs-number">1</span>).log().unsqueeze(-<span class="hljs-number">1</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">model</span>(<span class="hljs-params">xb</span>):</span><br>    <span class="hljs-keyword">return</span> log_softmax(xb @ weights + bias)  <span class="hljs-comment">#  @ä»£è¡¨ç‚¹ç§¯è¿ç®—</span><br><br>bs = <span class="hljs-number">64</span>  <span class="hljs-comment"># batch size</span><br><br>xb = x_train[<span class="hljs-number">0</span>:bs]  <span class="hljs-comment"># a mini-batch from x</span><br>preds = model(xb)  <span class="hljs-comment"># predictions</span><br>preds[<span class="hljs-number">0</span>], preds.shape<br><span class="hljs-built_in">print</span>(preds[<span class="hljs-number">0</span>], preds.shape)<br><br><span class="hljs-comment">## æŸå¤±å‡½æ•°</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">nll</span>(<span class="hljs-params"><span class="hljs-built_in">input</span>, target</span>):</span><br>    <span class="hljs-keyword">return</span> -<span class="hljs-built_in">input</span>[<span class="hljs-built_in">range</span>(target.shape[<span class="hljs-number">0</span>]), target].mean()<br><br>loss_func = nll<br><br>yb = y_train[<span class="hljs-number">0</span>:bs]<br><span class="hljs-built_in">print</span>(loss_func(preds, yb))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">accuracy</span>(<span class="hljs-params">out, yb</span>):</span><br>    preds = torch.argmax(out, dim=<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> (preds == yb).<span class="hljs-built_in">float</span>().mean()<br><br><span class="hljs-built_in">print</span>(accuracy(preds, yb))<br><br><span class="hljs-keyword">from</span> IPython.core.debugger <span class="hljs-keyword">import</span> set_trace<br><br>lr = <span class="hljs-number">0.5</span>  <span class="hljs-comment"># learning rate</span><br>epochs = <span class="hljs-number">2</span>  <span class="hljs-comment"># how many epochs to train for</span><br><br><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(epochs):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>((n - <span class="hljs-number">1</span>) // bs + <span class="hljs-number">1</span>):<br>        <span class="hljs-comment">#         set_trace()</span><br>        start_i = i * bs<br>        end_i = start_i + bs<br>        xb = x_train[start_i:end_i]<br>        yb = y_train[start_i:end_i]<br>        pred = model(xb)<br>        loss = loss_func(pred, yb)<br><br>        loss.backward()<br>        <span class="hljs-keyword">with</span> torch.no_grad():<br>            weights -= weights.grad * lr<br>            bias -= bias.grad * lr<br>            weights.grad.zero_()<br>            bias.grad.zero_()<br>            <br><span class="hljs-built_in">print</span>(loss_func(model(xb), yb), accuracy(model(xb), yb))<br><br></code></pre></td></tr></table></figure><pre><code>tensor([-2.5487, -2.8346, -2.7262, -2.1794, -2.1199, -2.1041, -1.9327, -2.1947,        -2.5637, -2.2133], grad_fn=&lt;SelectBackward&gt;) torch.Size([64, 10])tensor(2.3308, grad_fn=&lt;NegBackward&gt;)tensor(0.1094)tensor(0.0806, grad_fn=&lt;NegBackward&gt;) tensor(1.)</code></pre><h5 id="ä½¿ç”¨torch-nn-functional-é‡æ„"><a href="#ä½¿ç”¨torch-nn-functional-é‡æ„" class="headerlink" title="ä½¿ç”¨torch.nn.functional é‡æ„"></a>ä½¿ç”¨torch.nn.functional é‡æ„</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<br><br>loss_func = F.cross_entropy<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">model</span>(<span class="hljs-params">xb</span>):</span><br>    <span class="hljs-keyword">return</span> xb @ weights + bias<br><br><span class="hljs-built_in">print</span>(loss_func(model(xb), yb), accuracy(model(xb), yb))<br><br></code></pre></td></tr></table></figure><pre><code>tensor(0.0806, grad_fn=&lt;NllLossBackward&gt;) tensor(1.)</code></pre><h5 id="ä½¿ç”¨nn-Moduleé‡æ„"><a href="#ä½¿ç”¨nn-Moduleé‡æ„" class="headerlink" title="ä½¿ç”¨nn.Moduleé‡æ„"></a>ä½¿ç”¨nn.Moduleé‡æ„</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> nn<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Mnist_Logistic</span>(<span class="hljs-params">nn.Module</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-built_in">super</span>().__init__()<br>        self.weights = nn.Parameter(torch.randn(<span class="hljs-number">784</span>, <span class="hljs-number">10</span>) / math.sqrt(<span class="hljs-number">784</span>))<br>        self.bias = nn.Parameter(torch.zeros(<span class="hljs-number">10</span>))<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">self, xb</span>):</span><br>        <span class="hljs-keyword">return</span> xb @ self.weights + self.bias<br>    <br>model = Mnist_Logistic()<br><span class="hljs-built_in">print</span>(loss_func(model(xb), yb))<br><br>    <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fit</span>():</span><br>    <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(epochs):<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>((n - <span class="hljs-number">1</span>) // bs + <span class="hljs-number">1</span>):<br>            start_i = i * bs<br>            end_i = start_i + bs<br>            xb = x_train[start_i:end_i]<br>            yb = y_train[start_i:end_i]<br>            pred = model(xb)<br>            loss = loss_func(pred, yb)<br><br>            loss.backward()<br>            <span class="hljs-keyword">with</span> torch.no_grad():<br>                <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> model.parameters():<br>                    p -= p.grad * lr<br>                model.zero_grad()<br><br>fit()<br><span class="hljs-built_in">print</span>(loss_func(model(xb), yb))<br><br></code></pre></td></tr></table></figure><pre><code>tensor(2.4222, grad_fn=&lt;NllLossBackward&gt;)tensor(0.0817, grad_fn=&lt;NllLossBackward&gt;)</code></pre><h5 id="ä½¿ç”¨nn-Linearé‡æ„"><a href="#ä½¿ç”¨nn-Linearé‡æ„" class="headerlink" title="ä½¿ç”¨nn.Linearé‡æ„"></a>ä½¿ç”¨nn.Linearé‡æ„</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Mnist_Logistic</span>(<span class="hljs-params">nn.Module</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-built_in">super</span>().__init__()<br>        self.lin = nn.Linear(<span class="hljs-number">784</span>, <span class="hljs-number">10</span>)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">self, xb</span>):</span><br>        <span class="hljs-keyword">return</span> self.lin(xb)<br>    <br>model = Mnist_Logistic()<br><span class="hljs-built_in">print</span>(loss_func(model(xb), yb))<br>fit()<br><br><span class="hljs-built_in">print</span>(loss_func(model(xb), yb))<br></code></pre></td></tr></table></figure><pre><code>tensor(2.3090, grad_fn=&lt;NllLossBackward&gt;)tensor(0.0824, grad_fn=&lt;NllLossBackward&gt;)</code></pre><h5 id="ä½¿ç”¨optimé‡æ„"><a href="#ä½¿ç”¨optimé‡æ„" class="headerlink" title="ä½¿ç”¨optimé‡æ„"></a>ä½¿ç”¨optimé‡æ„</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> torch <span class="hljs-keyword">import</span> optim<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_model</span>():</span><br>    model = Mnist_Logistic()<br>    <span class="hljs-keyword">return</span> model, optim.SGD(model.parameters(), lr=lr)<br><br>model, opt = get_model()<br><span class="hljs-built_in">print</span>(loss_func(model(xb), yb))<br><br><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(epochs):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>((n - <span class="hljs-number">1</span>) // bs + <span class="hljs-number">1</span>):<br>        start_i = i * bs<br>        end_i = start_i + bs<br>        xb = x_train[start_i:end_i]<br>        yb = y_train[start_i:end_i]<br>        pred = model(xb)<br>        loss = loss_func(pred, yb)<br><br>        loss.backward()<br>        opt.step()<br>        opt.zero_grad()<br><br><span class="hljs-built_in">print</span>(loss_func(model(xb), yb))<br></code></pre></td></tr></table></figure><pre><code>tensor(2.2990, grad_fn=&lt;NllLossBackward&gt;)tensor(0.0805, grad_fn=&lt;NllLossBackward&gt;)</code></pre><h5 id="ä½¿ç”¨Dataseté‡æ„"><a href="#ä½¿ç”¨Dataseté‡æ„" class="headerlink" title="ä½¿ç”¨Dataseté‡æ„"></a>ä½¿ç”¨Dataseté‡æ„</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> TensorDataset<br><br>train_ds = TensorDataset(x_train, y_train)<br>xb,yb = train_ds[i*bs : i*bs+bs]<br>model, opt = get_model()<br><br><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(epochs):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>((n - <span class="hljs-number">1</span>) // bs + <span class="hljs-number">1</span>):<br>        xb, yb = train_ds[i * bs: i * bs + bs]<br>        pred = model(xb)<br>        loss = loss_func(pred, yb)<br><br>        loss.backward()<br>        opt.step()<br>        opt.zero_grad()<br><br><span class="hljs-built_in">print</span>(loss_func(model(xb), yb))<br></code></pre></td></tr></table></figure><pre><code>tensor(0.0817, grad_fn=&lt;NllLossBackward&gt;)</code></pre><h5 id="ä½¿ç”¨DataLoaderé‡æ„"><a href="#ä½¿ç”¨DataLoaderé‡æ„" class="headerlink" title="ä½¿ç”¨DataLoaderé‡æ„"></a>ä½¿ç”¨DataLoaderé‡æ„</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader<br><br>train_ds = TensorDataset(x_train, y_train)<br>train_dl = DataLoader(train_ds, batch_size=bs)<br><br>model, opt = get_model()<br><br><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(epochs):<br>    <span class="hljs-keyword">for</span> xb, yb <span class="hljs-keyword">in</span> train_dl:<br>        pred = model(xb)<br>        loss = loss_func(pred, yb)<br><br>        loss.backward()<br>        opt.step()<br>        opt.zero_grad()<br><br><span class="hljs-built_in">print</span>(loss_func(model(xb), yb))<br></code></pre></td></tr></table></figure><pre><code>tensor(0.0803, grad_fn=&lt;NllLossBackward&gt;)</code></pre><h5 id="æ·»åŠ éªŒè¯"><a href="#æ·»åŠ éªŒè¯" class="headerlink" title="æ·»åŠ éªŒè¯"></a>æ·»åŠ éªŒè¯</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python">train_ds = TensorDataset(x_train, y_train)<br>train_dl = DataLoader(train_ds, batch_size=bs, shuffle=<span class="hljs-literal">True</span>)<br><br>valid_ds = TensorDataset(x_valid, y_valid)<br>valid_dl = DataLoader(valid_ds, batch_size=bs * <span class="hljs-number">2</span>)<br><br>model, opt = get_model()<br><br><span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(epochs):<br>    model.train()<br>    <span class="hljs-keyword">for</span> xb, yb <span class="hljs-keyword">in</span> train_dl:<br>        pred = model(xb)<br>        loss = loss_func(pred, yb)<br><br>        loss.backward()<br>        opt.step()<br>        opt.zero_grad()<br><br>    model.<span class="hljs-built_in">eval</span>()<br>    <span class="hljs-keyword">with</span> torch.no_grad():<br>        valid_loss = <span class="hljs-built_in">sum</span>(loss_func(model(xb), yb) <span class="hljs-keyword">for</span> xb, yb <span class="hljs-keyword">in</span> valid_dl)<br><br>    <span class="hljs-built_in">print</span>(epoch, valid_loss / <span class="hljs-built_in">len</span>(valid_dl))<br></code></pre></td></tr></table></figure><pre><code>0 tensor(0.3093)1 tensor(0.3198)</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## åˆ›å»ºfit()å’Œget_data()</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">loss_batch</span>(<span class="hljs-params">model, loss_func, xb, yb, opt=<span class="hljs-literal">None</span></span>):</span><br>    loss = loss_func(model(xb), yb)<br><br>    <span class="hljs-keyword">if</span> opt <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        loss.backward()<br>        opt.step()<br>        opt.zero_grad()<br><br>    <span class="hljs-keyword">return</span> loss.item(), <span class="hljs-built_in">len</span>(xb)<br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fit</span>(<span class="hljs-params">epochs, model, loss_func, opt, train_dl, valid_dl</span>):</span><br>    <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(epochs):<br>        model.train()<br>        <span class="hljs-keyword">for</span> xb, yb <span class="hljs-keyword">in</span> train_dl:<br>            loss_batch(model, loss_func, xb, yb, opt)<br><br>        model.<span class="hljs-built_in">eval</span>()<br>        <span class="hljs-keyword">with</span> torch.no_grad():<br>            losses, nums = <span class="hljs-built_in">zip</span>(<br>                *[loss_batch(model, loss_func, xb, yb) <span class="hljs-keyword">for</span> xb, yb <span class="hljs-keyword">in</span> valid_dl]<br>            )<br>        val_loss = np.<span class="hljs-built_in">sum</span>(np.multiply(losses, nums)) / np.<span class="hljs-built_in">sum</span>(nums)<br><br>        <span class="hljs-built_in">print</span>(epoch, val_loss)<br>        <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_data</span>(<span class="hljs-params">train_ds, valid_ds, bs</span>):</span><br>    <span class="hljs-keyword">return</span> (<br>        DataLoader(train_ds, batch_size=bs, shuffle=<span class="hljs-literal">True</span>),<br>        DataLoader(valid_ds, batch_size=bs * <span class="hljs-number">2</span>),<br>    )<br><br>train_dl, valid_dl = get_data(train_ds, valid_ds, bs)<br>model, opt = get_model()<br>fit(epochs, model, loss_func, opt, train_dl, valid_dl)<br></code></pre></td></tr></table></figure><pre><code>0 0.33136114755868911 0.35820939881801606</code></pre><h5 id="åˆ‡æ¢åˆ°-CNN"><a href="#åˆ‡æ¢åˆ°-CNN" class="headerlink" title="åˆ‡æ¢åˆ° CNN"></a>åˆ‡æ¢åˆ° CNN</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Mnist_CNN</span>(<span class="hljs-params">nn.Module</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-built_in">super</span>().__init__()<br>        self.conv1 = nn.Conv2d(<span class="hljs-number">1</span>, <span class="hljs-number">16</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>, padding=<span class="hljs-number">1</span>)<br>        self.conv2 = nn.Conv2d(<span class="hljs-number">16</span>, <span class="hljs-number">16</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>, padding=<span class="hljs-number">1</span>)<br>        self.conv3 = nn.Conv2d(<span class="hljs-number">16</span>, <span class="hljs-number">10</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>, padding=<span class="hljs-number">1</span>)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">self, xb</span>):</span><br>        xb = xb.view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>)<br>        xb = F.relu(self.conv1(xb))<br>        xb = F.relu(self.conv2(xb))<br>        xb = F.relu(self.conv3(xb))<br>        xb = F.avg_pool2d(xb, <span class="hljs-number">4</span>)<br>        <span class="hljs-keyword">return</span> xb.view(-<span class="hljs-number">1</span>, xb.size(<span class="hljs-number">1</span>))<br><br>lr = <span class="hljs-number">0.1</span><br><br>model = Mnist_CNN()<br>opt = optim.SGD(model.parameters(), lr=lr, momentum=<span class="hljs-number">0.9</span>)<br><br>fit(epochs, model, loss_func, opt, train_dl, valid_dl)<br></code></pre></td></tr></table></figure><pre><code>0 0.29366704518795011 0.21561954822540283</code></pre><h5 id="nn-Sequential-Sequentialå¯¹è±¡ä»¥é¡ºåºæ–¹å¼è¿è¡Œå…¶ä¸­åŒ…å«çš„æ¯ä¸ªæ¨¡å—ã€‚"><a href="#nn-Sequential-Sequentialå¯¹è±¡ä»¥é¡ºåºæ–¹å¼è¿è¡Œå…¶ä¸­åŒ…å«çš„æ¯ä¸ªæ¨¡å—ã€‚" class="headerlink" title="nn.Sequential   Sequentialå¯¹è±¡ä»¥é¡ºåºæ–¹å¼è¿è¡Œå…¶ä¸­åŒ…å«çš„æ¯ä¸ªæ¨¡å—ã€‚"></a>nn.Sequential   Sequentialå¯¹è±¡ä»¥é¡ºåºæ–¹å¼è¿è¡Œå…¶ä¸­åŒ…å«çš„æ¯ä¸ªæ¨¡å—ã€‚</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Lambda</span>(<span class="hljs-params">nn.Module</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, func</span>):</span><br>        <span class="hljs-built_in">super</span>().__init__()<br>        self.func = func<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">forward</span>(<span class="hljs-params">self, x</span>):</span><br>        <span class="hljs-keyword">return</span> self.func(x)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">preprocess</span>(<span class="hljs-params">x</span>):</span><br>    <span class="hljs-keyword">return</span> x.view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>)<br><br>model = nn.Sequential(<br>    Lambda(preprocess),<br>    nn.Conv2d(<span class="hljs-number">1</span>, <span class="hljs-number">16</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>, padding=<span class="hljs-number">1</span>),<br>    nn.ReLU(),<br>    nn.Conv2d(<span class="hljs-number">16</span>, <span class="hljs-number">16</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>, padding=<span class="hljs-number">1</span>),<br>    nn.ReLU(),<br>    nn.Conv2d(<span class="hljs-number">16</span>, <span class="hljs-number">10</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>, padding=<span class="hljs-number">1</span>),<br>    nn.ReLU(),<br>    nn.AvgPool2d(<span class="hljs-number">4</span>),<br>    Lambda(<span class="hljs-keyword">lambda</span> x: x.view(x.size(<span class="hljs-number">0</span>), -<span class="hljs-number">1</span>)),<br>)<br><br>opt = optim.SGD(model.parameters(), lr=lr, momentum=<span class="hljs-number">0.9</span>)<br><br>fit(epochs, model, loss_func, opt, train_dl, valid_dl)<br></code></pre></td></tr></table></figure><pre><code>0 0.40379241023063661 0.25595326462984086</code></pre><h5 id="åŒ…è£…DataLoader"><a href="#åŒ…è£…DataLoader" class="headerlink" title="åŒ…è£…DataLoader"></a>åŒ…è£…DataLoader</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">preprocess</span>(<span class="hljs-params">x, y</span>):</span><br>    <span class="hljs-keyword">return</span> x.view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>), y<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WrappedDataLoader</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, dl, func</span>):</span><br>        self.dl = dl<br>        self.func = func<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__len__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self.dl)<br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__iter__</span>(<span class="hljs-params">self</span>):</span><br>        batches = <span class="hljs-built_in">iter</span>(self.dl)<br>        <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> batches:<br>            <span class="hljs-keyword">yield</span> (self.func(*b))<br><br>train_dl, valid_dl = get_data(train_ds, valid_ds, bs)<br>train_dl = WrappedDataLoader(train_dl, preprocess)<br>valid_dl = WrappedDataLoader(valid_dl, preprocess)<br><br>model = nn.Sequential(<br>    nn.Conv2d(<span class="hljs-number">1</span>, <span class="hljs-number">16</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>, padding=<span class="hljs-number">1</span>),<br>    nn.ReLU(),<br>    nn.Conv2d(<span class="hljs-number">16</span>, <span class="hljs-number">16</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>, padding=<span class="hljs-number">1</span>),<br>    nn.ReLU(),<br>    nn.Conv2d(<span class="hljs-number">16</span>, <span class="hljs-number">10</span>, kernel_size=<span class="hljs-number">3</span>, stride=<span class="hljs-number">2</span>, padding=<span class="hljs-number">1</span>),<br>    nn.ReLU(),<br>    nn.AdaptiveAvgPool2d(<span class="hljs-number">1</span>),<br>    Lambda(<span class="hljs-keyword">lambda</span> x: x.view(x.size(<span class="hljs-number">0</span>), -<span class="hljs-number">1</span>)),<br>)<br><br>opt = optim.SGD(model.parameters(), lr=lr, momentum=<span class="hljs-number">0.9</span>)<br><br>fit(epochs, model, loss_func, opt, train_dl, valid_dl)<br><br></code></pre></td></tr></table></figure><pre><code>0 0.313964178180694551 0.2551067463874817</code></pre><h5 id="ä½¿ç”¨GPUï¼Œï¼Œï¼Œå¦‚æœæœ‰"><a href="#ä½¿ç”¨GPUï¼Œï¼Œï¼Œå¦‚æœæœ‰" class="headerlink" title="ä½¿ç”¨GPUï¼Œï¼Œï¼Œå¦‚æœæœ‰"></a>ä½¿ç”¨GPUï¼Œï¼Œï¼Œå¦‚æœæœ‰</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(torch.cuda.is_available())<br>dev = torch.device(<br>    <span class="hljs-string">&quot;cuda&quot;</span>) <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> torch.device(<span class="hljs-string">&quot;cpu&quot;</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">preprocess</span>(<span class="hljs-params">x, y</span>):</span><br>    <span class="hljs-keyword">return</span> x.view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>).to(dev), y.to(dev)<br><br>train_dl, valid_dl = get_data(train_ds, valid_ds, bs)<br>train_dl = WrappedDataLoader(train_dl, preprocess)<br>valid_dl = WrappedDataLoader(valid_dl, preprocess)<br><br>model.to(dev)<br>opt = optim.SGD(model.parameters(), lr=lr, momentum=<span class="hljs-number">0.9</span>)<br>fit(epochs, model, loss_func, opt, train_dl, valid_dl)<br><br></code></pre></td></tr></table></figure><pre><code>False0 0.223737240695953381 0.2494806985616684</code></pre>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iPhone å¿«æ·æŒ‡ä»¤ä¸Šä¸‹ç­åŠè‡ªåŠ¨æ‰“å¡</title>
    <link href="/2021/09/10/iPhone/"/>
    <url>/2021/09/10/iPhone/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><p>æ‰“å·¥äººæœ‰æ—¶å€™ä¼šå¿˜è®°æ‰“å¡ï¼Œä¸ºäº†èƒ½å°½é‡å°‘å¿˜è®°ï¼Œæœ‰æ—¶å€™ä¼šè®¾å®šé—¹é’Ÿæ¥æé†’ã€‚åœ¨iPhoneä¸Šè¿˜æœ‰ä¸ªç¨å¾®åŠè‡ªåŠ¨åŒ–çš„åº”ç”¨ä¹Ÿå¯ä»¥å®ç°ï¼Œå°±æ˜¯å¿«æ·æŒ‡ä»¤ã€‚ä¸ºå•¥æ˜¯åŠè‡ªåŠ¨åŒ–å‘¢ï¼Œå› ä¸ºæ¯å±çŠ¶æ€ä¸‹æ˜¯æ— æ³•æ‰§è¡Œçš„ï¼Œåªæ˜¯ä¼šæœ‰æé†’ï¼Œéœ€è¦è§£é”åç‚¹å‡»æ‰èƒ½æ‰§è¡Œã€‚å½“ç„¶äº†åœ¨ä¸æ¯å±çš„çŠ¶æ€ä¸‹æ˜¯å®Œå…¨å¯ä»¥å®ç°è‡ªåŠ¨åŒ–çš„ï¼Œä½†æ˜¯ä¹Ÿä¸å¯èƒ½ä¸€ç›´ä¸æ¯å±å§ã€‚iPhoneçš„é‚£ç‚¹ç‚¹ç”µé‡å°±ä¸è¯´äº†ã€‚<br>è¿˜æœ‰ä¸ªå‰æå°±æ˜¯æå‰è®¾ç½®å¥½æ‰“å¡APPçš„å¿«æ·æ‰“å¡åŠŸèƒ½ã€‚</p><h6 id="å¿«æ·æŒ‡ä»¤APPï¼ˆä¸€èˆ¬è‡ªå¸¦ï¼Œä¸å°å¿ƒåˆ äº†å¯ä»¥å»APP-Storeé‡æ–°ä¸‹è½½ï¼‰"><a href="#å¿«æ·æŒ‡ä»¤APPï¼ˆä¸€èˆ¬è‡ªå¸¦ï¼Œä¸å°å¿ƒåˆ äº†å¯ä»¥å»APP-Storeé‡æ–°ä¸‹è½½ï¼‰" class="headerlink" title="å¿«æ·æŒ‡ä»¤APPï¼ˆä¸€èˆ¬è‡ªå¸¦ï¼Œä¸å°å¿ƒåˆ äº†å¯ä»¥å»APP Storeé‡æ–°ä¸‹è½½ï¼‰"></a>å¿«æ·æŒ‡ä»¤APPï¼ˆä¸€èˆ¬è‡ªå¸¦ï¼Œä¸å°å¿ƒåˆ äº†å¯ä»¥å»APP Storeé‡æ–°ä¸‹è½½ï¼‰</h6><p>æ‰“å¼€å¿«æ·æŒ‡ä»¤appï¼Œç‚¹å‡»è‡ªåŠ¨åŒ–ï¼Œç‚¹å‡»åˆ›å»ºä¸ªäººè‡ªåŠ¨åŒ–<br><img src="/img/article/iphone/0.jpg"></p><h5 id="é€‰æ‹©ç‰¹å®šæ—¶é—´"><a href="#é€‰æ‹©ç‰¹å®šæ—¶é—´" class="headerlink" title="é€‰æ‹©ç‰¹å®šæ—¶é—´"></a>é€‰æ‹©ç‰¹å®šæ—¶é—´</h5><p>è¿™ä¸ªé¡µé¢è¿˜æœ‰å…¶å®ƒäº‹ä»¶ï¼Œæ¯”å¦‚åˆ°è¾¾ã€ç¦»å¼€ç­‰ã€‚ä¸€èˆ¬ç°åœ¨ä¼ä¸šå¾®ä¿¡æˆ–è€…é’‰é’‰äº¦æˆ–è€…æ˜¯å…¬å¸è‡ªå·±çš„æ‰“å¡APPéƒ½æ˜¯åŸºäºè·ç¦»è¿›è¡Œå®šä½æ‰“å¡ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿå¯ä»¥é€‰æ‹©åˆ°è¾¾æˆ–è€…ç¦»å¼€ï¼Œè¿™é‡Œä»¥ç‰¹å®šæ—¶é—´ä¸ºä¾‹ï¼Œå…¶å®ƒäº‹ä»¶å¯ä»¥è‡ªè¡Œæ‘¸ç´¢ã€‚<br>ç„¶åè®¾ç½®ä¸Šä¸‹ç­æ—¶é—´ï¼Œå¯ä»¥é€‰æ‹©æ¯å¤©ï¼Œæ¯å‘¨ï¼ˆå¯é€‰å‘¨ä¸€è‡³å‘¨äº”ï¼‰ï¼ŒæŒ‰å¿ƒæƒ…é€‰æ‹©ã€‚<br><img src="/img/article/iphone/1.jpg"></p><h5 id="ç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œç‚¹å‡»æ·»åŠ æ“ä½œã€‚"><a href="#ç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œç‚¹å‡»æ·»åŠ æ“ä½œã€‚" class="headerlink" title="ç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œç‚¹å‡»æ·»åŠ æ“ä½œã€‚"></a>ç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œç‚¹å‡»æ·»åŠ æ“ä½œã€‚</h5><p><img src="/img/article/iphone/2.jpg"></p><h5 id="æœç´¢è¾“å…¥ï¼šæ‰“å¼€appï¼Œç‚¹å‡»æ‰“å¼€appï¼Œç‚¹å‡»é€‰æ‹©ã€‚"><a href="#æœç´¢è¾“å…¥ï¼šæ‰“å¼€appï¼Œç‚¹å‡»æ‰“å¼€appï¼Œç‚¹å‡»é€‰æ‹©ã€‚" class="headerlink" title="æœç´¢è¾“å…¥ï¼šæ‰“å¼€appï¼Œç‚¹å‡»æ‰“å¼€appï¼Œç‚¹å‡»é€‰æ‹©ã€‚"></a>æœç´¢è¾“å…¥ï¼šæ‰“å¼€appï¼Œç‚¹å‡»æ‰“å¼€appï¼Œç‚¹å‡»é€‰æ‹©ã€‚</h5><p><img src="/img/article/iphone/3.jpg"></p><h5 id="æœç´¢è¾“å…¥ä¼ä¸šå¾®ä¿¡ï¼Œç‚¹å‡»ä¼ä¸šå¾®ä¿¡ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚"><a href="#æœç´¢è¾“å…¥ä¼ä¸šå¾®ä¿¡ï¼Œç‚¹å‡»ä¼ä¸šå¾®ä¿¡ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚" class="headerlink" title="æœç´¢è¾“å…¥ä¼ä¸šå¾®ä¿¡ï¼Œç‚¹å‡»ä¼ä¸šå¾®ä¿¡ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚"></a>æœç´¢è¾“å…¥ä¼ä¸šå¾®ä¿¡ï¼Œç‚¹å‡»ä¼ä¸šå¾®ä¿¡ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚</h5><p><img src="/img/article/iphone/4.jpg"></p><h5 id="å°†è¿è¡Œå‰è¯¢é—®å…³é—­ï¼Œç‚¹å‡»ä¸è¯¢é—®ï¼Œç‚¹å‡»å®Œæˆã€‚"><a href="#å°†è¿è¡Œå‰è¯¢é—®å…³é—­ï¼Œç‚¹å‡»ä¸è¯¢é—®ï¼Œç‚¹å‡»å®Œæˆã€‚" class="headerlink" title="å°†è¿è¡Œå‰è¯¢é—®å…³é—­ï¼Œç‚¹å‡»ä¸è¯¢é—®ï¼Œç‚¹å‡»å®Œæˆã€‚"></a>å°†è¿è¡Œå‰è¯¢é—®å…³é—­ï¼Œç‚¹å‡»ä¸è¯¢é—®ï¼Œç‚¹å‡»å®Œæˆã€‚</h5><p><img src="/img/article/iphone/5.jpg"></p><h5 id="é¢˜å¤–è¯"><a href="#é¢˜å¤–è¯" class="headerlink" title="é¢˜å¤–è¯"></a>é¢˜å¤–è¯</h5><p>iPhoneçš„å¿«æ·æŒ‡ä»¤æœ‰ç‚¹åƒç¼–ç¨‹ï¼Œæ‰€ä»¥åŠŸèƒ½ä¸æ­¢è¿™äº›ï¼Œç½‘ä¸Šè¿˜æœ‰å¦‚ä½•å®ç°æ•²å‡»èƒŒé¢æ˜¾ç¤ºå¥åº·ç ç­‰ï¼Œæœ‰å…´è¶£çš„å¯ä»¥æœæ¥çœ‹çœ‹ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>iPhone</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç©</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python ç›‘æ§</title>
    <link href="/2021/09/02/python%E7%9B%91%E6%8E%A7/"/>
    <url>/2021/09/02/python%E7%9B%91%E6%8E%A7/</url>
    
    <content type="html"><![CDATA[<h2 id="ä½¿ç”¨pythonç›‘æ§ç”µè„‘é”®ç›˜ã€é¼ æ ‡å¹¶æ‹ç…§å½•åƒ"><a href="#ä½¿ç”¨pythonç›‘æ§ç”µè„‘é”®ç›˜ã€é¼ æ ‡å¹¶æ‹ç…§å½•åƒ" class="headerlink" title="ä½¿ç”¨pythonç›‘æ§ç”µè„‘é”®ç›˜ã€é¼ æ ‡å¹¶æ‹ç…§å½•åƒ"></a>ä½¿ç”¨pythonç›‘æ§ç”µè„‘é”®ç›˜ã€é¼ æ ‡å¹¶æ‹ç…§å½•åƒ</h2><span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> keyboard<br><span class="hljs-keyword">from</span> cv2 <span class="hljs-keyword">import</span> cv2<br><span class="hljs-comment"># from pynput.mouse import Listener</span><br><span class="hljs-keyword">import</span> pyautogui <span class="hljs-keyword">as</span> pag    <span class="hljs-comment">#ç›‘å¬é¼ æ ‡</span><br><span class="hljs-comment"># from pynput.keyboard import Key, Listener</span><br><span class="hljs-keyword">from</span> threading <span class="hljs-keyword">import</span> Thread<br><br>x1, y1 = pag.position()<br><span class="hljs-comment"># print(x1, y1)</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">camera</span>():</span><br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    æ‹ç…§</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    cap = cv2.VideoCapture(<span class="hljs-number">0</span>)<br>    ret,frame = cap.read() <span class="hljs-comment">#è¯»å–æ‘„åƒå¤´å†…å®¹</span><br>    cv2.imwrite(<span class="hljs-string">&quot;./test.jpg&quot;</span>,frame) <span class="hljs-comment">#ä¿å­˜åˆ°ç£ç›˜</span><br>    <span class="hljs-comment">#é‡Šæ”¾æ‘„åƒå¤´</span><br>    cap.release()<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">record_video</span>():</span><br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    å½•åˆ¶è§†é¢‘</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    cap = cv2.VideoCapture(<span class="hljs-number">0</span>)<br>    fps = <span class="hljs-number">30</span><br>    size=(<span class="hljs-built_in">int</span>(cap.get(cv2.CAP_PROP_FRAME_WIDTH)),<span class="hljs-built_in">int</span>(cap.get(cv2.CAP_PROP_FRAME_HEIGHT)))<br>    videoWriter=cv2.VideoWriter(<span class="hljs-string">&#x27;./test.avi&#x27;</span>,cv2.VideoWriter_fourcc(<span class="hljs-string">&#x27;X&#x27;</span>,<span class="hljs-string">&#x27;V&#x27;</span>,<span class="hljs-string">&#x27;I&#x27;</span>,<span class="hljs-string">&#x27;D&#x27;</span>),fps,size)<br>    success,frame = cap.read()<br>    numFrameRemaining = <span class="hljs-number">5</span> * fps    <span class="hljs-comment">#æ‘„åƒå¤´æ•è·æŒç»­æ—¶é—´</span><br>    <span class="hljs-keyword">while</span> success <span class="hljs-keyword">and</span> numFrameRemaining &gt; <span class="hljs-number">0</span>:<br>        videoWriter.write(frame)<br>        success,frame = cap.read()<br>        numFrameRemaining -= <span class="hljs-number">1</span><br><br>    cap.release()<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">display_video</span>():</span><br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    å®æ—¶çª—å£</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    face_locations = []<br>    cap = cv2.VideoCapture(<span class="hljs-number">0</span>)<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-comment"># Grab a single frame of video</span><br>        ret, frame = cap.read()<br><br>        <span class="hljs-comment"># Convert the image from BGR color (whichOpenCV uses) to RGB color (which face_recognition uses)</span><br>        rgb_frame = frame[:, :, ::-<span class="hljs-number">1</span>]<br><br>        <span class="hljs-comment"># Find all the faces in the current frameof video</span><br>        face_locations = face_recognition.face_locations(rgb_frame)<br><br>        <span class="hljs-comment"># Display the results</span><br>        <span class="hljs-keyword">for</span> top, right, bottom, left <span class="hljs-keyword">in</span> face_locations:<br>            <span class="hljs-comment"># Draw a box around the face</span><br>            cv2.rectangle(frame, (left, top),(right, bottom), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), <span class="hljs-number">2</span>)<br><br>        <span class="hljs-comment"># Display the resulting image</span><br>        cv2.imshow(<span class="hljs-string">&#x27;Video&#x27;</span>, frame)<br><br>        <span class="hljs-comment"># Hit &#x27;q&#x27; on the keyboard to quit!</span><br>        <span class="hljs-keyword">if</span> cv2.waitKey(<span class="hljs-number">1</span>) &amp; <span class="hljs-number">0xFF</span> == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;q&#x27;</span>):<br>            <span class="hljs-keyword">break</span><br><br>    <span class="hljs-comment"># Release handle tothe webcam</span><br>    cap.release()<br>    cv2.destroyAllWindows()<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">display_video2</span>():</span><br>    <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">    å®æ—¶æ£€æµ‹</span><br><span class="hljs-string">    &#x27;&#x27;&#x27;</span><br>    <span class="hljs-comment">#å­˜å‚¨çŸ¥é“äººååˆ—è¡¨</span><br>    known_names=[<span class="hljs-string">&#x27;yahaha1&#x27;</span>, <span class="hljs-string">&#x27;yahaha2&#x27;</span>] <br>    <span class="hljs-comment">#å­˜å‚¨çŸ¥é“çš„ç‰¹å¾å€¼</span><br>    known_faces=[]<br><br>    image1 =face_recognition.load_image_file(<span class="hljs-string">&quot;yahaha2.jpg&quot;</span>)<br>    face_encoding1 =face_recognition.face_encodings(image1)<br><br>    image2 =face_recognition.load_image_file(<span class="hljs-string">&quot;yahaha1.jpg&quot;</span>)<br>    face_encoding2 =face_recognition.face_encodings(image1)<br><br>    <span class="hljs-keyword">if</span> face_encoding1 <span class="hljs-keyword">and</span> face_encoding2:<br>        face_encoding1 = face_encoding1[<span class="hljs-number">0</span>]<br>        face_encoding2 = face_encoding2[<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">else</span>:<br>        sys.exit()<br><br>    known_faces = [face_encoding1, face_encoding2]<br><br>    cap = cv2.VideoCapture(<span class="hljs-number">0</span>)<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-comment"># Grab a single frame of video</span><br>        ret, frame = cap.read()<br>        <span class="hljs-comment"># Convert the image from BGR color (whichOpenCV uses) to RGB color (which face_recognition uses)</span><br>        rgb_frame = frame[:, :, ::-<span class="hljs-number">1</span>]<br><br>        <span class="hljs-comment"># Find all the faces and face encodings inthe current frame of video</span><br>        face_locations =face_recognition.face_locations(rgb_frame)  <span class="hljs-comment"># å¦‚æœ‰gpuå¯æ·»åŠ å‚æ•°model=&#x27;cnn&#x27;æå‡ç²¾åº¦</span><br>        face_encodings =face_recognition.face_encodings(rgb_frame, face_locations)<br><br>        face_names = []<br>        <span class="hljs-keyword">for</span> face_encoding <span class="hljs-keyword">in</span> face_encodings:<br>            <span class="hljs-comment"># See if the face is a match for theknown face(s)</span><br>            matches =face_recognition.compare_faces(known_faces, face_encoding, tolerance=<span class="hljs-number">0.60</span>)<br><br>            name = <span class="hljs-literal">None</span><br>            <span class="hljs-comment"># if match[0]:</span><br>            <span class="hljs-comment">#     name = &quot;Yahaha&quot;</span><br>            <span class="hljs-built_in">print</span>(matches)<br>            <span class="hljs-keyword">if</span> <span class="hljs-literal">True</span> <span class="hljs-keyword">in</span> matches:<br>                first_match_index = matches.index(<span class="hljs-literal">True</span>)<br>                name = known_names[first_match_index]<br>            <span class="hljs-keyword">else</span>:<br>                name = <span class="hljs-string">&#x27;Unkonwn&#x27;</span><br><br>            face_names.append(name)<br><br>        <span class="hljs-comment"># Label the results</span><br>        <span class="hljs-keyword">for</span> (top, right, bottom, left), name <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(face_locations, face_names):<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> name:<br>                <span class="hljs-keyword">continue</span><br><br>            <span class="hljs-comment"># Draw a box around the face</span><br>            cv2.rectangle(frame, (left, top),(right, bottom), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), <span class="hljs-number">2</span>)<br>            <span class="hljs-comment"># Draw a label with a name below theface</span><br>            cv2.rectangle(frame, (left, bottom -<span class="hljs-number">25</span>), (right, bottom), (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>), cv2.FILLED)<br>            font = cv2.FONT_HERSHEY_DUPLEX<br>            cv2.putText(frame, name, (left + <span class="hljs-number">6</span>,bottom - <span class="hljs-number">6</span>), font, <span class="hljs-number">0.5</span>, (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>), <span class="hljs-number">1</span>)<br><br>        cv2.imshow(<span class="hljs-string">&#x27;Video&#x27;</span>, frame)<br><br>        <span class="hljs-comment"># Hit &#x27;q&#x27; on the keyboard to quit!</span><br>        <span class="hljs-keyword">if</span> cv2.waitKey(<span class="hljs-number">1</span>) &amp; <span class="hljs-number">0xFF</span> == <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;q&#x27;</span>):<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-comment"># All done!</span><br>    cap.release()<br>    cv2.destroyAllWindows()<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">proof</span>(<span class="hljs-params">x</span>):</span><br>    <span class="hljs-comment"># print(x)</span><br>    <span class="hljs-comment"># record_video()</span><br>    camera()<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">monitor_keyboard</span>():</span><br>    keyboard.hook(proof)<br>    <span class="hljs-comment">#æŒ‰ä¸‹ä»»ä½•æŒ‰é”®æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨proofï¼Œå…¶ä¸­ä¸€å®šä¼šä¼ ä¸€ä¸ªå€¼ï¼Œå°±æ˜¯é”®ç›˜äº‹ä»¶</span><br>    keyboard.wait()<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">monitor_mouse</span>():</span><br>    x2, y2 = pag.position()<br>    <span class="hljs-keyword">while</span> x1 == x2:<br>        x2, y2 = pag.position()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-comment"># record_video()</span><br>        camera()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    k = Thread(target=monitor_keyboard, args=())<br>    m = Thread(target=monitor_mouse, args=())<br>    k.start()<br>    m.start()<br>    k.join()<br>    m.join()<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç©</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>We Are SVIP</title>
    <link href="/2021/08/20/WeAreSVIP/"/>
    <url>/2021/08/20/WeAreSVIP/</url>
    
    <content type="html"><![CDATA[<h2 id="è–…å„å¤§å‚è§†é¢‘ç¾Šæ¯›"><a href="#è–…å„å¤§å‚è§†é¢‘ç¾Šæ¯›" class="headerlink" title="è–…å„å¤§å‚è§†é¢‘ç¾Šæ¯›"></a>è–…å„å¤§å‚è§†é¢‘ç¾Šæ¯›</h2><span id="more"></span><p>å‘¨æœ«äº†åˆå¯ä»¥è¿½å‰§äº†ï¼Œæœ€è¿‘åœ¨çœ‹æ‰«é»‘é£æš´ï¼Œä½†æ˜¯å§ï¼Œç°åœ¨å„å¤§è§†é¢‘ç½‘ç«™éƒ½æ˜¯éœ€è¦VIPæ‰èƒ½çœ‹ï¼Œæœ‰çš„ç”šè‡³æ›´å¯æ¶ï¼Œè¿˜è¦è¶…å‰ç‚¹æ’­ã€‚è¿™å˜´è„¸çœŸçš„æ˜¯ç©·å‡¶ææ¶ã€‚éƒ½æ˜¯å¤§å‚äº†ï¼Œè¯´å¥½çš„å›æŠ¥ç¤¾ä¼šå‘¢ï¼Œï¼Œï¼Œå°±è¿™æ ·å›æŠ¥ç¤¾ä¼šå‘¢ã€‚äººå®¶ï¼ˆæˆ‘æ²¡æœ‰ï¼‰éƒ½å·²ç»å¿ç—›è´­ä¹°ä½ çš„VIPäº†ï¼Œè¿˜ä¸æ»¡è¶³ã€‚ç®—äº†ï¼Œä½ æœ‰å¼ è‰¯è®¡ï¼Œæˆ‘æœ‰è¿‡å¢™æ¢¯ã€‚<br>ä»Šå¤©å°±ç»™å¤§å®¶åˆ†äº«ä¸ªå¯ä»¥è–…ä»–ä»¬VIPçš„æ’ä»¶â€”â€”æ²¹çŒ´ï¼Œç¡®åˆ‡çš„è¯´æ˜¯å„è·¯å¤§ç¥å¼€å‘çš„è„šæœ¬ï¼Œæ²¹çŒ´åªæ˜¯ä¸ªè„šæœ¬ç®¡å®¶ã€‚å¦‚æœèƒ½ä¸Šgoogleçš„è¯å°±æ–¹ä¾¿å¾ˆå¤šï¼Œç›´æ¥æœç´¢æ²¹çŒ´æ’ä»¶è¿›è¡Œå®‰è£…ã€‚ä½†æ˜¯å›½å†…å§ï¼Œï¼Œï¼Œï¼Œå¯èƒ½å¾ˆå¤šäººéƒ½æ— æ³•ä¸Šè°·æ­Œã€‚è¿™é‡Œå°±ä»‹ç»ä¸‹æœ¬åœ°å®‰è£…æ²¹çŒ´æ’ä»¶çš„æ–¹æ³•ã€‚</p><h5 id="No-1"><a href="#No-1" class="headerlink" title="No.1"></a>No.1</h5><p>é¦–å…ˆå…ˆä¸‹è½½ä¸‹æ²¹çŒ´ï¼Œé“¾æ¥åœ¨æ­¤ï¼š<a href="https://pan.baidu.com/s/1FQZBBjqr2s8f-9idizxI6w">https://pan.baidu.com/s/1FQZBBjqr2s8f-9idizxI6w</a> ;æå–ç ï¼š<span  style="color: #519D9E; ">8fmu</span><br>ä¸‹è½½å®Œæˆåç›´æ¥è§£å‹åˆ°è¯¥æ–‡ä»¶å¤¹ã€‚<br>ç„¶åæ‰“å¼€æˆ‘ä»¬çš„è°·æ­Œæµè§ˆå™¨ï¼Œåœ¨æœç´¢åœ°å€æ è¾“å…¥ï¼š<span  style="color: #519D9E; ">chrome://extensions/</span>ï¼Œè¿›å…¥æ‰©å±•ç¨‹åºç•Œé¢ï¼Œ<span  style="color: #519D9E; ">æ‰“å¼€å³ä¸Šè§’çš„å¼€å‘è€…æ¨¡å¼</span>ã€‚æ¥ç€é€‰æ‹©<span  style="color: #519D9E; ">å·¦ä¸Šè§’çš„åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº</span>ï¼Œç„¶åé€‰æ‹©æˆ‘ä»¬åˆšåˆšè§£å‹è¿‡çš„æ²¹çŒ´çš„ç›®å½•å³å¯ï¼Œåˆ°è¿™é‡Œæ²¹çŒ´æ’ä»¶å°±å®Œæˆäº†ã€‚æ¥ä¸‹æ¥å°±æ˜¯å®‰è£…è„šæœ¬äº†ã€‚</p><h5 id="No-2"><a href="#No-2" class="headerlink" title="No.2"></a>No.2</h5><p>ç„¶åè¿›å…¥è¿™ä¸ªç½‘ç«™ï¼š<a href="https://greasyfork.org/zh-CN">https://greasyfork.org/zh-CN</a> ï¼Œæœç´¢VIPï¼Œä¼šå‡ºç°å¾ˆå¤šä¸ªè„šæœ¬ï¼Œè‡ªè¡Œé€‰æ‹©å°±å¥½ã€‚æˆ‘é€‰æ‹©çš„æ˜¯ <a href="https://greasyfork.org/zh-CN/scripts/370634-%E6%87%92%E4%BA%BA%E4%B8%93%E7%94%A8-%E5%85%A8%E7%BD%91vip%E8%A7%86%E9%A2%91%E5%85%8D%E8%B4%B9%E7%A0%B4%E8%A7%A3%E5%8E%BB%E5%B9%BF%E5%91%8A-%E5%85%A8%E7%BD%91%E9%9F%B3%E4%B9%90%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD-%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD%E7%AD%89%E5%A4%9A%E5%90%88%E4%B8%80%E7%89%88-%E9%95%BF%E6%9C%9F%E6%9B%B4%E6%96%B0-%E6%94%BE%E5%BF%83%E4%BD%BF%E7%94%A8">https://greasyfork.org/zh-CN/scripts/370634-%E6%87%92%E4%BA%BA%E4%B8%93%E7%94%A8-%E5%85%A8%E7%BD%91vip%E8%A7%86%E9%A2%91%E5%85%8D%E8%B4%B9%E7%A0%B4%E8%A7%A3%E5%8E%BB%E5%B9%BF%E5%91%8A-%E5%85%A8%E7%BD%91%E9%9F%B3%E4%B9%90%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD-%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD%E7%AD%89%E5%A4%9A%E5%90%88%E4%B8%80%E7%89%88-%E9%95%BF%E6%9C%9F%E6%9B%B4%E6%96%B0-%E6%94%BE%E5%BF%83%E4%BD%BF%E7%94%A8</a> è¿™ä¸ªï¼Œè§‰å¾—è¿˜æ˜¯æ¯”è¾ƒå¥½ç”¨çš„ã€‚ä¹‹åç‚¹å‡»å®‰è£…å°±å¤§åŠŸå‘Šæˆå•¦ã€‚</p><h4 id="No-3"><a href="#No-3" class="headerlink" title="No.3"></a>No.3</h4><p>åˆ©å™¨æœ‰äº†ï¼Œå°±å¯ä»¥å»å„å¤§è§†é¢‘ç½‘ç«™è–…ä¸€æ³¢äº†ï¼Œè¶…å‰ç‚¹æ’­ä¹Ÿå¯ä»¥è–…å“¦ã€‚æ²¹çŒ´è¿™ä¸ªæ’ä»¶åŠå…¶è„šæœ¬çš„åŠŸèƒ½ä¸ä»…é™äºæ­¤ï¼Œæœ‰å…´è¶£å¯ä»¥è‡ªè¡Œæ‘¸ç´¢ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>TroubleShoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è–…ç¾Šæ¯›</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ°´ä¸€ç¯‡</title>
    <link href="/2021/08/20/%E6%B0%B4%E4%B8%80%E7%AF%87/"/>
    <url>/2021/08/20/%E6%B0%B4%E4%B8%80%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<h2 id="å¦‚é¢˜"><a href="#å¦‚é¢˜" class="headerlink" title="å¦‚é¢˜"></a>å¦‚é¢˜</h2><span id="more"></span><p>è™½ç„¶å‚ç…§è¿™ç¯‡æ–‡ç« è®¾ç½®äº†ï¼Œä½†è¿˜æ˜¯ç«™ç‚¹åœ°å›¾æ˜¾ç¤ºæ— æ³•è·å–ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯æ—¶é—´çš„é—®é¢˜ï¼Œç­‰ç­‰å§ã€‚</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment">## åˆ›å»ºsitemap.xml</span><br>npm install hexo-generator-sitemap <span class="hljs-comment">--save</span><br></code></pre></td></tr></table></figure><iframe src="https://www.gongsunqi.xyz/2021/08/14/%E8%AE%A9%E8%87%AA%E5%B7%B1%E9%80%9A%E8%BF%87Hexo%E5%BB%BA%E7%AB%8B%E7%9A%84%E5%8D%9A%E5%AE%A2%E8%A2%AB%E8%B0%B7%E6%AD%8C%E6%90%9C%E7%B4%A2%E5%88%B0/" width="100%" height="500" name="topFrame" scrolling="yes"  noresize="noresize" frameborder="0" id="topFrame"></iframe>]]></content>
    
    
    <categories>
      
      <category>Working</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åˆ’æ°´æ‘¸é±¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Trouble No Shoot</title>
    <link href="/2021/08/20/TroubleNoShoot/"/>
    <url>/2021/08/20/TroubleNoShoot/</url>
    
    <content type="html"><![CDATA[<h2 id="å‡çº§hexoé‡åˆ°çš„é—®é¢˜"><a href="#å‡çº§hexoé‡åˆ°çš„é—®é¢˜" class="headerlink" title="å‡çº§hexoé‡åˆ°çš„é—®é¢˜"></a>å‡çº§hexoé‡åˆ°çš„é—®é¢˜</h2><span id="more"></span><p>hexoçš„ä¸€ä¸ªæ’ä»¶éœ€è¦5.0ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œçœ‹äº†ä¸‹è‡ªå·±å®‰è£…çš„æ˜¯4.3çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥æƒ³ç€å‡çº§ä¸€ä¸‹ã€‚æŸ¥äº†åŠå¤©ä¹Ÿæ²¡æ‰¾åˆ°æœ‰æ•ˆçš„æ–¹æ³•ã€‚ä¹‹ååˆæŸ¥çœ‹äº†nodeçš„ç‰ˆæœ¬çœ‹ç€ä¹Ÿå¾ˆä½ï¼Œæƒ³å‡çº§çš„å¿ƒåˆæ¥äº†ã€‚æŠ˜è…¾äº†åŠå¤©æ„£æ˜¯æ²¡å‡çº§æˆåŠŸï¼Œè¿˜æŠŠç³»ç»Ÿæåäº†ï¼Œaptã€dpkgè¿™äº›ä¹Ÿéƒ½æ²¡æ³•ç”¨äº†ã€‚ç½‘ä¸Šçš„èµ„æ–™æœ‰æ—¶å€™ä¹Ÿä¸èƒ½ç›²ç›®è·Ÿç€åšï¼Œè¿˜æ˜¯ç”¨rootè´¦æˆ·åˆ çš„ï¼ŒçœŸæ˜¯ç»†æ€ææï¼Œè¿™è¦æ˜¯å…¬å¸çš„ç”Ÿäº§ç¯å¢ƒï¼Œè¿™ä¼°è®¡æ˜¯è¦è¢«ç¥­å¤©çš„ã€‚ä¼°è®¡æˆ‘ä¹Ÿæ˜¯ä»—ç€è¿™æ˜¯è‡ªå·±ç”µè„‘é‡Œçš„å­ç³»ç»Ÿæ‰æ•¢è¿™ä¹ˆèƒ¡ä½œéä¸ºã€‚ç³»ç»Ÿåäº†ï¼Œæœ¬æ¥æƒ³æŒ½æ•‘ä¸€ä¸‹çš„ï¼Œå‘ç°è¶ŠæŒ½æ•‘é—®é¢˜è¶Šå¤§ã€‚é¡ºæ”¾å¼ƒã€‚ã€‚ã€‚äºæ˜¯é‡æ–°å¸è½½Linuxå­ç³»ç»Ÿï¼Œå†é‡æ–°å®‰è£…ï¼Œå‰åæ²¡èŠ±10åˆ†é’Ÿã€‚æœç„¶è¿˜æ˜¯å¾®è½¯babaçš„å­ç³»ç»Ÿå®‰è£…å¸è½½æ–¹ä¾¿å•Šã€‚<br>ç³»ç»Ÿé‡æ–°å®‰è£…äº†ï¼Œå¾ˆå¤šä¸œè¥¿å°±è¦é‡æ–°é…ç½®ï¼Œæ¯”å¦‚githubçš„å…å¯†æäº¤ç­‰ï¼Œè¿™é‡Œä¹Ÿç®€å•è®°å½•ä¸‹ã€‚</p><h5 id="é¦–å…ˆé…ç½®githubåŠç”Ÿæˆsshç§˜é’¥ï¼Œæ‰§è¡Œ"><a href="#é¦–å…ˆé…ç½®githubåŠç”Ÿæˆsshç§˜é’¥ï¼Œæ‰§è¡Œ" class="headerlink" title="é¦–å…ˆé…ç½®githubåŠç”Ÿæˆsshç§˜é’¥ï¼Œæ‰§è¡Œ"></a>é¦–å…ˆé…ç½®githubåŠç”Ÿæˆsshç§˜é’¥ï¼Œæ‰§è¡Œ</h5><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs verilog">git <span class="hljs-keyword">config</span> --<span class="hljs-keyword">global</span> user<span class="hljs-variable">.email</span> <span class="hljs-string">&quot;you@example.com&quot;</span>    ## æˆ‘çš„ git <span class="hljs-keyword">config</span> --<span class="hljs-keyword">global</span> user<span class="hljs-variable">.email</span> <span class="hljs-string">&quot;jrwjb@sina.com&quot;</span>   <br>git <span class="hljs-keyword">config</span> --<span class="hljs-keyword">global</span> user<span class="hljs-variable">.name</span> <span class="hljs-string">&quot;Your Name&quot;</span>  ## æˆ‘çš„ git <span class="hljs-keyword">config</span> --<span class="hljs-keyword">global</span> user<span class="hljs-variable">.name</span> <span class="hljs-string">&quot;shubihu&quot;</span><br>ssh-keygen        ## ä¸€è·¯å›è½¦å³å¯<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œåä¼šåœ¨å®¶ç›®å½•çš„.sshä¸‹ç”Ÿæˆä¸‹é¢å‡ ä¸ªæ–‡ä»¶</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs clean">id_rsa   ## ç§é’¥<br>id_rsa.pub  ## å…±é’¥<br></code></pre></td></tr></table></figure><p>ç„¶åæŠŠå…¬é’¥çš„å†…å®¹æ·»åŠ åˆ°githubä¸Šå³å¯ã€‚<br><img src="/img/article/gitssh.jpg"></p><h5 id="å›åˆ°æœ€å¼€å§‹çš„é—®é¢˜ï¼Œå‡çº§hexoã€nodeã€‚"><a href="#å›åˆ°æœ€å¼€å§‹çš„é—®é¢˜ï¼Œå‡çº§hexoã€nodeã€‚" class="headerlink" title="å›åˆ°æœ€å¼€å§‹çš„é—®é¢˜ï¼Œå‡çº§hexoã€nodeã€‚"></a>å›åˆ°æœ€å¼€å§‹çš„é—®é¢˜ï¼Œå‡çº§hexoã€nodeã€‚</h5><p>å› ä¸ºæ˜¯æ–°ç³»ç»Ÿï¼Œæ‰€ä»¥ç›¸å¯¹ç®€å•äº›ï¼Œç›´æ¥å®‰è£…æ–°ç‰ˆçš„nodeï¼Œå¯ä»¥ä»å®˜ç½‘ä¸‹è½½æœ€æ–°çš„ç¨³å®šç‰ˆè¿›è¡Œå®‰è£…ï¼Œä¸è¿‡æˆ‘å«Œéº»çƒ¦æ‡’å¾—å»ä¸‹è½½ï¼Œæ‰€ä»¥å‚è€ƒäº†è¿™ç¯‡æ–‡ç« è¿›è¡Œå®‰è£…ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">## ä½¿ç”¨nvmè¿›è¡Œå®‰è£…</span><br>curl -o- https:<span class="hljs-regexp">//</span>raw.githubusercontent.com<span class="hljs-regexp">/nvm-sh/</span>nvm<span class="hljs-regexp">/v0.35.3/i</span>nstall.sh | bash<br>nvm install node<br></code></pre></td></tr></table></figure><!-- <iframe src="https://www.myfreax.com/how-to-install-node-js-on-ubuntu-18-04/" width="100%" height="500" name="topFrame" scrolling="yes"  noresize="noresize" frameborder="0" id="topFrame"></iframe> --><h5 id="æœ€åæ˜¯å‡çº§hexo"><a href="#æœ€åæ˜¯å‡çº§hexo" class="headerlink" title="æœ€åæ˜¯å‡çº§hexo"></a>æœ€åæ˜¯å‡çº§hexo</h5><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-comment"># ä½¿ç”¨æ·˜å®æºçš„ cnpm æ›¿æ¢ npm</span><br><span class="hljs-built_in">npm</span> install -g cnpm --registry=https://registry.<span class="hljs-built_in">npm</span>.taobao.org<br><br>cnpm install -g cnpm                 <span class="hljs-comment"># å‡çº§ npm</span><br>cnpm cache clean -f                 <span class="hljs-comment"># æ¸…é™¤ npm ç¼“å­˜</span><br><br>===æ›´æ–° hexo: è¿›å…¥ blog ç›®å½•ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤=== <br><span class="hljs-comment"># æ›´æ–° package.json ä¸­çš„ hexo åŠä¸ªæ’ä»¶ç‰ˆæœ¬</span><br>cnpm install -g <span class="hljs-built_in">npm</span>-check           <span class="hljs-comment"># æ£€æŸ¥ä¹‹å‰å®‰è£…çš„æ’ä»¶ï¼Œéƒ½æœ‰å“ªäº›æ˜¯å¯ä»¥å‡çº§çš„ </span><br>cnpm install -g <span class="hljs-built_in">npm</span>-upgrade         <span class="hljs-comment"># å‡çº§ç³»ç»Ÿä¸­çš„æ’ä»¶</span><br><span class="hljs-built_in">npm</span>-check<br><span class="hljs-built_in">npm</span>-upgrade<br><br><span class="hljs-comment"># æ›´æ–° hexo åŠæ‰€æœ‰æ’ä»¶</span><br>cnpm update<br><br><span class="hljs-comment"># ç¡®è®¤ hexo å·²ç»æ›´æ–°</span><br>hexo -v<br></code></pre></td></tr></table></figure><!-- <iframe src="https://xmuli.tech/posts/cb1e6c4f/" width="100%" height="500" name="topFrame" scrolling="yes"  noresize="noresize" frameborder="0" id="topFrame"></iframe> --><p>å‚è€ƒ</p><ul><li><a href="https://xmuli.tech/posts/cb1e6c4f">https://xmuli.tech/posts/cb1e6c4f</a></li><li><a href="https://www.myfreax.com/how-to-install-node-js-on-ubuntu-18-04">https://www.myfreax.com/how-to-install-node-js-on-ubuntu-18-04</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>TroubleShoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>TroubleShoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python Sort Algorithm</title>
    <link href="/2021/08/16/PythonSortAlgorithm/"/>
    <url>/2021/08/16/PythonSortAlgorithm/</url>
    
    <content type="html"><![CDATA[<h2 id="Pythonå¸¸ç”¨æ’åºç®—æ³•"><a href="#Pythonå¸¸ç”¨æ’åºç®—æ³•" class="headerlink" title="Pythonå¸¸ç”¨æ’åºç®—æ³•"></a>Pythonå¸¸ç”¨æ’åºç®—æ³•</h2><span id="more"></span><h5 id="å¿«é€Ÿæ’åº"><a href="#å¿«é€Ÿæ’åº" class="headerlink" title="å¿«é€Ÿæ’åº"></a>å¿«é€Ÿæ’åº</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">def quick_sort(<span class="hljs-keyword">array</span>):<br>    if len(<span class="hljs-keyword">array</span>) <span class="hljs-operator">&lt;=</span> <span class="hljs-number">1</span>:  # é€’å½’è·³å‡ºæ¡ä»¶<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">array</span><br>    pivot <span class="hljs-operator">=</span> <span class="hljs-keyword">array</span>[<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">left</span> <span class="hljs-operator">=</span> [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-keyword">array</span>[<span class="hljs-number">1</span>:] if i <span class="hljs-operator">&lt;</span> pivot]<br>    <span class="hljs-keyword">right</span> <span class="hljs-operator">=</span> [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-keyword">array</span>[<span class="hljs-number">1</span>:] if i <span class="hljs-operator">&gt;=</span> pivot]<br>    <span class="hljs-keyword">return</span> quick_sort(<span class="hljs-keyword">left</span>) <span class="hljs-operator">+</span> [pivot] <span class="hljs-operator">+</span> quick_sort(<span class="hljs-keyword">right</span>)<br></code></pre></td></tr></table></figure><h5 id="å†’æ³¡æ’åº"><a href="#å†’æ³¡æ’åº" class="headerlink" title="å†’æ³¡æ’åº"></a>å†’æ³¡æ’åº</h5><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sas">def bubble_sort(<span class="hljs-meta">array</span>):<br>    for i <span class="hljs-meta">in</span><span class="hljs-meta"> range(</span>l<span class="hljs-meta">en(</span><span class="hljs-meta">array</span>) - 1):<br>        for j <span class="hljs-meta">in</span><span class="hljs-meta"> range(</span>l<span class="hljs-meta">en(</span><span class="hljs-meta">array</span>) - i -1): # å·²æ’åºå¥½çš„éƒ¨åˆ†ä¸éœ€å†éå†<br>            <span class="hljs-meta">if</span> <span class="hljs-meta">array</span>[j] &gt; <span class="hljs-meta">array</span>[j+1]:<br>                <span class="hljs-meta">array</span>[j], <span class="hljs-meta">array</span>[j+1] = <span class="hljs-meta">array</span>[j+1], <span class="hljs-meta">array</span>[j]<br>    <span class="hljs-meta">return</span> <span class="hljs-meta">array</span><br></code></pre></td></tr></table></figure><h5 id="æ¡¶æ’"><a href="#æ¡¶æ’" class="headerlink" title="æ¡¶æ’"></a>æ¡¶æ’</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql">def bucker_sort(<span class="hljs-keyword">array</span>):<br>    <span class="hljs-keyword">result</span> <span class="hljs-operator">=</span> []<br>    minVal, maxVal <span class="hljs-operator">=</span> <span class="hljs-built_in">min</span>(<span class="hljs-keyword">array</span>), <span class="hljs-built_in">max</span>(<span class="hljs-keyword">array</span>)<br>    bucket <span class="hljs-operator">=</span> [<span class="hljs-number">0</span>] <span class="hljs-operator">*</span> (maxVal <span class="hljs-operator">-</span> minVal <span class="hljs-operator">+</span> <span class="hljs-number">1</span>)  # æ‰€éœ€çš„æ¡¶æ•°<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-keyword">array</span>:<br>        bucket[i <span class="hljs-operator">-</span> minVal] <span class="hljs-operator">+</span><span class="hljs-operator">=</span> <span class="hljs-number">1</span>     # æ¯ä¸ªæ•°å­—å‡ºç°çš„æ¬¡æ•°<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-keyword">range</span>(len(bucket)):<br>        if bucket[i]:<br>            <span class="hljs-keyword">result</span> <span class="hljs-operator">+</span><span class="hljs-operator">=</span> [i <span class="hljs-operator">+</span> minVal] <span class="hljs-operator">*</span> bucket[i]<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">result</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux One Line Command</title>
    <link href="/2021/08/13/OneLineCommand/"/>
    <url>/2021/08/13/OneLineCommand/</url>
    
    <content type="html"><![CDATA[<h2 id="Linux-å¸¸ç”¨å‘½ä»¤"><a href="#Linux-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="Linux å¸¸ç”¨å‘½ä»¤"></a>Linux å¸¸ç”¨å‘½ä»¤</h2><span id="more"></span><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs clean">sh -n ##åˆ¤æ–­æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯<br>sh -x ##æ‰§è¡Œè¯¦ç»†è¿‡ç¨‹<br>## ä¿®æ”¹ç›®å½•é¢œè‰²<br>dircolors -p &gt; ~/.dircolors   ## ç¼–è¾‘ ~/.dircolors ä¿®æ”¹<br>## å¿½ç•¥å¤§å°å†™<br>echo <span class="hljs-string">&#x27;set completion-ignore-case on&#x27;</span> &gt; ~/.inputrc<br></code></pre></td></tr></table></figure><h5 id="Linux-ä¸¤ä¸ªæ–‡ä»¶æ±‚äº¤é›†ã€å¹¶é›†ã€å·®é›†"><a href="#Linux-ä¸¤ä¸ªæ–‡ä»¶æ±‚äº¤é›†ã€å¹¶é›†ã€å·®é›†" class="headerlink" title="Linux ä¸¤ä¸ªæ–‡ä»¶æ±‚äº¤é›†ã€å¹¶é›†ã€å·®é›†"></a>Linux ä¸¤ä¸ªæ–‡ä»¶æ±‚äº¤é›†ã€å¹¶é›†ã€å·®é›†</h5><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-built_in">sort</span> <span class="hljs-keyword">a</span>.txt b.txt | uniq -d   <span class="hljs-comment">### äº¤é›†</span><br><span class="hljs-built_in">sort</span> <span class="hljs-keyword">a</span>.txt b.txt | uniq   <span class="hljs-comment">###å¹¶é›† </span><br><span class="hljs-built_in">sort</span> <span class="hljs-keyword">a</span>.txt b.txt b.txt | uniq -u  <span class="hljs-comment">## å·®é›† a-b</span><br><span class="hljs-built_in">sort</span> b.txt <span class="hljs-keyword">a</span>.txt <span class="hljs-keyword">a</span>.txt | uniq -u  <span class="hljs-comment">## å·®é›† b-a</span><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨sortå¯ä»¥å°†æ–‡ä»¶è¿›è¡Œæ’åºï¼Œå¯ä»¥ä½¿ç”¨sortåé¢çš„ç²ç²ï¼Œä¾‹å¦‚ -n æŒ‰ç…§æ•°å­—æ ¼å¼æ’åºï¼Œä¾‹å¦‚ -i å¿½ç•¥å¤§å°å†™ï¼Œä¾‹å¦‚ä½¿ç”¨-r ä¸ºé€†åºè¾“å‡ºç­‰<br>uniqä¸ºåˆ é™¤æ–‡ä»¶ä¸­é‡å¤çš„è¡Œï¼Œå¾—åˆ°æ–‡ä»¶ä¸­å”¯ä¸€çš„è¡Œï¼Œåé¢çš„å‘½ä»¤ -d è¡¨ç¤ºçš„æ˜¯è¾“å‡ºå‡ºç°æ¬¡æ•°å¤§äº1çš„å†…å®¹ -uè¡¨ç¤ºçš„æ˜¯è¾“å‡ºå‡ºç°æ¬¡æ•°ä¸º1çš„å†…å®¹ï¼Œé‚£ä¹ˆå¯¹äºä¸Šè¿°çš„æ±‚äº¤é›†å¹¶é›†å·®é›†çš„å‘½ä»¤åšå¦‚ä¸‹çš„è§£é‡Šï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">sort</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.txt</span> <span class="hljs-selector-tag">b</span><span class="hljs-selector-class">.txt</span> | <span class="hljs-selector-tag">uniq</span> <span class="hljs-selector-tag">-d</span> #å°†<span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.txt</span> <span class="hljs-selector-tag">b</span><span class="hljs-selector-class">.txt</span>æ–‡ä»¶è¿›è¡Œæ’åºï¼Œ<span class="hljs-selector-tag">uniq</span>ä½¿å¾—ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹ä¸ºå”¯ä¸€çš„ï¼Œä½¿ç”¨<span class="hljs-selector-tag">-d</span>è¾“å‡ºä¸¤ä¸ªæ–‡ä»¶ä¸­æ¬¡æ•°å¤§äº<span class="hljs-selector-tag">1</span>çš„å†…å®¹ï¼Œå³æ˜¯å¾—åˆ°äº¤é›†<br><span class="hljs-selector-tag">sort</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.txt</span> <span class="hljs-selector-tag">b</span><span class="hljs-selector-class">.txt</span> | <span class="hljs-selector-tag">uniq</span>  #å°†<span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.txt</span> <span class="hljs-selector-tag">b</span><span class="hljs-selector-class">.txt</span>æ–‡ä»¶è¿›è¡Œæ’åºï¼Œ<span class="hljs-selector-tag">uniq</span>ä½¿å¾—ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹ä¸ºå”¯ä¸€çš„ï¼Œå³å¯å¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶çš„å¹¶é›†<br><span class="hljs-selector-tag">sort</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.txt</span> <span class="hljs-selector-tag">b</span><span class="hljs-selector-class">.txt</span> <span class="hljs-selector-tag">b</span><span class="hljs-selector-class">.txt</span> | <span class="hljs-selector-tag">uniq</span> <span class="hljs-selector-tag">-u</span> #å°†ä¸¤ä¸ªæ–‡ä»¶æ’åºï¼Œæœ€åè¾“å‡º<span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.txt</span> <span class="hljs-selector-tag">b</span><span class="hljs-selector-class">.txt</span> <span class="hljs-selector-tag">b</span><span class="hljs-selector-class">.txt</span>æ–‡ä»¶ä¸­åªå‡ºç°è¿‡ä¸€æ¬¡çš„å†…å®¹ï¼Œå› ä¸ºæœ‰ä¸¤ä¸ª<span class="hljs-selector-tag">b</span><span class="hljs-selector-class">.txt</span>æ‰€ä»¥åªä¼šè¾“å‡ºåªåœ¨<span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.txt</span>å‡ºç°è¿‡ä¸€æ¬¡çš„å†…å®¹ï¼Œå³æ˜¯<span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.txt-b</span><span class="hljs-selector-class">.txt</span>å·®é›†<br>#å¯¹äº<span class="hljs-selector-tag">b</span><span class="hljs-selector-class">.txt-a</span><span class="hljs-selector-class">.txt</span>ä¸ºåŒç†<br></code></pre></td></tr></table></figure><h5 id="grep-å‘½ä»¤æ˜¯å¸¸ç”¨çš„æœç´¢æ–‡æœ¬å†…å®¹çš„ï¼Œè¦æ‰¾äº¤é›†ï¼Œå¦‚ä¸‹å³å¯ï¼š"><a href="#grep-å‘½ä»¤æ˜¯å¸¸ç”¨çš„æœç´¢æ–‡æœ¬å†…å®¹çš„ï¼Œè¦æ‰¾äº¤é›†ï¼Œå¦‚ä¸‹å³å¯ï¼š" class="headerlink" title="grep å‘½ä»¤æ˜¯å¸¸ç”¨çš„æœç´¢æ–‡æœ¬å†…å®¹çš„ï¼Œè¦æ‰¾äº¤é›†ï¼Œå¦‚ä¸‹å³å¯ï¼š"></a>grep å‘½ä»¤æ˜¯å¸¸ç”¨çš„æœç´¢æ–‡æœ¬å†…å®¹çš„ï¼Œè¦æ‰¾äº¤é›†ï¼Œå¦‚ä¸‹å³å¯ï¼š</h5><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">grep <span class="hljs-operator">-F</span> <span class="hljs-operator">-f</span> a.txt b.txt | <span class="hljs-built_in">sort</span> | uniq<br></code></pre></td></tr></table></figure><h5 id="å·®é›†"><a href="#å·®é›†" class="headerlink" title="å·®é›†:"></a>å·®é›†:</h5><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">grep -F -v -f <span class="hljs-keyword">a</span>.txt b.txt | <span class="hljs-built_in">sort</span> | uniq<br>grep -F -v -f b.txt <span class="hljs-keyword">a</span>.txt | <span class="hljs-built_in">sort</span> | uniq<br><span class="hljs-comment">#ç¬¬ä¸€è¡Œç»“æœä¸ºb-aï¼›ç¬¬äºŒè¡Œä¸ºa-bã€‚æ³¨æ„é¡ºåºå¾ˆé‡è¦</span><br></code></pre></td></tr></table></figure><h5 id="æ ¹æ®idæå–fastq"><a href="#æ ¹æ®idæå–fastq" class="headerlink" title="æ ¹æ®idæå–fastq"></a>æ ¹æ®idæå–fastq</h5><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clean">grep -f id -A <span class="hljs-number">3</span> BC01.fq &gt; test.fq   ### -f å‚æ•°ä¸ºIDæ–‡ä»¶<br></code></pre></td></tr></table></figure><h5 id="æ‰¹é‡é‡å‘½åæ–‡ä»¶"><a href="#æ‰¹é‡é‡å‘½åæ–‡ä»¶" class="headerlink" title="æ‰¹é‡é‡å‘½åæ–‡ä»¶"></a>æ‰¹é‡é‡å‘½åæ–‡ä»¶</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#åªæ›´æ”¹æˆ·åç¼€</span><br>rename <span class="hljs-string">&#x27;s/.txt/.log/&#x27;</span> *.txt   <span class="hljs-comment">#### æŠŠtxtåç¼€æ”¹ä¸ºlog</span><br><span class="hljs-comment">#å°å†™å˜å¤§å†™</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `ls`;<span class="hljs-keyword">do</span> mv -f <span class="hljs-variable">$i</span> `<span class="hljs-built_in">echo</span> <span class="hljs-variable">$i</span> | tr a-z A-Z`;<span class="hljs-keyword">done</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `ls`;<span class="hljs-keyword">do</span> mv -f <span class="hljs-variable">$i</span> `<span class="hljs-built_in">echo</span> <span class="hljs-variable">$i</span> | sed <span class="hljs-string">&#x27;s/..../..../&#x27;</span>`;<span class="hljs-keyword">done</span>  <span class="hljs-comment">##ä½¿ç”¨sedæ›¿æ¢q</span><br>rename <span class="hljs-string">&#x27;s/small/large/&#x27;</span> image_*.png<br></code></pre></td></tr></table></figure><h5 id="åˆ é™¤ç©ºè¡Œ"><a href="#åˆ é™¤ç©ºè¡Œ" class="headerlink" title="åˆ é™¤ç©ºè¡Œ"></a>åˆ é™¤ç©ºè¡Œ</h5><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs vim">sed -i <span class="hljs-string">&#x27;/^$/d&#x27;</span> <span class="hljs-keyword">file</span><br><span class="hljs-keyword">grep</span> -v <span class="hljs-string">&#x27;^$&#x27;</span> <span class="hljs-keyword">file</span>   æˆ–  sed <span class="hljs-string">&#x27;/^$/d&#x27;</span> <span class="hljs-keyword">file</span> æˆ– sed -n <span class="hljs-string">&#x27;/./p&#x27;</span> <span class="hljs-keyword">file</span><br>awk <span class="hljs-string">&#x27;/./&#123;print&#125;&#x27;</span> <span class="hljs-keyword">file</span> æˆ–  <span class="hljs-keyword">tr</span> -s <span class="hljs-string">&#x27;n&#x27;</span><br>#åˆ é™¤æœ€åä¸€åˆ—<br>sed -r -<span class="hljs-keyword">e</span> <span class="hljs-string">&#x27;s/\t[^\t]*$//g&#x27;</span> <span class="hljs-keyword">file</span>   <br></code></pre></td></tr></table></figure><h5 id="ç»Ÿè®¡æ–‡ä»¶å¤§å°"><a href="#ç»Ÿè®¡æ–‡ä»¶å¤§å°" class="headerlink" title="ç»Ÿè®¡æ–‡ä»¶å¤§å°"></a>ç»Ÿè®¡æ–‡ä»¶å¤§å°</h5><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim">du -<span class="hljs-keyword">sh</span> * æˆ–è€… du -h --<span class="hljs-built_in">max</span>-depth=<span class="hljs-number">1</span>  æˆ– du -<span class="hljs-keyword">sh</span> * | <span class="hljs-keyword">grep</span> [GM] | <span class="hljs-keyword">sort</span> æå–G å’Œ Mçš„æ–‡ä»¶å¹¶æ’åº<br></code></pre></td></tr></table></figure><h5 id="è®¡ç®—readsæ•°"><a href="#è®¡ç®—readsæ•°" class="headerlink" title="è®¡ç®—readsæ•°"></a>è®¡ç®—readsæ•°</h5><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">expr <span class="hljs-constructor">$(<span class="hljs-params">wc</span> -<span class="hljs-params">l</span> &lt; <span class="hljs-operator">*</span>.<span class="hljs-params">fastq</span>)</span><span class="hljs-operator"> / </span><span class="hljs-number">4</span><br>expr <span class="hljs-constructor">$(<span class="hljs-params">zcat</span> <span class="hljs-params">test</span><span class="hljs-operator">/</span>1.R1.<span class="hljs-params">fq</span>.<span class="hljs-params">gz</span> | <span class="hljs-params">wc</span> -<span class="hljs-params">l</span>)</span><span class="hljs-operator"> / </span><span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><h5 id="fastq-è½¬-fasta"><a href="#fastq-è½¬-fasta" class="headerlink" title="fastq è½¬ fasta"></a>fastq è½¬ fasta</h5><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">awk</span> &#x27;&#123;if(NR%<span class="hljs-number">4</span> == <span class="hljs-number">1</span>)&#123;print <span class="hljs-string">&quot;&gt;&quot;</span> substr($<span class="hljs-number">0</span>, <span class="hljs-number">2</span>)&#125;&#125;&#123;if(NR%<span class="hljs-number">4</span> == <span class="hljs-number">2</span>)&#123;print&#125;&#125;&#x27; xx.fastq &gt;xx.fasta<br><span class="hljs-attribute">awk</span> &#x27;&#123;if(NR%<span class="hljs-number">4</span> == <span class="hljs-number">1</span>)&#123;print <span class="hljs-string">&quot;&gt;&quot;</span> <span class="hljs-string">&quot;&#x27;$j&#x27;&quot;</span><span class="hljs-string">&quot;_&quot;</span>NR&#125;&#125;&#123;if(NR%<span class="hljs-number">4</span> == <span class="hljs-number">2</span>)&#123;print&#125;&#125;&#x27;    #   <span class="hljs-string">&quot;&#x27;$j&#x27;&quot;</span> awkä¸­å¼•ç”¨å¤–éƒ¨å˜é‡<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sort</span> -k<span class="hljs-number">1</span>,<span class="hljs-number">1</span>V -k<span class="hljs-number">2</span>,<span class="hljs-number">2</span>n file   ## V å‚æ•°å¿½ç•¥ç¬¬ä¸€åˆ—ä¸­çš„æ–‡æœ¬æŒ‰æ•°å­—æ’åº<br><span class="hljs-attribute">awk</span> &#x27;$<span class="hljs-number">1</span> ~ /chr<span class="hljs-number">1</span>|chr<span class="hljs-number">3</span>/&#x27; file ## ç¬¬ä¸€åˆ—åŒ¹é…chr<span class="hljs-number">1</span>æˆ–chr<span class="hljs-number">3</span><br><span class="hljs-attribute">awk</span> &#x27;NR &gt; <span class="hljs-number">3</span>&#x27; file ## å–å‡ºç¬¬å››è¡Œä»¥å<br><span class="hljs-attribute">sed</span> -n &#x27;<span class="hljs-number">20</span>,<span class="hljs-number">50</span>p&#x27; file # å–å‡º<span class="hljs-number">20</span>åˆ°<span class="hljs-number">50</span>è¡Œ<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">paste</span> file<span class="hljs-number">1</span> file<span class="hljs-number">2</span>  # æ¨ªå‘æ‹¼æ¥æ–‡ä»¶ï¼Œæ‹¼æ¥å‰å¯ç”¨dos<span class="hljs-number">2</span>unixè½¬æ¢æ–‡ä»¶ç±»å‹<br></code></pre></td></tr></table></figure><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs clean"><span class="hljs-string">&#x27;%&#x27;</span> ä»åå‘å‰åˆ é™¤, <span class="hljs-string">&#x27;#&#x27;</span> ä»å‰å‘ååˆ é™¤<br>sed æ›¿æ¢æ¯è¡Œæœ€åä¸€ä¸ªåŒ¹é…çš„å­—ç¬¦<br>sed <span class="hljs-string">&#x27;s/\(.*\)src_str\(.*\)/\1dst_str\2/&#x27;</span>  yourfile   ##  src_strï¼šè¦åŒ¹é…çš„å­—ç¬¦  dst_str: è¦æ›¿æ¢çš„å­—ç¬¦<br></code></pre></td></tr></table></figure><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">biom</span>=<span class="hljs-variable">$&#123;i##*/&#125;</span>    <span class="hljs-comment">#è¿”å› / åçš„å­—ç¬¦</span><br><span class="hljs-attr">biom</span>=<span class="hljs-variable">$&#123;i%/*&#125;</span>     <span class="hljs-comment">#è¿”å›æœ€å / å‰çš„å­—ç¬¦</span><br></code></pre></td></tr></table></figure><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">ls -<span class="hljs-keyword">ld</span> åˆ—å‡ºæ–‡ä»¶å…¨è·¯å¾„<br></code></pre></td></tr></table></figure><h5 id="ä½¿ç”¨-wget-å®Œæˆæ‰¹é‡ä¸‹è½½"><a href="#ä½¿ç”¨-wget-å®Œæˆæ‰¹é‡ä¸‹è½½" class="headerlink" title="ä½¿ç”¨ wget å®Œæˆæ‰¹é‡ä¸‹è½½"></a>ä½¿ç”¨ wget å®Œæˆæ‰¹é‡ä¸‹è½½</h5><p>å¦‚æœæƒ³ä¸‹è½½ä¸€ä¸ªç½‘ç«™ä¸Šç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶, æˆ‘éœ€è¦æ‰§è¡Œä¸€é•¿ä¸²wgetå‘½ä»¤, ä½†è¿™æ ·åšä¼šæ›´å¥½:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">wget -nd -r -l1 --no-parent http:<span class="hljs-regexp">//</span>www.foo.com<span class="hljs-regexp">/mp3/</span><br></code></pre></td></tr></table></figure><p>è¿™æ¡å‘½ä»¤å¯ä»¥æ‰§è¡Œçš„å¾ˆå¥½, ä½†æœ‰æ—¶ä¼šä¸‹è½½åƒ index.@xx è¿™æ ·ä¸€äº›æˆ‘ä¸æƒ³è¦çš„æ–‡ä»¶. å¦‚æœä½ çŸ¥é“æƒ³è¦æ–‡ä»¶çš„æ ¼å¼, å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥é¿å…ä¸‹è½½é‚£äº›å¤šä½™çš„æ–‡ä»¶:</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">wget -nd -r -l1 --no-parent -<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">A</span>.</span></span>mp3 -<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">A</span>.</span></span>wma http:<span class="hljs-comment">//www.foo.com/mp3/</span><br></code></pre></td></tr></table></figure><p>æˆ‘æ¥ç®€å•çš„ä»‹ç»ä¸€ä¸‹å‘½ä»¤ä¸­æŒ‡å®šé€‰é¡¹çš„ä½œç”¨.<br>-nd ä¸åˆ›å»ºç›®å½•, wgeté»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ªç›®å½•<br>-r é€’å½’ä¸‹è½½<br>-l1 (L one) é€’å½’ä¸€å±‚,åªä¸‹è½½æŒ‡å®šæ–‡ä»¶å¤¹ä¸­çš„å†…å®¹, ä¸ä¸‹è½½ä¸‹ä¸€çº§ç›®å½•ä¸­çš„.<br>â€“no-parent ä¸ä¸‹è½½çˆ¶ç›®å½•ä¸­çš„æ–‡ä»¶</p><h5 id="rsyncå¯è§†åŒ–å¤åˆ¶æ–‡ä»¶æ—¶çš„è¿›åº¦"><a href="#rsyncå¯è§†åŒ–å¤åˆ¶æ–‡ä»¶æ—¶çš„è¿›åº¦" class="headerlink" title="rsyncå¯è§†åŒ–å¤åˆ¶æ–‡ä»¶æ—¶çš„è¿›åº¦"></a>rsyncå¯è§†åŒ–å¤åˆ¶æ–‡ä»¶æ—¶çš„è¿›åº¦</h5><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">rsync</span> -avPh æºæ–‡ä»¶ ç›®æ ‡æ–‡ä»¶<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çŸ¥ç½‘ç¾Šæ¯›</title>
    <link href="/2021/08/12/%E7%9F%A5%E7%BD%91%E7%BE%8A%E6%AF%9B/"/>
    <url>/2021/08/12/%E7%9F%A5%E7%BD%91%E7%BE%8A%E6%AF%9B/</url>
    
    <content type="html"><![CDATA[<h2 id="è–…ç¤¾ä¼šä¸»ä¹‰ç¾Šæ¯›-çŸ¥ç½‘"><a href="#è–…ç¤¾ä¼šä¸»ä¹‰ç¾Šæ¯›-çŸ¥ç½‘" class="headerlink" title="è–…ç¤¾ä¼šä¸»ä¹‰ç¾Šæ¯›-çŸ¥ç½‘"></a>è–…ç¤¾ä¼šä¸»ä¹‰ç¾Šæ¯›-çŸ¥ç½‘</h2><span id="more"></span><p>å·¥ä½œä¸­ç»å¸¸ä¼šå—åˆ°åŒäº‹ã€æœ‹å‹çš„æ±‚åŠ©å¸®å¿™ä¸‹è½½è®ºæ–‡ï¼Œä¸­æ–‡çš„ã€å¤–æ–‡çš„éƒ½é‡åˆ°è¿‡ã€‚å¤–æ–‡æ–‡çŒ®ä¸€èˆ¬éƒ½åœ¨Sci_hub(<a href="https://tool.yovisun.com/scihub/">https://tool.yovisun.com/scihub/</a>) ä¸ŠæŸ¥æ‰¾ï¼Œå½“ç„¶ä¹Ÿä¼šæœ‰äº›æ‰¾ä¸åˆ°ã€‚ä¸­æ–‡çš„æ–‡çŒ®è«è¿‡äºçŸ¥ç½‘äº†ï¼Œä½†æ˜¯çŸ¥ç½‘ä¹Ÿæ˜¯æ”¶è´¹æ¨¡å¼çš„ã€‚äºæ˜¯åœ¨ç½‘ä¸ŠæŒ–äº†ä¸‹ï¼Œæ‰¾åˆ°äº†ä¸¤ä¸‰ä¸ªç›¸å¯¹é è°±çš„å¯ä»¥è–…çŸ¥ç½‘ç¾Šæ¯›çš„æ–¹æ³•ï¼Œä½†æ˜¯ä¹Ÿæ˜¯æœ‰äº›é™åˆ¶çš„ã€‚</p><h5 id="iData-https-www-cn-ki-net"><a href="#iData-https-www-cn-ki-net" class="headerlink" title="iData(https://www.cn-ki.net/)"></a>iData(<a href="https://www.cn-ki.net/">https://www.cn-ki.net/</a>)</h5><p>ç›´æ¥æ³¨å†Œä¾¿å¯ä½¿ç”¨ï¼Œç¼ºç‚¹å°±æ˜¯æ¯å¤©åªèƒ½ä¸‹è½½å‡ ç¯‡å§</p><h5 id="80å›¾ä¹¦é¦†-å®˜ç½‘-http-www-80lib-com-çŸ¥ç½‘-http-www-80lib-com-cnki"><a href="#80å›¾ä¹¦é¦†-å®˜ç½‘-http-www-80lib-com-çŸ¥ç½‘-http-www-80lib-com-cnki" class="headerlink" title="80å›¾ä¹¦é¦†(å®˜ç½‘:http://www.80lib.com/ çŸ¥ç½‘:http://www.80lib.com/cnki/)"></a>80å›¾ä¹¦é¦†(å®˜ç½‘:<a href="http://www.80lib.com/">http://www.80lib.com/</a> çŸ¥ç½‘:<a href="http://www.80lib.com/cnki/">http://www.80lib.com/cnki/</a>)</h5><p>ä¼˜ç‚¹æ˜¯æ— é™ç¯‡ä¸‹è½½ï¼Œç¼ºç‚¹å°±æ˜¯åªæœ‰ä¸‰å¤©è¯•ç”¨ï¼Œä¸è¿‡åº”è¯¥å¯ä»¥æ¢ä¸ªé‚®ç®±å†æ³¨å†Œã€‚è¿˜æœ‰ä¸ªç¼ºç‚¹å°±æ˜¯ä½¿ç”¨ç›¸å¯¹éº»çƒ¦ï¼Œéœ€è¦ä½¿ç”¨è°·æ­Œæµè§ˆå™¨ä»¥åŠå¯¹åº”çš„æ’ä»¶ï¼Œä¸è¿‡å¥½åœ¨å®˜ç½‘éƒ½æä¾›äº†è¯¦ç»†çš„æ­¥éª¤ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p><h5 id="ç§‘ç ”é€š-www-ablesci-com"><a href="#ç§‘ç ”é€š-www-ablesci-com" class="headerlink" title="ç§‘ç ”é€š(www.ablesci.com)"></a>ç§‘ç ”é€š(<a href="http://www.ablesci.com/">www.ablesci.com</a>)</h5><p>ç±»ä¼¼äºç™¾åº¦æ–‡çŒ®äº’åŠ©</p><h5 id="ç™¾åº¦æ–‡çŒ®äº’åŠ©-å¤‡ç”¨"><a href="#ç™¾åº¦æ–‡çŒ®äº’åŠ©-å¤‡ç”¨" class="headerlink" title="ç™¾åº¦æ–‡çŒ®äº’åŠ©(å¤‡ç”¨)"></a>ç™¾åº¦æ–‡çŒ®äº’åŠ©(å¤‡ç”¨)</h5><p>ç¼ºç‚¹æ¯å¤©ä¸¤ç¯‡ï¼Œæ—¶é—´é•¿ï¼Œè¿˜ä¸ä¸€å®šæˆåŠŸã€‚</p><p>å…¶ä»–å¯ç”¨æ–¹æ³•å¯å‚è€ƒï¼š<br><a href="https://zhuanlan.zhihu.com/p/138142587">https://zhuanlan.zhihu.com/p/138142587</a></p>]]></content>
    
    
    <categories>
      
      <category>TroubleShoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>TroubleShoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python å¼‚æ­¥</title>
    <link href="/2021/08/11/Python_%E5%BC%82%E6%AD%A5/"/>
    <url>/2021/08/11/Python_%E5%BC%82%E6%AD%A5/</url>
    
    <content type="html"><![CDATA[<h2 id="Pythonä¸­å¼‚æ­¥ã€åŒæ­¥ã€å¤šè¿›ç¨‹åŠå¤šçº¿ç¨‹çš„æ¯”è¾ƒ"><a href="#Pythonä¸­å¼‚æ­¥ã€åŒæ­¥ã€å¤šè¿›ç¨‹åŠå¤šçº¿ç¨‹çš„æ¯”è¾ƒ" class="headerlink" title="Pythonä¸­å¼‚æ­¥ã€åŒæ­¥ã€å¤šè¿›ç¨‹åŠå¤šçº¿ç¨‹çš„æ¯”è¾ƒ"></a>Pythonä¸­å¼‚æ­¥ã€åŒæ­¥ã€å¤šè¿›ç¨‹åŠå¤šçº¿ç¨‹çš„æ¯”è¾ƒ</h2><span id="more"></span><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> request<br><span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> parse<br><span class="hljs-keyword">from</span> urllib.request <span class="hljs-keyword">import</span> urlopen<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-comment"># ç”¨äºå¤šè¿›ç¨‹</span><br><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process<br><span class="hljs-comment"># ç”¨äºå¤šçº¿ç¨‹</span><br><span class="hljs-keyword">from</span> threading <span class="hljs-keyword">import</span> Thread<br><span class="hljs-comment"># ç”¨äºåç¨‹+å¼‚æ­¥</span><br><span class="hljs-keyword">import</span> aiohttp<br><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">aiohttp:å¼‚æ­¥å‘é€POSTè¯·æ±‚</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">city_rule_asy</span>():</span><br>    data = &#123;<span class="hljs-string">&quot;key&quot;</span>: <span class="hljs-string">&quot;&quot;</span>&#125;<br>    myPostUrl = <span class="hljs-string">&quot;http://api.chinadatapay.com/government/traffic/2299&quot;</span><br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp.ClientSession() <span class="hljs-keyword">as</span> session:<br>        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> session.post(myPostUrl, data=data) <span class="hljs-keyword">as</span> res:<br>            <span class="hljs-comment"># print(res.status)</span><br>            <span class="hljs-keyword">return</span> json.loads(<span class="hljs-keyword">await</span> res.text())<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span>():</span><br>    tasks = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        task = asyncio.ensure_future(city_rule_asy())<br>        tasks.append(task)<br>    loop = asyncio.get_event_loop()<br>    result = loop.run_until_complete(asyncio.gather(*tasks))<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;city_rules.txt&#x27;</span>, <span class="hljs-string">&#x27;a+&#x27;</span>) <span class="hljs-keyword">as</span> fw:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> response[<span class="hljs-string">&#x27;data&#x27;</span>]:<br>           <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> i[<span class="hljs-string">&#x27;cities&#x27;</span>]:<br>                fw.write(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;j[<span class="hljs-string">&#x27;city&#x27;</span>]&#125;</span>\t<span class="hljs-subst">&#123;j[<span class="hljs-string">&#x27;engine&#x27;</span>]&#125;</span>\t<span class="hljs-subst">&#123;j[<span class="hljs-string">&#x27;prefix&#x27;</span>]&#125;</span>\t<span class="hljs-subst">&#123;j[<span class="hljs-string">&#x27;vin&#x27;</span>]&#125;</span>\t<span class="hljs-subst">&#123;j[<span class="hljs-string">&#x27;model&#x27;</span>]&#125;</span>\n&quot;</span>)<br><span class="hljs-comment">#### ============================================ ###</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">city_rule</span>():</span><br>    myPostUrl = <span class="hljs-string">&quot;http://api.chinadatapay.com/government/traffic/2299&quot;</span><br>    data = &#123;<span class="hljs-string">&quot;key&quot;</span>: <span class="hljs-string">&quot;&quot;</span>&#125;<br>    params = parse.urlencode(data).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)  <span class="hljs-comment"># æäº¤ç±»å‹ä¸èƒ½ä¸ºstrï¼Œéœ€è¦ä¸ºbyteç±»å‹</span><br>    req = request.Request(myPostUrl, params)<br>    response = json.loads(urlopen(req).read().decode())<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;city_rules.txt&#x27;</span>, <span class="hljs-string">&#x27;a+&#x27;</span>) <span class="hljs-keyword">as</span> fw:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> response[<span class="hljs-string">&#x27;data&#x27;</span>]:<br>           <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> i[<span class="hljs-string">&#x27;cities&#x27;</span>]:<br>                fw.write(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;j[<span class="hljs-string">&#x27;city&#x27;</span>]&#125;</span>\t<span class="hljs-subst">&#123;j[<span class="hljs-string">&#x27;engine&#x27;</span>]&#125;</span>\t<span class="hljs-subst">&#123;j[<span class="hljs-string">&#x27;prefix&#x27;</span>]&#125;</span>\t<span class="hljs-subst">&#123;j[<span class="hljs-string">&#x27;vin&#x27;</span>]&#125;</span>\t<span class="hljs-subst">&#123;j[<span class="hljs-string">&#x27;model&#x27;</span>]&#125;</span>\n&quot;</span>)<br><span class="hljs-comment">## å•è¿›ç¨‹å•çº¿ç¨‹åŒæ­¥</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">single_process</span>():</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        city_rule()<br><span class="hljs-comment"># å¤šè¿›ç¨‹å¹¶è¡Œ</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mul_process</span>():</span><br>    processes = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        p = Process(target=city_rule, args=())     <span class="hljs-comment"># ä¸€ä¸ªå‚æ•° args=(prameter,)</span><br>        processes.append(p)<br>        p.start()<br>    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> processes:<br>        p.join()<br><span class="hljs-comment"># å¤šçº¿ç¨‹å¹¶å‘</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">mul_thead</span>():</span><br>    threads = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        t = Thread(target=city_rule, args=())<br>        threads.append(t)<br>        t.start()<br>    <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> threads:<br>        t.join()<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment"># å¼‚æ­¥</span><br>    run()<br>    <span class="hljs-comment"># åŒæ­¥</span><br>    single_process()<br>    <span class="hljs-comment"># å¤šè¿›ç¨‹</span><br>    mul_process()<br>    <span class="hljs-comment">#å¤šçº¿ç¨‹</span><br>    mul_thead()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python Notes</title>
    <link href="/2021/02/02/Python-Notes/"/>
    <url>/2021/02/02/Python-Notes/</url>
    
    <content type="html"><![CDATA[<h2 id="Pythonå­¦ä¹ éšç¬”"><a href="#Pythonå­¦ä¹ éšç¬”" class="headerlink" title="Pythonå­¦ä¹ éšç¬”"></a>Pythonå­¦ä¹ éšç¬”</h2><span id="more"></span><h3 id="å­—å…¸è½¬dataframe"><a href="#å­—å…¸è½¬dataframe" class="headerlink" title="å­—å…¸è½¬dataframe"></a>å­—å…¸è½¬dataframe</h3><p>ä¸å®šä¹‰åˆ—åæ—¶ï¼špd.DataFrame.from_dict(data, orient=â€™indexâ€™)<br>å®šä¹‰åˆ—åæ—¶ï¼špd.DataFrame.from_dict(data, orient=â€™indexâ€™, columns=[â€˜Aâ€™, â€˜Bâ€™, â€˜Câ€™, â€˜Dâ€™])</p><h3 id="pandasç­›é€‰"><a href="#pandasç­›é€‰" class="headerlink" title="pandasç­›é€‰"></a>pandasç­›é€‰</h3><h4 id="é€‰å–æŸåˆ—å€¼ç­‰äºæŸäº›å€¼çš„è¡Œç”¨-ï¼Œä¸ç­‰äºç”¨-ï¼-ï¼Œdata-loc-data-â€˜aâ€™-â€˜oneâ€™"><a href="#é€‰å–æŸåˆ—å€¼ç­‰äºæŸäº›å€¼çš„è¡Œç”¨-ï¼Œä¸ç­‰äºç”¨-ï¼-ï¼Œdata-loc-data-â€˜aâ€™-â€˜oneâ€™" class="headerlink" title="é€‰å–æŸåˆ—å€¼ç­‰äºæŸäº›å€¼çš„è¡Œç”¨ == ï¼Œä¸ç­‰äºç”¨ ï¼= ï¼Œdata.loc[data[â€˜aâ€™] == â€˜oneâ€™]"></a>é€‰å–æŸåˆ—å€¼ç­‰äºæŸäº›å€¼çš„è¡Œç”¨ == ï¼Œä¸ç­‰äºç”¨ ï¼= ï¼Œdata.loc[data[â€˜aâ€™] == â€˜oneâ€™]</h4><h4 id="é€‰å–æŸåˆ—å€¼æ˜¯å¦æ˜¯æŸä¸€ç±»å‹çš„æ•°å€¼ç”¨-isin-å–åç”¨"><a href="#é€‰å–æŸåˆ—å€¼æ˜¯å¦æ˜¯æŸä¸€ç±»å‹çš„æ•°å€¼ç”¨-isin-å–åç”¨" class="headerlink" title="é€‰å–æŸåˆ—å€¼æ˜¯å¦æ˜¯æŸä¸€ç±»å‹çš„æ•°å€¼ç”¨ isin ,å–åç”¨ ~"></a>é€‰å–æŸåˆ—å€¼æ˜¯å¦æ˜¯æŸä¸€ç±»å‹çš„æ•°å€¼ç”¨ isin ,å–åç”¨ ~</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs language">data.loc[data[&#x27;a&#x27;].isin([&#x27;one&#x27;, &#x27;two&#x27;])]<br>data.loc[~data[&#x27;a&#x27;].isin([&#x27;one&#x27;, &#x27;two&#x27;])]<br></code></pre></td></tr></table></figure><h4 id="å¤šç§æ¡ä»¶çš„é€‰å–ç”¨-amp-data-loc-data-â€˜aâ€™-â€˜oneâ€™-amp-data-â€˜bâ€™-â€˜twoâ€™"><a href="#å¤šç§æ¡ä»¶çš„é€‰å–ç”¨-amp-data-loc-data-â€˜aâ€™-â€˜oneâ€™-amp-data-â€˜bâ€™-â€˜twoâ€™" class="headerlink" title="å¤šç§æ¡ä»¶çš„é€‰å–ç”¨ &amp; , data.loc[(data[â€˜aâ€™] == â€˜oneâ€™) &amp; (data[â€˜bâ€™] == â€˜twoâ€™)]"></a>å¤šç§æ¡ä»¶çš„é€‰å–ç”¨ &amp; , data.loc[(data[â€˜aâ€™] == â€˜oneâ€™) &amp; (data[â€˜bâ€™] == â€˜twoâ€™)]</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs language">np.linspace(start, stop, num) ##å‚æ•°ä¸ºèµ·ç‚¹ï¼Œç»ˆç‚¹ï¼Œç‚¹æ•°ï¼Œnumé»˜è®¤ä¸º50<br></code></pre></td></tr></table></figure><h3 id="æŠŠæŸåˆ—å€¼è®¾ä¸ºindexï¼Œdf-set-index-â€˜columnsâ€™-df-reset-index-é‡ç½®ç´¢å¼•"><a href="#æŠŠæŸåˆ—å€¼è®¾ä¸ºindexï¼Œdf-set-index-â€˜columnsâ€™-df-reset-index-é‡ç½®ç´¢å¼•" class="headerlink" title="æŠŠæŸåˆ—å€¼è®¾ä¸ºindexï¼Œdf.set_index(â€˜columnsâ€™)  (df.reset_index()é‡ç½®ç´¢å¼•)"></a>æŠŠæŸåˆ—å€¼è®¾ä¸ºindexï¼Œdf.set_index(â€˜columnsâ€™)  (df.reset_index()é‡ç½®ç´¢å¼•)</h3><p>dfä¸­mergeå‡½æ•°æŒ‰ é”® åˆå¹¶ï¼Œconcatå‡½æ•°æŒ‰ è½´ åˆå¹¶</p><h3 id="æŒ‰é”®-key-åˆå¹¶å¯ä»¥åˆ†ã€Œå•é”®åˆå¹¶ã€å’Œã€Œå¤šé”®åˆå¹¶ã€"><a href="#æŒ‰é”®-key-åˆå¹¶å¯ä»¥åˆ†ã€Œå•é”®åˆå¹¶ã€å’Œã€Œå¤šé”®åˆå¹¶ã€" class="headerlink" title="æŒ‰é”® (key) åˆå¹¶å¯ä»¥åˆ†ã€Œå•é”®åˆå¹¶ã€å’Œã€Œå¤šé”®åˆå¹¶ã€"></a>æŒ‰é”® (key) åˆå¹¶å¯ä»¥åˆ†ã€Œå•é”®åˆå¹¶ã€å’Œã€Œå¤šé”®åˆå¹¶ã€</h3><h3 id="å•é”®åˆå¹¶ï¼š"><a href="#å•é”®åˆå¹¶ï¼š" class="headerlink" title="å•é”®åˆå¹¶ï¼š"></a>å•é”®åˆå¹¶ï¼š</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs language">pd.merge(df1, df2, how=s, on=c ) ##c æ˜¯ df1 å’Œ df2 å…±æœ‰çš„ä¸€æ ï¼Œåˆå¹¶æ–¹å¼ (how=s) æœ‰å››ç§ï¼š<br></code></pre></td></tr></table></figure><h6 id="å·¦è¿æ¥-left-ï¼šåˆå¹¶ä¹‹åæ˜¾ç¤º-df1-çš„æ‰€æœ‰è¡Œ"><a href="#å·¦è¿æ¥-left-ï¼šåˆå¹¶ä¹‹åæ˜¾ç¤º-df1-çš„æ‰€æœ‰è¡Œ" class="headerlink" title="å·¦è¿æ¥ (left)ï¼šåˆå¹¶ä¹‹åæ˜¾ç¤º df1 çš„æ‰€æœ‰è¡Œ"></a>å·¦è¿æ¥ (left)ï¼šåˆå¹¶ä¹‹åæ˜¾ç¤º df1 çš„æ‰€æœ‰è¡Œ</h6><h6 id="å³è¿æ¥-right-ï¼šåˆå¹¶ä¹‹åæ˜¾ç¤º-df2-çš„æ‰€æœ‰è¡Œ"><a href="#å³è¿æ¥-right-ï¼šåˆå¹¶ä¹‹åæ˜¾ç¤º-df2-çš„æ‰€æœ‰è¡Œ" class="headerlink" title="å³è¿æ¥ (right)ï¼šåˆå¹¶ä¹‹åæ˜¾ç¤º df2 çš„æ‰€æœ‰è¡Œ"></a>å³è¿æ¥ (right)ï¼šåˆå¹¶ä¹‹åæ˜¾ç¤º df2 çš„æ‰€æœ‰è¡Œ</h6><h6 id="å¤–è¿æ¥-outer-ï¼šåˆå¹¶-df1-å’Œ-df2-å…±æœ‰çš„æ‰€æœ‰è¡Œ"><a href="#å¤–è¿æ¥-outer-ï¼šåˆå¹¶-df1-å’Œ-df2-å…±æœ‰çš„æ‰€æœ‰è¡Œ" class="headerlink" title="å¤–è¿æ¥ (outer)ï¼šåˆå¹¶ df1 å’Œ df2 å…±æœ‰çš„æ‰€æœ‰è¡Œ"></a>å¤–è¿æ¥ (outer)ï¼šåˆå¹¶ df1 å’Œ df2 å…±æœ‰çš„æ‰€æœ‰è¡Œ</h6><h6 id="å†…è¿æ¥-inner-ï¼šåªä¿ç•™ä¸¤ä¸ªè¡¨ä¸­å…¬å…±éƒ¨åˆ†çš„ä¿¡æ¯-é»˜è®¤æƒ…å†µ"><a href="#å†…è¿æ¥-inner-ï¼šåªä¿ç•™ä¸¤ä¸ªè¡¨ä¸­å…¬å…±éƒ¨åˆ†çš„ä¿¡æ¯-é»˜è®¤æƒ…å†µ" class="headerlink" title="å†…è¿æ¥ (inner)ï¼šåªä¿ç•™ä¸¤ä¸ªè¡¨ä¸­å…¬å…±éƒ¨åˆ†çš„ä¿¡æ¯ (é»˜è®¤æƒ…å†µ)"></a>å†…è¿æ¥ (inner)ï¼šåªä¿ç•™ä¸¤ä¸ªè¡¨ä¸­å…¬å…±éƒ¨åˆ†çš„ä¿¡æ¯ (é»˜è®¤æƒ…å†µ)</h6><h6 id="å¤šé”®åˆå¹¶-ä¿©ç»„æ•°æ®å‡æœ‰è¯¥åˆ—"><a href="#å¤šé”®åˆå¹¶-ä¿©ç»„æ•°æ®å‡æœ‰è¯¥åˆ—" class="headerlink" title="å¤šé”®åˆå¹¶(ä¿©ç»„æ•°æ®å‡æœ‰è¯¥åˆ—)"></a>å¤šé”®åˆå¹¶(ä¿©ç»„æ•°æ®å‡æœ‰è¯¥åˆ—)</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs language">pd.merge( df1, df2, how=s, on=c )  ## c æ˜¯å¤šæ ï¼ˆå¦‚ä¸€ä¸ªåˆ—è¡¨<br></code></pre></td></tr></table></figure><h3 id="å¤šé”®åˆå¹¶-ä¸¤ç»„æ•°æ®ä¸åŒçš„åˆ—åï¼‰"><a href="#å¤šé”®åˆå¹¶-ä¸¤ç»„æ•°æ®ä¸åŒçš„åˆ—åï¼‰" class="headerlink" title="å¤šé”®åˆå¹¶(ä¸¤ç»„æ•°æ®ä¸åŒçš„åˆ—åï¼‰"></a>å¤šé”®åˆå¹¶(ä¸¤ç»„æ•°æ®ä¸åŒçš„åˆ—åï¼‰</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs language">pd.merge(df1, df2, left_on = &#x27;key1&#x27;, right_on = &#x27;key2&#x27;)<br></code></pre></td></tr></table></figure><h3 id="æ’å…¥åˆ—ï¼šé™¤åœ¨æœ€å³ä¾§æ’å…¥ç”¨æ ‡ç­¾ç›´æ¥åˆ›å»ºå¤–ï¼Œå…¶ä»–åˆ—ç”¨-insert-æ–¹æ³•è¿›è¡Œæ’å…¥ï¼Œæ¯”å¦‚table-insert-0-â€™dateâ€™-date"><a href="#æ’å…¥åˆ—ï¼šé™¤åœ¨æœ€å³ä¾§æ’å…¥ç”¨æ ‡ç­¾ç›´æ¥åˆ›å»ºå¤–ï¼Œå…¶ä»–åˆ—ç”¨-insert-æ–¹æ³•è¿›è¡Œæ’å…¥ï¼Œæ¯”å¦‚table-insert-0-â€™dateâ€™-date" class="headerlink" title="æ’å…¥åˆ—ï¼šé™¤åœ¨æœ€å³ä¾§æ’å…¥ç”¨æ ‡ç­¾ç›´æ¥åˆ›å»ºå¤–ï¼Œå…¶ä»–åˆ—ç”¨.insert()æ–¹æ³•è¿›è¡Œæ’å…¥ï¼Œæ¯”å¦‚table.insert(0,â€™dateâ€™,date)"></a>æ’å…¥åˆ—ï¼šé™¤åœ¨æœ€å³ä¾§æ’å…¥ç”¨æ ‡ç­¾ç›´æ¥åˆ›å»ºå¤–ï¼Œå…¶ä»–åˆ—ç”¨.insert()æ–¹æ³•è¿›è¡Œæ’å…¥ï¼Œæ¯”å¦‚table.insert(0,â€™dateâ€™,date)</h3><p>å½“ df1 å’Œ df2 æœ‰ä¸¤ä¸ªç›¸åŒçš„åˆ— (Asset å’Œ Instrument) æ—¶ï¼Œå•å•åªå¯¹ä¸€åˆ— (Asset) åšåˆå¹¶äº§å‡ºçš„ DataFrame ä¼šæœ‰å¦ä¸€åˆ— (Instrument) é‡å¤çš„åç§°ã€‚<br>è¿™æ—¶ merge å‡½æ•°ç»™é‡å¤çš„åç§°åŠ ä¸ªåç¼€ _x, _yï¼Œä¹Ÿå¯ä»¥è®¾å®š suffixes æ¥æ”¹åç¼€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs language">pd.concat([df1,df2], axis=0, ignore_index=True)  # é»˜è®¤axis=0ï¼ˆè¡Œè¿æ¥ï¼‰<br></code></pre></td></tr></table></figure><h3 id="åˆ—ç´¢å¼•-â†’-è¡Œç´¢å¼•ï¼Œç”¨-stack-å‡½æ•°-è¡Œç´¢å¼•-â†’-åˆ—ç´¢å¼•ï¼Œç”¨-unstack-å‡½æ•°"><a href="#åˆ—ç´¢å¼•-â†’-è¡Œç´¢å¼•ï¼Œç”¨-stack-å‡½æ•°-è¡Œç´¢å¼•-â†’-åˆ—ç´¢å¼•ï¼Œç”¨-unstack-å‡½æ•°" class="headerlink" title="åˆ—ç´¢å¼• â†’ è¡Œç´¢å¼•ï¼Œç”¨ stack å‡½æ•°;è¡Œç´¢å¼• â†’ åˆ—ç´¢å¼•ï¼Œç”¨ unstack å‡½æ•°"></a>åˆ—ç´¢å¼• â†’ è¡Œç´¢å¼•ï¼Œç”¨ stack å‡½æ•°;è¡Œç´¢å¼• â†’ åˆ—ç´¢å¼•ï¼Œç”¨ unstack å‡½æ•°</h3><h3 id="æ•°æ®é€è§†ï¼š"><a href="#æ•°æ®é€è§†ï¼š" class="headerlink" title="æ•°æ®é€è§†ï¼š"></a>æ•°æ®é€è§†ï¼š</h3><p>ç”¨ pivot å‡½æ•°å°†ã€Œä¸€å¼ é•¿è¡¨ã€å˜ã€Œå¤šå¼ å®½è¡¨ã€ï¼Œ<br>ç”¨ melt å‡½æ•°å°†ã€Œå¤šå¼ å®½è¡¨ã€å˜ã€Œä¸€å¼ é•¿è¡¨ã€  # å‡½æ•° melt å®é™…æ˜¯å°†ã€Œæºè¡¨ã€è½¬åŒ–æˆ id-variable ç±»å‹çš„ DataFrame</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">data_pivot = data.pivot(index=<span class="hljs-string">&#x27;Date&#x27;</span>,columns=<span class="hljs-string">&#x27;Symbol&#x27;</span>,values=<span class="hljs-string">&#x27;Adj Close&#x27;</span>) <span class="hljs-comment">#è‹¥ä¸è®¾ç½®valueå‚æ•°ï¼Œå‰©ä¸‹çš„åˆ—éƒ½ç”¨æ¥é€è§†</span><br>melted_data = pd.melt(data, id_vars=[<span class="hljs-string">&#x27;Date&#x27;</span>,<span class="hljs-string">&#x27;Symbol&#x27;</span>])<br><span class="hljs-built_in">sorted</span>(<span class="hljs-built_in">set</span>(<span class="hljs-built_in">list</span>), key=<span class="hljs-built_in">list</span>.index)  <span class="hljs-comment">## æ¶ˆé™¤é‡å¤å…ƒç´ ä¸æ”¹å˜åŸå§‹æ•°æ®é¡ºåº</span><br><span class="hljs-built_in">sorted</span>(<span class="hljs-built_in">dict</span>.items(),key=<span class="hljs-keyword">lambda</span> x:x[<span class="hljs-number">1</span>],reverse=<span class="hljs-literal">True</span>)  <span class="hljs-comment">## å¯¹å­—å…¸æŒ‰å€¼åå‘æ’åºï¼ˆx[0]æŒ‰é”®æ’åºï¼‰</span><br></code></pre></td></tr></table></figure><h3 id="pandas-åˆ é™¤åˆ—"><a href="#pandas-åˆ é™¤åˆ—" class="headerlink" title="pandas åˆ é™¤åˆ—"></a>pandas åˆ é™¤åˆ—</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">df = df.drop([<span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>], <span class="hljs-attribute">axis</span>=1)<br><span class="hljs-comment">#æˆ–è€…</span><br>df.drop([<span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>], <span class="hljs-attribute">axis</span>=1, <span class="hljs-attribute">inplace</span>=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><h3 id="å¯¹è¡Œ-z-score-æ ‡å‡†åŒ–"><a href="#å¯¹è¡Œ-z-score-æ ‡å‡†åŒ–" class="headerlink" title="å¯¹è¡Œ z-score æ ‡å‡†åŒ–"></a>å¯¹è¡Œ z-score æ ‡å‡†åŒ–</h3><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">df.<span class="hljs-built_in">apply</span>(<span class="hljs-built_in">lambda</span> x: (x - <span class="hljs-built_in">np</span>.<span class="hljs-built_in">mean</span>(x)) / (<span class="hljs-built_in">np</span>.<span class="hljs-built_in">std</span>(x,ddof=<span class="hljs-number">1</span>)), axis=<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><h3 id="å¯¹-Majority-protein-IDs-åˆ—è½¬æˆå¤šè¡Œ"><a href="#å¯¹-Majority-protein-IDs-åˆ—è½¬æˆå¤šè¡Œ" class="headerlink" title="å¯¹ Majority protein IDs åˆ—è½¬æˆå¤šè¡Œ"></a>å¯¹ Majority protein IDs åˆ—è½¬æˆå¤šè¡Œ</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">df = df[~df[<span class="hljs-string">&#x27;Majority protein IDs&#x27;</span>].str.contains(<span class="hljs-string">&#x27;CON|REV&#x27;</span>, regex=<span class="hljs-keyword">True</span>)]<br>df = df.<span class="hljs-keyword">drop</span>(<span class="hljs-string">&#x27;Majority protein IDs&#x27;</span>, axis=<span class="hljs-number">1</span>).<span class="hljs-keyword">join</span>(df[<span class="hljs-string">&#x27;Majority protein IDs&#x27;</span>].str.split(<span class="hljs-string">&#x27;;&#x27;</span>, expand=<span class="hljs-keyword">True</span>).stack().reset_index(<span class="hljs-keyword">level</span>=<span class="hljs-number">1</span>, <span class="hljs-keyword">drop</span>=<span class="hljs-keyword">True</span>).<span class="hljs-keyword">rename</span>(<span class="hljs-string">&#x27;Majority protein IDs&#x27;</span>))<br><br>def ab(df): <br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;;&#x27;</span>.<span class="hljs-keyword">join</span>(df.<span class="hljs-keyword">values</span>)<br>newcolumns = df_merge.<span class="hljs-keyword">columns</span>.tolist()<br>newcolumns.remove(<span class="hljs-string">&#x27;Majority protein IDs&#x27;</span>)<br>newdf = df_merge.groupby(newcolumns)[<span class="hljs-string">&#x27;Majority protein IDs&#x27;</span>].apply(ab)   ## å¤šè¡Œåˆå¹¶ä¸€è¡Œ<br></code></pre></td></tr></table></figure><h3 id="forã€whileå¾ªç¯ä¸­çš„elseæ‰©å±•ç”¨æ³•"><a href="#forã€whileå¾ªç¯ä¸­çš„elseæ‰©å±•ç”¨æ³•" class="headerlink" title="forã€whileå¾ªç¯ä¸­çš„elseæ‰©å±•ç”¨æ³•"></a>forã€whileå¾ªç¯ä¸­çš„elseæ‰©å±•ç”¨æ³•</h3><p>elseä¸­çš„ç¨‹åºåªåœ¨ä¸€ç§æ¡ä»¶ä¸‹æ‰§è¡Œï¼Œå³å¾ªç¯æ­£å¸¸éå†æ‰€æœ‰å†…å®¹æˆ–è€…ç”±äºæ¡ä»¶ä¸æˆç«‹è€Œç»“æŸå¾ªç¯ï¼Œæ²¡æœ‰å› breakæˆ–è€…returnè€Œé€€å‡ºå¾ªç¯ã€‚continueå¯¹elseæ²¡å½±å“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs language">for i in range(10):<br>    if i==5:<br>        break<br>    print(&#x27;i=&#x27;,i,end=&#x27;,&#x27;)<br>else:<br>    print(&#x27;success&#x27;)#ä¸è¾“å‡º   åœ¨forå¾ªç¯ä¸­å«æœ‰breakæ—¶åˆ™ç›´æ¥ç»ˆæ­¢å¾ªç¯ï¼Œå¹¶ä¸ä¼šæ‰§è¡Œelseå­å¥ã€‚<br><br>for i in range(10):<br>    if i==5:<br>        continue<br>    print(&#x27;i=&#x27;,i,end=&#x27;,&#x27;)<br>else:<br>    print(&#x27;success&#x27;)#è¾“å‡º<br></code></pre></td></tr></table></figure><h3 id="å±•å¹³åµŒå¥—åˆ—è¡¨"><a href="#å±•å¹³åµŒå¥—åˆ—è¡¨" class="headerlink" title="å±•å¹³åµŒå¥—åˆ—è¡¨"></a>å±•å¹³åµŒå¥—åˆ—è¡¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs language">newlist = [item for items in newlist for item in items]<br>#æˆ–è€…æ‚¨å¯ä»¥åƒè¿™æ ·ä»chainä¸­ä½¿ç”¨itertools<br>from itertools import chain<br>newlist = list(chain(*newlist))<br>#æˆ–è€…æ‚¨å¯ä»¥ä½¿ç”¨chain.from_iterableï¼Œå…¶ä¸­æ— éœ€è§£å‹ç¼©åˆ—è¡¨<br>from itertools import chain<br>newlist = list(chain.from_iterable(newlist)) #æ•ˆç‡æ›´é«˜<br></code></pre></td></tr></table></figure><h3 id="ç”Ÿæˆrequirements-txt"><a href="#ç”Ÿæˆrequirements-txt" class="headerlink" title="ç”Ÿæˆrequirements.txt"></a>ç”Ÿæˆrequirements.txt</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs language">pipreqs ./ --encoding=utf-8 --force<br></code></pre></td></tr></table></figure><h3 id="å•ä¾‹"><a href="#å•ä¾‹" class="headerlink" title="å•ä¾‹"></a>å•ä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs language">class Singleton(object):<br>    __instance = None<br><br>    def __new__(cls, age, name):<br>        if not cls.__instance:<br>            cls.__instance = object.__new__(cls)<br>        return cls.__instance<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
